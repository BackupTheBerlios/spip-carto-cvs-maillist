From fxp at berlios.de  Mon Sep  5 16:47:58 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:47:58 +0200
Subject: [Spip-carto-cvs] spipcarto carto_symbol.xml,NONE,1.1
Message-ID: <200509051447.j85ElwAD005963@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv5938

Added Files:
	carto_symbol.xml 
Log Message:
SVG / Ajout du support des symboles

--- NEW FILE: carto_symbol.xml ---
		<linearGradient id="GradientLinear" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 
		<radialGradient id="GradientCircular">
			<stop id="0" offset="0%" style="stop-color:yellow"/>
			<stop id="1" offset="50%" style="stop-color:blue"/>
			<stop id="2" offset="100%" style="stop-color:white"/>         
		</radialGradient>
		<symbol id="coniferous" overflow="visible" style="fill:none;stroke:green;stroke-width:2">
			<path d="M0 -15 l0 30"/>
			<path d="M0 -15 q0 3.5 5 3.5"/>
			<path d="M0 -15 q0 3.5 -5 3.5"/>
			<path d="M0 -9 q0 6 8 6"/>
			<path d="M0 -9 q0 6 -8 6"/>
			<path d="M0 0 q0 7 10 7"/>
			<path d="M0 0 q0 7 -10 7"/>		
		</symbol>
		<symbol id="broadLeave" overflow="visible" style="fill:none;stroke:green;stroke-width:2;">
			<path d="M0 15 l0 -10"/>
			<path d="M0 5 a6 6 0 1 1 -3.5 -10 a6 6 0 1 1 7 0 a6 6 0 1 1 -3.5 10z"/>
		</symbol>
		<pattern id="pat00" patternUnits="userSpaceOnUse" width="30" height="45">
			<use xlink:href="#coniferous" transform="translate(10,15) scale(0.75)"/>
		</pattern>
		<pattern id="pat01" patternUnits="userSpaceOnUse" width="30" height="45">
			<use xlink:href="#broadLeave" transform="translate(15,20) scale(0.5)"/>
		</pattern>
		<path id="geometry" style="fill-rule:nonzero;stroke:#B42D25;stroke-width:2;" d="M0 50 l100 -50 100 20 -50 50 -100 20z"/>

 
<!-- Point Symbol -->
		<symbol id="use" overflow="visible" class="use">
		  <circle cx="0" cy="0" r="100%"/>
		</symbol>
	
<!-- Point Symbol From carto.net / Fin -->
		<!-- HOSPITAL -->
		<symbol id="usehospital" overflow="visible" style="fill:red;stroke:white;stroke-width:2" transform="translate(-15,-15) scale(50%)">
		  <path d="M0 10 l0 10 l10 0 l0 10 l10 0 l0 -10 l10 0 l0 -10 l-10 0 l0 -10 l-10 0 l0 10z"/>
		</symbol>
	
		<!-- AEROPORT -->
		<symbol id="useairport" overflow="visible" transform="scale(50%)">
                     <g transform="translate(0,-21.21) scale(0.666)">
			 <rect x="0" y="0" rx="1" ry="1" width="30" height="30" transform="rotate(45)"  style="fill:rgb(250,250,0); stroke:rgb(100,100,100);stroke-width:0.1"/>
  		  	 <path d="M-2 21.21 c0,-21.5 4,-21.5 4,0 c1 20 -5,20 -4,0" style="fill:rgb(100,100,100);stroke-width:0.1"/>
		 	 <path d="M1 14 l11 12.5 l-12 -7.5 l-12 7.5 l11 -12.5z" style="fill:rgb(100,100,100);stroke:rgb(100,100,100);stroke-width:0.1; stroke-linejoin:miter"/>
			</g>
		</symbol>
		<!-- PISCINE EXT -->
		<symbol id="usepool_indoor" overflow="visible" transform="scale(50%)">
			<g transform="translate(-16,-17.5)">
			<rect x="0" y="-2.5" rx="2" ry="2" width="32" height="35" style="fill:white"/>
			<path d="M6 7.5 l0 20 l20 0 l0 -20" style="fill:none;stroke:rgb(50,150,255);stroke-width:3"/>
			<path d="M1 10 l15 -10 l15 10" style="fill:none;stroke:rgb(50,150,255);stroke-width:3"/>
			<path d="M6 15 q5,-5 10,0 t10 0 l0 12.5 l-20 0z" style="fill:rgb(50,150,255);"/>
			</g>
		</symbol>
		<!-- PISCINE INT -->
		<symbol id="usepool_outdoor" overflow="visible" transform="scale(50%)">
			<g transform="translate(-15,-17.5)">
			  <rect x="0" y="0" rx="2" ry="2" width="30" height="32.5" style="fill:white"/>
			  <rect x="5" y="5" width="20" height="22.5" style="fill:none;stroke:rgb(50,150,255);stroke-width:3"/>
			  <path d="M5 15 q5,-5 10,0 t10 0 l0 12.5 l-20 0z" style="fill:rgb(50,150,255);"/>
			</g>
		</symbol>
		<!-- RESTAURANT -->
		<symbol id="userestaurant" overflow="visible" transform="scale(50%)">
			<g transform="translate(-16,-17.5)">
			<rect height="30" width="30" rx="1" ry="1" style="fill:rgb(0,0,0);stroke:white;stroke-width:2"/>
			<g style="fill:none;stroke:white;stroke-linecap:round">	
				<path d="M5 25 l15 -15" style="stroke-width:2.5;"/>		
				<path d="M20 10 l5 -5" style="stroke-width:1.5;"/>
				<path d="M20 10 s-3,-4 2,-7" style="stroke-width:1.5;"/>
				<path d="M20 10 s4,4 7,-2" style="stroke-width:1.5;"/>
				<path d="M4 4 l21 21" style="stroke-width:2.5;"/>
			</g>
			<path d="M12.5 12.5 c-5,5 -12,-11 -9,-9" style="fill:rgb(255,255,255)"/>
			</g>
		</symbol>
		<!-- PARKING -->
		<symbol id="usecarpark" overflow="visible" transform="scale(50%)">
			<g transform="translate(-15,-15)">		
			  <rect x="0" y="0" rx="1" ry="1" width="30" height="30" style="fill:rgb(0,0,255);stroke:white;stroke-width:2"/>
			  <text x="15" y="15" style="font-size:28;font-weight:bolder;fill:white;text-anchor:middle;baseline-shift:-35%">P</text>
			</g>
		</symbol>
<!-- Point Symbol From carto.net / Fin -->
<!-- Point Symbol -->


<!-- Weather Symbol From carto.net -->
	<symbol id="sun" overflow="visible">
  	<g>
  		<g>
  			<circle cx="0" cy="0" r="0.3" style="fill:yellow;stroke:black;stroke-width:0.05" />
  			<g id="animray">
  				<line x1="0.5" y1="0" x2="1.5" y2="0" style="fill:none;stroke:black;stroke-width:0.3">
  					<animate attributeName="x2" values="1;1.5;1" dur="10s" repeatCount="indefinite" />
  				</line>
  				<line x1="0.5" y1="0" x2="1.4" y2="0" style="fill:none;stroke:yellow;stroke-width:0.15">
  					<animate attributeName="x2" values="0.9;1.4;0.9" dur="10s" repeatCount="indefinite" />
  				</line>
  			</g>
  			<use xlink:href="#animray" transform="rotate(60)" />
  			<use xlink:href="#animray" transform="rotate(120)" />
  			<use xlink:href="#animray" transform="rotate(180)" />
  			<use xlink:href="#animray" transform="rotate(240)" />
  			<use xlink:href="#animray" transform="rotate(300)" />
  		</g>
  	</g>
	</symbol>
	<symbol id="usesun" overflow="visible" transform="scale(25%)">
  		<use xlink:href="#sun"/>
	</symbol>
  	<symbol id="userain" overflow="visible" transform="scale(25%)">
  		<path style="fill:black;stroke:none;" d="M-1.3 0 Q -0.9 -0.7 -0.7 -0.3 Q 0.2 -1.2 0.7 -0.3 Q 1 -0.7 1.3 0 z"/>
  		<g style="fill:none;stroke:mediumblue;stroke-width:0.15;stroke-dasharray:0.4,0.2">
  		<line id="rain" x1="0.2" y1="0.2" x2="-0.3" y2="1.5">
  			<animate attributeName="stroke-dashoffset" from="1" to="0" dur="1s" repeatCount="indefinite" />
  		</line>
  		<use x="-0.5" xlink:href="#rain" transform="scale(0.8)" />
  		<use x="0.5" xlink:href="#rain" transform="scale(0.8)" />
  		</g>
  	</symbol>
  	<symbol id="useclouds" overflow="visible" transform="scale(25%)">
  		<g fill="lightgray">
  			<path id="cloud" style="stroke:black;stroke-width:0.05" d="M-1.6 0 Q -1.2 -0.7 -0.9 -0.3 Q -0.1 -1.5 0.4 -0.3 Q 0.7 -0.7 1 0 z">
  			<animateTransform attributeName="transform" type="translate" from="-0.3,0" to="0.3,0" dur="5s" repeatCount="indefinite" />
  			</path>
  		</g>
  		<use style="fill:darkgray" x="0.5" y="0.5" xlink:href="#cloud" />
  	</symbol>
  	<symbol id="usesunandclouds" overflow="visible" transform="scale(50%)">
  		<use x="-0.5" y="-0.3" transform="scale(0.7)" style="fill:darkgray;" xlink:href="#cloud" />
  		<use xlink:href="#usesun" />
  		<use x="0.8" y="0.6" style="fill:white;opacity:0.9" xlink:href="#cloud" />
  	</symbol>
	<symbol id="usesunandcloud" overflow="visible" transform="scale(25%)">
  		<use xlink:href="#usesun" />
	   	<use x="0.3" y="-0.3" style="fill:white;opacity:0.9" xlink:href="#cloud" />
	</symbol>
  	<path id="snowPath" d="M0.3 -0.2 L-0.3 1.5"/>

  	<symbol id="usesnow" overflow="visible" transform="scale(25%)">
 		<g id="snowAnim">
			<text style="fill:white;stroke:black;stroke-width:0.05;font-size:2">
			<textPath method="align" startOffset="0%" xlink:href="#snowPath">
				<tspan dy="0.6">**</tspan>
				<animate attributeName="startOffset" values="0%;20%" accumulate="none" additive="replace" calcMode="linear" fill="remove" dur="5s" repeatCount="indefinite" />
			</textPath>
			</text>
   		</g>
   		<use x="-1" y="-0.2" xlink:href="#snowAnim" />
  		<path style="fill:lightgray;stroke:black;stroke-width:0.05" d="M-1.3 0 Q -0.9 -0.7 -0.7 -0.3 Q 0.2 -1.2 0.7 -0.3 Q 1 -0.7 1.3 0 z"/>
 	</symbol>

	<!-- Fog / Filter pour fond--> 
  	<filter id="myTurbulence" filterUnits="objectBoundingBox" x="0%" y="100%" width="100%" height="100%" filterRes="50">
		<feTurbulence in="SourceGraphic" seed="2" result="myTurb" baseFrequency="0.2,1" numOctaves="6" type="fractalNoise">
			<animate attributeName="baseFrequency" values="0.2,1;0.3,1;0.2,1" dur="50s" repeatCount="indefinite" stitchTiles="stitch" />
		</feTurbulence>
 		<feDiffuseLighting in="myTurb" result="myTurbLight" lighting-color="white" surfaceScale="3">
 			<feDistantLight azimuth="45" elevation="85" />
 		</feDiffuseLighting>
 		<feColorMatrix in="myTurbLight" type="matrix" values="1 1 1 0 0 1 1 1 0 0 1 1 1 0 0 0 1 0 0 0">
 			<animate attributeName="values" values="1 1 1 0 0 1 1 1 0 0 1 1 1 0 0 1 1 1 0 0;1 1 1 0 0 1 1 1 0 0 1 1 1 0 0 0 1 0 0 0;1 1 1 0 0 1 1 1 0 0 1 1 1 0 0 1 1 1 0 0" dur="10s" repeatCount="indefinite" />
  		</feColorMatrix>
  	</filter>
  	<pattern id="turbuPattern" patternContentUnits="objectBoundingBox">
		<rect x="0" y="-1" width="1" height="1" filter="url(#myTurbulence)"/>
  	</pattern> 
	<linearGradient id="fogGradient" gradientUnits="objectBoundingBox" gradientTransform="rotate(90)">
 		<stop offset="0" stop-color="white" stop-opacity="0.5">
 			<animate attributeName="stop-opacity" values="0.8;0.3;0.8" dur="10s" repeatCount="indefinite" />
 		</stop>
 		<stop offset="1" stop-color="white" stop-opacity="1" />
 	</linearGradient>

 	<symbol id="usefog" overflow="visible" transform="scale(25%)">
 		<use xlink:href="#sun" />
 		<!--<path style="fill:url(#turbuPattern);stroke:none;" d="M-1.5 1.5 Q-1.5 0 -0.5 -1 L2.5 -1 Q1 0 1 1.5z"/>-->
 		<path style="fill:url(#turbuPattern);stroke:none;" d="M-1.2 0.6 Q -2.3 0 -1.2 -0.6 C-2 -1.6 2 -1.6 1.2 -0.6 Q2.3 0 1.2 0.6C2 1.6 -2 1.6 -1.2 0.6z" />
 	</symbol>


<!-- Weather Symbol From carto.net / Fin -->




From fxp at berlios.de  Mon Sep  5 16:48:16 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:48:16 +0200
Subject: [Spip-carto-cvs] spipcarto carto_style.css,NONE,1.1
Message-ID: <200509051448.j85EmGAD005981@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv5975

Added Files:
	carto_style.css 
Log Message:
SVG / Ajout du support des symboles

--- NEW FILE: carto_style.css ---

		<style type="text/css"><![CDATA[
		.polygon {fill:red;fill-opacity:.6;}
		.polygoncat1 {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0.5;}
		.polygoncat2 {stroke-width:2;fill:url(#GradientLinear);fill-opacity:.6;}
		.use {fill:red;}
		.polyline {stroke:gray;stroke-width:5;fill:none;}
		]]></style>








From fxp at berlios.de  Mon Sep  5 16:49:10 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:49:10 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto.php3,1.16,1.17
Message-ID: <200509051449.j85EnAAD006102@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv6096/ecrire

Modified Files:
	inc_carto.php3 
Log Message:
SVG / Ajout du support des symboles

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.16
retrieving revision 1.17
diff -u -d -r1.16 -r1.17
--- inc_carto.php3	17 Aug 2005 09:17:39 -0000	1.16
+++ inc_carto.php3	5 Sep 2005 14:49:08 -0000	1.17
@@ -83,7 +83,7 @@
 			if (strcasecmp($wktGeomType,"POLYGON")==0)
 				return "polygon"; 
 			if (strcasecmp($wktGeomType,"POINT")==0)
-				return "circle"; 
+				return "use"; 
 			if (strcasecmp($wktGeomType,"LINE")==0)
 				return "polyline"; 
 		break;
@@ -158,7 +158,7 @@
  * http://www.uzine.net/spip_contrib/
  *
  */
-function wkt2coords($geometrie, $format = "HTML", $callage = "",$url_carte, $args = ""){
+function wkt2coords($geometrie, $format = "HTML", $callage = "",$url_carte, $mot_desc = "", $args = ""){
 	//recuperer geometrie
 	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));
 	$wktGeom 	= substr($geometrie,strpos($geometrie,"(")+1,-1);
@@ -171,8 +171,8 @@
 	$GeoHeight 	= $tab[2];
 	$GeoWidth 	= $tab[3];
 
-	$radius		 = 3;	// TODO : Param?tre (ou fonction du callage ?) pr?f?rable car fonction des projections 5 peut ?tre bcp trop petit
-	$rgeo 		 = $radius*$GeoWidth/$ImgWidth;
+	$radius	= 6;	// TODO : Param?tre (ou fonction du callage ?) pr?f?rable car fonction des projections 5 peut ?tre bcp trop petit
+	$rgeo 		= round($radius*$GeoWidth/$ImgWidth);
 	$callage 	= worldfile2array ($callage);
 	
 	switch ($format){
@@ -248,7 +248,7 @@
 			{  	return "points=\"".$wktGeom."\"";		
 			}elseif (strcasecmp($wktGeomType,"POINT")==0)
 			{	$coordTab = explode (" ", $wktGeom);
-				return "cx=\"".$coordTab[0]."\" cy=\"".$coordTab[1]."\" r=\"".$rgeo."\"";
+				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
 			}
 		break;
 		case "GOOGLE":



From fxp at berlios.de  Mon Sep  5 16:49:33 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:49:33 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgfile.html,1.3,1.4 carto_svgfilex.html,1.3,1.4 carto_geosvgwmsfile.html,1.3,1.4 carto_svgfile.html,1.2,1.3
Message-ID: <200509051449.j85EnXAD006144@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv6136/squelettes/template

Modified Files:
	carto_geosvgfile.html carto_svgfilex.html 
	carto_geosvgwmsfile.html carto_svgfile.html 
Log Message:
SVG / Ajout du support des symboles

Index: carto_geosvgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgfile.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto_geosvgfile.html	18 Aug 2005 06:33:33 -0000	1.3
+++ carto_geosvgfile.html	5 Sep 2005 14:49:31 -0000	1.4
@@ -369,6 +369,10 @@
 	.normalline {stroke-width:2;}
 	.mediumThickLine {stroke-width:5;}
   ]]></style>
+		<INCLURE(carto_style.css)>
+		<INCLURE(carto_symbol.xml)>
+
+
 		<!-- Symbols for checkboxes -->
 		<symbol id="checkBoxRect" overflow="visible">
 			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
@@ -471,7 +475,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" style="opacity:.6;"/></a><!-- style="fill:url(#MyGradient);"-->
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto_svgfilex.html	18 Aug 2005 06:33:33 -0000	1.3
+++ carto_svgfilex.html	5 Sep 2005 14:49:31 -0000	1.4
@@ -95,9 +95,14 @@
 	.thinline {stroke-width:1.5;}
 	.normalline {stroke-width:2;}
 	.mediumThickLine {stroke-width:5;}
-	<INCLURE(style_carto_svgfilex.css)>
+	
 	
   ]]></style>
+
+		<INCLURE(carto_style.css)>
+		<INCLURE(carto_symbol.xml)>
+
+
 		<!-- Symbols for checkboxes -->
 		<symbol id="checkBoxRect" overflow="visible">
 			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
@@ -176,13 +181,7 @@
 		<marker id="myEndArrow" overflow="visible" orient="auto">
 			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
 		</marker>
-		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
-			<stop offset="0%" style="stop-color:white"/> 
-			<stop offset="30%" style="stop-color:red"/> 
-			<stop offset="100%" style="stop-color:black"/> 
-		</linearGradient> 
-
-
+		
 	</defs>
 	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
 	
@@ -200,7 +199,7 @@
 	<!-- #DESCRIPTIF -->
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
 		 </BOUCLE_M>
@@ -270,18 +269,10 @@
 				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
 				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
 			</g>
-			<!-- third checkbox 
-			<g transform="translate(0 [(#ID_MOT|plus{60})])">
-				<use id="checkBoxDOQ" xlink:href="#checkBoxRect"
-				onclick="checkBoxScript(evt,'DOQ');"/>
-				<use id="checkCrossDOQ" xlink:href="#checkBoxCross"
-				visibility="visible"/>
-			</g>-->
 			<!-- checkbox text labels -->
 			<g class="allText normalText">
-				<text x="12" y="[(#ID_MOT|plus{26})]">Objets SPIP-CARTO</text>
-				<text x="12" y="[(#ID_MOT|plus{46})]">Image de fond</text>
-				<!-- Check for WMS <text x="12" y="[(#ID_MOT|plus{66})]">Bassin versant</text>-->
+				<text x="12" y="[(#ID_MOT|plus{26})]">Objets</text>
+				<text x="12" y="[(#ID_MOT|plus{46})]">Fond de carte</text>
 			</g>
 		</g>
 		</B_OBJ2>

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto_geosvgwmsfile.html	18 Aug 2005 06:33:33 -0000	1.3
+++ carto_geosvgwmsfile.html	5 Sep 2005 14:49:31 -0000	1.4
@@ -284,9 +284,15 @@
 			//adopt width and height of map extent
 			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
 			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
-			//adopt line width of park boundary
+			
 			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
 			
+			<BOUCLE__OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
+		 	<BOUCLE__M(MOTS){id_carto_objet}{par num titre}{doublons a}>
+			document.getElementById("spipCarto_#ID_MOT").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
+			</BOUCLE__M>
+			</BOUCLE__OBJ>
+
 			// Pour charger un claque WMS ... 
 			<BOUCLE_WMS_evt(SITES){titre_mot="WMS"}>
 			getWMS(#ID_SYNDIC);
@@ -366,6 +372,11 @@
 	.normalline {stroke-width:2;}
 	.mediumThickLine {stroke-width:5;}
   ]]></style>
+
+		<INCLURE(carto_style.css)>
+		<INCLURE(carto_symbol.xml)>
+
+
 		<!-- Symbols for checkboxes -->
 		<symbol id="checkBoxRect" overflow="visible">
 			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
@@ -468,12 +479,23 @@
 			<BOUCLE_WMS_layer(SITES){titre_mot="WMS"}>
 				<g id="#ID_SYNDIC" visibility="hidden" />
 			</BOUCLE_WMS_layer>
-
+		
+			<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
+			 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
+	 		 <!-- #DESCRIPTIF -->
+				<g id="spipCarto_#ID_MOT">
+				<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
+					<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+				</BOUCLE_OBJECT>
+				</g>
+			 </BOUCLE_M>
+			</BOUCLE_OBJ>
 			<g id="spipCartoObj">
+			
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
-				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" style="opacity:.6;"/></a><!-- style="fill:url(#MyGradient);"-->
+				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>
@@ -507,33 +529,50 @@
 		<!-- control map layer visibility with checkBoxes -->
 		<g transform="translate(590 225)">
 			<text class="allText subTitleText" x="-10" y="0">Calques :</text>
-			<!-- first checkbox -->
-			<g transform="translate(0 20)">
-				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
-				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
-			</g>
-			<!-- second checkbox -->
-			<g transform="translate(0 40)">
-				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
-				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
-			</g>
+			
+			<!-- checkbox -->
+			<BOUCLE_OBJ2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
+			 <BOUCLE_M2(MOTS){id_carto_objet}{par num titre}{doublons c}>
+				<g transform="translate(0 [(#ID_MOT|ajoute{20})])">
+					<use id="checkBoxspipCarto_#ID_MOT" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCarto_#ID_MOT');"/>
+					<use id="checkCrossspipCarto_#ID_MOT" xlink:href="#checkBoxCross" visibility="visible"/>
+				</g>
+				<g class="allText normalText">
+					<text x="12" y="[(#ID_MOT|plus{6})]">#TITRE</text>';
+				</g>
+			 </BOUCLE_M2>
+			</BOUCLE_OBJ2>
 
+
+			
 			<BOUCLE_WMS_guick(SITES){titre_mot="WMS"}{par nom_site}>
-				<g transform="translate(0 [(#COMPTEUR_BOUCLE|guiPos{40})])">
+				<g transform="translate(0 [(#COMPTEUR_BOUCLE|ajoute{20})])">
 				<use id="checkBox#ID_SYNDIC" xlink:href="#checkBoxRect" visibility="visible"
 				onclick="checkBoxScript(evt,'#ID_SYNDIC');"/>
 				<use id="checkCross#ID_SYNDIC" xlink:href="#checkBoxCross" 
 				visibility="hidden"/>
 				</g>
+				<g class="allText normalText">
+				<text x="12" y="[(#COMPTEUR_BOUCLE|plus{6})]">[(#NOM_SITE|supprimer_numero)]</text>
+				</g>
 			</BOUCLE_WMS_guick>
 			
+			<!-- first checkbox -->
+			<g transform="translate(0 [(#COMPTEUR_BOUCLE|plus{20})])">
+				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
+				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
+			</g>
+			<!-- second checkbox -->
+			<g transform="translate(0 [(#COMPTEUR_BOUCLE|plus{40})])">
+				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
+				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
+			</g>
+			
 			<!-- checkbox text labels -->
 			<g class="allText normalText">
-				<text x="12" y="26">Objets cartographiques</text>
-				<text x="12" y="46">Image de fond</text>
-				<BOUCLE_WMS_guilabel(SITES){titre_mot="WMS"}{par nom_site}>
-				<text x="12" y="[(#COMPTEUR_BOUCLE|guiPos{46})]">[(#NOM_SITE|supprimer_numero)]</text>
-				</BOUCLE_WMS_guilabel>		
+				<text x="12" y="[(#COMPTEUR_BOUCLE|plus{26})]">Objets cartographiques</text>
+				<text x="12" y="[(#COMPTEUR_BOUCLE|plus{46})]">Image de fond</text>
+						
 			</g>
 			
 			

Index: carto_svgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfile.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_svgfile.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_svgfile.html	5 Sep 2005 14:49:31 -0000	1.3
@@ -7,6 +7,10 @@
 		  <stop offset="30%" style="stop-color:red"/>
 		  <stop offset="100%" style="stop-color:black"/>
 		 </linearGradient>
+		
+		<INCLURE(carto_style.css)>
+		<INCLURE(carto_symbol.xml)>
+
 		</defs>
 		
 		<g id="background" visibility="visible">
@@ -16,7 +20,7 @@
 		 
 		<g id="mainlayer">
 		 	<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-		  		<a xlink:href="[(#URL_OBJET|url)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] style="fill:url(#myGradient);opacity:.7;"/></a>
+		  		<a xlink:href="[(#URL_OBJET|url)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 		 	</BOUCLE_objets>
 		</g>
 	</svg>



From fxp at berlios.de  Mon Sep  5 16:49:55 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:49:55 +0200
Subject: [Spip-carto-cvs] spipcarto style_carto_svgfilex.css,1.1,NONE
Message-ID: <200509051449.j85EntAD006192@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv6186

Removed Files:
	style_carto_svgfilex.css 
Log Message:
SVG / Ajout du support des symboles

--- style_carto_svgfilex.css DELETED ---



From fxp at berlios.de  Mon Sep  5 16:50:52 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:50:52 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.15,1.16
Message-ID: <200509051450.j85EoqAD006268@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv6254/ecrire

Modified Files:
	carte_edit.php3 
Log Message:
SVG / Ajout du support des symboles

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.15
retrieving revision 1.16
diff -u -d -r1.15 -r1.16
--- carte_edit.php3	18 Aug 2005 06:32:19 -0000	1.15
+++ carte_edit.php3	5 Sep 2005 14:50:49 -0000	1.16
@@ -163,8 +163,7 @@
 	icone_horizontale( _L('Image avec liens'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
 	icone_horizontale( _L('Image avec logos'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
 	icone_horizontale( _L('SVG simple'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('SVG x'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('SVG avec zoom'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvg&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _L('SVG avec zoom'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
 	icone_horizontale( _L('SVG avec zoom et services web (WMS)'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
 }
 echo "</div>\n";



From fxp at berlios.de  Mon Sep  5 16:51:03 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 5 Sep 2005 16:51:03 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template style_carto_svgfilex.css,1.1,NONE
Message-ID: <200509051451.j85Ep3AD006354@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv6328/squelettes/template

Removed Files:
	style_carto_svgfilex.css 
Log Message:
SVG / Ajout du support des symboles

--- style_carto_svgfilex.css DELETED ---



From fxp at berlios.de  Tue Sep  6 07:41:44 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Tue, 6 Sep 2005 07:41:44 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgfile.html,1.4,1.5 carto_svgfilex.html,1.4,1.5 carto_geosvgwmsfile.html,1.4,1.5 carto_svgfile.html,1.3,1.4
Message-ID: <200509060541.j865fiAD003256@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv3114/squelettes/template

Modified Files:
	carto_geosvgfile.html carto_svgfilex.html 
	carto_geosvgwmsfile.html carto_svgfile.html 
Log Message:
SVG / Ajout header

Index: carto_geosvgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgfile.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carto_geosvgfile.html	5 Sep 2005 14:49:31 -0000	1.4
+++ carto_geosvgfile.html	6 Sep 2005 05:41:39 -0000	1.5
@@ -1,4 +1,9 @@
-<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
+<?php 
+header("Content-type: image/svg+xml");
+echo '<'.'?xml version="1.0" encoding="#CHARSET" standalone="no"?'.">\n"; 
+?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/SVG/DTD/svg10.dtd">
+
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <svg width="100%" height="100%" viewBox="0 0 850 590" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
 	<script type="text/ecmascript" xlink:href="helper_functions.js"/>

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carto_svgfilex.html	5 Sep 2005 14:49:31 -0000	1.4
+++ carto_svgfilex.html	6 Sep 2005 05:41:40 -0000	1.5
@@ -1,4 +1,8 @@
-<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
+<?php 
+header("Content-type: image/svg+xml");
+echo '<'.'?xml version="1.0" encoding="#CHARSET" standalone="no"?'.">\n"; 
+?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/SVG/DTD/svg10.dtd">
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <svg width="100%" height="100%" viewBox="0 0 760 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
 	<script type="text/ecmascript" xlink:href="helper_functions.js"/>

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carto_geosvgwmsfile.html	5 Sep 2005 14:49:31 -0000	1.4
+++ carto_geosvgwmsfile.html	6 Sep 2005 05:41:40 -0000	1.5
@@ -1,4 +1,8 @@
-<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
+<?php 
+header("Content-type: image/svg+xml");
+echo '<'.'?xml version="1.0" encoding="#CHARSET" standalone="no"?'.">\n"; 
+?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/SVG/DTD/svg10.dtd">
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <svg width="100%" height="100%" viewBox="0 0 850 590" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
 	<script type="text/ecmascript" xlink:href="helper_functions.js"/>

Index: carto_svgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfile.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto_svgfile.html	5 Sep 2005 14:49:31 -0000	1.3
+++ carto_svgfile.html	6 Sep 2005 05:41:40 -0000	1.4
@@ -1,4 +1,8 @@
-<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
+<?php 
+header("Content-type: image/svg+xml");
+echo '<'.'?xml version="1.0" encoding="#CHARSET" standalone="no"?'.">\n"; 
+?>
+<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.0//EN" "http://www.w3.org/TR/SVG/DTD/svg10.dtd">
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 	<svg viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve">
 		<defs>



From stef at berlios.de  Wed Sep  7 17:01:56 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 7 Sep 2005 17:01:56 +0200
Subject: [Spip-carto-cvs] spipcarto/formulaires formulaire_ecrire_auteur.html,1.3,1.4 inc-formulaire_forum.php3,1.5,1.6 formulaire_admin.html,1.6,1.7 inc-formulaire_ecrire_auteur.php3,1.3,1.4
Message-ID: <200509071501.j87F1uAD032305@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/formulaires
In directory sheep:/tmp/cvs-serv32010/formulaires

Modified Files:
	formulaire_ecrire_auteur.html inc-formulaire_forum.php3 
	formulaire_admin.html inc-formulaire_ecrire_auteur.php3 
Log Message:
spip 1.8.2d

Index: formulaire_ecrire_auteur.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_ecrire_auteur.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- formulaire_ecrire_auteur.html	3 Mar 2005 14:53:17 -0000	1.3
+++ formulaire_ecrire_auteur.html	7 Sep 2005 15:01:54 -0000	1.4
@@ -1,8 +1,25 @@
 [<br />(#ENV*{sujetko})<:form_prop_indiquer_sujet:><br />&nbsp;][
 <br />(#ENV*{mailko})<:form_prop_indiquer_email:><br /><br />
-]<form action="[(#ENV{action})]" method='post'>[
-<input type="hidden" name="id_formulaire_ecrire_auteur" value="(#ENV{valide})" />]
-<p><label><:form_pet_votre_email:>
+]
+
+<form action="#SELF" method='post'>
+
+[(#REM) Previsualisation ... ]
+[<input type="hidden" name="num_formulaire_ecrire_auteur" value="(#ENV{valide})" />]
+[<div class='spip_encadrer'>
+<i>[(#ENV{mail})]</i> - <strong>[(#ENV{sujet})]</strong>
+<div>
+[(#ENV{texte}|nl2br)]
+</div>
+<div style="text-align:#LANG_RIGHT;">
+	<input type="submit"  class="spip_bouton" name="confirmer[(#ENV{id})]"
+		 value="(#ENV{boutonconfirmation})" />
+</div>
+</div>
+]
+
+[(#REM) Formulaire normal   ]
+<p><label><:form_pet_votre_email:><br />
 <input type="text" class="forml" name="email_message_auteur[(#ENV{id})]"
 	value="[(#ENV{mail})]" size="30" />
 </label></p>
@@ -13,8 +30,9 @@
 <p>
 <textarea name="texte_message_auteur[(#ENV{id})]" rows='10' class='forml' cols='40'>[(#ENV{texte})]</textarea>
 </p>
-<div align="right">
+<div style="text-align:#LANG_RIGHT;">
 	<input type="submit"  class="spip_bouton" name="valide"
 		 value="[(#ENV{bouton})]" />
 </div>
+
 </form>

Index: inc-formulaire_forum.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_forum.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-formulaire_forum.php3	21 Jul 2005 21:47:12 -0000	1.5
+++ inc-formulaire_forum.php3	7 Sep 2005 15:01:54 -0000	1.6
@@ -391,7 +391,7 @@
 
 	if ($r) {
 		list($titre) = spip_fetch_array(spip_query($r));
-		$titre = '> ' . supprimer_numero(preg_replace('/^[> ]*/', '', $titre));
+		$titre = supprimer_numero($titre);
 	} else {
 		$titre = _T('forum_titre_erreur');
 		$table = '';

Index: formulaire_admin.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_admin.html,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- formulaire_admin.html	19 Aug 2005 00:25:30 -0000	1.6
+++ formulaire_admin.html	7 Sep 2005 15:01:54 -0000	1.7
@@ -1,4 +1,4 @@
-<div [class="(#ENV{divclass})" ]dir='#LANG_DIR'>[
+<div [class="(#ENV{divclass,spip-admin-bloc})" ]dir='#LANG_DIR'>[
 	<a href='(#ENV{analyser})' class='spip-admin-boutons'><:analyse_xml:>[(#ENV{xhtml_error}|?{' *',''})]</a>][
 	<a href='ecrire/articles.php3?id_article=(#ENV{id_article})' class='spip-admin-boutons'><:admin_modifier_article:> ([(#ENV{id_article})])</a>][
 	<a href='ecrire/breves_voir.php3?id_breve=(#ENV{id_breve})' class='spip-admin-boutons'><:admin_modifier_breve:> ([(#ENV{id_breve})])</a>][

Index: inc-formulaire_ecrire_auteur.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_ecrire_auteur.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc-formulaire_ecrire_auteur.php3	3 Mar 2005 14:53:17 -0000	1.3
+++ inc-formulaire_ecrire_auteur.php3	7 Sep 2005 15:01:54 -0000	1.4
@@ -56,24 +56,18 @@
 
 	// doit-on envoyer le mail ?
 	if ($validable
-	AND $id == _request('id_formulaire_ecrire_auteur')) { 
-		$texte .= "\n\n-- "._T('envoi_via_le_site')." ".lire_meta('nom_site')." (".lire_meta('adresse_site')."/) --\n";
+	AND $id == _request('num_formulaire_ecrire_auteur')
+	AND _request('confirmer'.$id)) { 
+		$texte .= "\n\n-- "._T('envoi_via_le_site')." ".supprimer_tags(extraire_multi(lire_meta('nom_site')))." (".lire_meta('adresse_site')."/) --\n";
 		include_ecrire("inc_mail.php3");
 		envoyer_mail($mail, $sujet, $texte, $adres,
 				"X-Originating-IP: ".$GLOBALS['REMOTE_ADDR']);
 		return _T('form_prop_message_envoye');
 	}
 
-	$link = new Link;
-	$link->delVar('sujet_message_auteur'.$id);
-	$link->delVar('texte_message_auteur'.$id);
-	$link->delVar('email_message_auteur'.$id);
-	$link->delVar('id_formulaire_ecrire_auteur');
-
 	return 
 		array('formulaire_ecrire_auteur', 0,
 			array(
-			'action' => $link->getUrl(),
 			'id' => $id,
 			'mailko' => $mailko ? $puce : '',
 			'mail' => $adres,
@@ -81,9 +75,10 @@
 			'sujet' => $sujet,
 			'texte' => $texte,
 			'valide' => ($validable ? $id : ''),
-			'bouton' => ($validable ?
+			'bouton' => (_T('form_prop_envoyer')),
+			'boutonconfirmation' => ($validable ?
 				_T('form_prop_confirmer_envoi') :
-				_T('form_prop_envoyer'))
+				'')
 			)
 		);
 }



From stef at berlios.de  Wed Sep  7 17:01:56 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 7 Sep 2005 17:01:56 +0200
Subject: [Spip-carto-cvs] spipcarto inc-html-squel.php3,1.8,1.9 inc-balises.php3,1.10,1.11 inc-criteres.php3,1.8,1.9 spip_image.php3,1.4,1.5 agenda_mois.php3,1.1,NONE agenda_jour.php3,1.1,NONE agenda_semaine.php3,1.1,NONE
Message-ID: <200509071501.j87F1uAD032286@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv32010

Modified Files:
	inc-html-squel.php3 inc-balises.php3 inc-criteres.php3 
	spip_image.php3 
Removed Files:
	agenda_mois.php3 agenda_jour.php3 agenda_semaine.php3 
Log Message:
spip 1.8.2d

Index: inc-html-squel.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-html-squel.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- inc-html-squel.php3	18 Aug 2005 23:28:34 -0000	1.8
+++ inc-html-squel.php3	7 Sep 2005 15:01:53 -0000	1.9
@@ -195,7 +195,8 @@
 	  if (!$match[1])
 	    erreur_squelette(_T('zbug_info_erreur_squelette'), $texte);
 	  // pas d'arg et pas d'autres filtres ==> critere infixe comme "/"
-          if ((!$suite) || strpos(")|", $suite[0]) === false) break;
+          if (($fin != ':') &&
+	      ((!$suite) || strpos(")|", $suite[0]) === false)) break;
 	} else {
 	$args = ltrim(substr($suite,1)); 
 	$collecte = array();

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -d -r1.10 -r1.11
--- inc-balises.php3	19 Aug 2005 00:49:28 -0000	1.10
+++ inc-balises.php3	7 Sep 2005 15:01:53 -0000	1.11
@@ -59,8 +59,7 @@
 		'URL_SITE_SPIP' => 'htmlspecialchars(vider_url(%s))',
 		'URL_SITE' => 'htmlspecialchars(vider_url(%s))',
 		'URL_SYNDIC' => 'htmlspecialchars(vider_url(%s))',
-		'ENV' => 'entites_html(%s)',
-		'URL_OBJET' => 'htmlspecialchars(vider_url(%s))'
+		'ENV' => 'entites_html(%s)'
 	);
 	$ps = $traitements[$p->nom_champ];
 	if (!$ps) return $p->code;

Index: inc-criteres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-criteres.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- inc-criteres.php3	18 Aug 2005 23:28:34 -0000	1.8
+++ inc-criteres.php3	7 Sep 2005 15:01:53 -0000	1.9
@@ -220,6 +220,13 @@
 		else if ($par == 'type_mot'){
 		  $order= "'mots.type'";
 		}
+    // par multi champ
+    else if (ereg("^multi[[:space:]]*(.*)$",$par, $m)) {
+        $texte = $boucle->id_table . '.' . trim($m[1]);
+        $boucle->select[] =  " \".creer_objet_multi('".$texte."', \$GLOBALS['spip_lang']).\"" ;
+        $order = "multi";
+    }
+	
 	// par num champ(, suite)
 		else if (ereg("^num[[:space:]]*(.*)$",$par, $m)) {
 		  $texte = '0+' . $boucle->id_table . '.' . trim($m[1]);

Index: spip_image.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_image.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_image.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ spip_image.php3	7 Sep 2005 15:01:53 -0000	1.5
@@ -116,7 +116,7 @@
 	//
 	// Upload d'un ZIP
 	//
-    if (function_exists('gzopen')) {
+	if (function_exists('gzopen') AND !($mode == 'distant')) {
 
 		// traiter la reponse de l'utilisateur ('telquel' ou 'decompacter')
 		if ($_POST['source_zip']
@@ -162,6 +162,7 @@
 				else if ($action_zip == 'decompacter') {
 					// 1. on deballe
 					define('_tmp_dir', creer_repertoire_documents($hash));
+					if (_tmp_dir == _DIR_DOC) die(_L('Op&eacute;ration impossible'));
 					$archive->extract(
 						PCLZIP_OPT_PATH, _tmp_dir,
 						PCLZIP_CB_PRE_EXTRACT, 'callback_deballe_fichier'

--- agenda_mois.php3 DELETED ---

--- agenda_jour.php3 DELETED ---

--- agenda_semaine.php3 DELETED ---



From stef at berlios.de  Wed Sep  7 17:01:56 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 7 Sep 2005 17:01:56 +0200
Subject: [Spip-carto-cvs] spipcarto/dist agenda.html,1.2,1.3 agenda_jour.html,1.1,1.2 agenda_mois.html,1.1,1.2
Message-ID: <200509071501.j87F1uAD032319@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/dist
In directory sheep:/tmp/cvs-serv32010/dist

Modified Files:
	agenda.html agenda_jour.html agenda_mois.html 
Log Message:
spip 1.8.2d

Index: agenda.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/agenda.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- agenda.html	19 Aug 2005 00:13:23 -0000	1.2
+++ agenda.html	7 Sep 2005 15:01:54 -0000	1.3
@@ -8,5 +8,5 @@
 <script type="text/javascript" src="ecrire/presentation.js"></script>
 </head><body>
 [(#ENV{type, mois}|agenda_connu)<INCLURE(page.php3)
- {fond=agenda_#ENV{type,mois}}{type}{delais=900}{annee}{mois}{jour}{echelle}{partie_cal}>]
+ {fond=agenda_#ENV{type,mois}}{type}{delais=900}{annee}{mois}{jour}{echelle}{partie_cal}{theme}>]
 </body></html>

Index: agenda_jour.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/agenda_jour.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- agenda_jour.html	19 Aug 2005 00:13:23 -0000	1.1
+++ agenda_jour.html	7 Sep 2005 15:01:54 -0000	1.2
@@ -1,7 +1,52 @@
 <BOUCLE_jour(ARTICLES)
     {agenda date, jour, #ENV{annee}, #ENV{mois}, #ENV{jour}}{par date}
 >[(#DATE|agenda_memo{#DESCRIPTIF, #TITRE, #URL_ARTICLE, 
-  [(#COMPTEUR_BOUCLE|
-	alterner{'calendrier-couleur1', 'calendrier-couleur3'})]})]</BOUCLE_jour>[(#TOTAL_BOUCLE|
-	agenda_affiche{<:aucun_article:>, 'jour', 'calendrier-couleur1', 'calendrier-couleur3'}
-)]<//B_jour>
\ No newline at end of file
+  calendrier-couleur[(#ENV{theme,0}|modulo{14,1})]})]</BOUCLE_jour>[(#TOTAL_BOUCLE|agenda_affiche{<:aucun_article:>, 'jour', 
+  calendrier-couleur[(#ENV{theme,0}|modulo{14,1})]})
+<div style='position: fixed; top:50px; left: 20px'>
+<table style='width: 10px'><tr>
+<td class='calendrier-couleur1'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,0})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur2'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,1'})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur3'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,2})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur4'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,3})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur5'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,4})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur6'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,5'})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur7'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,6})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur8'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,7})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur9'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,8})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur10'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,9})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur11'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,10})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur12'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,11})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur13'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,12})]'>&nbsp;&nbsp;</a></td></tr>
+<tr><td class='calendrier-couleur14'
+    ><a style='text-decoration: none;'
+	href='[(#SELF|parametre_url{theme,13})]'>&nbsp;&nbsp;</a></td></tr>
+</table>
+</div>
+]<//B_jour>

Index: agenda_mois.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/agenda_mois.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- agenda_mois.html	19 Aug 2005 00:13:23 -0000	1.1
+++ agenda_mois.html	7 Sep 2005 15:01:54 -0000	1.2
@@ -1,5 +1,9 @@
 <BOUCLE_mois(ARTICLES)
-    {agenda date, mois, #ENV{annee}, #ENV{mois}}{par date}>[
-(#DATE|agenda_memo{#DESCRIPTIF, #TITRE, #URL_ARTICLE,'calendrier-couleur5'})]</BOUCLE_mois>[(#TOTAL_BOUCLE|
-	agenda_affiche{<:aucun_article:>, 'mois', 'calendrier-couleur5'}
+    {agenda date, mois, #ENV{annee}, #ENV{mois}}{par date}
+>[(#DATE|agenda_memo{#DESCRIPTIF,
+		#TITRE,
+		#URL_ARTICLE,
+		calendrier-couleur[(#ID_SECTEUR|
+			modulo{14,1})]})]</BOUCLE_mois>[(#TOTAL_BOUCLE|
+	agenda_affiche{<:aucun_article:>, 'mois'}
 )]<//B_mois>



From stef at berlios.de  Wed Sep  7 17:01:55 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 7 Sep 2005 17:01:55 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire naviguer.php3,1.5,1.6 inc_index.php3,1.4,1.5 rubriques_edit.php3,1.5,1.6 js_menu_rubriques.php,1.5,1.6 inc_mots.php3,1.5,1.6 inc_majbase.php3,1.6,1.7 inc_calendrier.php,1.10,1.11 inc_serialbase.php3,1.4,1.5 inc_texte.php3,1.10,1.11 inc_debug_sql.php3,1.8,1.9 inc_sites.php3,1.7,1.8 auteurs.php3,1.3,1.4 delete_all.php3,1.2,1.3 inc_acces.php3,1.6,1.7 inc_getdocument.php3,1.6,1.7 mots_tous.php3,1.4,1.5 aide_index.php3,1.5,1.6 mots_edit.php3,1.5,1.6 pclzip.lib.php,1.4,1.5 engines-list.txt,1.3,1.4 inc_filtres.php3,1.9,1.10 inc_flock.php3,1.4,1.5 inc_version.php3,1.11,1.12 inc_db_mysql.php3,1.5,1.6 inc_lang.php3,1.9,1.10 inc_presentation.php3,1.11,1.12 optimiser.php3,1.1,NONE
Message-ID: <200509071501.j87F1tAD032254@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv32010/ecrire

Modified Files:
	naviguer.php3 inc_index.php3 rubriques_edit.php3 
	js_menu_rubriques.php inc_mots.php3 inc_majbase.php3 
	inc_calendrier.php inc_serialbase.php3 inc_texte.php3 
	inc_debug_sql.php3 inc_sites.php3 auteurs.php3 delete_all.php3 
	inc_acces.php3 inc_getdocument.php3 mots_tous.php3 
	aide_index.php3 mots_edit.php3 pclzip.lib.php engines-list.txt 
	inc_filtres.php3 inc_flock.php3 inc_version.php3 
	inc_db_mysql.php3 inc_lang.php3 inc_presentation.php3 
Removed Files:
	optimiser.php3 
Log Message:
spip 1.8.2d

Index: naviguer.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/naviguer.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- naviguer.php3	10 Aug 2005 12:00:38 -0000	1.5
+++ naviguer.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -59,7 +59,7 @@
 			$champs_extra = ", extra = '".addslashes(extra_recup_saisie("rubriques"))."'";
 		} 
 		spip_query("UPDATE spip_rubriques SET " .
-(acces_rubrique($id_parent) ? "id_parent=\"$id_parent\"," : "") . "
+(acces_rubrique($id_parent) ? "id_parent='$id_parent'," : "") . "
 titre='" . addslashes($titre) ."',
 descriptif='" . addslashes($descriptif) . "',
 texte='" . addslashes($texte) . "'
@@ -390,7 +390,7 @@
 
 if ($connect_statut == "0minirezo" AND $options == 'avancees') {
 	afficher_articles(_T('info_tous_articles_en_redaction'),
-		"WHERE statut=\"prepa\" AND id_rubrique='$id_rubrique' ORDER BY date DESC");
+		"WHERE statut='prepa' AND id_rubrique='$id_rubrique' ORDER BY date DESC");
 }
 
 
@@ -398,7 +398,7 @@
 /////////////////////////
 
 afficher_articles(_T('info_tous_articles_presents'),
-	"WHERE statut=\"publie\" AND id_rubrique='$id_rubrique' ORDER BY date DESC", true);
+	"WHERE statut='publie' AND id_rubrique='$id_rubrique' ORDER BY date DESC", true);
 
 if ($id_rubrique > 0){
 	echo "<div align='$spip_lang_right'>";

Index: inc_index.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_index.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_index.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ inc_index.php3	7 Sep 2005 15:01:53 -0000	1.5
@@ -180,7 +180,7 @@
 				spip_auteurs_".table_objet($objet)." AS lien
 				WHERE lien.".id_table_objet($objet)."=$id_objet
 				AND auteurs.id_auteur=lien.id_auteur");
-			while ($row_doc = spip_fetch_array($r)) {
+			while ($row = spip_fetch_array($r)) {
 				indexer_chaine($row['nom'], 1 * $valeur, 2);
 			}
 			break;

Index: rubriques_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/rubriques_edit.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- rubriques_edit.php3	21 Jul 2005 21:47:15 -0000	1.5
+++ rubriques_edit.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -59,6 +59,7 @@
 			else {
 			}
 
+			$titre = couper(supprimer_tags(typo(extraire_multi($titre)))." ", 50);
 			if ($statut_rubrique!='publie') $titre = "($titre)";
 			if (lire_meta('multi_rubriques') == 'oui' AND $langue_choisie_rub == "oui") $titre = $titre." [".traduire_nom_langue($lang_rub)."]";
 

Index: js_menu_rubriques.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/js_menu_rubriques.php,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- js_menu_rubriques.php	10 Aug 2005 12:00:38 -0000	1.5
+++ js_menu_rubriques.php	7 Sep 2005 15:01:53 -0000	1.6
@@ -128,7 +128,7 @@
 		$ret .= '<div class=\"bandeau_rub\" style=\"z-index: '.($z+1).';\" id=\"b_'.$id_rubrique.'\">';
 		
 		$ret .= '<table cellspacing=\"0\" cellpadding=\"0\"><tr><td valign=\"top\">';		
-		$ret .= "<div class='bandeau_rubriques' style='width: 170px;'>";
+		$ret .= "<div  style='width: 170px;'>";
 		foreach( $arr_rub as $id_rub => $titre_rub) {
 			$count_ligne ++;
 			
@@ -136,7 +136,7 @@
 				$count_ligne = 0;
 				$ret .= "</div>";
 				$ret .= '</td><td>&nbsp;</td><td valign=\"top\">';
-				$ret .= "<div class='bandeau_rubriques' style='width: 170px;'>";
+				$ret .= "<div  style='width: 170px;'>";
 
 			}
 		

Index: inc_mots.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_mots.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_mots.php3	21 Jul 2005 21:47:15 -0000	1.5
+++ inc_mots.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -237,7 +237,7 @@
 			echo "<div style='width: 200px;'>";
 			$retour = urlencode($GLOBALS['clean_link']->getUrl());
 			$titre = urlencode($cherche_mot);
-			icone_horizontale(_T('icone_creer_mot_cle'), "mots_edit.php3?new=oui&ajouter_id_article=$id_objet&titre=$titre&redirect=$retour", "mot-cle-24.gif", "creer.gif");
+			icone_horizontale(_T('icone_creer_mot_cle'), "mots_edit.php3?new=oui&ajouter_id_article=$id_objet&table=$table&id_table=$id_table&titre=$titre&redirect=$retour", "mot-cle-24.gif", "creer.gif");
 			echo "</div> ";
 		}
 
@@ -304,15 +304,15 @@
 		
 			$id_mot = $row['id_mot'];
 			$titre_mot = $row['titre'];
-			$type_mot = typo($row['type']);
 			$descriptif_mot = $row['descriptif'];
 			$id_groupe = $row['id_groupe'];
-	
 			$query_groupe = "SELECT * FROM spip_groupes_mots WHERE id_groupe = $id_groupe";
 			$result_groupe = spip_query($query_groupe);
 			while($row_groupe = spip_fetch_array($result_groupe)) {
 				$id_groupe = $row_groupe['id_groupe'];
 				$titre_groupe = entites_html($row_groupe['titre']);
+				// On recupere le typo_mot ici, et non dans le mot-cle lui-meme; sinon bug avec arabe
+				$type_mot = typo($row_groupe['titre']);
 				$unseul = $row_groupe['unseul'];
 				$obligatoire = $row_groupe['obligatoire'];
 				$acces_admin =  $row_groupe['minirezo'];
@@ -398,7 +398,9 @@
 	if ($id_groupes_vus) $id_groupes_vus = join($id_groupes_vus, ",");
 	else $id_groupes_vus = "0";
 
-	$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND ".substr($connect_statut,1)." = 'oui' AND obligatoire = 'oui' AND id_groupe NOT IN ($id_groupes_vus)";
+	$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' 
+	AND ".substr($connect_statut,1)." = 'oui' AND obligatoire = 'oui' 
+	AND id_groupe NOT IN ($id_groupes_vus)";
 	$nb_groupes = spip_num_rows(spip_query($query_groupes));
 
 	//
@@ -435,7 +437,10 @@
 
 		echo "<table border='0' width='100%' style='text-align: $spip_lang_right'>";
 
-		$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND ".substr($connect_statut,1)." = 'oui' AND (unseul != 'oui'  OR (unseul = 'oui' AND id_groupe NOT IN ($id_groupes_vus))) ORDER BY titre";
+		$query_groupes = "SELECT *, ".creer_objet_multi ("titre", "$spip_lang")." FROM spip_groupes_mots WHERE $table = 'oui'
+		AND ".substr($connect_statut,1)." = 'oui' AND (unseul != 'oui'  OR
+		(unseul = 'oui' AND id_groupe NOT IN ($id_groupes_vus)))
+		ORDER BY multi";
 		$result_groupes = spip_query($query_groupes);
 
 		// Afficher un menu par groupe de mots
@@ -524,7 +529,7 @@
 			echo "<tr><td></td><td colspan='2'>";
 			echo "<div style='width: 200px;'>";
 			$retour = urlencode($GLOBALS['clean_link']->getUrl());
-			icone_horizontale(_T('icone_creer_mot_cle'), "mots_edit.php3?new=oui&ajouter_id_article=$id_objet&redirect=$retour", "mot-cle-24.gif", "creer.gif");
+			icone_horizontale(_T('icone_creer_mot_cle'), "mots_edit.php3?new=oui&ajouter_id_article=$id_objet&table=$table&id_table=$id_table&redirect=$retour", "mot-cle-24.gif", "creer.gif");
 			echo "</div> ";
 			echo "</td></tr>";
 		}

Index: inc_majbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_majbase.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_majbase.php3	10 Aug 2005 12:00:38 -0000	1.6
+++ inc_majbase.php3	7 Sep 2005 15:01:53 -0000	1.7
@@ -1034,6 +1034,17 @@
 		maj_version(1.820);
 	}
 
+	// reindexer les articles (on avait oublie les auteurs)
+	if ($version_installee < 1.821) {
+		spip_query("UPDATE spip_articles SET idx='1' WHERE idx='oui'");
+		maj_version(1.821);
+	}
+	// le ?type? des mots doit etre du texte, sinon on depasse en champ multi
+	if ($version_installee < 1.822) {
+		spip_query("ALTER TABLE spip_mots DROP INDEX type");
+		spip_query("ALTER TABLE spip_mots CHANGE type type TEXT NOT NULL");
+		maj_version(1.822);
+	}
 
 	return true;
 }

Index: inc_calendrier.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_calendrier.php,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -d -r1.10 -r1.11
--- inc_calendrier.php	18 Aug 2005 23:28:33 -0000	1.10
+++ inc_calendrier.php	7 Sep 2005 15:01:53 -0000	1.11
@@ -16,6 +16,7 @@
 define("_ECRIRE_INC_CALENDRIER", "1");
 
 include_ecrire("inc_texte.php3");
+charger_generer_url();
 
 //  Typographie generale des calendriers de 3 type: jour/semaine/mois(ou plus)
 
@@ -25,20 +26,6 @@
 
 define(DEFAUT_D_ECHELLE,120); # 1 pixel = 2 minutes
 
-// Ecrire cookies
-
-if ($GLOBALS['set_echelle'] > 0) {
-	spip_setcookie('spip_calendrier_echelle', floor($GLOBALS['set_echelle']), time() + 365 * 24 * 3600);
-	$GLOBALS['echelle'] = floor($GLOBALS['set_echelle']);
-} else 
-	$GLOBALS['echelle'] = $GLOBALS['_COOKIE']['spip_calendrier_echelle'];
-
-if ($GLOBALS['set_partie_cal']) {
-	spip_setcookie('spip_partie_cal', $GLOBALS['set_partie_cal'], time() + 365 * 24 * 3600);
-	$GLOBALS['partie_cal'] = $GLOBALS['set_partie_cal'];
-} else 
-	$GLOBALS['partie_cal'] = $GLOBALS['_COOKIE']['spip_partie_cal'];
-
 // icones standards, fonction de la direction de la langue
 
 global $bleu, $vert, $jaune;
@@ -61,20 +48,28 @@
 	  $ancre = $m[2];
   } else { $ancre = ''; }
   if ($script[strlen($script)-1] == '?')  $script = substr($script,0,-1);
-  foreach(array('echelle','jour','mois','annee', 'type', 'set_echelle', 'set_partie_cal') as $arg) {
+  foreach(array('echelle','jour','mois','annee', 'type', 'partie_cal') as $arg) {
 		$script = preg_replace("/([?&])$arg=[^&]*&/",'\1', $script);
 		$script = preg_replace("/([?&])$arg=[^&]*$/",'\1', $script);
 	}
   return array($script, $ancre);
 }
 
-function calendrier_args_date($annee, $mois, $jour) 
+// tous les liens de navigations sont issus de cette fonction
+// on peut definir generer_url_date et un htacces pour simplifier les URL
+
+function calendrier_args_date($script, $annee, $mois, $jour, $type, $finurl) 
 {
-  return 'annee=' . sprintf("%04d", $annee) . '&' .
-	 'mois=' . sprintf("%02d", $mois) . '&' .
-    'jour=' . sprintf("%02d", $jour);
+  if (function_exists('generer_url_date'))
+    return generer_url_date($script, $annee, $mois, $jour, $type, $finurl);
+  else return	$script .		   
+	(ereg('[?&]$', $script) ?  "" : (strpos($script,'?') ? '&' : '?')) .
+		'annee=' . sprintf("%04d", $annee) . '&' .
+		'mois='  . sprintf("%02d", $mois) . '&' .
+		'jour='  . sprintf("%02d", $jour) . '&' .
+		'type='  . $type .
+    		$finurl;
 }
-  
 
 # prend une heure de debut et de fin, ainsi qu'une echelle (seconde/pixel)
 # et retourne un tableau compose
@@ -200,30 +195,32 @@
 {
 	global $spip_ecran;
 	if (!isset($spip_ecran)) $spip_ecran = 'large';
+	$premier_jour = '01';
+	$dernier_jour = '31';
 
-	list($sansduree, $evenements, $premier_jour, $dernier_jour) = $evt;
-
-	if ($sansduree)
-		foreach($sansduree as $d => $r) 
-			{
-			  $evenements[$d] = !$evenements[$d] ? $r : 
-			     array_merge($evenements[$d], $r); }
-
-	if (!$premier_jour) $premier_jour = '01';
-	if (!$dernier_jour)
-	  {
-	    $dernier_jour = 31;
-	    while (!(checkdate($mois,$dernier_jour,$annee))) $dernier_jour--;
-	  }
+	if (is_array($evt)) {
+	  list($sansduree, $evenements, $premier_jour, $dernier_jour) = $evt;
+	  if (!$premier_jour) $premier_jour = '01';
+	  if (!$dernier_jour)
+	    {
+	      $dernier_jour = 31;
+	      while (!(checkdate($mois,$dernier_jour,$annee))) $dernier_jour--;
+	    }
+	  if ($sansduree)
+	    foreach($sansduree as $d => $r) 
+	      $evenements[$d] = !$evenements[$d] ? $r : array_merge($evenements[$d], $r);
+	  $evt = 
+	    http_calendrier_mois_noms($annee, $mois, $jour, $script, $ancre) .
+	    http_calendrier_mois_sept($annee, $mois, $premier_jour, $dernier_jour,$evenements, $script, "&echelle=$echelle&partie_cal=$partie_cal$ancre") ;
+	    }
 
-      return 
-	"<table class='calendrier-table-$spip_ecran' cellspacing='0' cellpadding='0'>" .
-	http_calendrier_mois_navigation($annee, $mois, $premier_jour, $dernier_jour, $echelle, $partie_cal, $script, $ancre) .
-	http_calendrier_mois_noms($annee, $mois, $jour, $script, $ancre) .
-	http_calendrier_mois_sept($annee, $mois, $premier_jour, $dernier_jour,$evenements, $script, $ancre) .
-	'</table>' .
-	http_calendrier_sans_date($annee, $mois, $evenements) .
-	(_DIR_RESTREINT ? "" : http_calendrier_aide_mess());
+	return 
+	  "<table class='calendrier-table-$spip_ecran' cellspacing='0' cellpadding='0'>" .
+	  http_calendrier_mois_navigation($annee, $mois, $premier_jour, $dernier_jour, $echelle, $partie_cal, $script, $ancre) .
+	  $evt .
+	  '</table>' .
+	  http_calendrier_sans_date($annee, $mois, $evenements) .
+	  (_DIR_RESTREINT ? "" : http_calendrier_aide_mess());
 }
 
 // si la periore a plus de 31 jours, c'est du genre trimestre, semestre etc
@@ -244,8 +241,8 @@
 	  $annee_prec=$annee-1;
 	}
 	else if ($mois==12){$mois_suiv=1;	$annee_suiv=$annee+1;}
-	$prec = calendrier_args_date($annee_prec, $mois_prec, 1);
-	$suiv = calendrier_args_date($annee_suiv, $mois_suiv, 1);
+	$prec = array($annee_prec, $mois_prec, 1, "mois");
+	$suiv = array($annee_suiv, $mois_suiv, 1, "mois");
 	$periode = affdate_mois_annee("$annee-$mois-1");
 	}
 	return
@@ -336,40 +333,39 @@
 		  ($ligne ? "" :
 		   " border-$spip_lang_left: 1px solid $couleur_claire;") .
 		  "'>" .
-		  http_calendrier_mois_clics($annee_en_cours, $mois_en_cours, $jour, $script, $ancre, $couleur_lien) .
+		  (!_DIR_RESTREINT ? 
+		   (http_href(calendrier_args_date($script,$annee_en_cours, $mois_en_cours, $jour, "jour", $ancre), 
+			      $jour,
+			      '', "color: $couleur_lien",'calendrier-helvetica16') . 
+		    http_calendrier_ics_message($annee_en_cours, $mois_en_cours, $jour, false)):
+		   http_calendrier_mois_clics($annee_en_cours, $mois_en_cours, $jour, $script, $ancre)) .
 		  $res .
 		  "\n\t</td>";
 	}
 	return  $total . ($ligne ? "\n<tr>$ligne\n</tr>" : '');
 }
 
-function http_calendrier_mois_clics($annee, $mois, $jour, $script, $ancre, $color)
+// typo pour l'espace public
+
+function http_calendrier_mois_clics($annee, $mois, $jour, $script, $ancre)
 {
-  $script .= calendrier_args_date($annee, $mois, $jour);
-  if (!_DIR_RESTREINT) 
-    return http_href($script. "&type=jour" . $ancre, $jour,
-		     '', "color: $color",'calendrier-helvetica16') . 
-      http_calendrier_ics_message($annee, $mois, $jour, false);
-  else
-    {
       $d = mktime(0,0,0,$mois, $jour, $annee);
       $semaine = date("W", $d);
       return 
 	"<table width='100%'>\n<tr><td style='text-align: left'>". 
-	http_href("$script&type=jour" . $ancre, 
+	http_href(calendrier_args_date($script,$annee, $mois, $jour, "jour", $ancre), 
 		  "$jour/$mois",
 		  _T('date_jour_'. (1+date('w',$d))) .
 		  " $jour " .
 		  _T('date_mois_'.(0+$mois)),
 		  '','calendrier-helvetica16') .
 	"</td><td style='text-align: right'>" .
-	http_href("$script&type=semaine" . $ancre,
+	http_href(calendrier_args_date($script,$annee, $mois, $jour, "semaine", $ancre),
 		  $semaine,
 		  _T('date_semaines') . " $semaine",
 		  '',
 		  'calendrier-helvetica16') .
 	"</td></tr>\n</table>";
-    }
 }
 
 # dispose les evenements d'une semaine
@@ -381,14 +377,23 @@
 
 	$init = date("w",mktime(1,1,1,$mois,$jour,$annee));
 	$init = $jour+1-($init ? $init : 7);
+	$sd = '';
+
+	if (is_array($evt))
+	  {
+	    $sd = http_calendrier_sans_date($annee, $mois,$evt[0]);
+	    $finurl = "&echelle=$echelle&partie_cal=$partie_cal$ancre";
+	    $evt =
+	      http_calendrier_semaine_noms($annee, $mois, $init, $scriptep, $finurl) .
+	      http_calendrier_semaine_sept($annee, $mois, $init, $echelle, $partie_cal, $evt);
+	  }
 
 	return 
 	  "\n<table class='calendrier-table-$spip_ecran' cellspacing='0' cellpadding='0'>" .
 	  http_calendrier_semaine_navigation($annee, $mois, $init, $echelle, $partie_cal, $script, $ancre) .
-	  http_calendrier_semaine_noms($annee, $mois, $init, $script, $ancre) .
-	  http_calendrier_semaine_sept($annee, $mois, $init, $echelle, $partie_cal, $evt) .
+	  $evt .
 	  "</table>" .
-	  http_calendrier_sans_date($annee, $mois,$evt[0]) .
+	  $sd .
 	  (_DIR_RESTREINT ? "" : http_calendrier_aide_mess());
 }
 
@@ -419,8 +424,8 @@
 			       $partie_cal, 
 			       $periode,
 			       $script,
-calendrier_args_date($dannee, $dmois, ($djour-7)),
-calendrier_args_date($fannee, $fmois, ($fjour+1)),
+			       array($dannee, $dmois, ($djour-7), "semaine"),
+			       array($fannee, $fmois, ($fjour+1), "semaine"),
 			       'semaine',
 			       $ancre) .
     "</td></tr>\n";
@@ -428,11 +433,9 @@
 
 function http_calendrier_semaine_noms($annee, $mois, $jour, $script, $ancre){
 	global $couleur_claire;
-	$href = $script .
-	  (ereg('[?&]$', $script) ? '' : (strpos($script,'?') ? '&' : '?')) .
-	  "type=jour&";
 
 	$bandeau = '';
+	$script .= (ereg('[?&]$', $script) ? "" : (strpos($script,'?') ? '&' : '?'));
 	for ($j=$jour; $j<$jour+7;$j++){
 		$nom = mktime(0,0,0,$mois,$j,$annee);
 		$num = intval(date("d", $nom)) ;
@@ -440,10 +443,7 @@
 		$nomjour = _T('date_jour_'. (1+date('w',$nom)));
 		$bandeau .= 
 		  "\n\t<th class='calendrier-th'>" .
-		  http_href(($href .
-			     calendrier_args_date(date("Y",$nom), $numois, $num) .
-			     
-			     $ancre),
+		  http_href((calendrier_args_date($script, date("Y",$nom), $numois, $num, 'jour', $ancre)),
 			    ($nomjour .
 			     " " .
 			     $num .
@@ -482,6 +482,7 @@
 function http_calendrier_jour($annee, $mois, $jour, $echelle, $partie_cal, $script, $ancre, $evt){
 	global $spip_ecran;
 	if (!isset($spip_ecran)) $spip_ecran = 'large';
+
 	return 	
 	  "\n<table class='calendrier-table-$spip_ecran'>" .
 	  "\n<tr><td class='calendrier-td-gauche'></td>" .
@@ -490,33 +491,36 @@
 				     (nom_jour("$annee-$mois-$jour") . " " .
 				      affdate_jourcourt("$annee-$mois-$jour")),
 				     $script,
-calendrier_args_date($annee, $mois, ($jour-1)),
-calendrier_args_date($annee, $mois, ($jour+1)),
+				     array($annee, $mois, ($jour-1), "jour"),
+				     array($annee, $mois, ($jour+1), "jour"),
 				     'jour',
 				     $ancre) .
 	  "</td>" .
 	  "<td class='calendrier-td-droit calendrier-arial10'></td>" .
 	  "</tr>" .
-	  http_calendrier_jour_noms($annee, $mois, $jour, $script, $ancre) .
-	  http_calendrier_jour_sept($annee, $mois, $jour, $echelle,  $partie_cal, $script, $ancre, $evt) .
+	  (!is_array($evt) ? $evt :
+	   (http_calendrier_jour_noms($annee, $mois, $jour, $echelle, $partie_cal, $script, $ancre) .
+	    http_calendrier_jour_sept($annee, $mois, $jour, $echelle,  $partie_cal, $script, $ancre, $evt))) .
 	  "</table>";
 }
 
-function http_calendrier_jour_noms($annee, $mois, $jour, $script, $ancre){
+function http_calendrier_jour_noms($annee, $mois, $jour, $echelle, $partie_cal, $script, $ancre){
+
 	global $spip_ecran;
+	$finurl = "&echelle=$echelle&partie_cal=$partie_cal$ancre";
 
 	$gauche = (_DIR_RESTREINT  || ($spip_ecran != "large"));
 	return
 	  "\n<tr><td class='calendrier-td-gauche'>" .
 	  ($gauche ? '' :
-	   http_calendrier_ics_titre($annee,$mois,$jour-1,$script)) .
+	   http_calendrier_ics_titre($annee,$mois,$jour-1,$script, $finurl)) .
 	  "</td><td colspan='5' class='calendrier-td-centre'>" .
 	  (_DIR_RESTREINT ? '' :
 		   ("\n\t<div class='calendrier-titre'>" .
 		    http_calendrier_ics_message($annee, $mois, $jour, true) .
 		    '</div>')) .
 	  "</td><td class='calendrier-td-droit calendrier-arial10'> " .
-	   (_DIR_RESTREINT ? '' : http_calendrier_ics_titre($annee,$mois,$jour+1,$script)) .
+	   (_DIR_RESTREINT ? '' : http_calendrier_ics_titre($annee,$mois,$jour+1,$script, $finurl)) .
 	  "</td></tr>";
 }
 
@@ -638,7 +642,7 @@
 			$haut = calendrier_top ("$heure_debut:$minutes_debut", $debut, $fin, $dimheure, $dimjour, $fontsize);
 			$bas =  !$e ? $haut :calendrier_top ("$heure_fin:$minutes_fin", $debut, $fin, $dimheure, $dimjour, $fontsize);
 			$hauteur = calendrier_height ("$heure_debut:$minutes_debut", "$heure_fin:$minutes_fin", $debut, $fin, $dimheure, $dimjour, $fontsize);
-			if ($bas_prec > $haut) $decale += $modif_decalage;
+			if ($bas_prec >= $haut) $decale += $modif_decalage;
 			else $decale = (4 * $fontsize);
 			if ($bas > $bas_prec) $bas_prec = $bas;
 			$url = $evenement['URL']; 
@@ -752,19 +756,15 @@
 	return "\n<div style='position: relative; z-index: 2; top: ${pos}px; margin-$spip_lang_left: " . $largeur . "px'>$res</div>";
 }
 
-function http_calendrier_ics_titre($annee, $mois, $jour,$script)
+function http_calendrier_ics_titre($annee, $mois, $jour,$script, $finurl='')
 {
 	$date = mktime(0,0,0,$mois, $jour, $annee);
 	$jour = date("d",$date);
 	$mois = date("m",$date);
 	$annee = date("Y",$date);
 
-	$l = new Link($script);
-	$l->addvar("type","jour");
-
 	return "<div class='calendrier-arial10 calendrier-titre'>" .
-	  http_href($l->getUrl() . '&' .
-		    calendrier_args_date($annee, $mois, $jour),
+	  http_href(calendrier_args_date($script, $annee, $mois, $jour, 'jour', $finurl),
 		    affdate_jourcourt("$annee-$mois-$jour"),
 		    '', '', 'calendrier-noir') .
 	  "</div>";
@@ -896,9 +896,18 @@
 
 	if (!$echelle) $echelle = DEFAUT_D_ECHELLE;
 
-	if (!ereg('[?&]$', $script)) $script .= (strpos($script,'?') ? '&' : '?');
-	$args = calendrier_args_date($annee, $mois, $jour);
-	  
+	if ($args_pred) {
+	  list($a, $m, $j, $t) = $args_pred;
+	  $args_pred = calendrier_args_date($script, $a, $m, $j, $t, "&echelle=$echelle&partie_cal=$partie_cal$ancre");
+	}
+
+	if ($args_suiv) {
+	  list($a, $m, $j, $t) = $args_suiv;
+	  $args_suiv = calendrier_args_date($script, $a, $m, $j, $t, "&echelle=$echelle&partie_cal=$partie_cal$ancre");
+	}
+
+	$args_e = calendrier_args_date($script, $annee, $mois, $jour, $type, "&echelle=$echelle");
+	$args_p = calendrier_args_date($script, $annee, $mois, $jour, $type, "&partie_cal=$partie_cal");
 	$today=getdate(time());
 	$jour_today = $today["mday"];
 	$mois_today = $today["mon"];
@@ -912,50 +921,48 @@
 	  . "><div style='float: $spip_lang_right; padding-left: 5px; padding-right: 5px;'>"
 	  . (($type == "mois") ? '' :
 	     (
-		  http_href_img(("$script$args&type=$type&set_partie_cal=tout$ancre"),
+		  http_href_img(("$args_e&partie_cal=tout$ancre"),
 				 "heures-tout.png",
 				 "class='calendrier-png" .
 				 (($partie_cal == "tout") ? " calendrier-opacity'" : "'"),
 				 _T('cal_jour_entier'))
-		  .http_href_img(("$script$args&type=$type&set_partie_cal=matin$ancre"),
+		  .http_href_img(("$args_e&partie_cal=matin$ancre"),
 				 "heures-am.png",
 				 "class='calendrier-png" .
 				 (($partie_cal == "matin") ? " calendrier-opacity'" : "'"),
 				 _T('cal_matin'))
 
-		  .http_href_img(("$script$args&type=$type&set_partie_cal=soir$ancre"),
+		  .http_href_img(("$args_e&partie_cal=soir$ancre"),
 				 "heures-pm.png", 
 				 "class='calendrier-png" .
 				 (($partie_cal == "soir") ? " calendrier-opacity'" : "'"),
 				 _T('cal_apresmidi'))
 		  . "&nbsp;"
-		  . http_href_img(("$script$args&type=$type&set_echelle=" .
+		  . http_href_img(("$args_p&echelle=" .
 					  floor($echelle * 1.5)) . $ancre,
 					 "loupe-moins.gif",
 					 '',
 					 _T('info_zoom'). '-')
-		  . http_href_img(("$script$args&type=$type&set_echelle=" .
+		  . http_href_img(("$args_p&echelle=" .
 					  floor($echelle / 1.5)) . $ancre, 
 					 "loupe-plus.gif",
 					 '', 
 					 _T('info_zoom'). '+')
 		  ))
-	  . http_href_img(("$script$args&type=jour&echelle=$echelle$ancre"),"cal-jour.gif",
+	  . http_href_img(calendrier_args_date($script,$annee, $mois, $jour, "jour", "&echelle=$echelle&partie_cal=$partie_cal$ancre"),"cal-jour.gif",
 			  (($type == 'jour') ? " class='calendrier-opacity'" : ''),
 			  _T('cal_par_jour'))
 
-	  . http_href_img("$script$args&type=semaine&echelle=$echelle$ancre", "cal-semaine.gif", 
+	  . http_href_img(calendrier_args_date($script,$annee, $mois, $jour, "semaine", "&echelle=$echelle&partie_cal=$partie_cal$ancre"), "cal-semaine.gif", 
 			  (($type == 'semaine') ?  " class='calendrier-opacity'" : "" ),
 			  _T('cal_par_semaine'))
 
-	  . http_href_img("$script$args&type=mois&echelle=$echelle$ancre","cal-mois.gif",
+	  . http_href_img(calendrier_args_date($script,$annee, $mois, $jour, "mois", "&echelle=$echelle&partie_cal=$partie_cal$ancre"),"cal-mois.gif",
 			  (($type == 'mois') ? " class='calendrier-opacity'" : "" ),
 			  _T('cal_par_mois'))
 	  . "</div>"
 	  . "&nbsp;&nbsp;"
-	  . http_href_img($script . 
-calendrier_args_date($annee_today, $mois_today, $jour_today) .
-			  "&type=$type&echelle=$echelle$ancre",
+	  . http_href_img(calendrier_args_date($script,$annee_today, $mois_today, $jour_today, $type, "&echelle=$echelle&partie_cal=$partie_cal$ancre"),
 			  "cal-today.gif",
 			  (" onmouseover=\"montrer('$id');\"" .
 			   (($annee == $annee_today && $mois == $mois_today && (($type == 'mois')  || ($jour == $jour_today)))
@@ -963,18 +970,18 @@
 			  _T("ecrire:info_aujourdhui"))
 	  . "&nbsp;"
 	  . (!$args_pred ? '' :
-	     http_href($script . "type=$type&echelle=$echelle&$args_pred$ancre",
+	     http_href($args_pred,
 		       http_img_pack("fleche-$spip_lang_left.png", '&lt;&lt;&lt;', "class='calendrier-png'"),
 		       _T('precedent')))
 	  . (!$args_suiv ? '' :
-	     http_href(($script . "type=$type&echelle=$echelle&$args_suiv$ancre"),
+	     http_href($args_suiv,
 		       http_img_pack("fleche-$spip_lang_right.png",  '&gt;&gt;&gt;', "class='calendrier-png'"),
 		       _T('suivant')))
 	  . "&nbsp;&nbsp;"
 	  . $nom
 	  . (_DIR_RESTREINT ? '' :  aide("messcalen"))
 	  . "</div>"
-	  . http_calendrier_invisible($annee, $mois, $jour, $script, $ancre,$id);
+	  . http_calendrier_invisible($annee, $mois, $jour, $script, "&echelle=$echelle&partie_cal=$partie_cal$ancre", $id);
 }
 
 
@@ -993,16 +1000,12 @@
 	$annee_avant = $annee - 1;
 	$annee_apres = $annee + 1;
 
-	$finurl = "&type=mois&echelle=$echelle" . $ancre; 
-
 	for ($i=$mois; $i < 13; $i++) {
-		$gadget .= http_href($script .
-				     calendrier_args_date($annee_avant, $i, 1) . $finurl,
+	  $gadget .= http_href(calendrier_args_date($script,$annee_avant, $i, 1, "mois", $ancre),
 				     nom_mois("$annee_avant-$i-1"),'','', 'calendrier-annee') ;
 			}
 	for ($i=1; $i < $mois - 1; $i++) {
-		$gadget .= http_href($script .
-				     calendrier_args_date($annee, $i, 1) . $finurl,
+	  $gadget .= http_href(calendrier_args_date($script,$annee, $i, 1, "mois", $ancre),
 					nom_mois("$annee-$i-1"),'','', 'calendrier-annee');
 			}
 	$gadget .= "</td></tr>"
@@ -1016,13 +1019,11 @@
 		. "</tr>"
 		. "\n<tr><td colspan='3' style='text-align:$spip_lang_right;'>";
 	for ($i=$mois+2; $i <= 12; $i++) {
-				$gadget .= http_href($script .
-				     calendrier_args_date($annee, $i, 1) . $finurl,
+	  $gadget .= http_href(calendrier_args_date($script,$annee, $i, 1, "mois", $ancre),
 					nom_mois("$annee-$i-1"),'','', 'calendrier-annee');
 			}
 	for ($i=1; $i < $mois+1; $i++) {
-		$gadget .= http_href($script . 
-				     calendrier_args_date($annee_apres, $i, 1) . $finurl,
+	  $gadget .= http_href(calendrier_args_date($script, $annee_apres, $i, 1, "mois", $ancre),
 					nom_mois("$annee_apres-$i-1"),'','', 'calendrier-annee');
 			}
 	return $gadget . "</td></tr></table></div>";
@@ -1039,9 +1040,7 @@
   if (!$evt) $evt = sql_calendrier_agenda($annee, $mois);
   return 
     "<div class='calendrier-titre calendrier-arial10'>" .
-    http_href($script .
-	      calendrier_args_date($annee, $mois, 1) .
-	      '&type=mois' . $ancre,
+    http_href(calendrier_args_date($script, $annee, $mois, 1, 'mois', $ancre),
 	      affdate_mois_annee("$annee-$mois-1"),
 	      '',
 	      'color: black;') .
@@ -1059,9 +1058,7 @@
 
   list($script, $ancre) = $perso;
 
-  return http_href($script .
-		   calendrier_args_date($annee, $mois, $jour) .
-		   "&type=$type$ancre", 
+  return http_href(calendrier_args_date($script, $annee, $mois, $jour,$type, $ancre), 
 		   $jour,
 		   '',
 		   "color: $couleur; font-weight: bold");
@@ -1327,20 +1324,7 @@
 
 	while($row=spip_fetch_array($result)){
 		$amj = date_anneemoisjour($row['date']);
-		if ((!_DIR_RESTREINT) || ($now >= $amj))
-			$url = $script . $row['id_article'];
-		else {
-			if (substr($row['chapo'], 0, 1) != '=')
-				$url = " ";
-			else {
-				list(,$url) = extraire_lien(array('','','',
-					substr($row['chapo'], 1)));
-				if ($url)
-					$url = texte_script(str_replace('&amp;', '&', $url));
-				else $url = " ";
-			}
-		}
-
+		$url = generer_url_article($row['id_article']);
 		$evenements[$amj][]=
 		    array(
 			'CATEGORIES' => 'info_articles',
@@ -1361,10 +1345,10 @@
 ");
 	while($row=spip_fetch_array($result)){
 		$amj = date_anneemoisjour($row['date_heure']);
-		$script = (_DIR_RESTREINT ? 'breve' : 'breves_voir');
+		$script = generer_url_breve($row['id_breve']);
 		$evenements[$amj][]=
 		array(
-			'URL' => $script . _EXTENSION_PHP . "?id_breve=" . $row['id_breve'],
+			'URL' => $script,
 			'CATEGORIES' => 'info_breves_02',
 			'SUMMARY' => $row['titre']);
 	}

Index: inc_serialbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_serialbase.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_serialbase.php3	21 Jul 2005 21:47:15 -0000	1.4
+++ inc_serialbase.php3	7 Sep 2005 15:01:53 -0000	1.5
@@ -135,11 +135,11 @@
 
 $spip_mots = array(
 		"id_mot"	=> "bigint(21) NOT NULL",
-		"type"	=> "VARCHAR(100) NOT NULL",
 		"titre"	=> "text NOT NULL",
 		"descriptif"	=> "text NOT NULL",
 		"texte"	=> "longblob NOT NULL",
 		"id_groupe"	=> "bigint(21) NOT NULL",
+		"type"	=> "text NOT NULL",
 		"extra"	=> "longblob NULL",
 		"idx"		=> "ENUM('', '1', 'non', 'oui', 'idx') DEFAULT '' NOT NULL",
 		"url_propre" => "VARCHAR(255) NOT NULL",
@@ -148,7 +148,6 @@
 $spip_mots_key = array(
 		"PRIMARY KEY"	=> "id_mot",
 		"KEY idx"	=> "idx",
-		"KEY type"	=> "type",
 		"KEY url_propre"	=> "url_propre");
 
 $spip_groupes_mots = array(

Index: inc_texte.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_texte.php3,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -d -r1.10 -r1.11
--- inc_texte.php3	18 Aug 2005 23:28:33 -0000	1.10
+++ inc_texte.php3	7 Sep 2005 15:01:53 -0000	1.11
@@ -189,7 +189,7 @@
 		foreach ($matches as $match) {
 			$num_echap++;
 
-			// Si le resultat contient des <div>, forcer la sortie de paragraphes			
+			// Si le resultat contient des <div>, forcer la sortie du paragraphe
 			if ( $match[1] == "doc" OR $match[1] == "emb" OR eregi("^\|center", $match[3]) )  {
 				$letexte = str_replace($match[0],
 					"\n\n</no p>@@SPIP_$source$num_echap@@<no p>\n\n", $letexte);
@@ -538,6 +538,18 @@
 	return echappe_retour_doublon($letexte, $les_echap, "SOURCETYPO", $doublons);
 }
 
+function charger_generer_url()
+{
+		// Traitement des liens internes
+	if (!_DIR_RESTREINT)
+		include_ecrire('inc_urls.php3');
+	else if (@file_exists("inc-urls.php3"))
+		include_local("inc-urls.php3");
+	else	include_local("inc-urls-".$GLOBALS['type_urls'].".php3");
+}
+
+
+
 // cette fonction est tordue : on lui passe un tableau correspondant au match
 // de la regexp ci-dessous, et elle retourne le texte a inserer a la place
 // et le lien "brut" a usage eventuel de redirection...
@@ -548,20 +560,12 @@
 	$compt_liens++;
 	$lien_interne = false;
 	if (ereg('^[[:space:]]*(art(icle)?|rub(rique)?|br(.ve)?|aut(eur)?|mot|site|doc(ument)?|im(age|g))?[[:space:]]*([[:digit:]]+)(#.*)?[[:space:]]*$', $lien_url, $match)) {
-		// Traitement des liens internes
-		if (!_DIR_RESTREINT)
-			include_ecrire('inc_urls.php3');
-		else
-		if (@file_exists("inc-urls.php3"))
-			include_local("inc-urls.php3");
-		else
-			include_local("inc-urls-".$GLOBALS['type_urls'].".php3");
-
 		$id_lien = $match[8];
 		$ancre = $match[9];
 		$type_lien = substr($match[1], 0, 2);
 		$lien_interne=true;
 		$class_lien = "in";
+		charger_generer_url();
 		switch ($type_lien) {
 			case 'ru':
 				$lien_url = generer_url_rubrique($id_lien);
@@ -942,13 +946,22 @@
 	//
 	// Tableaux
 	//
+
+	// traiter le cas particulier des echappements (<doc...> par exemple)
+	// qui auraient provoque des \n\n</no p> devant les | des tableaux
+	$letexte = preg_replace(',[|]\n\n</no p>@@,','|@@', $letexte);
+	$letexte = preg_replace(',@@<no p>\n\n[|],','@@|', $letexte);
+
+	// ne pas oublier les tableaux au debut ou a la fin du texte
 	$letexte = preg_replace(",^\n?[|],", "\n\n|", $letexte);
 	$letexte = preg_replace(",\n\n+[|],", "\n\n\n\n|", $letexte);
 	$letexte = preg_replace(",[|](\n\n+|\n?$),", "|\n\n\n\n", $letexte);
-	if (preg_match_all(',\n\n[|].*[|]\n\n,Ums', $letexte,
+
+	// traiter chaque tableau
+	if (preg_match_all(',[^|](\n[|].*[|]\n)[^|],Ums', $letexte,
 	$regs, PREG_SET_ORDER))
 	foreach ($regs as $tab) {
-		$letexte = str_replace($tab[0], traiter_tableau($tab[0]), $letexte);
+		$letexte = str_replace($tab[1], traiter_tableau($tab[1]), $letexte);
 	}
 
 	//

Index: inc_debug_sql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_debug_sql.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- inc_debug_sql.php3	18 Aug 2005 23:28:33 -0000	1.8
+++ inc_debug_sql.php3	7 Sep 2005 15:01:53 -0000	1.9
@@ -214,7 +214,7 @@
 
 	$id = $nom . $boucle;
 	foreach($debug_objets['sequence'][$id] as $v) {
-	  if (!ereg('^(.*)(<\?.*\?>)(.*)$', $v[2],$r))
+	  if (!preg_match('/^(.*)(<\?.*\?>)(.*)$/', $v[2],$r))
 	    $y = substr_count($v[2], "\n");
 	  else {
 	    if ($v[1][0] == '#')

Index: inc_sites.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_sites.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc_sites.php3	10 Aug 2005 12:00:38 -0000	1.7
+++ inc_sites.php3	7 Sep 2005 15:01:53 -0000	1.8
@@ -482,7 +482,8 @@
 
 
 	$items = array();
-	while (preg_match($syndic_regexp['item'],$rss,$regs)) {
+	if (preg_match_all($syndic_regexp['item'],$rss,$r, PREG_SET_ORDER))
+	foreach ($r as $regs) {
 		$debut_item = strpos($rss,$regs[0]);
 		$fin_item = strpos($rss,
 			$syndic_regexp['itemfin'])+strlen($syndic_regexp['itemfin']);

Index: auteurs.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/auteurs.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- auteurs.php3	30 Jun 2005 10:09:39 -0000	1.3
+++ auteurs.php3	7 Sep 2005 15:01:53 -0000	1.4
@@ -102,8 +102,10 @@
 
 case 'nom':
 default:
-	$sql_order = ' ORDER BY unom';
+//	$sql_order = ' ORDER BY unom';
 	$type_requete = 'auteur';
+	$sql_sel = ", ".creer_objet_multi ("nom", "$spip_lang");
+	$sql_order = " ORDER BY multi";
 }
 
 
@@ -117,7 +119,7 @@
 $auteurs = Array();
 
 if ($type_requete == 'auteur') {
-	$result_auteurs = spip_query("SELECT id_auteur, statut, login, nom, email, url_site, messagerie, UPPER(nom) AS unom
+	$result_auteurs = spip_query("SELECT id_auteur, statut, login, nom, email, url_site, messagerie, UPPER(nom) AS unom$sql_sel
 		FROM spip_auteurs AS auteurs
 		WHERE 1 $sql_statut_auteurs
 		$sql_order");
@@ -126,7 +128,7 @@
 		$nombre_auteurs ++;
 	}
 
-	$result_nombres = spip_query("SELECT auteurs.id_auteur, UPPER(auteurs.nom) AS unom, COUNT(articles.id_article) AS compteur
+	$result_nombres = spip_query("SELECT auteurs.id_auteur, UPPER(auteurs.nom) AS unom, COUNT(articles.id_article) AS compteur, ".creer_objet_multi ("UPPER(auteurs.nom)", "$spip_lang")." 
 		FROM spip_auteurs AS auteurs, spip_auteurs_articles AS lien, spip_articles AS articles
 		WHERE auteurs.id_auteur=lien.id_auteur AND lien.id_article=articles.id_article
 		$sql_statut_auteurs $sql_statut_articles
@@ -153,7 +155,7 @@
 	$lettres_nombre_auteurs = 0;
 	foreach ($auteurs as $auteur) {
 		$lettres_nombre_auteurs ++;
-		$premiere_lettre = addslashes(strtoupper(substr($auteur['nom'],0,1)));
+		$premiere_lettre = addslashes(strtoupper(spip_substr($auteur['multi'],0,1)));
 		if ($premiere_lettre != $lettre_prec) {
 			$lettre[$premiere_lettre] = $lettres_nombre_auteurs-1;
 		}

Index: delete_all.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/delete_all.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- delete_all.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ delete_all.php3	7 Sep 2005 15:01:53 -0000	1.3
@@ -62,6 +62,18 @@
 spip_query("DROP TABLE spip_visites_articles");
 spip_query("DROP TABLE spip_visites_temp");
 spip_query("DROP TABLE spip_test");
+spip_query("DROP TABLE spip_caches");
+spip_query("DROP TABLE spip_documents_syndic");
+spip_query("DROP TABLE spip_index_documents");
+spip_query("DROP TABLE spip_index_forum");
+spip_query("DROP TABLE spip_index_signatures");
+spip_query("DROP TABLE spip_mots_documents");
+spip_query("DROP TABLE spip_ortho_cache");
+spip_query("DROP TABLE spip_ortho_dico");
+spip_query("DROP TABLE spip_versions");
+spip_query("DROP TABLE spip_versions_fragments");
+spip_query("DROP TABLE spip_ajax_fonc");
+
 
 @unlink(_ACCESS_FILE_NAME);
 @unlink(_FILE_CONNECT);

Index: inc_acces.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_acces.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_acces.php3	21 Jul 2005 21:47:15 -0000	1.6
+++ inc_acces.php3	7 Sep 2005 15:01:53 -0000	1.7
@@ -130,7 +130,11 @@
 
 		echo "<OPTION".mySel("1comite",$statut).">"._T('intem_redacteur');
 
-		if (($statut == '6forum') OR (lire_meta('accepter_visiteurs') == 'oui') OR (lire_meta('forums_publics') == 'abo'))
+		if (($statut == '6forum')
+		OR (lire_meta('accepter_visiteurs') == 'oui')
+		OR (lire_meta('forums_publics') == 'abo')
+		OR spip_num_rows(spip_query("SELECT statut
+		FROM spip_auteurs WHERE statut='6forum'")))
 			echo "<OPTION".mySel("6forum",$statut).">"._T('item_visiteur');
 		echo "<OPTION".mySel("5poubelle",$statut).
 		  " style='background:url(" . _DIR_IMG_PACK . "rayures-sup.gif)'>&gt; "._T('texte_statut_poubelle');

Index: inc_getdocument.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_getdocument.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_getdocument.php3	21 Jul 2005 21:47:16 -0000	1.6
+++ inc_getdocument.php3	7 Sep 2005 15:01:53 -0000	1.7
@@ -385,6 +385,7 @@
 			}
 			if (!$tmp_dir = tempnam(_DIR_SESSIONS, 'tmp_upload')) return;
 			@unlink($tmp_dir); @mkdir($tmp_dir);
+			if (!is_dir(_DIR_IMG.'tmp')) @mkdir(_DIR_IMG.'tmp');
 			$tmp = $tmp_dir.'/'.translitteration($nom_envoye);
 			$nom_envoye .= '.zip'; # conserver l'extension dans le nom de fichier, par exemple toto.js => toto.js.zip
 			$fichier = deplacer_fichier_upload($source, $tmp);

Index: mots_tous.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_tous.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- mots_tous.php3	10 Aug 2005 12:00:38 -0000	1.4
+++ mots_tous.php3	7 Sep 2005 15:01:53 -0000	1.5
@@ -79,10 +79,7 @@
 				,carto_objets='$carto_objets' WHERE id_groupe='$id_groupe'";
 			spip_query($query);
 		} else {	// creation groupe
-			$query = "INSERT INTO spip_groupes_mots SET titre='$change_type', texte='$texte', descriptif='$descriptif', unseul='$unseul', obligatoire='$obligatoire',
-				articles='$articles', breves='$breves', rubriques='$rubriques', syndic='$syndic',
-				carto_objets='$carto_objets', minirezo='$acces_minirezo', comite='$acces_comite', forum='$acces_forum'";
-			spip_query($query);
+			spip_query("INSERT INTO spip_groupes_mots (titre, unseul,  obligatoire, articles, breves, rubriques, syndic, minirezo, comite, forum, carto_objets) VALUES ('$change_type', '$unseul', '$obligatoire', '$articles','$breves', '$rubriques', '$syndic', '$acces_minirezo',  '$acces_comite', '$acces_forum','$carto_objets')");
 		}
 	}
 
@@ -193,7 +190,7 @@
 // On boucle d'abord sur les groupes de mots
 //
 
-$query_groupes = "SELECT * FROM spip_groupes_mots ORDER BY titre";
+$query_groupes = "SELECT *, ".creer_objet_multi ("titre", "$spip_lang")." FROM spip_groupes_mots ORDER BY multi";
 $result_groupes = spip_query($query_groupes);
 
 while ($row_groupes = spip_fetch_array($result_groupes)) {
@@ -249,7 +246,8 @@
 	//
 	// Afficher les mots-cles du groupe
 	//
-	$query = "SELECT * FROM spip_mots WHERE id_groupe = '$id_groupe' ORDER BY titre";
+	$query = "SELECT id_mot, titre, ".creer_objet_multi ("titre", "$spip_lang")." FROM spip_mots WHERE id_groupe = '$id_groupe' ORDER BY multi";
+	
 	$tranches = afficher_tranches_requete($query, 3);
 
 	$table = '';
@@ -312,7 +310,7 @@
 
 
 				if ($connect_statut=="0minirezo") {
-					$vals[] = "<a href='mots_tous.php3?conf_mot=$id_mot'>"._T('info_supprimer_mot')."&nbsp;<img src='" . _DIR_IMG_PACK . "croix-rouge.gif' alt='X' width='7' height='7' border='0' align='middle'></a>";
+					$vals[] = "<a href='mots_tous.php3?conf_mot=$id_mot'>"._T('info_supprimer_mot')."&nbsp;<img src='" . _DIR_IMG_PACK . "croix-rouge.gif' alt='X' width='7' height='7' border='0' align='bottom' /></a>";
 				} 
 
 				$table[] = $vals;
@@ -322,7 +320,7 @@
 				
 		}
 		if ($connect_statut=="0minirezo") {
-			$largeurs = array('', 100, 100);
+			$largeurs = array('', 100, 130);
 			$styles = array('arial11', 'arial1', 'arial1');
 		}
 		else {

Index: aide_index.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/aide_index.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- aide_index.php3	30 Jun 2005 10:09:40 -0000	1.5
+++ aide_index.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -484,7 +484,7 @@
 		}
 	} else {
 		echo debut_entete(_T('info_aide_en_ligne'),
-				  "Content-Type: text/html; charset=utf-8");
+				  array("Content-Type: text/html; charset=utf-8"));
 		if ($frame == 'menu')
 			help_menu($aide, $html);
 		else if ($frame == 'body')

Index: mots_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_edit.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- mots_edit.php3	21 Jul 2005 21:47:15 -0000	1.5
+++ mots_edit.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -32,17 +32,16 @@
 		if ($new == 'oui' && $id_groupe) {
 		  $id_mot = spip_abstract_insert("spip_mots", '(id_groupe)', "($id_groupe)");
 
-
 			// ajouter le mot a l'article
 			if (settype($ajouter_id_article, 'integer') AND ($ajouter_id_article>0))
-				spip_query("INSERT INTO spip_mots_articles (id_mot, id_article) VALUES ($id_mot, $ajouter_id_article)");
+				spip_query("INSERT INTO spip_mots_$table (id_mot, $id_table) VALUES ($id_mot, $ajouter_id_article)");
 		}
 
 		$titre_mot = addslashes($titre_mot);
 		$texte = addslashes($texte);
 		$descriptif = addslashes($descriptif);
 		$type = addslashes(corriger_caracteres($type));
-		$result = spip_query("SELECT * FROM spip_groupes_mots WHERE id_groupe='$id_groupe'");
+		$result = spip_query("SELECT titre FROM spip_groupes_mots WHERE id_groupe='$id_groupe'");
 		if ($row = spip_fetch_array($result))
 			$type = addslashes(corriger_caracteres($row['titre']));
 
@@ -213,10 +212,12 @@
 	if ($id_mot)
 		echo "<INPUT TYPE='Hidden' NAME='id_mot' VALUE='$id_mot'>\n";
 	else if ($new=='oui')
-		echo "<INPUT TYPE='Hidden' NAME='new' VALUE='oui'>\n";
-	echo "<INPUT TYPE='Hidden' NAME='redirect' VALUE=\"$redirect\">\n";
-	echo "<INPUT TYPE='Hidden' NAME='redirect_ok' VALUE='oui'>\n";
-	echo "<INPUT TYPE='Hidden' NAME='ajouter_id_article' VALUE=\"$ajouter_id_article\">\n";
+		echo "<INPUT TYPE='Hidden' NAME='new' VALUE='oui' />\n";
+	echo "<INPUT TYPE='Hidden' NAME='redirect' VALUE=\"$redirect\" />\n";
+	echo "<INPUT TYPE='Hidden' NAME='redirect_ok' VALUE='oui' />\n";
+	echo "<INPUT TYPE='Hidden' NAME='table' VALUE='$table' />\n";
+	echo "<INPUT TYPE='Hidden' NAME='id_table' VALUE='$id_table' />\n";
+	echo "<INPUT TYPE='Hidden' NAME='ajouter_id_article' VALUE=\"$ajouter_id_article\" />\n";
 
 	$titre_mot = entites_html($titre_mot);
 	$descriptif = entites_html($descriptif);
@@ -225,10 +226,10 @@
 	echo "<B>"._T('info_titre_mot_cle')."</B> "._T('info_obligatoire_02');
 	echo aide ("mots");
 
-	echo "<BR><INPUT TYPE='text' NAME='titre_mot' CLASS='formo' VALUE=\"$titre_mot\" SIZE='40' $onfocus>";
+	echo "<BR><INPUT TYPE='text' NAME='titre_mot' CLASS='formo' VALUE=\"$titre_mot\" SIZE='40' $onfocus />";
 
 	// dans le groupe...
-	$query_groupes = "SELECT * FROM spip_groupes_mots ORDER BY titre";
+	$query_groupes = "SELECT id_groupe, titre FROM spip_groupes_mots ORDER BY titre";
 	$result = spip_query($query_groupes);
 	if (spip_num_rows($result)>1) {
 		debut_cadre_relief("groupe-mot-24.gif");
@@ -247,10 +248,11 @@
 		if (!$row_groupes) {
 			// il faut creer un groupe de mots (cas d'un mot cree depuis articles.php3)
 		  $row_groupes['id_groupe'] = spip_abstract_insert("spip_groupes_mots",
-							  "(titre, unseul, obligatoire, articles, breves, rubriques, syndic, minirezo, comite, forum)",
-							  "('" .
-							  addslashes(_T('info_mot_sans_groupe'))."', 'non',  'non', 'oui', 'oui', 'non', 'oui', 'oui', 'non', 'non'");
-
+			"(titre, unseul, obligatoire, articles, breves, rubriques, syndic, minirezo, comite, forum)",
+			"('" . 
+			addslashes(_T('info_mot_sans_groupe')) .
+			"', 'non',  'non', 'oui', 'oui', 'non', 'oui', 'oui', 'non', 'non'" .
+			")");
 		}
 		echo "<input type='hidden' name='id_groupe' value='".$row_groupes['id_groupe']."'>";
 	}

Index: pclzip.lib.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/pclzip.lib.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- pclzip.lib.php	30 Jun 2005 10:09:39 -0000	1.4
+++ pclzip.lib.php	7 Sep 2005 15:01:53 -0000	1.5
@@ -5188,20 +5188,25 @@
   // Return Values :
   //   The path translated.
   // --------------------------------------------------------------------------------
-  function PclZipUtilTranslateWinPath($p_path, $p_remove_disk_letter=true)
-  {
-    if (stristr(php_uname(), 'windows')) {
-      // ----- Look for potential disk letter
-      if (($p_remove_disk_letter) && (($v_position = strpos($p_path, ':')) != false)) {
-          $p_path = substr($p_path, $v_position+1);
-      }
-      // ----- Change potential windows directory separator
-      if ((strpos($p_path, '\\') > 0) || (substr($p_path, 0,1) == '\\')) {
-          $p_path = strtr($p_path, '\\', '/');
-      }
-    }
-    return $p_path;
-  }
+  
+  //
+  // ATTENTION: PATCH !
+  // PHP_OS remplace uname, qui est bloquee par de nombreux hebergeurs
+  //
+  function PclZipUtilTranslateWinPath($p_path, $p_remove_disk_letter=true) 
+  { 
+    if (stristr(PHP_OS, 'windows')) { 
+      // ----- Look for potential disk letter 
+      if (($p_remove_disk_letter) && (($v_position = strpos($p_path, ':')) != false)) { 
+          $p_path = substr($p_path, $v_position+1); 
+      } 
+      // ----- Change potential windows directory separator 
+      if ((strpos($p_path, '\\') > 0) || (substr($p_path, 0,1) == '\\')) { 
+          $p_path = strtr($p_path, '\\', '/'); 
+      } 
+    } 
+    return $p_path; 
+  } 
   // --------------------------------------------------------------------------------
 
 

Index: engines-list.txt
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/engines-list.txt,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- engines-list.txt	30 Jun 2005 10:09:39 -0000	1.3
+++ engines-list.txt	7 Sep 2005 15:01:53 -0000	1.4
@@ -17,7 +17,7 @@
 [Google]
 (q|as_q)=
 www\.google\.(.*)
-web.toile.com
+(web|www).toile.com
 
 [Voila]
 (kw|rdata)=
@@ -59,6 +59,7 @@
 s=
 (.*)\.nomade\.fr
 (.*)\.nomade\.tiscali\.fr
+(.*)\.nomade\.aliceadsl\.fr
 
 [Lycos]
 query=
@@ -136,6 +137,19 @@
 kw=
 www\.reacteur\.com
 
+[francesurf]
+q=
+www\.francesurf\.net
+
+
+
+#
+# Dmoz
+#
+[dmoz.org]
+rien=
+(.*\.)?dmoz\.org
+
 
 
 #
@@ -150,4 +164,5 @@
 (.*)mail\.(.*)\.([a-z]+)$
 webmail([0-9]*)\.wanadoo\.fr
 www\.laposte\.net
+mail([0-9]*)\.voila\.fr
 

Index: inc_filtres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_filtres.php3,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -d -r1.9 -r1.10
--- inc_filtres.php3	18 Aug 2005 23:28:33 -0000	1.9
+++ inc_filtres.php3	7 Sep 2005 15:01:53 -0000	1.10
@@ -297,6 +297,15 @@
 	return $url;
 }
 
+function parametre_url($url, $parametre, $valeur = '__global__') {
+	$link = new Link(str_replace('&amp;', '&', $url));
+	if($valeur == '__global__')
+		$valeur = $GLOBALS[$parametre];
+	if(empty($valeur)) $link->DelVar($parametre);
+	else $link->AddVar($parametre, $valeur);
+	return quote_amp($link->getUrl());
+}
+
 //
 // Ajouter le &var_recherche=toto dans les boucles de recherche
 //
@@ -742,6 +751,7 @@
 // et une suite de noms N.
 // Elle demande a la fonction la precedente son tableau
 // et affiche selon le type les elements indexes par N dans ce tableau.
+// Si le suite de noms est vide, tout le tableau est pris
 // Ces noms N sont aussi des classes CSS utilisees par http_calendrier_init
 
 function agenda_affiche($i)
@@ -753,12 +763,12 @@
   $type = array_shift($args);
   $agenda = agenda_memo(0);
   $evt = array();
-  foreach ($args as $k) {  
+  foreach (($args ? $args : array_keys($agenda)) as $k) {  
       if (is_array($agenda[$k]))
 	foreach($agenda[$k] as $d => $v) { 
 	  $evt[$d] = $evt[$d] ? (array_merge($evt[$d], $v)) : $v;
 	}
-  }
+    }
   if ($type != 'periode')
       $evt = array('', $evt);
   else
@@ -950,8 +960,9 @@
 // analyse un bloc multi
 function extraire_trad ($bloc) {
 	$lang = '';
-
-	while (preg_match("/^(.*?)[{\[]([a-z_]+)[}\]]/si", $bloc, $regs)) {
+// ce reg fait planter l'analyse multi s'il y a de l'{italique} dans le champ
+//	while (preg_match("/^(.*?)[{\[]([a-z_]+)[}\]]/si", $bloc, $regs)) {
+	while (preg_match("/^(.*?)[\[]([a-z_]+)[\]]/si", $bloc, $regs)) {
 		$texte = trim($regs[1]);
 		if ($texte OR $lang)
 			$trads[$lang] = $texte;
@@ -1378,5 +1389,8 @@
 
 }
 
-
+function modulo($nb, $mod, $add=0)
+{
+  return ($nb%$mod)+$add;
+}
 ?>

Index: inc_flock.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_flock.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_flock.php3	18 Aug 2005 23:28:33 -0000	1.4
+++ inc_flock.php3	7 Sep 2005 15:01:53 -0000	1.5
@@ -100,13 +100,16 @@
 	$s = @fputs($fp, $contenu, $a = strlen($contenu));
 
 	$ok = ($s == $a);
-	if (!$ok)
-		spip_log("echec ecriture fichier $fichier");
 
 	// liberer le verrou et fermer le fichier
 	@flock($fp, LOCK_UN);
 	@fclose($fp);
 
+	if (!$ok) {
+		spip_log("echec ecriture fichier $fichier");
+		@unlink($fichier);
+	}
+
 	return $ok;
 }
 
@@ -131,4 +134,4 @@
 	@unlink($fichier);
 }
 
-?>
\ No newline at end of file
+?>

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- inc_version.php3	18 Aug 2005 23:28:33 -0000	1.11
+++ inc_version.php3	7 Sep 2005 15:01:53 -0000	1.12
@@ -412,13 +412,10 @@
 // (utilise pour les modifs de la base de donnees)
 
 // version de la base
-$spip_version = 1.820;
+$spip_version = 1.822;
 
 // version de spip
-$spip_version_affichee = "1.8.2 pr3";
-
-// version de spip / tag cvs
-if (ereg('Name: v(.*) ','$Name$', $regs)) $spip_version_affichee = $regs[1];
+$spip_version_affichee = "1.8.2 d";
 
 
 // ** Securite **
@@ -1070,15 +1067,22 @@
 	if (!$charset = lire_meta('charset'))
 		$charset = 'utf-8';
 	if (!$entete)
-		$entete = "Content-Type: text/html; charset=$charset";
-
-	if (!$flag_preserver) @header($entete);
+	  $entete = array("Content-Type: text/html; charset=$charset",
+			  "Expires: 0",
+			  "Last-Modified: " .gmdate("D, d M Y H:i:s"). " GMT",
+			  "Cache-Control: no-store, no-cache, must-revalidate",
+			  "Pragma: no-cache");
+	if (!$flag_preserver) array_map('header', $entete);
+	// selon http://developer.apple.com/internet/safari/faq.html#anchor5
+	// il faudrait aussi pour Safari
+	// header("Cache-Control: post-check=0, pre-check=0", false)
+	// mais ca ne respecte pas
+	// http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9
 	return "<!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.01 Transitional//EN' 'http://www.w3.org/TR/html4/loose.dtd'>\n" .
 	  "<html lang='".$GLOBALS['spip_lang']."' dir='".($GLOBALS['spip_lang_rtl'] ? 'rtl' : 'ltr')."'>\n" .
 	  "<head>\n" .
 #	  "<base href='$base' />\n" .
-	  "<title>$title</title>\n" .
-	  "<meta http-equiv='Content-Type' content='text/html; charset=$charset'>\n";
+	  "<title>$title</title>\n";
 }
 
 

Index: inc_db_mysql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_db_mysql.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_db_mysql.php3	21 Jul 2005 21:47:16 -0000	1.5
+++ inc_db_mysql.php3	7 Sep 2005 15:01:53 -0000	1.6
@@ -256,4 +256,31 @@
 	return "($in_sql)";
 }
 
+
+function creer_objet_multi ($objet, $lang) {
+	$retour = "(TRIM(IF(INSTR(".$objet.", '<multi>') = 0 , ".
+		"     TRIM(".$objet."), ".
+		"     CONCAT( ".
+		"          LEFT(".$objet.", INSTR(".$objet.", '<multi>')-1), ".
+		"          IF( ".
+		"               INSTR(TRIM(RIGHT(".$objet.", LENGTH(".$objet.") -(6+INSTR(".$objet.", '<multi>')))),'[".$lang."]') = 0, ".
+		"               IF( ".
+		"                     TRIM(RIGHT(".$objet.", LENGTH(".$objet.") -(6+INSTR(".$objet.", '<multi>')))) REGEXP '^\\[[a-z\_]{2,}\\]', ".
+		"                     INSERT( ".
+		"                          TRIM(RIGHT(".$objet.", LENGTH(".$objet.") -(6+INSTR(".$objet.", '<multi>')))), ".
+		"                          1, ".
+		"                          INSTR(TRIM(RIGHT(".$objet.", LENGTH(".$objet.") -(6+INSTR(".$objet.", '<multi>')))), ']'), ".
+		"                          '' ".
+		"                     ), ".
+		"                     TRIM(RIGHT(".$objet.", LENGTH(".$objet.") -(6+INSTR(".$objet.", '<multi>')))) ".
+		"                ), ".
+		"               TRIM(RIGHT(".$objet.", ( LENGTH(".$objet.") - (INSTR(".$objet.", '[".$lang."]')+ LENGTH('[".$lang."]')-1) ) )) ".
+		"          ) ".
+		"     ) ".
+		"))) AS multi ";
+
+	return $retour;
+}
+
+
 ?>

Index: inc_lang.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_lang.php3,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -d -r1.9 -r1.10
--- inc_lang.php3	18 Aug 2005 23:28:33 -0000	1.9
+++ inc_lang.php3	7 Sep 2005 15:01:53 -0000	1.10
@@ -507,7 +507,6 @@
 		$lang_demandee = $_GET['lang'];
 
 	// Verifier que la langue demandee existe
-	include_ecrire('inc_lang.php3');
 	lang_select($lang_demandee);
 	$lang_demandee = $spip_lang;
 

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- inc_presentation.php3	18 Aug 2005 23:28:33 -0000	1.11
+++ inc_presentation.php3	7 Sep 2005 15:01:53 -0000	1.12
@@ -489,8 +489,10 @@
 
 	$query = trim($query);
 	$query_count = eregi_replace('^(SELECT)[[:space:]].*[[:space:]](FROM)[[:space:]]', '\\1 COUNT(*) \\2 ', $query);
-
+	$query_count = eregi_replace('ORDER[[:space:]]+BY.*$', '', $query_count);
+	
 	list($num_rows) = spip_fetch_array(spip_query($query_count));
+	
 	if (!$num_rows) return;
 
 	$nb_aff = 10;
@@ -858,7 +860,7 @@
 
 		if ($options == "avancees") { // Afficher le numero (JMB)
 			if ($afficher_auteurs) {
-				$largeurs = array(11, '', 80, 100, 35);
+				$largeurs = array(11, '', 80, 100, 50);
 				$styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
 			} else {
 				$largeurs = array(11, '', 100, 35);
@@ -2007,7 +2009,7 @@
 
 function afficher_javascript ($html) {
 	  return http_script("
-document.write(\"" . addslashes(str_replace("\n", " ", $html))."\")");
+document.write(\"" . addslashes(strtr($html, "\n\r", "  "))."\")");
 }
 
 function debut_page($titre = "", $rubrique = "asuivre", $sous_rubrique = "asuivre", $onLoad = "") {
@@ -2146,13 +2148,6 @@
 			if ($articles_mots != "non") {
 				icone_bandeau_secondaire (_T('icone_mots_cles'), "mots_tous.php3", "mot-cle-24.gif", "mots", $sous_rubrique);
 			}
-			///////////////////////////////////////
-			//MODIFICATION
-			///////////////////////////////////////
-			if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) 
-				icone_bandeau_secondaire (_T('mot-partout'), "mots_partout.php", "mot-cle-24.gif", "mots++", $sous_rubrique);
-			///////////////////////////////////////
-			
 
 			$activer_sites = lire_meta('activer_sites');
 			if ($activer_sites<>'non')
@@ -2164,6 +2159,9 @@
 			//if (@spip_num_rows(spip_query("SELECT * FROM spip_documents_rubriques LIMIT 0,1")) > 0) {
 			//	icone_bandeau_secondaire (_T('icone_doc_rubrique'), "documents_liste.php3", "doc-24.gif", "documents", $sous_rubrique);
 			//}
+			if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) 
+				icone_bandeau_secondaire (_T('mot-partout'), "mots_partout.php", "mot-cle-24.gif", "mots++", $sous_rubrique);
+
 			//une requete en moins ...
 			if (lire_meta('documents_rubrique')== 'oui') 
 				icone_bandeau_secondaire (_T('icone_doc_rubrique'), "documents_liste.php3", "doc-24.gif", "documents", $sous_rubrique);
@@ -3078,10 +3076,7 @@
 		$titre=_T('info_installation_systeme_publication');
 
 	echo debut_entete($titre),
-	  "<meta http-equiv='Expires' content='0'>
-	<meta http-equiv='cache-control' content='no-cache,no-store'>
-	<meta http-equiv='pragma' content='no-cache'>
-	<style type='text/css'>
+	  "<style type='text/css'>
 	<!--
 	a {text-decoration: none; }
 	A:Hover {color:#FF9900; text-decoration: underline;}

--- optimiser.php3 DELETED ---



From stef at berlios.de  Wed Sep  7 17:01:55 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 7 Sep 2005 17:01:55 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang ecrire_eo.php3,1.3,1.4 ecrire_eu.php3,1.1,1.2 ecrire_ro.php3,1.2,1.3 ecrire_oc_prv.php3,1.3,1.4 spip_oc_lms.php3,1.3,1.4 ecrire_hu.php3,1.3,1.4 ecrire_oc_gsc.php3,1.3,1.4 spip_oc_ni_la.php3,1.2,1.3 spip_oc_gsc.php3,1.3,1.4 ecrire_pl.php3,1.3,1.4 spip_oc_prv.php3,1.4,1.5 ecrire_zh.php3,1.3,1.4 ecrire_da.php3,1.3,1.4 ecrire_lb.php3,1.5,1.6 spip_ca.php3,1.5,1.6 spip_eo.php3,1.4,1.5 spip_oc_va.php3,1.4,1.5 ecrire_oc_va.php3,1.3,1.4 ecrire_oc_ni_la.php3,1.2,1.3 spip_oc_lnc.php3,1.4,1.5 ecrire_fon.php3,1.3,1.4 ecrire_oc_lnc.php3,1.4,1.5 ecrire_oc_auv.php3,1.3,1.4 ecrire_oc_lms.php3,1.3,1.4 spip_oc_auv.php3,1.3,1.4
Message-ID: <200509071501.j87F1tAD032229@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv32010/ecrire/lang

Modified Files:
	ecrire_eo.php3 ecrire_eu.php3 ecrire_ro.php3 
	ecrire_oc_prv.php3 spip_oc_lms.php3 ecrire_hu.php3 
	ecrire_oc_gsc.php3 spip_oc_ni_la.php3 spip_oc_gsc.php3 
	ecrire_pl.php3 spip_oc_prv.php3 ecrire_zh.php3 ecrire_da.php3 
	ecrire_lb.php3 spip_ca.php3 spip_eo.php3 spip_oc_va.php3 
	ecrire_oc_va.php3 ecrire_oc_ni_la.php3 spip_oc_lnc.php3 
	ecrire_fon.php3 ecrire_oc_lnc.php3 ecrire_oc_auv.php3 
	ecrire_oc_lms.php3 spip_oc_auv.php3 
Log Message:
spip 1.8.2d

Index: ecrire_eo.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_eo.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_eo.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_eo.php3	7 Sep 2005 15:01:51 -0000	1.4
@@ -79,9 +79,9 @@
 'bouton_radio_envoi_annonces_adresse' => 'Sendi la anoncojn al jena adreso:',
 'bouton_radio_envoi_liste_nouveautes' => 'Sendi liston de la nova&#309;oj',
 'bouton_radio_moderation_priori' => 'Apriora mastrumado (kontribua&#309;oj estas publikigataj nur post validigo de mastrumanto).',
-'bouton_radio_modere_abonnement' => 'mastrumata nur per abono',
-'bouton_radio_modere_posteriori' => 'aposteriore mastrumata',
-'bouton_radio_modere_priori' => 'apriore mastrumata',
+'bouton_radio_modere_abonnement' => '<MODIF>mastrumata nur per abono',
+'bouton_radio_modere_posteriori' => '<MODIF>aposteriore mastrumata',
+'bouton_radio_modere_priori' => '<MODIF>apriore mastrumata',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Ne aperigi en listo de la redaktantoj',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Ne sendi &#265;efartikolajn anoncojn',
 'bouton_radio_non_syndication' => 'Neniu kunligado',
@@ -234,7 +234,6 @@
 'info_ajout_participant' => 'La jena partoprenanto estas aldonita&nbsp;:',
 'info_ajouter_rubrique' => 'Aldoni alian administrendan rubrikon:',
 'info_annonce_nouveautes' => 'Anonco pri nova&#309;oj',
-'info_annuler_blocage_priori' => 'Apriore nuligi tiun blokadon',
 'info_anterieur' => 'anta&#365;a',
 'info_appliquer_choix_moderation' => 'Apliki tiun mastrum-elekton:',
 'info_article' => 'artikolo',
@@ -256,6 +255,7 @@
 'info_avertissement' => 'Averto',
 'info_base_installee' => 'La strukturo de via datenbazo estas instalita.',
 'info_base_restauration' => 'La datenbazo estas nun resta&#365;rata.',
+'info_bloquer' => '<NEW>bloquer',
 'info_breves' => '&#264;u via teksejo uzas la informetilon ?',
 'info_breves_03' => ' informetoj',
 'info_breves_liees_mot' => 'La informetoj ligitaj kun tiu &#349;losilvorto',
@@ -291,7 +291,6 @@
 'info_date_publication_anterieure' => 'Dato de anta&#365;a redaktado :',
 'info_date_referencement' => 'DATO DE REFERENCIGO DE TIU teksejo:',
 'info_delet_mots_cles' => 'Vi petis forigon de la &#349;losilvorto <B>@titre_mot@</b> (@type_mot@). Tiu &#349;losilvorto estante ligita al <b>@texte_lie@</b> vi devas konfirmi tiun decidon:',
-'info_demander_blocage_priori' => 'Peti aprioran blokadon',
 'info_derniere_etape' => 'Lasta etapo: <b>finite!',
 'info_derniere_syndication' => 'La lasta kunligado de tiu teksejo efektivi&#285;is la ',
 'info_derniers_articles_publies' => 'Viaj artikoloj laste publikigitaj sur la reto',
@@ -453,6 +452,7 @@
 'info_procedure_maj_version' => 'la proceduro de &#285;isdatigo devas esti lan&#265;ita por adapti
 	la datenbazon al la nova versio de SPIP.',
 'info_ps' => 'P.S',
+'info_publier' => '<NEW>publier',
 'info_publies' => 'Viaj artikoloj rete publikigitaj',
 'info_question_accepter_visiteurs' => 'Se via skeleto permesas la registradon de vizitantoj kiuj ne rajtas aliri la privatan spacon, bonvolu aktivigi la &#265;i-supran opcion:',
 'info_question_gerer_statistiques' => '&#264;u via retpa&#285;o devas mastrumi la statistikojn de la vizitoj&nbsp;?',
@@ -715,6 +715,12 @@
 
 // S
 'statut_admin_restreint' => '(etrajta administranto)',
+'syndic_choix_moderation' => '<NEW>Que faire des prochains liens en provenance de ce site&nbsp;?',
+'syndic_choix_oublier' => '<NEW>Que faire des liens qui ne figurent plus dans le fichier de syndication&nbsp;?',
+'syndic_lien_obsolete' => '<NEW>lien obsol&egrave;te',
+'syndic_option_miroir' => '<NEW>les bloquer automatiquement',
+'syndic_option_oubli' => '<NEW>les effacer (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => '<NEW>Options de syndication&nbsp;:',
 
 
 // T
@@ -784,8 +790,6 @@
 'texte_date_publication_anterieure' => 'DATO DE ANTA&#364;A REDAKTADO&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Ne afi&#349;i daton de anta&#365;a redaktado.',
 'texte_date_publication_article' => 'DATO DE RETA PUBLIKIGO&nbsp;:',
-'texte_demander_blocage_priori' => 'La venontaj ligoj devenantaj
-				de tiu teksejo estos apriore blokitaj.',
 'texte_descriptif_petition' => 'Priskribo de la subskriblisto',
 'texte_descriptif_rapide' => 'Konciza priskribo',
 'texte_documents_joints' => 'Vi povas permesi la aldonon de dokumentoj (oficejajn dosierojn, bildojn,
@@ -826,8 +830,6 @@
 			ligon unuope, a&#365; elekti unuope la teksejojn
 			kies estontaj ligoj
 			estu blokitaj.',
-'texte_liens_syndication' => 'La sekvaj ligoj el tiu &#265;i teksejo estos tuj
-				afi&#349;itaj en la publika spaco.',
 'texte_login_ldap_1' => 'Lasu malplena por anonima aliro, a&#365; enigu la kompletan vojon, ekzemple &laquo;&nbsp;<tt>uid=dupont, ou=users, dc=mon-domaine, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Atentu&nbsp;! Tio &#265;i estas la salutnomo sub kiu vi estas nun konektita.
 	Uzu tiun &#265;i formularon prudente...',

Index: ecrire_eu.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_eu.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- ecrire_eu.php3	30 Jun 2005 10:09:36 -0000	1.1
+++ ecrire_eu.php3	7 Sep 2005 15:01:51 -0000	1.2
@@ -8,35 +8,35 @@
 // A
 'aide_non_disponible' => 'On line delakoaren laguntza-atal hau prestatzeke dago hizkuntza honetan.',
 'avis_acces_interdit' => 'Sarrera Debekatua',
-'avis_article_modifie' => 'Adi egon, (@nom_auteur_modif@) lan honetan aritu zen orain dela(@date_diff@)minutu.',
+'avis_article_modifie' => 'Adi egon,(@nom_auteur_modif@) lan honetan aritu zen orain dela(@date_diff@)minutu.',
 'avis_aucun_resultat' => 'Ez dago emaitzarik.',
 'avis_chemin_invalide_1' => 'Aukeratutako bideak',
-'avis_chemin_invalide_2' => 'ez dirudi egokia. Itzul zaitez aurreko orrialdera eta egiazta itzazu sartutako informazioak.',
+'avis_chemin_invalide_2' => 'ez dirudi egokia. Itzul zaitezaurreko orrialdera eta egiazta itzazu sartutako informazioak.',
 'avis_connexion_echec_1' => 'MySQL zerbitzariarekiko lokarriak huts egin du.',
 'avis_connexion_echec_2' => 'Itzul zaitez aurreko orrialdera eta egiazta itzazu sartutako informazioak.',
[...1401 lines suppressed...]
+'titre_suivi_petition' => 'Eskaerenkudeaketa',
 'titre_syndication' => 'Tokien elkarpena',
-'tout_dossier_upload' => '<NEW>Tout le dossier @upload@',
+'tout_dossier_upload' => '<MODIF>Karpeta osoa @upload@',
 'trad_article_inexistant' => 'Zenbaki horrekin ez dago artikulurik',
 'trad_article_traduction' => 'Artikulu honen bertsio guztiak:',
 'trad_deja_traduit' => 'Artikuluaren instantzia hau dagoeneko itzulpen bat da',
-'trad_delier' => 'Jada ez lotu artikulu hau bere itzulpenekin ',
-'trad_lier' => 'Artikulu hau   artikuluaren itzulpena da',
+'trad_delier' => 'Jada ez lotuartikulu hau bere itzulpenekin ',
+'trad_lier' => 'Artikulu hau artikuluaren itzulpena da',
 'trad_new' => 'Artikulu honen itzulpen berria idatzi',
 
 
 // V
-'version_initiale' => 'Hasierako bertsioa'
+'version_initiale' => 'Hasierako bertsioioa'
 
 );
 

Index: ecrire_ro.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_ro.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- ecrire_ro.php3	21 Jul 2005 21:47:13 -0000	1.2
+++ ecrire_ro.php3	7 Sep 2005 15:01:51 -0000	1.3
@@ -235,8 +235,6 @@
 'info_ajout_participant' => 'Participantul urm&#259;tor a fost ad&#259;ugat&nbsp;:',
 'info_ajouter_rubrique' => 'Ad&#259;uga&#355;i o alt&#259; rubric&#259; de administrat&nbsp;:',
 'info_annonce_nouveautes' => 'Anun&#355;ul nout&#259;&#355;ilor',
-'info_annuler_blocage_priori' => 'Anula&#355;i
-    acest blocaj &agrave; priori',
 'info_anterieur' => 'anterior',
 'info_appliquer_choix_moderation' => 'Aplica&#355;i aceast&#259; alegere de moderare&nbsp;:',
 'info_article' => 'articol',
@@ -297,8 +295,6 @@
 'info_delet_mots_cles' => 'A&#355;i cerut &#351;tergerea cuv&acirc;ntului-cheie
 <b>@titre_mot@</b> (@type_mot@). Acest cuv&acirc;nt-cheie fiind legat de
 <b>@texte_lie@</b> v&#259; rug&#259;m s&#259; confirma&#355;i aceast&#259; decizie&nbsp;:',
-'info_demander_blocage_priori' => 'Cere&#355;i
-    un blocaj &agrave; priori',
 'info_derniere_etape' => 'Ultima etap&#259;: <b>Gata !</b>',
 'info_derniere_syndication' => 'Ultima sindicalizare a acestui site a fost f&#259;cuta la data de',
 'info_derniers_articles_publies' => 'Articolele dumneavoastr&#259; publicate recent',
@@ -789,8 +785,6 @@
 'texte_date_publication_anterieure' => 'DATA REDACT&#258;RII ANTERIOARE&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Nu afi&#351;a&#355;i data redact&#259;rii anterioare.',
 'texte_date_publication_article' => 'DATA PUBLIC&#258;RII &Icirc;N LINIE&nbsp;:',
-'texte_demander_blocage_priori' => 'Urm&#259;toarele leg&#259;turi provenind de la
-   acest site vor fi blocate &agrave; priori.',
 'texte_descriptif_petition' => 'Descrierea peti&#355;iei',
 'texte_descriptif_rapide' => 'Descriere pe scurt',
 'texte_documents_joints' => 'Pute&#355;i autoriza ad&#259;ugarea de documente (fi&#351;iere de birotic&#259;, imagini, fi&#351;iere multimedia, &#351;.a.m.d.)
@@ -825,8 +819,6 @@
    site-urilor sindicalizate dup&#259; crearea lor. Este
    posibil dup&#259; aceea s&#259; debloca&#355;i fiecare leg&#259;tur&#259; &icirc;n mod individual, sau s&#259;
    alege&#355;i, site cu site, s&#259; bloca&#355;i leg&#259;turile.',
-'texte_liens_syndication' => 'Urm&#259;toarele leg&#259;turi provenind de la
-    acest site vor fi afi&#351;ate imediat pe site-ul dumneavoastr&#259; public.',
 'texte_login_ldap_1' => '(L&#259;sa&#355;i gol pentru un acces anonim, sau introduce&#355;i o cale complet&#259;, de exemplu: &laquo;&nbsp;<tt>uid=ionescu, ou=utilizatori, dc=domeniul-meu, dc=ro</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Aten&#355;ie&nbsp;! Acesta este login-ul cu care sunte&#355;i conectat acum.
  Utiliza&#355;i acest formular cu precau&#355;ie...',

Index: ecrire_oc_prv.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_prv.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_oc_prv.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_oc_prv.php3	7 Sep 2005 15:01:51 -0000	1.4
@@ -239,7 +239,6 @@
 'info_ajout_participant' => 'Lo participant seguent es apondut:',
 'info_ajouter_rubrique' => 'Apondre una autra rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci dei novetats',
-'info_annuler_blocage_priori' => 'Anullar aqueu blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar aquela chausida de moderacion:',
 'info_article' => 'article',
@@ -261,6 +260,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de v&ograve;stra basa de donadas es installada.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'V&ograve;stre sit utiliza lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Lei br&egrave;vas liadas a aqueu mot clau',
@@ -298,7 +298,6 @@
 'info_delet_mots_cles' => 'Av&egrave;tz demandat de suprimir lo mot clau
  <B>@titre_mot@</b> (@type_mot@). Aqueu mot clau es ligat a
  <b>@texte_lie@</b>. Dev&egrave;tz confirmar aquela decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darriera estapa: <B>Es acabat!',
 'info_derniere_syndication' => 'La darriera sindicacion d\'aqueu sit se fagu&egrave;t lo',
 'info_derniers_articles_publies' => 'V&ograve;strei darriers articles publicats en linha',
@@ -465,6 +464,7 @@
 'info_procedure_maj_version' => 'Cau lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donadas a la version nov&egrave;la d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'V&ograve;streis articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'ais esqueletas de v&ograve;stre sit web se prevei lo registrament de vesitaires sens acc&egrave;s a l\'espaci privat, vougatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, v&ograve;stre sit, leis estadisticas dei vesitas?',
@@ -726,6 +726,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrench)',
+'syndic_choix_moderation' => 'Que se p&ograve;t far amb lei liames venents que provenon d\'aqueu sit?',
+'syndic_choix_oublier' => 'Que se p&ograve;t far amb lei liames que figuran pus dins lo fichier de sindicacion?',
+'syndic_lien_obsolete' => 'liame obsolet',
+'syndic_option_miroir' => 'lei blocar sus lo c&ograve;p',
+'syndic_option_oubli' => 'leis escafar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindication:',
 
 
 // T
@@ -785,8 +791,6 @@
 'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Afichar ges de data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Lei liames seguents
- que provenon d\'aqueu sit ser&agrave;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Pod&egrave;tz autorizar que s\'apondan de documents (fichiers burotics, imatges,
@@ -826,8 +830,6 @@
     es possible puei de 
    desblocar cada liame individualament, o de
    chausir, sit per sit, de blocar lei liames avenidors.',
-'texte_liens_syndication' => 'Lei liames venents que 
-   provenon d\'aqueu sit s\'afichar&agrave;n sus lo c&ograve;p dins lo sit public.',
 'texte_login_ldap_1' => '(Laissar vuege per un acc&egrave;s anonim, o picar lo camin complet, per exemple &laquo;<tt>uid=fabre, ou=usanciers, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Aqu&ograve;\'s lo login amb lo quau siatz ara connectat/ada. 
  Utilizatz aquest formulari amb precaucion...',

Index: spip_oc_lms.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_lms.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_lms.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_oc_lms.php3	7 Sep 2005 15:01:51 -0000	1.4
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar quela rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Alerta!</b> Quo es impossible d\'actualizar la basa MySQL vers la version @version@; benleu i a un problema relatiu au drech de modificar la basa de donadas. Volhatz contactar v&ograve;stre auberjador.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichier archiu es pas un fichier SPIP',
 'avis_archive_invalide' => 'lo fichier archiu es pas valid',
 'avis_attention' => 'ATENCION!',

Index: ecrire_hu.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_hu.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_hu.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_hu.php3	7 Sep 2005 15:01:51 -0000	1.4
@@ -242,8 +242,6 @@
 'info_ajout_participant' => 'A k&ouml;vetkez&#337; r&eacute;sztvev&#337; hozz&aacute; van t&eacute;ve&nbsp;:',
 'info_ajouter_rubrique' => '&Uacute;jabb adminisztr&aacute;land&oacute; rovat l&eacute;trehoz&aacute;sa&nbsp;:',
 'info_annonce_nouveautes' => 'Az &uacute;jdons&aacute;gok k&ouml;zl&eacute;se',
-'info_annuler_blocage_priori' => 'T&ouml;r&ouml;lni
-    ezt az eleve blokkol&aacute;st',
 'info_anterieur' => 'el&ouml;z&#337;',
 'info_appliquer_choix_moderation' => 'Alkalmazni ezt a moder&aacute;l&aacute;si v&aacute;laszt&aacute;st&nbsp;:',
 'info_article' => 'cikk',
@@ -302,8 +300,6 @@
 'info_delet_mots_cles' => 'K&eacute;rte, hogy t&ouml;r&ouml;lve legyen a kulcssz&oacute;
 <B>@titre_mot@</B> (@type_mot@). Mivel ez a kulcssz&oacute; ehhez kapcsol&oacute;dik
 <b>@texte_lie@</b>, meg kell er&#337;s&iacute;teni ezt a d&ouml;nt&eacute;st&nbsp;:',
-'info_demander_blocage_priori' => 'K&eacute;rni
-    az eleve blokkol&aacute;st',
 'info_derniere_etape' => 'Utols&oacute; l&eacute;p&eacute;s : <B>V&eacute;ge van !',
 'info_derniere_syndication' => 'A honlap legutols&oacute; szindik&aacute;l&aacute;sa ker&uuml;lt sor',
 'info_derniers_articles_publies' => 'Az &Ouml;n legutols&oacute; publik&aacute;lt cikkei',
@@ -780,8 +776,6 @@
 'texte_date_publication_anterieure' => 'El&ouml;z&#337; szerkeszt&eacute;s d&aacute;tuma&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Nem kell megjelen&iacute;teni az el&ouml;z&#337; szerkeszt&eacute;s(ek) id&#337;pontj&aacute;t.',
 'texte_date_publication_article' => 'NYILV&Aacute;NOS PUBLIK&Aacute;L&Aacute;S ID&#336;PONTJA&nbsp;:',
-'texte_demander_blocage_priori' => 'A leend&#337; linkek, melyek
-    sz&aacute;rmaznak err&#337;l a honlapr&oacute;l eleve tiltva lesznek.',
 'texte_descriptif_petition' => 'Az al&aacute;&iacute;r&aacute;sgy&#369;jt&eacute;s le&iacute;r&aacute;sa',
 'texte_descriptif_rapide' => 'R&ouml;vid le&iacute;r&aacute;s',
 'texte_documents_joints' => 'Engedely&eacute;zheti a dokumentumok hozz&aacute;ad&aacute;s&aacute;t (irodai f&aacute;jlok, k&eacute;pek,
@@ -813,7 +807,6 @@
 'texte_liens_sites_syndiques' => 'A szindik&aacute;lt honlapokr&oacute;l sz&aacute;rmaz&oacute; linkeket lehetnek eleve tiltva&nbsp;; a lenti be&aacute;ll&iacute;t&aacute;s jelzi a szindik&aacute;lt honlapok alap&eacute;rtelmezett be&aacute;ll&iacute;t&aacute;s&aacute;t l&eacute;trehoz&aacute;suk ut&aacute;n.
 Egy&eacute;bkent minden linket lehet ut&oacute;lag enged&eacute;lyezni egyenk&eacute;nt, vagy honlap szerint tiltani a leend&#337; linkeket.
 ',
-'texte_liens_syndication' => 'E honlapr&oacute;l sz&aacute;rmaz&oacute; leend&#337; linkek azonnal lesznek publik&aacute;lva a nyilv&aacute;nos honlapon.',
 'texte_login_ldap_1' => '(N&eacute;vtelen hozz&aacute;f&eacute;r&eacute;shez &uuml;resen kell hagyni, vagy be&iacute;rni a teljes utat p&eacute;ld&aacute;ul &laquo;&nbsp;<tt>uid=azennevem, ou=users, dc=azen-domainem, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Vigy&aacute;zat&nbsp;! Ez az a login, amivel jelenleg csatlakozva van.
  Ezt az &#369;rlapot &oacute;vatosan haszn&aacute;lja...',

Index: ecrire_oc_gsc.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_gsc.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_oc_gsc.php3	30 Jun 2005 10:09:36 -0000	1.3
+++ ecrire_oc_gsc.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -239,7 +239,6 @@
 'info_ajout_participant' => 'Lo participant seguent qu\'ei ajustat:',
 'info_ajouter_rubrique' => 'Ajustar ua auta rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci de las nautats',
-'info_annuler_blocage_priori' => 'Anullar aqueth blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar aquera causida de moderacion:',
 'info_article' => 'article',
@@ -261,6 +260,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de la v&ograve;sta basa de dadas qu\'ei installada.',
 'info_base_restauration' => 'La basa qu\'ei en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'Utiliza, lo v&ograve;ste sit, lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Las br&egrave;vas ligadas a aqueth mot clau',
@@ -298,7 +298,6 @@
 'info_delet_mots_cles' => 'Qu\'avetz demandat de suprimir lo mot clau
 <B>@titre_mot@</b> (@type_mot@). Aqueth mot clau qu\'ei ligat a
  <b>@texte_lie@</b>. Que devetz confirmar aquera decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darr&egrave;ra estapa: <B>Qu\'ei acabat!',
 'info_derniere_syndication' => 'La darr&egrave;ra sindicacion d\'aqueth sit que\'s has&oacute; lo',
 'info_derniers_articles_publies' => 'Los v&ograve;stes darr&egrave;rs articles publicats en linha',
@@ -465,6 +464,7 @@
 'info_procedure_maj_version' => 'Que cau lan&ccedil;ar la procedura d\'actualizacion t&agrave; adaptar
  la basa de dadas a la version nav&egrave;ra d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'Los v&ograve;stes articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'a las esqueletas deu v&ograve;ste sit web e\'s preved lo registrament de vesitaires shens acc&egrave;s a l\'espaci privat, volhatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'E deu gerir, lo v&ograve;ste sit, las estadisticas de las vesitas?',
@@ -726,6 +726,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrent)',
+'syndic_choix_moderation' => 'Que\'s p&ograve;t har dab los ligams vienents qui provienen d\'aqueth sit?',
+'syndic_choix_oublier' => 'Que\'s p&ograve;t har dab los ligams qui figuran pas pus dens lo fichi&egrave;r de sindicacion?',
+'syndic_lien_obsolete' => 'ligam obsolet',
+'syndic_option_miroir' => 'bloc&agrave;\'us suu c&ograve;p',
+'syndic_option_oubli' => 'escaf&agrave;\'us (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -785,8 +791,6 @@
 'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'N\'afichar pas nada data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Los ligams seguents
- qui provienen d\'aqueth sit que ser&agrave;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Que podetz autorizar que s\'ajusten documents (fichi&egrave;rs burotics, imatges,
@@ -826,8 +830,6 @@
     qu\'ei possible puish de 
    desblocar cada ligam individuaument, o de
    causir, sit per sit, de blocar los ligams avieneders.',
-'texte_liens_syndication' => 'Los ligams vienents qui 
-   provienen d\'aqueth sit que s\'afichar&agrave;n suu c&ograve;p dens lo sit public.',
 'texte_login_ldap_1' => '(Deishar vueid ent&agrave; un acc&egrave;s anonim, o picar lo camin complet, per exemple &laquo;<tt>uid=fabre, ou=usanciers, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Aqu&ograve; qu\'ei lo login dab lo quau &egrave;tz ara connectat/ada. 
  Utilizatz aqueste formulari dab precaucion...',

Index: spip_oc_ni_la.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_ni_la.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- spip_oc_ni_la.php3	18 Aug 2005 23:27:16 -0000	1.2
+++ spip_oc_ni_la.php3	7 Sep 2005 15:01:52 -0000	1.3
@@ -23,7 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquela rubrica',
 'admin_recalculer' => 'Tornar calcular la p&agrave;gina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Es impossible d\'actualizar la basa MySQL v&egrave;rs la version @version@; benl&egrave;u i a un probl&egrave;ma relatiu au drech de modificar la basa de donadas. Vorgatz contactar lo v&ograve;stre aubergador.',
-'analyse_xml' => '<NEW>Analyse XML',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichier archiu non es un fichier SPIP',
 'avis_archive_invalide' => 'lo fichier archiu non es valid',
 'avis_attention' => 'ATENCION!',

Index: spip_oc_gsc.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_gsc.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_gsc.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_oc_gsc.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquera rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Qu\'ei impossible d\'actualizar la basa MySQL de cap t&agrave; la version @version@; dilh&egrave;u que i a un probl&egrave;ma relatiu au dret de modificar la basa de dadas. Volhatz contactar lo v&ograve;ste aubergader.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichi&egrave;r archiu n\'ei pas un fichi&egrave;r SPIP',
 'avis_archive_invalide' => 'lo fichi&egrave;r archiu n\'ei pas valid',
 'avis_attention' => 'ATENCION!',

Index: ecrire_pl.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_pl.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_pl.php3	30 Jun 2005 10:09:36 -0000	1.3
+++ ecrire_pl.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -246,8 +246,6 @@
 'info_ajout_participant' => 'Nast&#281;puj&#261;cy uczestnik zosta&#322; dodany:',
 'info_ajouter_rubrique' => 'Dodaj dzia&#322; do zarz&#261;dzania&nbsp;:',
 'info_annonce_nouveautes' => 'Zapowiedzi najnowszych news&oacute;w',
-'info_annuler_blocage_priori' => 'Anulowa&#263;
-    domy&#347;lnie ustawion&#261; blokad&#281;',
 'info_anterieur' => 'poprzedni',
 'info_appliquer_choix_moderation' => 'Wybierze ten spos&oacute;b moderowania:',
 'info_article' => 'artyku&#322;',
@@ -306,8 +304,6 @@
 'info_delet_mots_cles' => 'Zarz&#261;da&#322;e&#347; usuni&#281;cia s&#322;owa kluczowego
 <B>@titre_mot@</b> (@type_mot@). To s&#322;owo jest powi&#261;zane z
 <b>@texte_lie@</b>musisz potwierdzi&#263; swoj&#261; decyzj&#281;:',
-'info_demander_blocage_priori' => 'Zapytaj
-    ustawienia domy&#347;lnej blokady',
 'info_derniere_etape' => 'Ostatni krok: <B>Zako&#324;czone!',
 'info_derniere_syndication' => 'Ostatnia syndykacja tego serwisu zosta&#322;a dokonana',
 'info_derniers_articles_publies' => 'Twoje ostatnie opublikowane artyku&#322;y',
@@ -809,8 +805,6 @@
 'texte_date_publication_anterieure' => 'Data poprzedniej publikacji&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Ukryj dat&#281; poprzedniej publikacji.',
 'texte_date_publication_article' => 'DATA PUBLIKACJI ONLINE:',
-'texte_demander_blocage_priori' => 'Kolejne linki pochodz&#261;ce
-z tej strony, zostan&#261; automatycznie zablokowane.',
 'texte_descriptif_petition' => 'Opis og&#322;oszenia',
 'texte_descriptif_rapide' => 'Kr&oacute;tki opis',
 'texte_documents_joints' => 'Mo&#380;esz autoryzowa&#263; dodawanie dokument&oacute;w tekstowych, obrazk&oacute;w,
@@ -848,7 +842,6 @@
    stron syndykowanych po ich stworzeniu. Jest
    mo&#380;liwe p&oacute;&#378;niejsze odblokowanie, &#322;&#261;czy indywidualnie, lub
    wyb&oacute;r, strona po stronie, blokady link&oacute;w pochodz&#261;cych z danych stron.',
-'texte_liens_syndication' => 'Kolejne linki pochodz&#261;ce z tej strony b&#281;d&#261; wy&#347;wietlane automatycznie w serwisie publicznym.',
 'texte_login_ldap_1' => '(Pozostaw puste przy dost&#281;pie anonimowym, lub wpisz pe&#322;n&#261; &#347;cie&#380;k&#281;, np. &laquo;&nbsp;<tt>uid=dupont, ou=users, dc=mon-domaine, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Uwaga&nbsp;! To jest login, z kt&oacute;rego pomoc&#261; jeste&#347; teraz po&#322;&#261;czony.
  U&#380;ywaj tego formularza ostro&#380;nie...',

Index: spip_oc_prv.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_prv.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_oc_prv.php3	21 Jul 2005 21:47:13 -0000	1.4
+++ spip_oc_prv.php3	7 Sep 2005 15:01:52 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquela rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Es impossible d\'actualizar la basa MySQL v&egrave;rs la version @version@; benl&egrave;u i a un probl&egrave;ma relatiu au drech de modificar la basa de donadas. Vougatz contactar v&ograve;stre aubergador.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichier archiu es pas un fichier SPIP',
 'avis_archive_invalide' => 'lo fichier archiu es pas valid',
 'avis_attention' => 'ATENCION!',
@@ -32,7 +33,7 @@
 'avis_echec_syndication_02' => 'La sindicacion s\'es encalada: impossible d\'accedir au backend d\'aqueu sit.',
 'avis_erreur' => 'Error: vejatz &ccedil;ai sota',
 'avis_erreur_connexion' => 'Error de connexion',
-'avis_erreur_cookie' => '<MODIF>',
+'avis_erreur_cookie' => 'probl&egrave;ma de cookie',
 'avis_erreur_fonction_contexte' => 'Error de programacion. Cau pas apelar aquela foncion dins aqueu cont&egrave;xt.',
 'avis_erreur_mysql' => 'Error MySQL ',
 'avis_erreur_sauvegarde' => 'Error dins la sauvagarda (@type@ @id_objet@)! ',
@@ -77,10 +78,10 @@
 'cal_par_jour' => 'calendier per jorn',
 'cal_par_mois' => 'calendier per mes',
 'cal_par_semaine' => 'calendier per setmana',
-'calendrier_synchro_lien' => '',
-'calendrier_synchro_prive' => '',
-'calendrier_synchro_public' => '',
-'calendrier_synchro_sync' => '',
+'calendrier_synchro_lien' => 'Recuperar lo fichier <i>iCal</i>',
+'calendrier_synchro_prive' => 'Lo calendier seguent, d\'us estrictament personau, vos informa de l\'activitat editoriala privada d\'aquest sit (&ograve;bras e rend&egrave;tz-vos personaus, articles e br&egrave;vas prepausats...).',
+'calendrier_synchro_public' => 'Lo calendier seguent permet de seguir l\'activitat de l\'espaci public d\'aquest sit (articles e br&egrave;vas publicats).',
+'calendrier_synchro_sync' => 'Sincronizar lo fichier <i>iCal</i><br> (Mozilla Calendar, Apple iCal...)',
 'confirm_changer_statut' => 'Atencion, av&egrave;tz demandat de cambiar l\'estatut d\'aquel element. Desiratz de contunhar? ',
 
 
@@ -258,8 +259,8 @@
 'form_prop_sujet' => 'Subj&egrave;cte',
 'form_prop_url_site' => 'Adrei&ccedil;a (URL) dau sit',
 'forum_acces_refuse' => 'Pod&egrave;tz pus accedir a aquelei forums.',
-'forum_attention_dix_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
-'forum_attention_trois_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
+'forum_attention_dix_caracteres' => '<b>Atencion!</b> v&ograve;stre messatge deu tenir aumens d&egrave;tz caract&egrave;rs.',
+'forum_attention_trois_caracteres' => '<b>Atencion!</b> v&ograve;stre t&iacute;tol deu tenir aumens tres caract&egrave;rs.',
 'forum_avez_selectionne' => 'Av&egrave;tz seleccionat:',
 'forum_cliquer_retour' => 'Clicatz <a href=\'@retour_forum@\'>aic&iacute;</a> per contunhar.',
 'forum_forum' => 'forum',

Index: ecrire_zh.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_zh.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_zh.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_zh.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -242,8 +242,6 @@
 'info_ajout_participant' => '&#19979;&#21015;&#21442;&#32771;&#32773;&#24050;&#32463;&#21152;&#20837;:',
 'info_ajouter_rubrique' => '&#21152;&#20837;&#20854;&#23427;&#19987;&#26639;&#36827;&#34892;&#31649;&#29702;:',
 'info_annonce_nouveautes' => '&#26368;&#36817;&#30340;&#26032;&#38395;&#22768;&#26126;',
-'info_annuler_blocage_priori' => '&#21462;&#28040;
-    &#39044;&#20808;&#30340;&#27169;&#22359;',
 'info_anterieur' => '&#36820;&#22238;',
 'info_appliquer_choix_moderation' => '&#24212;&#29992;&#32531;&#20914;&#36873;&#25321;:',
 'info_article' => '&#25991;&#31456;',
@@ -302,8 +300,6 @@
 'info_delet_mots_cles' => '&#20320;&#34987;&#35831;&#27714;&#21024;&#38500;&#20851;&#38190;
 <B>@titre_mot@</b> (@type_mot@). &#20851;&#38190;&#35789;&#34987;&#36830;&#21040;
 <b>@texte_lie@</b>&#20320;&#24517;&#39035;&#30830;&#35748;&#20915;&#23450;:',
-'info_demander_blocage_priori' => '&#35831;&#27714;
-    &#39044;&#20808;&#38459;&#27490;',
 'info_derniere_etape' => '&#26368;&#21518;&#19968;&#27493;: <B>&#23436;&#25104;&#20102;!',
 'info_derniere_syndication' => '&#31449;&#28857;&#30340;&#26368;&#36817;&#32852;&#21512;&#24049;&#31227;&#20986;',
 'info_derniers_articles_publies' => '&#20320;&#26368;&#36817;&#20986;&#29256;&#30340;&#25991;&#31456;',
@@ -807,8 +803,6 @@
 'texte_date_publication_anterieure' => '<MODIF>&#26356;&#26089;&#30340;&#20986;&#29256;&#26085;&#26399;',
 'texte_date_publication_anterieure_nonaffichee' => '&#38544;&#34255;&#26356;&#26089;&#30340;&#20986;&#29256;&#26085;&#26399;.',
 'texte_date_publication_article' => '<MODIF>&#22312;&#32447;&#20986;&#29256;&#26085;&#26399;:',
-'texte_demander_blocage_priori' => '&#26469;&#33258;&#36825;&#20010;&#31449;&#28857;&#30340;&#23558;&#26469;&#36830;&#25509;
-    &#23558;&#22240;&#27492;&#38459;&#27490;.',
 'texte_descriptif_petition' => '&#35831;&#27714;&#35828;&#26126;',
 'texte_descriptif_rapide' => '&#20027;&#35201;&#25551;&#36848;',
 'texte_documents_joints' => '<MODIF>&#24744;&#21487;&#20197;&#20801;&#35768;&#28155;&#21152;&#25991;&#26723; (office &#25991;&#20214;, &#22270;&#20687;, &#22810;&#23186;&#20307;&#31561;.) &#21040;&#25991;&#31456;&#21644;&#19987;&#26639;. &#36825;&#20123;&#25991;&#26723;&#33021;&#22312;&#25991;&#31456;&#20013;&#24341;&#29992;&#25110;&#21333;&#29420;&#26174;&#31034;.<p>',
@@ -847,8 +841,6 @@
    , &#25110;&#36873;&#25321;,
    &#23545;&#27599;&#19968;&#31449;&#28857;, &#38459;&#27490;&#36830;&#25509;&#26469;&#33258;
    &#20219;&#20309;&#29305;&#21035;&#30340;&#31449;&#28857;.',
-'texte_liens_syndication' => '&#23558;&#26469;&#26469;&#33258;&#36825;&#20010;&#31449;&#28857;&#30340;&#36830;&#25509;&#23558;
-    &#33258;&#21160;&#26174;&#31034;&#22312;&#20844;&#20849;&#31449;&#28857;.',
 'texte_login_ldap_1' => '(&#21311;&#21517;&#35775;&#38382;&#30041;&#31354;&#25110;&#36755;&#20837;&#23436;&#25972;&#36335;&#24452;, &#20363;&#22914; &laquo;<tt>uid=smith, ou=users, dc=my-domain, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => '&#35686;&#21578; ! &#36825;&#26159;&#20320;&#27491;&#36830;&#25509;&#30340;&#30331;&#24405;.
  &#23567;&#24515;&#20351;&#29992;&#36825;&#20010;&#34920;&#21333;...',

Index: ecrire_da.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_da.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_da.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_da.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -239,7 +239,6 @@
 'info_ajout_participant' => 'F&oslash;lgende deltager er tilf&oslash;jet:',
 'info_ajouter_rubrique' => 'Tilf&oslash;j endnu et afsnit at administrere:',
 'info_annonce_nouveautes' => 'Seneste annonceringer',
-'info_annuler_blocage_priori' => 'Oph&aelig;v forh&aring;ndssp&aelig;rring',
 'info_anterieur' => 'forrige',
 'info_appliquer_choix_moderation' => 'Anvend denne godkendelsesprocedure:',
 'info_article' => 'artikel',
@@ -298,7 +297,6 @@
 'info_delet_mots_cles' => 'Du har &oslash;nsket at slette n&oslash;gleordet
 	<B>@titre_mot@</b> (@type_mot@). Da n&oslash;gleordet er knyttet til 
 	<b>@texte_lie@</b>skal du bekr&aelig;fte sletningen:',
-'info_demander_blocage_priori' => 'Forlang forh&aring;ndssp&aelig;rring',
 'info_derniere_etape' => 'Sidste skridt: <B>Det er overst&aring;et!',
 'info_derniere_syndication' => 'Sidste syndikering af dette websted blev udf&oslash;rt den',
 'info_derniers_articles_publies' => 'Dine senest offentliggjorte artikler',
@@ -769,7 +767,6 @@
 'texte_date_publication_anterieure' => 'DATO FOR TIDLIGERE OFFENTLIGG&Oslash;RELSE',
 'texte_date_publication_anterieure_nonaffichee' => 'Skjul dato for tidligere offentligg&oslash;relse.',
 'texte_date_publication_article' => 'DATO FOR ONLINE OFFENTLIGG&Oslash;RELSE:',
-'texte_demander_blocage_priori' => 'Links der i fremtiden kommer fra dette websted vil blive sp&aelig;rret autmatisk.',
 'texte_descriptif_petition' => 'Beskrivelse af appellen',
 'texte_descriptif_rapide' => 'Kort beskrivelse',
 'texte_documents_joints' => 'Du kan tillade at dokumenter (kontorfiler, billeder,
@@ -795,7 +792,6 @@
 'texte_lien_hypertexte' => '(Hvis din meddelelse henviser til en artikel der er offentliggjort p&aring; webben, eller til en side der giver flere oplysninger, s&aring; indtast her artiklens overskrift og dens URL.)',
 'texte_liens_sites_syndiques' => 'Links til syndikerede sider kan sp&aelig;rres p&aring; forh&aring;nd; f&oslash;lgende indstilling er standardindstillingen for syndikerede websteder, n&aring;r de er oprettet.
 			Det er s&aring;ledes p&aring; trods heraf muligt at sp&aelig;rre hvert link individuelt eller at v&aelig;lge for hver websted at sp&aelig;rre de links der kommer fra en givet websted.',
-'texte_liens_syndication' => 'Fremtidige links fra dette websted vil straks blive vist i webstedets offentlige omr&aring;de.',
 'texte_login_ldap_1' => '(Efterlad tom for anonym adgang eller indtast en fuldst&aelig;ndig sti, f.eks. &laquo;<tt>uid=hansen, ou=brugere, dc=mit-dom&aelig;ne, dc=dk</tt>&raquo;.)',
 'texte_login_precaution' => 'Advarsel! Dette er den login, du er koblet p&aring; med nu.
 	Brug denne formular med forsigtighed ...',

Index: ecrire_lb.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_lb.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- ecrire_lb.php3	21 Jul 2005 21:47:13 -0000	1.5
+++ ecrire_lb.php3	7 Sep 2005 15:01:52 -0000	1.6
@@ -230,7 +230,6 @@
 'info_ajout_participant' => 'De folgenden gouf derb&auml;i gesat:',
 'info_ajouter_rubrique' => 'Eng aner Rubrik fir ze administr&eacute;ieren derb&auml;i setzen:',
 'info_annonce_nouveautes' => 'D\'Neiegkeeten annonc&eacute;ieren',
-'info_annuler_blocage_priori' => 'D&euml;se Bloquage ophiewen',
 'info_anterieur' => 'viirdrun',
 'info_appliquer_choix_moderation' => 'D&euml;s Moderatiouns-Method iwwerhuelen:',
 'info_article' => 'Artikel',
@@ -289,7 +288,6 @@
 'info_delet_mots_cles' => 'Dir w&euml;llt d\'Schl&euml;sselwuert
 <B>@titre_mot@</B> (@type_mot@) l&auml;schen. D&euml;st Wuert ass un
 <b>@texte_lie@</b> gebonnen, dir musst d&euml;s Decisioun valid&eacute;ieren:',
-'info_demander_blocage_priori' => 'Bloquage &agrave; priori fro&euml;n',
 'info_derniere_etape' => 'L&auml;schte Schr&euml;tt: <B>&Euml;t ass f&auml;rdeg!',
 'info_derniere_syndication' => 'L&auml;scht Syndicatioun vun d&euml;sem Site den',
 'info_derniers_articles_publies' => '&Auml;r l&auml;scht publiz&eacute;iert Artikelen',
@@ -745,7 +743,6 @@
 'texte_date_publication_anterieure' => '&Eacute;ISCHTEN REDAKTIOUNS-DATUM:',
 'texte_date_publication_anterieure_nonaffichee' => '&Eacute;ischten Redaktiouns-Datum n&euml;t weisen.',
 'texte_date_publication_article' => 'PUBLIZ&Eacute;IRT DEN:',
-'texte_demander_blocage_priori' => 'D&eacute;i n&auml;chst Linken vun d&euml;sem Site ginn fir d\'&eacute;ischt emol block&eacute;iert.',
 'texte_descriptif_petition' => 'Beschreiwung vun der Petitioun',
 'texte_descriptif_rapide' => 'Kuerz Beschreiwung',
 'texte_documents_joints' => 'Dir k&euml;nnt Dokumenter (Fichier\'en, Biller, Multimedia, asw) bei den Artikelen an/oder de Rubriken erlaben. D&euml;s Fichier\'en k&euml;nnen dann am Artikel gelinkt oder separat ugewisen ginn.<p />',
@@ -765,7 +762,6 @@
 'texte_jeu_caractere_2' => 'D&euml;s Astellung ass n&euml;t retroaktiv. D&eacute;i al Texter k&euml;nnen falsch ugewisen ginn no enger &Auml;nnerung. Dir kommt awer ouni Schued er&euml;m op d&eacute;i l&auml;scht Astellung zer&euml;ck.',
 'texte_lien_hypertexte' => '(Wann &auml;re Message sech op een Artikel um Internet, oder op eng S&auml;it mat m&eacute;i Informatiounen bezitt, da gitt hei s&auml;in Titel an seng URL an.)',
 'texte_liens_sites_syndiques' => 'D\'Linken vun de syndiqu&eacute;ierten Siten k&euml;nnen fir d\'&eacute;ischt mol block&eacute;iert ginn; d&eacute;i Astellung ass den Default fir d&eacute;i nei syndiqu&eacute;iert Siten. Duerno kann een all Link eenzel deblock&eacute;ieren, oder Site fir Site block&eacute;ieren oder n&euml;t.',
-'texte_liens_syndication' => 'D&eacute;i n&auml;chst Linken vun d&euml;sem Site ginn direkt online gewisen.',
 'texte_login_ldap_1' => '(Eidel loossen fir en anonymen Zougang,  oder de kompletten Wee ugin, z.B. "&nbsp;<tt>uid=muller, ou=users, dc=domain, dc=com</tt>&nbsp;".)',
 'texte_login_precaution' => 'Opgepasst! D&euml;st ass de Login mat dem dier ugemeld sidd.
 Benotzt d&euml;sen Formulaire viirsichteg...',

Index: spip_ca.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_ca.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- spip_ca.php3	21 Jul 2005 21:47:13 -0000	1.5
+++ spip_ca.php3	7 Sep 2005 15:01:52 -0000	1.6
@@ -44,7 +44,7 @@
 'barre_aide' => 'Utilitzi les dreceres tipogr&agrave;fiques per enriquir la seva compaginaci&oacute;',
 'barre_e_accent_aigu' => 'Inserir una E maj&uacute;scula amb accent agut',
 'barre_eo' => 'Inserir una E dins la O',
-'barre_eo_maj' => 'Inserir una E dins la O maj&uacute;scula',
+'barre_eo_maj' => 'Inserir una E dins l\'O maj&uacute;scula',
 'barre_euro' => 'Inserir el simbol &euro;',
 'barre_gras' => 'Posar en {{negreta}}',
 'barre_guillemets' => 'Posar entre &laquo; cometes franceses &raquo; ',

Index: spip_eo.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_eo.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_eo.php3	10 Aug 2005 12:00:33 -0000	1.4
+++ spip_eo.php3	7 Sep 2005 15:01:52 -0000	1.5
@@ -44,7 +44,7 @@
 'barre_aide' => 'Uzu la tipografiajn &#349;parvojojn por ri&#265;igi vian enpa&#285;igon',
 'barre_e_accent_aigu' => 'Enigu malakut-akcentan majusklan E',
 'barre_eo' => 'Enigu E en majusklan O',
-'barre_eo_maj' => 'Enigi E en la O &#265;eflitero',
+'barre_eo_maj' => '<MODIF>Enigi E en la O &#265;eflitero',
 'barre_euro' => 'Enigu la simbolon &euro;',
 'barre_gras' => '{{Grasigi}}',
 'barre_guillemets' => '&#264;irka&#365;igi per &laquo; citiloj &raquo;',

Index: spip_oc_va.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_va.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_oc_va.php3	21 Jul 2005 21:47:13 -0000	1.4
+++ spip_oc_va.php3	7 Sep 2005 15:01:52 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquela rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Es impossible d\'actualizar la basa MySQL v&egrave;rs la version @version@; bensai i a un probl&egrave;ma relatiu au drech de modificar la basa de donaas. Vougatz contactar v&ograve;stre auberjaor.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichier archiu es pas un fichier SPIP',
 'avis_archive_invalide' => 'lo fichier archiu es pas valid',
 'avis_attention' => 'ATENCION!',
@@ -32,7 +33,7 @@
 'avis_echec_syndication_02' => 'La sindicacion a mau capitat: impossible d\'accedir v&egrave;rs lo backend d\'aqueu sit.',
 'avis_erreur' => 'Error: veatz &ccedil;ai sos',
 'avis_erreur_connexion' => 'Error de connexion',
-'avis_erreur_cookie' => '<MODIF>probl&egrave;ma de cookie',
+'avis_erreur_cookie' => 'probl&egrave;ma de cookie',
 'avis_erreur_fonction_contexte' => 'Error de programacion. Chau pas apelar aquela foncion dins aqueu cont&egrave;xt.',
 'avis_erreur_mysql' => 'Error MySQL ',
 'avis_erreur_sauvegarde' => 'Error dins la sauvagarda (@type@ @id_objet@)! ',
@@ -258,8 +259,8 @@
 'form_prop_sujet' => 'Subj&egrave;cte',
 'form_prop_url_site' => 'Adrei&ccedil;a (URL) dau sit',
 'forum_acces_refuse' => 'Po&egrave;tz pas pus accedir v&egrave;rs aqueles forums.',
-'forum_attention_dix_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
-'forum_attention_trois_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
+'forum_attention_dix_caracteres' => '<b>Atencion!</b> v&ograve;stre messatge deu tenir aumens d&egrave;tz caract&egrave;rs.',
+'forum_attention_trois_caracteres' => '<b>Atencion!</b> v&ograve;stre t&iacute;tol deu tenir aumens tres caract&egrave;rs.',
 'forum_avez_selectionne' => 'Av&egrave;tz seleccionat:',
 'forum_cliquer_retour' => 'Clicatz <a href=\'@retour_forum@\'>aic&iacute;</a> per contunhar.',
 'forum_forum' => 'forum',

Index: ecrire_oc_va.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_va.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_oc_va.php3	30 Jun 2005 10:09:36 -0000	1.3
+++ ecrire_oc_va.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -11,16 +11,16 @@
 'avis_article_modifie' => 'Atencion, @nom_auteur_modif@ a trabalhat sus aquel article fai @date_diff@ minutas',
 'avis_aucun_resultat' => 'Pas ges de resultat.',
 'avis_chemin_invalide_1' => 'Lo chamin qu\'av&egrave;tz chausit',
-'avis_chemin_invalide_2' => 'sembla pas valid. Vougatz tornar v&egrave;rs la pagina anteriora per verificar las informacions fornias.',
-'avis_connexion_echec_1' => 'La connexion au servior MySQL a mau capitat.',
+'avis_chemin_invalide_2' => 'sembla pas valid. Volhatz tornar v&egrave;rs la pagina anteriora per verificar las informacions fornias.',
+'avis_connexion_echec_1' => 'La connexion au servior MySQL a mal capitat.',
 'avis_connexion_echec_2' => 'Tornatz v&egrave;rs la pagina anteriora, e verificatz las informacions qu\'av&egrave;tz fornias.',
-'avis_connexion_echec_3' => '<b>N.B.</b> Sus ben de serviors, dev&egrave;tz <B>demandar</b> qu\'activen v&ograve;stre acc&egrave;s v&egrave;rs la basa MySQL avans de la poer utilizar. Se vos po&egrave;tz pas connectar, verificatz qu\'aiatz ben realizat aqueu procediment.',
-'avis_connexion_ldap_echec_1' => 'La connexion au servior LDAP a mau capitat.',
+'avis_connexion_echec_3' => '<b>N.B.</b> Sus ben de serviors, dev&egrave;tz <B>demandar</b> qu\'activen v&ograve;stre acc&egrave;s v&egrave;rs la basa MySQL avans de la poer utilizar. Se vos po&egrave;tz pas connectar, verificatz qu\'aiatz ben realizat aquel procediment.',
+'avis_connexion_ldap_echec_1' => 'La connexion au servior LDAP a mal capitat.',
 'avis_connexion_ldap_echec_2' => 'Tornatz a la pagina anteriora, e verificatz las informacions qu\'av&egrave;tz fornias. ',
 'avis_connexion_ldap_echec_3' => 'Alternativament, utilizetz pas lo sup&ograve;rt LDAP per importar d\'utilizaires.',
-'avis_conseil_selection_mot_cle' => '<b>Grop important:</b> s\'aconselha f&ograve;rt de seleccionar un mot clau dins aqueu grop.',
+'avis_conseil_selection_mot_cle' => '<b>Grop important:</b> s\'aconselha f&ograve;rt de seleccionar un mot clau dins aquel grop.',
 'avis_deplacement_rubrique' => 'Atention! Aquela rubrica conten @contient_breves@ br&egrave;vas at scb@: se la despla&ccedil;atz, voudretz ben oschar aquela casa de confirmacion.',
-'avis_destinataire_obligatoire' => 'Dev&egrave;tz indicar un destinatari avans de mandar aqueu messatge.',
+'avis_destinataire_obligatoire' => 'Dev&egrave;tz indicar un destinatari avans de mandar aquel messatge.',
 'avis_erreur_connexion_mysql' => 'Error de connexion MySQL',
 'avis_erreur_version_archive' => '<b>Atencion! Lo fichier @archive@ corresp&ograve;nd amb una autra version d\'SPIP qu\'aquela qu\'av&egrave;tz installaa.</b> Anatz v&egrave;rs de dificultats grandassas: risca de destruccion de v&ograve;stra basa de donaas, disfoncionaments div&egrave;rses dau sit, etc. Validetz pas aquela demanda d\'importacion.<p> Per mai d\'informacions, ve&egrave;tz
 <A HREF=\'http://www.spip.net/fr_article1489.html\'>
@@ -29,12 +29,12 @@
 'avis_lecture_noms_bases_1' => 'Lo programa d\'installacion a pas pogut legir los noms de las basas de donaas installaas.',
 'avis_lecture_noms_bases_2' => 'Si&aacute; ges de basa es pas disponibla, si&aacute; la foncion que permet d\'entierar las basas es estaa desactivaa per de rasons de seguretat (aqu&ograve;\'s lo cas en c&ograve; de mai d\'un auberjaor).',
 'avis_lecture_noms_bases_3' => 'Dins la segonda alternativa, es probable qu\'una basa que p&ograve;rta v&ograve;stre nom de login si&aacute; utilizabla:',
-'avis_non_acces_message' => 'Po&egrave;tz pas accedir v&egrave;rs aqueu messatge.',
+'avis_non_acces_message' => 'Po&egrave;tz pas accedir v&egrave;rs aquel messatge.',
 'avis_non_acces_page' => 'Po&egrave;tz pas accedir v&egrave;rs aquela pagina.',
-'avis_operation_echec' => 'L\'operacion a mau capitat.',
+'avis_operation_echec' => 'L\'operacion a mal capitat.',
 'avis_probleme_archive' => 'Probl&egrave;ma de lectura dau fichier @archive@',
 'avis_site_introuvable' => 'Sit introbable',
-'avis_site_syndique_probleme' => 'Atencion: la sindicacion d\'aqueu sit a rescontrat un probl&egrave;ma; lo sist&egrave;ma es doncas interromput tempor&agrave;riament. Verificatz l\'adrei&ccedil;a dau fichier de sindicacion d\'aqueu sit (<b>@url_syndic@</b>), e tornatz assajar de recuperar las informacions.',
+'avis_site_syndique_probleme' => 'Atencion: la sindicacion d\'aquel sit a rescontrat un probl&egrave;ma; lo sist&egrave;ma es doncas interromput temporariament. Verificatz l\'adrei&ccedil;a dau fichier de sindicacion d\'aquel sit (<b>@url_syndic@</b>), e tornatz assajar de recuperar las informacions.',
 'avis_sites_probleme_syndication' => 'Aqueles sits an rescontrat un probl&egrave;ma de sindicacion',
 'avis_sites_syndiques_probleme' => 'Aqueles sits sindicats an pausat un probl&egrave;ma',
 'avis_suppression_base' => 'ATENCION, suprimir las donaas es irreversible',
@@ -60,15 +60,15 @@
 'bouton_envoyer_message' => 'Messatge definitiu: mandar',
 'bouton_forum_petition' => 'FORUM E PETICION',
 'bouton_modifier' => 'Modificar',
-'bouton_pense_bete' => 'MEMENTO (D\'USATGE PERSONAU)',
+'bouton_pense_bete' => 'MEMENTO (D\'USATGE PERSONAL)',
 'bouton_radio_activer_messagerie' => 'Activar la messatjari&aacute; int&egrave;rna',
 'bouton_radio_activer_messagerie_interne' => 'Activar la messatjari&aacute; int&egrave;rna',
 'bouton_radio_activer_petition' => 'Activar la peticion',
 'bouton_radio_afficher' => 'Afichar',
 'bouton_radio_apparaitre_liste_redacteurs_connectes' => 'Afichar dins la tiera dels redactors connectats',
 'bouton_radio_articles_futurs' => 'als articles futurs solament (ges d\'accion sus la basa de donaas).',
-'bouton_radio_articles_tous' => 'als articles tots sens excepcion',
-'bouton_radio_articles_tous_sauf_forum_desactive' => 'a tots los articles, f&ograve;ra aqueles que lor forum es desactivat.',
+'bouton_radio_articles_tous' => 'als articles totes sens excepcion',
+'bouton_radio_articles_tous_sauf_forum_desactive' => 'a totes los articles, f&ograve;ra aqueles que lor forum es desactivat.',
 'bouton_radio_desactiver_messagerie' => 'Desactivar la messatjari&aacute;',
 'bouton_radio_enregistrement_obligatoire' => 'Registrament obligat&ograve;ri (los
  utilizaires se devon abonar en donant lor adrei&ccedil;a e-mail avans de
@@ -82,9 +82,9 @@
 'bouton_radio_modere_posteriori' => 'moderat a posteri&ograve;ri',
 'bouton_radio_modere_priori' => 'moderat a pri&ograve;ri',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Pas apar&eacute;isser dins la tiera dels redactors',
-'bouton_radio_non_envoi_annonces_editoriales' => 'Pas mandar d\'anoncis editoriaus',
+'bouton_radio_non_envoi_annonces_editoriales' => 'Pas mandar d\'anoncis editorials',
 'bouton_radio_non_syndication' => 'Ges de sindicacion',
-'bouton_radio_occidental' => 'Alfabet occidentau&nbsp; (<tt>iso-8859-1</tt>): permet mai que mai d\'afichar de lengas o&egrave;st-europ&egrave;as (occitan, catalan, angl&eacute;s, alemand...); SPIP permet totun de gerir pro ben las autras lengas.   ',
+'bouton_radio_occidental' => 'Alfabet occidental&nbsp; (<tt>iso-8859-1</tt>): permet mai que mai d\'afichar de lengas o&egrave;st-europ&egrave;as (occitan, catalan, angl&eacute;s, alemand...); SPIP permet totun de gerir pro ben las autras lengas.   ',
 'bouton_radio_pas_petition' => 'Ges de peticion',
 'bouton_radio_personnalise' => 'Juec de caract&egrave;rs personalizat: chausiss&egrave;tz aquela opcion se vol&egrave;tz
  utilizar un juec de caract&egrave;rs especific ',
@@ -96,7 +96,7 @@
 'bouton_radio_sauvegarde_non_compressee' => 'Sauvagarda non comprimia sos <b>ecrire/data/dump.xml</b>',
 'bouton_radio_supprimer_petition' => 'Suprimir la peticion',
 'bouton_radio_syndication' => 'Sindicacion:',
-'bouton_radio_universel' => 'Alfabet universau (<tt>utf-8</tt>): permet d\'afichar totas las lengas, mas p&ograve;t pausar de probl&egrave;mas de compatibilitat amb los logiciaus utilizats per modificar v&ograve;stras esqueletas, e pereu amb d\'unes legiors de corrier electronic.',
+'bouton_radio_universel' => 'Alfabet universal (<tt>utf-8</tt>): permet d\'afichar totas las lengas, mas p&ograve;t pausar de probl&egrave;mas de compatibilitat amb los logiciaus utilizats per modificar v&ograve;stras esqueletas, e pereu amb d\'unes legiors de corrier electronic.',
 'bouton_redirection' => 'TORNAR DIRIGIR',
 'bouton_relancer_installation' => 'Tornar lan&ccedil;ar l\'installacion',
 'bouton_restaurer_base' => 'Restaurar la basa',
@@ -111,7 +111,7 @@
 'cache_mode_compresse' => 'Los fichiers de l\'escondeor son registrats en m&ograve;de comprimit.',
 'cache_mode_non_compresse' => 'Los fichiers de l\'escondeor son registrats en m&ograve;de non comprimit.',
 'cache_modifiable_webmestre' => 'Lo webm&egrave;stre dau sit p&ograve;t modificar aquestes param&egrave;tres.',
-'calendrier_synchro' => 'S\'utilizatz un logiciau d\'agenda compatible <b>iCal</b> (Apple iCal, Mozilla Calendar, Ximian Evolution, KOrganizer...), lo po&egrave;tz sincronizar amb l\'actualitat dau sit.',
+'calendrier_synchro' => 'S\'utilizatz un logicial d\'agenda compatible <b>iCal</b> (Apple iCal, Mozilla Calendar, Ximian Evolution, KOrganizer...), lo po&egrave;tz sincronizar amb l\'actualitat dau sit.',
 
 
 // D
@@ -135,13 +135,13 @@
 'entree_base_donnee_1' => 'Adrei&ccedil;a de la basa de donaas',
 'entree_base_donnee_2' => '(Sovent, aquela adrei&ccedil;a corresp&ograve;nd a aquela de v&ograve;stre sit, de viatges corresp&ograve;nd a la men&ccedil;on "localhost", de viatges, se laissa voida completament.)',
 'entree_biographie' => 'Biografia br&egrave;va, en quauques mots.',
-'entree_breve_publiee' => 'Aquela br&egrave;va la chau publicar?',
+'entree_breve_publiee' => 'Aquela br&egrave;va la chal publicar?',
 'entree_chemin_acces' => '<B>Intrar</b> lo chamin d\'acc&egrave;s:',
 'entree_cle_pgp' => 'V&ograve;stra clau PGP',
 'entree_contenu_rubrique' => '(Contengut de la rubrica en quauques mots.)',
 'entree_description_site' => 'Descripcion dau sit',
 'entree_identifiants_connexion' => 'V&ograve;stres identificants de connexion...',
-'entree_informations_connexion_ldap' => 'Vougatz intrar dins aqueu formulari las informacions de connexion a v&ograve;stre annuari LDAP.
+'entree_informations_connexion_ldap' => 'Volhatz intrar dins aquel formulari las informacions de connexion a v&ograve;stre annuari LDAP.
 L\'administrator dau sist&egrave;ma o de la ret vos deu poer fornir
  aquelas informacions.',
 'entree_infos_perso' => 'Cu siatz?',
@@ -150,7 +150,7 @@
 'entree_login' => 'V&ograve;stre login',
 'entree_login_connexion_1' => 'Lo login de connexion',
 'entree_login_connexion_2' => '(Corresp&ograve;nd de viatges a v&ograve;stre login d\'acc&egrave;s v&egrave;rs l\'FTP; de viatges se laissa voide)',
-'entree_login_ldap' => 'Login LDAP iniciau',
+'entree_login_ldap' => 'Login LDAP inicial',
 'entree_mot_passe' => 'V&ograve;stre mot de santa Clara',
 'entree_mot_passe_1' => 'Mot de santa Clara per la connexion',
 'entree_mot_passe_2' => '(Corresp&ograve;nd de viatges a v&ograve;stre mot de santa Clara per l\'FTP; de viatges se laissa voide)',
@@ -158,7 +158,7 @@
 'entree_nom_pseudo' => 'V&ograve;stre nom o v&ograve;stre pseudonim',
 'entree_nom_pseudo_1' => '(V&ograve;stre nom o v&ograve;stre pseudonim)',
 'entree_nom_site' => 'Lo nom de v&ograve;stre sit',
-'entree_nouveau_passe' => 'Mot de santa Clara nov&egrave;u',
+'entree_nouveau_passe' => 'Mot de santa Clara nov&egrave;l',
 'entree_passe_ldap' => 'Mot de santa Clara',
 'entree_port_annuaire' => 'Lo num&egrave;ro de p&ograve;rt de l\'annuari',
 'entree_signature' => 'Signatura',
@@ -168,14 +168,14 @@
 
 
 // I
-'ical_info1' => 'Aquela pagina m&ograve;stra de met&ograve;des diferents per restar en contacte amb la vita d\'aqueu sit.',
+'ical_info1' => 'Aquela pagina m&ograve;stra de met&ograve;des diferents per restar en contacte amb la vida d\'aquel sit.',
 'ical_info2' => 'Per tenir mai d\'informacions sobre aquelas tecnicas, esitetz pas de consultar <a href="http://www.spip.net/fr_suivi">la documentacion d\'SPIP</a>.',
-'ical_info_calendrier' => 'I a dos chalendiers a la v&ograve;stra disposicion. Lo primier es un plan dau sit qu\'an&oacute;ncia tots los articles publicats. Lo segond conten los anoncis editoriaus en mai de v&ograve;stres darriers messatges privats: vos es reservat gr&agrave;cias a una clau personala, que la po&egrave;tz modificar en tot moment en renovant v&ograve;stre mot de santa Clara. ',
+'ical_info_calendrier' => 'I a dos chalendiers a la v&ograve;stra disposicion. Lo primier es un plan dau sit qu\'an&oacute;ncia totes los articles publicats. Lo segond conten los anoncis editoriaus en mai de v&ograve;stres darriers messatges privats: vos es reservat gr&agrave;cias a una clau personala, que la po&egrave;tz modificar en tot moment en renovant v&ograve;stre mot de santa Clara. ',
 'ical_methode_http' => 'Telecharjament',
 'ical_methode_webcal' => 'Sincronizacion (webcal://)',
-'ical_texte_js' => 'Los articles publicats en aqueu sit se p&ograve;on afichar aisat, dins tots los sits v&ograve;stres, en fasent servir una linha javascript. ',
-'ical_texte_prive' => 'Aqueu chalendier, d\'us estrictament personau, vos informa de l\'activitat editoriala privaa d\'aqueu sit (&ograve;bras e rend&egrave;tz-vos personaus, articles e br&egrave;vas prepausats...).',
-'ical_texte_public' => 'Aqueu chalendier vos permet de seguir l\'activitat publica d\'aqueu sit (articles e br&egrave;vas publicats).',
+'ical_texte_js' => 'Los articles publicats en aqueu sit se p&ograve;on afichar aisat, dins totes los sits v&ograve;stres, en fasent servir una linha javascript. ',
+'ical_texte_prive' => 'Aquel chalendier, d\'us estrictament personal, vos informa de l\'activitat editoriala privaa d\'aquel sit (&ograve;bras e rend&egrave;tz-vos personals, articles e br&egrave;vas prepausats...).',
+'ical_texte_public' => 'Aquel chalendier vos permet de seguir l\'activitat publica d\'aquel sit (articles e br&egrave;vas publicats).',
 'ical_texte_rss' => 'Po&egrave;tz sindicar las novetats d\'aquest sit dins quin legior de fichiers que si&aacute; en format XML/RSS (Rich Site Summary). Es pereu lo format que permet a SPIP de legir las novetats publicaas dins d\'autres sits en utilizant un format d\'eschambi compatible (sits sindicats).  ',
 'ical_titre_js' => 'Javascript',
 'ical_titre_mailing' => 'Lista de corrier',
@@ -185,19 +185,19 @@
 'icone_afficher_visiteurs' => 'Afichar los vesitaires',
 'icone_arret_discussion' => 'Quitar aquela discussion',
 'icone_calendrier' => 'Chalendier',
-'icone_creation_groupe_mots' => 'Crear un nov&egrave;u grop de mots',
+'icone_creation_groupe_mots' => 'Crear un nov&egrave;l grop de mots',
 'icone_creation_mots_cles' => 'Crear un mot clau n&ograve;u',
 'icone_creer_auteur' => 'Crear un autor n&ograve;u e l\'associar a aquel article',
 'icone_creer_rubrique_2' => 'Crear una rubrica n&ograve;va',
 'icone_ecrire_nouvel_article' => 'Las br&egrave;vas contenguas dins aquela rubrica',
-'icone_envoyer_message' => 'Mandar aqueu messatge',
+'icone_envoyer_message' => 'Mandar aquel messatge',
 'icone_evolution_visites' => 'Evolucion de las vesitas<br>@visites@ vesitas',
-'icone_modif_groupe_mots' => 'Modificar aqueu grop de mots',
+'icone_modif_groupe_mots' => 'Modificar aquel grop de mots',
 'icone_modifier_article' => 'Modificar aquel article',
 'icone_modifier_breve' => 'Modificar aquela br&egrave;va',
-'icone_modifier_message' => 'Modificar aqueu messatge',
+'icone_modifier_message' => 'Modificar aquel messatge',
 'icone_modifier_rubrique' => 'Modificar aquela rubrica',
-'icone_modifier_site' => 'Modificar aqueu sit',
+'icone_modifier_site' => 'Modificar aquel sit',
 'icone_poster_message' => 'Postar un messatge',
 'icone_publier_breve' => 'Publicar aquela br&egrave;va',
 'icone_referencer_nouveau_site' => 'Referenciar un sit n&ograve;u',
@@ -206,25 +206,25 @@
 'icone_retour_article' => 'Tornar a l\'article',
 'icone_suivi_forum' => 'Seguit dau forum public: @nb_forums@&nbsp;contribucion(s)',
 'icone_supprimer_cookie' => 'Suprimir lo cookie de correspond&eacute;ncia',
-'icone_supprimer_groupe_mots' => 'Suprimir aqueu document',
+'icone_supprimer_groupe_mots' => 'Suprimir aquel document',
 'icone_supprimer_rubrique' => 'Suprimir aquela rubrica',
 'icone_supprimer_signature' => 'Suprimir aquela signatura',
 'icone_valider_signature' => 'Validar aquela signatura',
 'icone_voir_sites_references' => 'Veire los sits referenciats',
-'icone_voir_tous_mots_cles' => 'Veire tots los mots clau ',
+'icone_voir_tous_mots_cles' => 'Veire totes los mots clau ',
 'image_administrer_rubrique' => 'Po&egrave;tz administrar aquela rubrica',
 'info_1_article' => '1 article',
 'info_1_breve' => '1 br&egrave;va',
 'info_1_site' => '1 sit',
 'info_activer_cookie' => 'Po&egrave;tz activar un <b>cookie de correspond&eacute;ncia</b>; aqu&ograve; vos permetr&agrave; de passar aisat dau sit public au sit privat.',
-'info_activer_forum_public' => '<I>Per activar los forums publics, vougatz chausir lor m&ograve;de de moderacion predefinit:</i>',
+'info_activer_forum_public' => '<I>Per activar los forums publics, volhatz chausir lor m&ograve;de de moderacion predefinit:</i>',
 'info_admin_gere_rubriques' => 'Aquel administrator ger&iacute;s las rubricas seguentas:',
 'info_admin_gere_toutes_rubriques' => 'Aquel administrator ger&iacute;s <b>totas las rubricas</b>.',
 'info_administrateur' => 'Administrator',
 'info_administrateur_1' => 'Administrator',
 'info_administrateur_2' => 'dau sit(<i>d\'utilizar amb precaucion</i>)',
-'info_administrateur_site_01' => 'Se siatz administrator/tritz dau sit, vougatz',
-'info_administrateur_site_02' => 'clicar aqueu liam',
+'info_administrateur_site_01' => 'Se siatz administrator/tritz dau sit, volhatz',
+'info_administrateur_site_02' => 'clicar aquel liam',
 'info_administrateurs' => 'Administrators',
 'info_administrer_rubrique' => 'Po&egrave;tz administrar aquela rubrica',
 'info_adresse' => 'a l\'adrei&ccedil;a:',
@@ -237,7 +237,6 @@
 'info_ajout_participant' => 'Lo participant seguent es apondut:',
 'info_ajouter_rubrique' => 'Apondre una autra rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci de las novetats',
-'info_annuler_blocage_priori' => 'Anullar aqueu blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar aquela chausia de moderacion:',
 'info_article' => 'article',
@@ -246,7 +245,7 @@
 'info_articles_02' => 'articles',
 'info_articles_2' => 'Articles',
 'info_articles_auteur' => 'Los articles d\'aquel autor',
-'info_articles_lies_mot' => 'Los articles liats a aqueu mot clau',
+'info_articles_lies_mot' => 'Los articles liats a aquel mot clau',
 'info_articles_trouves' => 'Articles trobats',
 'info_articles_trouves_dans_texte' => 'Articles trobats (dins lo t&egrave;xt)',
 'info_attente_validation' => 'V&ograve;stres articles en esp&egrave;ra de validacion',
@@ -259,14 +258,15 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de v&ograve;stra basa de donaas es installaa.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'V&ograve;stre sit utiliza lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Las br&egrave;vas liaas a aqueu mot clau',
 'info_breves_touvees' => 'Br&egrave;vas trobaas',
 'info_breves_touvees_dans_texte' => 'Br&egrave;vas trobaas (dins lo t&egrave;xt)',
-'info_changer_nom_groupe' => 'Chambiar lo nom d\'aqueu grop:',
-'info_chapeau' => 'Chap&egrave;u',
-'info_chapeau_2' => 'Chap&egrave;u:',
+'info_changer_nom_groupe' => 'Chambiar lo nom d\'aquel grop:',
+'info_chapeau' => 'Chap&egrave;l',
+'info_chapeau_2' => 'Chap&egrave;l:',
 'info_chemin_acces_1' => 'Opcions: <B>chamin d\'acc&egrave;s dins l\'annuari</b>',
 'info_chemin_acces_2' => 'A&uuml;ra dev&egrave;tz configurar lo chamin d\'acc&egrave;s v&egrave;rs las informacions dins l\'annuari.',
 'info_chemin_acces_annuaire' => 'Opcions:<B>chamin d\'acc&egrave;s dins l\'annuari',
@@ -274,10 +274,10 @@
 'info_classement_1' => '<sup>ier</sup> de @liste@',
 'info_classement_2' => '<sup>nd</sup> de @liste@',
 'info_code_acces' => 'Eissublietz pas v&ograve;stres c&ograve;des d\'acc&egrave;s pr&ograve;pris!',
-'info_comment_lire_tableau' => 'Coma legir aqueu tabl&egrave;u',
+'info_comment_lire_tableau' => 'Coma legir aquel tabl&egrave;u',
 'info_config_suivi' => 'S\'aquela adrei&ccedil;a corresp&ograve;nd a una lista de corrier, po&egrave;tz indicar &ccedil;ai sos l\'adrei&ccedil;a ont los participants au sit se p&ograve;on inscriure. Aquela adrei&ccedil;a p&ograve;t &egrave;stre una URL (per exemple la pagina d\'inscripcion a la lista per lo web), o una adrei&ccedil;a e-mail tenent un subj&egrave;cte especific (per exemple: <tt>@adresse_suivi@?subject=subscribe</tt>):',
-'info_config_suivi_explication' => 'Po&egrave;tz recebre automaticament, per e-mail, los anoncis pertochant l\'activitat editoriala d\'aqueu sit. Per aqu&ograve; faire, vos po&egrave;tz abonar a la lista de corrier seguenta:',
-'info_confirmer_passe' => 'Confirmar aqueu mot de santa Clara nov&egrave;u:',
+'info_config_suivi_explication' => 'Po&egrave;tz recebre automaticament, per e-mail, los anoncis pertochant l\'activitat editoriala d\'aquel sit. Per aqu&ograve; faire, vos po&egrave;tz abonar a la lista de corrier seguenta:',
+'info_confirmer_passe' => 'Confirmar aquel mot de santa Clara nov&egrave;l:',
 'info_connexion_base' => 'Segonda estapa: <B>Assai de connexion a la basa</b>',
 'info_connexion_ldap_ok' => 'La connexion LDAP a abotit.</b><p> Po&egrave;tz passar a l\'estapa seguenta.',
 'info_connexion_mysql' => 'Primiera estapa:<B>V&ograve;stra connexion MySQL</b>',
@@ -292,11 +292,10 @@
 'info_dans_groupe' => 'Dins lo grop:',
 'info_dans_rubrique' => 'Dins la rubrica:',
 'info_date_publication_anterieure' => 'Data anteriora de publicacion:',
-'info_date_referencement' => 'DATA DE REFERENCIAMENT D\'AQUEU SIT:',
+'info_date_referencement' => 'DATA DE REFERENCIAMENT D\'AQUEL SIT:',
 'info_delet_mots_cles' => 'Av&egrave;tz demandat de suprimir lo mot clau
-<B>@titre_mot@</b> (@type_mot@). Aqueu mot clau es liat a
+<B>@titre_mot@</b> (@type_mot@). Aquel mot clau es liat a
  <b>@texte_lie@</b>. Dev&egrave;tz confirmar aquela decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darriera estapa: <B>Aqu&ograve;\'s achabat!',
 'info_derniere_syndication' => 'La darriera sindicacion d\'aqueu sit se fagu&egrave;c lo',
 'info_derniers_articles_publies' => 'V&ograve;stres darriers articles publicats en linha',
@@ -305,9 +304,9 @@
 'info_descriptif' => 'Descriptiu:',
 'info_discussion_cours' => 'Discussions en cors',
 'info_ecrire_article' => 'Avans de poer escriure d\'articles, vos chau crear aumens una rubrica.',
-'info_email_envoi' => 'Adrei&ccedil;a e-mail d\'enviament (opcionau)',
+'info_email_envoi' => 'Adrei&ccedil;a e-mail d\'enviament (opcional)',
 'info_email_envoi_txt' => 'Indicatz aic&iacute; l\'adrei&ccedil;a d\'utilizar per enviar los e-mails (a fauta d\'aqu&ograve;, s\'utilizar&agrave; l\'adrei&ccedil;a destinatari coma adrei&ccedil;a d\'enviament):',
-'info_email_webmestre' => 'Adrei&ccedil;a e-mail dau responsable dau sit (opcionau)',
+'info_email_webmestre' => 'Adrei&ccedil;a e-mail dau responsable dau sit (opcional)',
 'info_entrer_code_alphabet' => 'Picatz lo c&ograve;de de l\'alfabet d\'utilizar:',
 'info_envoi_email_automatique' => 'Enviament d\'e-mails automatics',
 'info_envoi_forum' => 'Manda&iacute;s dels forums als autors dels articles',
@@ -322,7 +321,7 @@
 'info_fonctionnement_forum' => 'Foncionament dau forum:',
 'info_forum_administrateur' => 'forum dels administrators',
 'info_forum_interne' => 'forum int&egrave;rne',
-'info_forum_ouvert' => 'Dins l\'espaci privat dau sit, un forum es dub&egrave;rt v&egrave;rs tots los redactors registrats. Po&egrave;tz, &ccedil;ai sos, activar un forum suplementari, reservat mas qu\'als administrators.',
+'info_forum_ouvert' => 'Dins l\'espaci privat dau sit, un forum es dob&egrave;rt v&egrave;rs totes los redactors registrats. Po&egrave;tz, &ccedil;ai sos, activar un forum suplementari, reservat mas qu\'als administrators.',
 'info_forum_statistiques' => 'Estadisticas de las vesitas',
 'info_forums_abo_invites' => 'V&ograve;stre sit web &ograve;fre de forums per los abonats; dins lo sit public los vesitaires son convidats a se registrar.',
 'info_gauche_admin_effacer' => '<B>A aquela pagina, mas que los responsables dau sit i p&ograve;on accedir.</b><p /> Permet de trobar las diferentas foncions de mantenen&ccedil;a tecnica. Quauques unas implican un proc&egrave;s d\'autentificacion especific, que necessita un acc&egrave;s FTP v&egrave;rs lo sit web.',
@@ -330,7 +329,7 @@
 'info_gauche_admin_vider' => '<b>A aquela pagina, mas que los responsables dau sit i p&ograve;on accedir.</b><p /> Permet de trobar las diferentas foncions de mantenen&ccedil;a tecnica. Quauques unas implican un proc&egrave;s d\'autentificacion especific, que necessita un acc&egrave;s FTP v&egrave;rs lo sit web.',
 'info_gauche_auteurs' => 'Trobaretz aic&iacute; totes los autors dau sit. La color de las ic&ograve;nas n\'indica l\'estatut (administrator = verd; redactor = jaune).',
 'info_gauche_auteurs_exterieurs' => 'Los autors exteriors, sens acc&egrave;s v&egrave;rs lo sit, son indicats amb una ic&ograve;na blava; los autors esfa&ccedil;ats amb un bordilhier.',
-'info_gauche_messagerie' => 'La messatjari&aacute; vos permet d\'eschambiar de mmementos (per v&ograve;stre usatge personau) o d\'afichar d\'anoncis sus la pagina d\'acuelh de l\'espaci privat (se siatz administrator/tritz).',
+'info_gauche_messagerie' => 'La messatjari&aacute; vos permet d\'eschambiar de mementos (per v&ograve;stre usatge personal) o d\'afichar d\'anoncis sus la pagina d\'acuelh de l\'espaci privat (se siatz administrator/tritz).',
 'info_gauche_numero_auteur' => 'AUTOR NUM&Egrave;RO',
 'info_gauche_numero_breve' => 'BR&Egrave;VA NUM&Egrave;RO',
 'info_gauche_statistiques_referers' => 'Aquela pagina presenta la lista dels <I>referiors</i>, aqu&ograve; v&ograve;u dire dels sits que contenon de liams que menan v&egrave;rs v&ograve;stre sit pr&ograve;pri, mas unicament au jorn d\'encuei: aquela lista s\'actualiza chasca 24 oras.',
@@ -358,7 +357,7 @@
 'info_image_process2' => '<b>N.B.</b> <i>Se ges d\'imatge apareis, aladonc lo servior qu\'aub&egrave;rja v&ograve;stre sit l\'an pas configurat per utilizar d\'aisinas talas. Se desiratz d\'utilizar aquelas foncions, contactatz lo responsable tecnic e demandatz las extensions &laquo;GD&raquo; o &laquo;Imagick&raquo;.</i>',
 'info_images_auto' => 'Imatges calculats automaticament',
 'info_informations_personnelles' => 'Cinquena estapa: <B>Informacions personalas</b>',
-'info_inscription_automatique' => 'Inscripcion automatica de redactors nov&egrave;us',
+'info_inscription_automatique' => 'Inscripcion automatica de redactors nov&egrave;ls',
 'info_jeu_caractere' => 'Juec de caract&egrave;rs dau sit',
 'info_jours' => 'jorns',
 'info_laisser_champs_vides' => 'laissar aqueles champs voides)',
@@ -373,7 +372,7 @@
 'info_liens_syndiques_6' => 'es',
 'info_liens_syndiques_7' => 'en esp&egrave;ra de validacion',
 'info_liste_redacteurs_connectes' => 'Tiera dels redactors connectats',
-'info_login_existant' => 'Aqueu login ja exist&iacute;s.',
+'info_login_existant' => 'Aquel login ja exist&iacute;s.',
 'info_login_trop_court' => 'Login tr&ograve;p cort.',
 'info_maximum' => 'maximum:',
 'info_meme_rubrique' => 'Dins la mesma rubrica',
@@ -396,11 +395,11 @@
 'info_mot_sans_groupe' => '(Mots f&ograve;ra grop...)',
 'info_moteur_recherche' => 'Cerchaor integrat',
 'info_mots_cles' => 'Los mots clau',
-'info_mots_cles_association' => 'Los mots clau d\'aqueu grop se p&ograve;on associar:',
+'info_mots_cles_association' => 'Los mots clau d\'aquel grop se p&ograve;on associar:',
 'info_moyenne' => 'mejana:',
 'info_multi_articles' => 'Activar lo menut de lenga per los articles?',
 'info_multi_cet_article' => 'Lenga d\'aquest article:',
-'info_multi_langues_choisies' => 'Vougatz seleccionar &ccedil;ai sos las lengas que son a posita dels redactors de v&ograve;stre sit.
+'info_multi_langues_choisies' => 'Volhatz seleccionar &ccedil;ai sos las lengas que son a posita dels redactors de v&ograve;stre sit.
   Las lengas ja emplejaas dins v&ograve;stre sit (afichaas primieras) se p&ograve;on pas desactivar.',
 'info_multi_rubriques' => 'Activar lo menut de lenga per las rubricas?',
 'info_multi_secteurs' => '... mas que per las rubricas a la rai&ccedil; dau sit?',
@@ -418,7 +417,7 @@
  (articles e br&egrave;vas publicats recentament).',
 'info_non_envoi_liste_nouveautes' => 'Pas mandar la tiera de las novetats',
 'info_non_modifiable' => 'se p&ograve;t pas modificar',
-'info_non_suppression_mot_cle' => 'v&ograve;lo pas suprimir aqueu mot clau.',
+'info_non_suppression_mot_cle' => 'v&ograve;lo pas suprimir aquel mot clau.',
 'info_notes' => 'N&ograve;tas',
 'info_nouveaux_message' => 'Messatges n&ograve;us',
 'info_nouvel_article' => 'Article n&ograve;u',
@@ -436,7 +435,7 @@
 'info_ortho_activer' => 'Activar lo verificaor d\'ortografia',
 'info_ortho_desactiver' => 'Desactivar lo verificaor d\'ortografia',
 'info_ou' => 'o... ',
-'info_oui_suppression_mot_cle' => 'V&ograve;lo suprimir aqueu mot clau definitivament.',
+'info_oui_suppression_mot_cle' => 'V&ograve;lo suprimir aquel mot clau definitivament.',
 'info_page_interdite' => 'Pagina pro&iuml;bia',
 'info_par_nombre_article' => '(per nombre d\'articles)',
 'info_par_tri' => '(per @tri@)',
@@ -457,16 +456,17 @@
 'info_preview_admin' => 'Mas que los administrators p&ograve;on previsualizar lo sit',
 'info_preview_comite' => 'Totes los redactors p&ograve;on previsualizar lo sit',
 'info_preview_desactive' => 'La previsualizacion es dau tot desactivaa',
-'info_preview_texte' => 'Es possible de previsualizar lo sit coma s\'avi&aacute;n publicat totes los articles e br&egrave;vas (que tenon aumens l\'estatut "prepausat"). La chau dubrir, aquela possibilitat, als administrators solament, a totes los redactors, o a degun?',
-'info_principaux_correspondants' => 'V&ograve;stres correspondents principaus',
+'info_preview_texte' => 'Es possible de previsualizar lo sit coma s\'avi&aacute;n publicat totes los articles e br&egrave;vas (que tenon aumens l\'estatut "prepausat"). La chal dobrir, aquela possibilitat, als administrators solament, a totes los redactors, o a degun?',
+'info_principaux_correspondants' => 'V&ograve;stres correspondents principals',
 'info_procedez_par_etape' => 'procediss&egrave;tz estapa per estapa',
-'info_procedure_maj_version' => 'Chau lan&ccedil;ar la procedura d\'actualizacion per adaptar
+'info_procedure_maj_version' => 'Chal lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donaas a la version nov&egrave;la d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'V&ograve;stres articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'a las esqueletas de v&ograve;stre sit web se prevei lo registrament de vesitaires sens acc&egrave;s a l\'espaci privat, volhatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, v&ograve;stre sit, las estadisticas de las vesitas?',
-'info_question_inscription_nouveaux_redacteurs' => 'Acceptatz que de redactors nov&egrave;us s\'inscrivan
+'info_question_inscription_nouveaux_redacteurs' => 'Acceptatz que de redactors nov&egrave;ls s\'inscrivan
  a partir dau sit public? Se o acceptatz, los vesitaires se poir&agrave;n inscriure
  gr&agrave;cias a un formulari automatizat e doncas accedir&agrave;n a l\'espaci privat per
  prepausar d\'articles.<blockquote><i> Durant la fasa d\'inscripcion, los utilizaires recebon un e-mail automatic
@@ -476,13 +476,13 @@
 'info_question_mots_cles' => 'Desiratz d\'utilizar los mots clau sobre v&ograve;stre sit?',
 'info_question_proposer_site' => 'Cu p&ograve;t prepausar de sits referenciats?',
 'info_question_utilisation_moteur_recherche' => 'Desiratz d\'utilizar lo cerchaor integrat a SPIP? (lo desactivar abriva lo foncionament dau sist&egrave;ma.)',
-'info_qui_attribue_mot_cle' => 'Los mots d\'aqueu grop p&ograve;don &egrave;sser atribuits per:',
+'info_qui_attribue_mot_cle' => 'Los mots d\'aquel grop p&ograve;don &egrave;sser atribuits per:',
 'info_racine_site' => 'Rai&ccedil; dau sit',
-'info_recharger_page' => 'Vougatz tornar charjar aquela pagina dins un momenton.',
-'info_recherche_auteur_a_affiner' => 'Tr&ograve;p de resultats per "@cherche_auteur@"; vougatz afinar la c&egrave;rcha.',
+'info_recharger_page' => 'Volhatz tornar charjar aquela pagina dins un momenton.',
+'info_recherche_auteur_a_affiner' => 'Tr&ograve;p de resultats per "@cherche_auteur@"; volhatz afinar la c&egrave;rcha.',
 'info_recherche_auteur_ok' => 'Mai d\'un redactor trobat per "@cherche_auteur@":',
 'info_recherche_auteur_zero' => '<B>Ges de resultat trobat per "@cherche_auteur@".',
-'info_recommencer' => 'Vougatz tornar comen&ccedil;ar.',
+'info_recommencer' => 'Volhatz tornar comen&ccedil;ar.',
 'info_redacteur_1' => 'Redactor',
 'info_redacteur_2' => 'qu\'acced&iacute;s v&egrave;rs l\'espaci privat (<i>recomandat</i>)',
 'info_redacteurs' => 'Redactors',
@@ -501,14 +501,14 @@
 'info_rubriques_liees_mot' => 'Las rubricas liaas a aqueu mot clau',
 'info_rubriques_trouvees' => 'Rubricas trobaas',
 'info_rubriques_trouvees_dans_texte' => 'Rubricas trobaas (dins lo t&egrave;xt)',
-'info_sans_titre' => 'Sensa t&iacute;tol',
+'info_sans_titre' => 'Sens t&iacute;tol',
 'info_sauvegarde' => 'Sauvagarda',
 'info_sauvegarde_articles' => 'Sauvagardar los articles',
 'info_sauvegarde_articles_sites_ref' => 'Sauvagardar los articles dels sits referenciats',
 'info_sauvegarde_auteurs' => 'Sauvagardar los autors',
 'info_sauvegarde_breves' => 'Sauvagardar las br&egrave;vas',
 'info_sauvegarde_documents' => 'Sauvagardar los documents',
-'info_sauvegarde_echouee' => 'Se la sauvagarda a mau capitat (&laquo;Maximum execution time exceeded&raquo;),',
+'info_sauvegarde_echouee' => 'Se la sauvagarda a mal capitat (&laquo;Maximum execution time exceeded&raquo;),',
 'info_sauvegarde_forums' => 'Sauvagardar los forums',
 'info_sauvegarde_groupe_mots' => 'Sauvagardar los grops de mots',
 'info_sauvegarde_messages' => 'Sauvagardar los messatges',
@@ -532,11 +532,11 @@
 'info_site_min' => 'sit',
 'info_site_propose' => 'Sit prepausat lo:',
 'info_site_reference_2' => 'Sit referenciat',
-'info_site_syndique' => 'Aqueu sit es sindicat...',
+'info_site_syndique' => 'Aquel sit es sindicat...',
 'info_site_valider' => 'Sits de validar',
 'info_site_web' => 'SIT WEB:',
 'info_sites' => 'sits',
-'info_sites_lies_mot' => 'Los sits referenciats liats a aqueu mot clau',
+'info_sites_lies_mot' => 'Los sits referenciats liats a aquel mot clau',
 'info_sites_proxy' => 'Utilizar un proxy',
 'info_sites_refuses' => 'Los sits refusats',
 'info_sites_trouves' => 'Sits trobats',
@@ -546,14 +546,14 @@
 'info_statut_auteur' => 'Estatut d\'aquel autor:',
 'info_statut_efface' => 'Esfa&ccedil;at',
 'info_statut_redacteur' => 'Redactor',
-'info_statut_site_1' => 'Aqueu sit es:',
+'info_statut_site_1' => 'Aquel sit es:',
 'info_statut_site_2' => 'Publicat',
 'info_statut_site_3' => 'Prepausat',
 'info_statut_site_4' => 'Au bordilhier',
 'info_statut_utilisateurs_1' => 'Estatut predefinit dels utilizaires importats',
 'info_statut_utilisateurs_2' => 'Chausiss&egrave;tz l\'estatut d\'atribuir a las personas presentas dins l\'annuari LDAP quand se conn&egrave;ctan per lo primier viatge. Poiretz puei modificar aquel estatut per chasque autor un cas per un.',
 'info_suivi_activite' => 'Seguit de l\'activitat editoriala',
-'info_supprimer_mot' => 'suprimir aqueu mot',
+'info_supprimer_mot' => 'suprimir aquel mot',
 'info_surtitre' => 'Sobret&iacute;tol:',
 'info_taille_maximale_vignette' => 'Talha maximala de las vinhetas congreaas per lo sist&egrave;ma:',
 'info_terminer_installation' => 'A&uuml;ra po&egrave;tz achabar la procedura d\'installacion estandard.',
@@ -564,18 +564,18 @@
 'info_texte_message_02' => 'T&egrave;xt dau messatge',
 'info_titre' => 'T&iacute;tol:',
 'info_titre_mot_cle' => 'Nom o t&iacute;tol dau mot clau',
-'info_total' => 'totau: ',
-'info_tous_articles_en_redaction' => 'Tots los articles en cors de redaccion',
-'info_tous_articles_presents' => 'Tots los articles publicats dins aquela rubrica',
-'info_tous_les' => 'tots los:',
-'info_tous_redacteurs' => 'Anoncis per tots los redactors ',
+'info_total' => 'total: ',
+'info_tous_articles_en_redaction' => 'Totes los articles en cors de redaccion',
+'info_tous_articles_presents' => 'Totes los articles publicats dins aquela rubrica',
+'info_tous_les' => 'totes los:',
+'info_tous_redacteurs' => 'Anoncis per totes los redactors ',
 'info_tout_site' => 'Tot lo sit ',
 'info_tout_site2' => 'An pas revirat l\'article dins aquela lenga.',
-'info_tout_site3' => 'An revirat l\'article dins aquela lenga, mas an portat puei de modificacions a l\'article de refer&eacute;ncia. Chau actualizar la reviraa.',
+'info_tout_site3' => 'An revirat l\'article dins aquela lenga, mas an portat puei de modificacions a l\'article de refer&eacute;ncia. Chal actualizar la reviraa.',
 'info_tout_site4' => 'An revirat l\'article dins aquela lenga, e la reviraa es actualizaa.',
-'info_tout_site5' => 'Article originau.',
-'info_tout_site6' => '<b>Atencion:</b> mas que los articles originaus s\'afichan.
-Las reviraas s\'ass&ograve;cian a l\'originau,
+'info_tout_site5' => 'Article original.',
+'info_tout_site6' => '<b>Atencion:</b> mas que los articles originals s\'afichan.
+Las reviraas s\'ass&ograve;cian a l\'original,
 una color indica lor estat:',
 'info_travail_colaboratif' => 'Trabalh collaboratiu sobre los articles',
 'info_un_article' => 'un article, ',
@@ -724,6 +724,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrench)',
+'syndic_choix_moderation' => 'Que se p&ograve;t far amb los liams venents que provenon d\'aquel sit?',
+'syndic_choix_oublier' => 'Que se p&ograve;t far amb los liams que figuran pas pus dins lo fichier de sindicacion?',
+'syndic_lien_obsolete' => 'liam obsolet',
+'syndic_option_miroir' => 'los blocar sus lo c&ograve;p',
+'syndic_option_oubli' => 'los esfa&ccedil;ar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -783,8 +789,6 @@
 'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA',
 'texte_date_publication_anterieure_nonaffichee' => 'Afichar ges de data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Los liams seguents
- que provenon d\'aqueu sit ser&agrave;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Po&egrave;tz autorizar que s\'apondan de documents (fichiers burotics, imatges,
@@ -825,8 +829,6 @@
     es possible puei de 
    desblocar chasque liam individualament, o de
    chausir, sit per sit, de blocar los liams aveniors.',
-'texte_liens_syndication' => 'Los liams venents que 
-   provenon d\'aqueu sit s\'afichar&agrave;n sus lo c&ograve;p dins lo sit public.',
 'texte_login_ldap_1' => '(Laissar voide per un acc&egrave;s anonim, o picar lo chamin complet, per exemple &laquo;<tt>uid=fabre, ou=usanciers, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Aqu&ograve;\'s lo login amb lo quau siatz a&uuml;ra connectat/aa. 
  Utilizatz aquest formulari amb precaucion...',

Index: ecrire_oc_ni_la.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_ni_la.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- ecrire_oc_ni_la.php3	18 Aug 2005 23:27:16 -0000	1.2
+++ ecrire_oc_ni_la.php3	7 Sep 2005 15:01:52 -0000	1.3
@@ -78,9 +78,9 @@
 'bouton_radio_moderation_priori' => 'Moderacion a pri&ograve;ri (li
  contribucions apareisson en public basta se lu administrators
  li an validadi).',
-'bouton_radio_modere_abonnement' => '<MODIF>moderat emb abonament',
-'bouton_radio_modere_posteriori' => '<MODIF>moderat a posteri&ograve;ri',
-'bouton_radio_modere_priori' => '<MODIF>moderat a pri&ograve;ri',
+'bouton_radio_modere_abonnement' => 'moderat emb abonament',
+'bouton_radio_modere_posteriori' => 'moderat a posteri&ograve;ri',
+'bouton_radio_modere_priori' => 'moderat a pri&ograve;ri',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Non apar&eacute;isser dins la tiera dei redactors',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Non mandar d\'anoncis editoriaus',
 'bouton_radio_non_syndication' => 'Minga de sindicacion',
@@ -112,7 +112,7 @@
 // C
 'cache_mode_compresse' => 'Lu fichiers de l\'escondedor son registrats en m&ograve;de comprimit.',
 'cache_mode_non_compresse' => 'Lu fichiers de l\'escondedor son registrats en m&ograve;de non comprimit.',
-'cache_modifiable_webmestre' => '<MODIF>Lo webm&egrave;stre dau sit p&ograve;u modificar aquestu param&egrave;tres.',
+'cache_modifiable_webmestre' => 'Lo webm&egrave;stre dau sit p&ograve;u modificar aquestu param&egrave;tres.',
 'calendrier_synchro' => 'S\'utilizatz un logiciau d\'agenda compatible <b>iCal</b>, lo pod&egrave;tz sincronizar embai informacions d\'aquest sit.',
 
 
@@ -260,7 +260,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de la v&ograve;stra basa de donadas es installada.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
-'info_bloquer' => '<NEW>bloquer',
+'info_bloquer' => 'blocar',
 'info_breves' => 'Lo v&ograve;stre sit utiliza lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Li br&egrave;vas ligadi a aqueu mot clau',
@@ -293,7 +293,7 @@
 'info_creer_base' => '<B>Crear</b> una basa de donadas nov&egrave;la:',
 'info_dans_groupe' => 'Dins lo grop:',
 'info_dans_rubrique' => 'Dins la rubrica:',
-'info_date_publication_anterieure' => '<MODIF>Data anteriora de publicacion:',
+'info_date_publication_anterieure' => 'Data anteriora de publicacion:',
 'info_date_referencement' => 'DATA DE REFERENCIAMENT D\'AQUEU SIT:',
 'info_delet_mots_cles' => 'Av&egrave;tz demandat de suprimir lo mot clau
  <B>@titre_mot@</b> (@type_mot@). Aqueu mot clau es ligat a
@@ -464,7 +464,7 @@
 'info_procedure_maj_version' => 'Cau lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donadas a la version nov&egrave;la d\'SPIP.',
 'info_ps' => 'P.S.',
-'info_publier' => '<NEW>publier',
+'info_publier' => 'publicar',
 'info_publies' => 'Lu v&ograve;stres articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'ai esqueletas dau v&ograve;stre sit web si prev&eacute; lo registrament de vesitaires sensa acc&egrave;s a l\'espaci privat, vorgatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, lo v&ograve;stre sit, li estadisticas dei vesitas?',
@@ -726,12 +726,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrench)',
-'syndic_choix_moderation' => '<NEW>Que faire des prochains liens en provenance de ce site&nbsp;?',
-'syndic_choix_oublier' => '<NEW>Que faire des liens qui ne figurent plus dans le fichier de syndication&nbsp;?',
-'syndic_lien_obsolete' => '<NEW>lien obsol&egrave;te',
-'syndic_option_miroir' => '<NEW>les bloquer automatiquement',
-'syndic_option_oubli' => '<NEW>les effacer (apr&egrave;s @mois@&nbsp;mois)',
-'syndic_options' => '<NEW>Options de syndication&nbsp;:',
+'syndic_choix_moderation' => 'Que si p&ograve;u far embai ligams venents que provenon d\'aqueu sit?',
+'syndic_choix_oublier' => 'Que si p&ograve;u far embai ligams que figuran pus dins lo fichier de sindicacion?',
+'syndic_lien_obsolete' => 'ligam obsolet',
+'syndic_option_miroir' => 'lu blocar sus lo c&ograve;up',
+'syndic_option_oubli' => 'lu escafar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -788,8 +788,8 @@
  automatica.',
 'texte_creer_rubrique' => 'Avans de poder escriure d\'articles,<BR> dev&egrave;tz crear una rubrica.',
 'texte_date_creation_article' => 'DATA DE CREACION DE L\'ARTICLE:',
-'texte_date_publication_anterieure' => '<MODIF>DATA DE PUBLICACION ANTERIORA:',
-'texte_date_publication_anterieure_nonaffichee' => '<MODIF>Afichar minga de data de publicacion anteriora.',
+'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA:',
+'texte_date_publication_anterieure_nonaffichee' => 'Afichar minga de data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA:',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',

Index: spip_oc_lnc.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_lnc.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_oc_lnc.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_oc_lnc.php3	7 Sep 2005 15:01:52 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquela rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Es impossible d\'actualizar la basa MySQL v&egrave;rs la version @version@; saique i a un probl&egrave;ma relatiu al drech de modificar la basa de donadas. Volgatz contactar v&ograve;stre albergador.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fichi&egrave;r archiu es pas un fichi&egrave;r SPIP',
 'avis_archive_invalide' => 'lo fichi&egrave;r archiu es pas valid',
 'avis_attention' => 'ATENCION!',
@@ -43,7 +44,7 @@
 'barre_aide' => 'Utilizar las acorchas tipograficas per enriquir v&ograve;stra compaginacion',
 'barre_e_accent_aigu' => 'Inserir una E accent agut majuscula',
 'barre_eo' => 'Inserir una E dins l\'O',
-'barre_eo_maj' => 'Inserir una E dins l\'O majuscula',
+'barre_eo_maj' => 'Inserir una E dins la O majuscula',
 'barre_euro' => 'Inserir lo simb&egrave;l de l\'&egrave;uro: &#8364;',
 'barre_gras' => 'Metre en {{gras}}',
 'barre_guillemets' => 'Enrodar amb de &laquo; verguetas &raquo;',

Index: ecrire_fon.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_fon.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_fon.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_fon.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -225,7 +225,6 @@
 'info_ajout_participant' => 'm&#603; d&oacute;kp&oacute; l&#603; g&#596;n&aacute;:',
 'info_ajouter_rubrique' => 'mi g&#596; x&oacute;kw&iacute;n d&oacute;kp&oacute;  n&aacute;:',
 'info_annonce_nouveautes' => 'x&oacute;j&iacute;jl&aacute; y&#596;y&#596; l&#603;',
-'info_annuler_blocage_priori' => 'gb&igrave;&#598;&iacute; ',
 'info_anterieur' => '&#598;&agrave;y&iacute; x&oacute;x&oacute;',
 'info_appliquer_choix_moderation' => 'mi z&aacute;n w&agrave;l&#596; &eacute; l&#596; &#598;&#603;&#598;&#603;:',
 'info_article' => 'we&#780;kp&aacute;',
@@ -282,7 +281,6 @@
 'info_date_publication_anterieure' => '&agrave;z&aacute;n g&ugrave;d&oacute; t&#596;n :',
 'info_date_referencement' => '&agrave;z&aacute;n g&ugrave;d&oacute; t&#596;n :',
 'info_delet_mots_cles' => '&agrave;z&aacute;n g&ugrave;d&oacute; t&#596;n ',
-'info_demander_blocage_priori' => 'mi k&aacute;nby&#596;, n&uacute; &#598;&eacute; j&aacute;n',
 'info_derniere_etape' => 'N&#596;t&#603;n g&ugrave;d&oacute; t&#596;n &#596;!',
 'info_derniere_syndication' => 'Min&aacute; g&ugrave;d&oacute; t&#596;n &#596;',
 'info_derniers_articles_publies' => 'w&eacute;kp&aacute; g&ugrave;d&oacute; t&#596;n &#596;',
@@ -729,7 +727,6 @@
 'texte_date_publication_anterieure' => 'AZAN &#393;E&#770; YE S&#390; WE&#780;MA S&#390; XL&#400; &#390;&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Mi s&#596; Az&aacute;n &#598;e&#770; y&eacute; s&#596; we&#780;m&agrave; s&#596; xl&#603;.',
 'texte_date_publication_article' => 'Mi s&#596; Az&aacute;n &#598;e&#770; y&eacute; s&#596; we&#780;m&agrave; s&#596; xl&#603;&nbsp;:',
-'texte_demander_blocage_priori' => '&agrave;l&#596;wl&iacute; &#598;&eacute;v&oacute; l&#603; &#598;e&#770; g&ograve;s&iacute;n gblogbloj&iacute; &eacute; l&#596; j&aacute;n .',
 'texte_descriptif_petition' => 'mi t&igrave;nm&#603; x&oacute;j&iacute;jl&aacute; &#596;',
 'texte_descriptif_rapide' => 'mi t&igrave;nm&#603; c&agrave;c&agrave;c&agrave;',
 'texte_documents_joints' => 'Z&eacute; g&#596; n&aacute; we&#780;m&aacute;m&#603;Y&eacute; m&#596; &agrave;y&igrave; &#598;&eacute; &#598;&oacute; w&eacute;kw&iacute;n &eacute; l&#596; w&uacute; &aacute;Y&eacute; s&#596; m&#596; &#598;e&#770; n&aacute; n&#596; kp&#596;n w&eacute;kw&iacute;n s&iacute;n winwl&aacute;n g&agrave;nj&iacute; &#596; &#598;&oacute; s&ugrave;p&iacute;p&ugrave;m&#603;.Am&#596; c&oacute; n&uacute; mi n&aacute; s&#596; we&#780;m&agrave; mi t&#596;n &#598;&eacute; xl&#603; h&uacute;n mi v&aacute;n n&uacute;k&uacute;n &#598;&eacute;m&#603; &#598;&eacute;s&uacute; hw&#603;',
@@ -746,7 +743,6 @@
 'texte_jeu_caractere_2' => 'vl&agrave;v&ograve; n&uacute; mi g&ograve;s&iacute;nb&ograve; d&oacute;z&ograve; n&uacute; &#598;&eacute;xl&#603;t&#596; mi t&#596;n  mi k&nbsp;p&#596;n &agrave;c&#603; winwl t&#596;n E &#598;&ograve; &agrave;kp&aacute;xw&eacute; &#596; m&#603; T&igrave;t&ograve;m&#603; &#596; n&aacute; mi &agrave;c&#603; mi &#598;&eacute; s&uacute; t&#596;n mi N&uacute; mi l&#603; j&aacute;n bl&oacute; b&#596; &agrave;c&#603; mi t&#596;n &#598;&ograve; &agrave;z&#596; w&agrave;w&#603; t&#603;gb&#603; &#596; mi s&iacute;w&uacute;',
 'texte_lien_hypertexte' => '(n&#603; ny&iacute; &#598;&#596; w&#603;n &eacute; l&#596; k&ograve; y&iacute; &agrave;t&#603; &#596; j&iacute; &#598;&aacute; y&iacute; &#596; mi xl&#603; n&#596;t&#603;n  URL.)',
 'texte_liens_sites_syndiques' => 'mi s&#596; &#598;id&eacute; &#598;&oacute; we&#780;m&agrave; l&#603; m&#603;s&ugrave;p&iacute;p&ugrave; t&#596;n n&uacute; mi n&aacute; t&ograve; we&#780;m&agrave; mi t&#596;n g&agrave;nj&iacute; &#596; mi s&iacute;w&uacute; z&aacute;n kw&iacute;n &eacute; l&#596; l&#603;mi k&oacute; m&#596; mi &agrave;m&#596; mi s&#596; &#598;&ograve; x&oacute;x&ograve;kpl&eacute;gb&agrave;v&iacute; &#596; m&#603; &aacute;mi l&#603; v&#596; y&iacute; k&agrave;nj&iacute;',
-'texte_liens_syndication' => '&agrave;l&#596;wl&iacute; y&#596;y&#596; l&#603; n&aacute; j&#603; &agrave;t&#603; &#596; j&iacute;,mi n&aacute; s&#596; y&eacute; xl&#603; &agrave;z&#596;n &#598;&oacute;kp&oacute;.',
 'texte_login_ldap_1' => 'vl&agrave;v&ograve; n&uacute; mi g&ograve;s&iacute;nb&ograve; d&oacute;z&ograve; n&uacute; &#598;&eacute;xl&#603;t&#596; mi t&#596;n  mi k&nbsp;p&#596;n &agrave;c&#603; winwl t&#596;n E &#598;&ograve; &agrave;kp&aacute;xw&eacute; &#596; m&#603; T&igrave;t&ograve;m&#603; &#596; n&aacute; mi &agrave;c&#603; mi &#598;&eacute; s&uacute; t&#596;n mi N&uacute; mi l&#603; j&aacute;n bl&oacute; b&#596; &agrave;c&#603; mi t&#596;n &#598;&ograve; &agrave;z&#596; w&agrave;w&#603; t&#603;gb&#603; &#596; mi s&iacute;w&uacute;',
 'texte_login_precaution' => 'vl&agrave;v&ograve; n&uacute; mi g&ograve;s&iacute;nb&ograve; d&oacute;z&ograve; n&uacute; &#598;&eacute;xl&#603;t&#596; mi t&#596;n  mi k&nbsp;p&#596;n &agrave;c&#603; winwl t&#596;n E &#598;&ograve; &agrave;kp&aacute;xw&eacute; &#596; m&#603; T&igrave;t&ograve;m&#603; &#596; n&aacute; mi &agrave;c&#603; mi &#598;&eacute; s&uacute; t&#596;n mi N&uacute; mi l&#603; j&aacute;n bl&oacute; b&#596; &agrave;c&#603; mi t&#596;n &#598;&ograve; &agrave;z&#596; w&agrave;w&#603; t&#603;gb&#603; &#596; mi s&iacute;w&uacute;...',
 'texte_message_edit' => 'Gbe&#770;gb&egrave; y&eacute; wl&aacute;n we&#780;m&agrave; &#596;Mi s&#596; Az&aacute;n &#598;e&#770; y&eacute; s&#596; we&#780;m&agrave; s&#596; xl&#603;&agrave;l&#596;wl&iacute; &#598;&eacute;v&oacute; l&#603; &#598;e&#770; g&ograve;s&iacute;n gblogbloj&iacute; &eacute; l&#596; j&aacute;n mi t&igrave;nm&#603; c&agrave;c&agrave;c&agrave;x&oacute;j&iacute;jl&aacute; &#596;mi s&#596; &#598;id&eacute; &#598;&oacute; we&#780;m&agrave; l&#603; m&#603;s&ugrave;p&iacute;p&ugrave; t&#596;n ',

Index: ecrire_oc_lnc.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_lnc.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- ecrire_oc_lnc.php3	30 Jun 2005 10:09:38 -0000	1.4
+++ ecrire_oc_lnc.php3	7 Sep 2005 15:01:52 -0000	1.5
@@ -78,9 +78,9 @@
 'bouton_radio_moderation_priori' => 'Moderacion a pri&ograve;ri (las
  contribucions apareisson en public sonque se los administrators
  las an validadas).',
-'bouton_radio_modere_abonnement' => 'moderat amb abonament',
-'bouton_radio_modere_posteriori' => 'moderat a posteri&ograve;ri',
-'bouton_radio_modere_priori' => 'moderat a pri&ograve;ri',
+'bouton_radio_modere_abonnement' => 'amb abonament',
+'bouton_radio_modere_posteriori' => 'moderacion a posteri&ograve;ri',
+'bouton_radio_modere_priori' => 'moderacion a pri&ograve;ri',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Apar&eacute;isser pas dins la ti&egrave;ra dels redactors',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Mandar pas d\'anoncis editorials',
 'bouton_radio_non_syndication' => 'Pas cap de sindicacion',
@@ -237,7 +237,6 @@
 'info_ajout_participant' => 'Lo participant seguent es apondut&nbsp;:',
 'info_ajouter_rubrique' => 'Apondre una autra rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci de las novetats',
-'info_annuler_blocage_priori' => 'Anullar aquel blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar aquela causida de moderacion&nbsp;:',
 'info_article' => 'article',
@@ -259,6 +258,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de v&ograve;stra basa de donadas es installada.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'V&ograve;stre sit utiliza lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Las br&egrave;vas ligadas a aquel mot clau',
@@ -296,7 +296,6 @@
 'info_delet_mots_cles' => 'Av&egrave;tz demandat de suprimir lo mot clau
 <B>@titre_mot@</b> (@type_mot@). Aquel mot clau es ligat a
  <b>@texte_lie@</b>. Dev&egrave;tz confirmar aquela decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darri&egrave;ra estapa: <B>Es acabat!',
 'info_derniere_syndication' => 'La darri&egrave;ra sindicacion d\'aquel sit se fagu&egrave;t lo',
 'info_derniers_articles_publies' => 'V&ograve;stres darri&egrave;rs articles publicats en linha',
@@ -463,6 +462,7 @@
 'info_procedure_maj_version' => 'Cal lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donadas a la version nov&egrave;la d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'Los v&ograve;stres articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'a las esqueletas de v&ograve;stre sit web se prevei lo registrament de vesitaires sens acc&egrave;s a l\'espaci privat, volgatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, v&ograve;stre sit, las estadisticas de las vesitas?',
@@ -724,6 +724,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrench)',
+'syndic_choix_moderation' => 'Que se p&ograve;t far amb los ligams venents que provenon d\'aquel sit?',
+'syndic_choix_oublier' => 'Que se p&ograve;t far amb los ligams que figuran pas pus dins lo fichi&egrave;r de sindicacion?',
+'syndic_lien_obsolete' => 'ligam obsolet',
+'syndic_option_miroir' => 'los blocar sus lo c&ograve;p',
+'syndic_option_oubli' => 'los escafar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -783,8 +789,6 @@
 'texte_date_publication_anterieure' => 'Data de redaccion anteriora:',
 'texte_date_publication_anterieure_nonaffichee' => 'Afichar pas cap de data de redaccion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Los ligams seguents
- que provenon d\'aquel sit ser&agrave;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Pod&egrave;tz autorizar que s\'apondan de documents (fichi&egrave;rs burotics, imatges,
@@ -825,8 +829,6 @@
     es possible pu&egrave;i de 
    desblocar cada ligam individualament, o de
    causir, sit per sit, de blocar los ligams avenidors.',
-'texte_liens_syndication' => 'Los ligams venents que 
-   provenon d\'aquel sit s\'afichar&agrave;n sul pic dins lo sit public.',
 'texte_login_ldap_1' => '(Daissar vu&egrave;g per un acc&egrave;s anonim, o picar lo camin complet, per exemple &laquo;<tt>uid=fabre, ou=usanciers, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Aqu&ograve;\'s lo login amb lo qual s&egrave;tz ara connectat/ada. 
  Utilizatz aqueste formulari amb precaucion...',

Index: ecrire_oc_auv.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_auv.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_oc_auv.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_oc_auv.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -237,7 +237,6 @@
 'info_ajout_participant' => 'Lo participant seguent es apondut:',
 'info_ajouter_rubrique' => 'Apondre una autra rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci de las novetats',
-'info_annuler_blocage_priori' => 'Anullar aquel blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar aquela chausida de moderacion:',
 'info_article' => 'article',
@@ -259,6 +258,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de v&ograve;stra basa de donadas z-es installada.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'V&ograve;stre sit utiliza lo sist&egrave;ma de br&egrave;vas?',
 'info_breves_03' => 'br&egrave;vas',
 'info_breves_liees_mot' => 'Las br&egrave;vas liadas a aquel mot clau',
@@ -296,7 +296,6 @@
 'info_delet_mots_cles' => 'Av&egrave;tz demandat de suprimir lo mot clau
 <B>@titre_mot@</b> (@type_mot@). Aquel mot clau z-es liat a
  <b>@texte_lie@</b>. Dev&egrave;tz confirmar aquela decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darr&egrave;ira estapa: <B>Quo es \'chabat!',
 'info_derniere_syndication' => 'La darr&egrave;ira sindicacion d\'aquel sit se fagu&egrave;t lo',
 'info_derniers_articles_publies' => 'V&ograve;stres darr&egrave;irs articles publicats en linha',
@@ -463,6 +462,7 @@
 'info_procedure_maj_version' => 'Chau lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donadas a la version nov&egrave;la d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'V&ograve;stres articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'a las esqueletas de v&ograve;stre sit web se prevei lo registrament de vesitaires sens acc&egrave;s a l\'espaci privat, volhatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, v&ograve;stre sit, las estadisticas de las vesitas?',
@@ -724,6 +724,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrent)',
+'syndic_choix_moderation' => 'Que se p&ograve;t far amb los liams venents que provenon d\'aquel sit?',
+'syndic_choix_oublier' => 'Que se p&ograve;t far amb los liams que figuran pas pus dins lo fich&egrave;ir de sindicacion?',
+'syndic_lien_obsolete' => 'liam obsolet',
+'syndic_option_miroir' => 'los blocar sus lo c&ograve;p',
+'syndic_option_oubli' => 'los esfa&ccedil;ar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -783,8 +789,6 @@
 'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Afichar ges de data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Los liams seguents
- que provenon d\'aquel sit ser&aacute;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Pod&egrave;tz autorizar que s\'apondan de documents (fich&egrave;irs burotics, imatges,
@@ -825,8 +829,6 @@
     z-es possible pu&egrave;i de 
    desblocar chasque liam individualament, o de
    chausir, sit per sit, de blocar los liams avenidors.',
-'texte_liens_syndication' => 'Los liams venents que 
-   provenon d\'aquel sit s\'afichar&aacute;n tot sit&ograve;st dins lo sit public.',
 'texte_login_ldap_1' => '(Laissar voide per un acc&egrave;s anonim, o picar lo chamin complet, per exemple &laquo;<tt>uid=fabre, ou=usanc&egrave;irs, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Quo es lo login amb lo quau s&egrave;tz ara connectat/ada. 
  Utilizatz aqueste formulari amb precaucion...',

Index: ecrire_oc_lms.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_oc_lms.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_oc_lms.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_oc_lms.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -239,7 +239,6 @@
 'info_ajout_participant' => 'Lo participant seguent es apondut:',
 'info_ajouter_rubrique' => 'Apondre una autra rubrica d\'administrar:',
 'info_annonce_nouveautes' => 'Anonci de las novetats',
-'info_annuler_blocage_priori' => 'Anullar queu blocatge a pri&ograve;ri',
 'info_anterieur' => 'anteriora',
 'info_appliquer_choix_moderation' => 'Aplicar quela chausida de moderacion:',
 'info_article' => 'article',
@@ -261,6 +260,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de v&ograve;stra basa de donadas es installada.',
 'info_base_restauration' => 'La basa es en cors de restauracion.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'V&ograve;stre sit utiliza lo sistema de brevas?',
 'info_breves_03' => 'brevas',
 'info_breves_liees_mot' => 'Las brevas liadas a queu mot clau',
@@ -298,7 +298,6 @@
 'info_delet_mots_cles' => 'Avetz demandat de suprimir lo mot clau
 <B>@titre_mot@</b> (@type_mot@). Queu mot clau es liat a
  <b>@texte_lie@</b>. Devetz confirmar quela decision:',
-'info_demander_blocage_priori' => 'Demandar un blocatge a pri&ograve;ri',
 'info_derniere_etape' => 'Darriera estapa: <B>Quo es \'chabat!',
 'info_derniere_syndication' => 'La darriera sindicacion de queu sit se faguet lo',
 'info_derniers_articles_publies' => 'V&ograve;stres darriers articles publicats en linha',
@@ -465,6 +464,7 @@
 'info_procedure_maj_version' => 'Chau lan&ccedil;ar la procedura d\'actualizacion per adaptar
  la basa de donadas a la version novela d\'SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publicar',
 'info_publies' => 'V&ograve;stres articles publicats en linha',
 'info_question_accepter_visiteurs' => 'S\'a las esqueletas de v&ograve;stre sit web se prevei lo registrament de vesitaires sens acc&egrave;s a l\'espaci privat, volhatz activar l\'opcion seguenta:',
 'info_question_gerer_statistiques' => 'Deu gerir, v&ograve;stre sit, las estadisticas de las vesitas?',
@@ -726,6 +726,12 @@
 
 // S
 'statut_admin_restreint' => '(admin. restrench)',
+'syndic_choix_moderation' => 'Que se p&ograve;t far emb los liams venents que provenon de queu sit?',
+'syndic_choix_oublier' => 'Que se p&ograve;t far emb los liams que figuran pas pus dins lo fichier de sindicacion?',
+'syndic_lien_obsolete' => 'liam obsolet',
+'syndic_option_miroir' => 'los blocar sus lo c&ograve;p',
+'syndic_option_oubli' => 'los esfa&ccedil;ar (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicacion:',
 
 
 // T
@@ -786,8 +792,6 @@
 'texte_date_publication_anterieure' => 'DATA DE PUBLICACION ANTERIORA&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Afichar brisa de data de publicacion anteriora.',
 'texte_date_publication_article' => 'DATA DE PUBLICACION EN LINHA&nbsp;:',
-'texte_demander_blocage_priori' => 'Los liams seguents
- que provenen de queu sit ser&aacute;n blocats a pri&ograve;ri.',
 'texte_descriptif_petition' => 'Descriptiu de la peticion',
 'texte_descriptif_rapide' => 'Descriptiu rapid',
 'texte_documents_joints' => 'Podetz autorizar que s\'apondan daus documents (fichiers burotics, imatges,
@@ -827,8 +831,6 @@
     es possible puei de 
    desblocar chasque liam individualament, o de
    chausir, sit per sit, de blocar los liams avenidors.',
-'texte_liens_syndication' => 'Los liams venents que 
-   provenen de queu sit s\'afichar&aacute;n c&ograve;p sec dins lo sit public.',
 'texte_login_ldap_1' => '(Laissar voide per un acc&egrave;s anonim, o picar lo chamin complet, per exemple &laquo;<tt>uid=fabre, ou=usanciers, dc=mon-domeni, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Atencion! Quo es lo login emb lo quau setz aura connectat/ada. 
  Utilizatz queste formulari emb precaucion...',

Index: spip_oc_auv.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_auv.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_auv.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_oc_auv.php3	7 Sep 2005 15:01:52 -0000	1.4
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquela rubrica',
 'admin_recalculer' => 'Tornar calcular la pagina',
 'alerte_maj_impossible' => '<b>Al&egrave;rta!</b> Quo es impossible d\'actualizar la basa MySQL v&egrave;rs la version @version@; benl&egrave;u i a un probl&egrave;ma relatiu au dreit de modificar la basa de donadas. Volhatz contactar v&ograve;stre auberjador.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'lo fich&egrave;ir archiu z-es pas un fich&egrave;ir SPIP',
 'avis_archive_invalide' => 'lo fich&egrave;ir archiu z-es pas valid',
 'avis_attention' => 'ATENCION!',



From stef at berlios.de  Sat Sep 24 02:51:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 02:51:47 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,NONE,1.1
Message-ID: <200509240051.j8O0plmq032503@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv32352/ecrire

Added Files:
	inc_carto_fonctions.php3 
Log Message:
fonctions generales regroupee ici

--- NEW FILE: inc_carto_fonctions.php3 ---
<?php
// Ce fichier ne sera execute qu'une fois
if (defined("_ECRIRE_INC_CARTE")) return;
define("_ECRIRE_INC_CARTE", "1");

function worldfileWidth($callage){	
	$tabcallage=worldfile2array($callage);
	return intval($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x']);
}
function worldfileHeight($callage){	
	$tabcallage=worldfile2array($callage);
	return intval($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y']);
}
function worldfileULX($callage){
	$tabcallage=worldfile2array($callage);
	return $tabcallage['bottom_right']['x'];
}
function worldfileULY($callage){
	$tabcallage=worldfile2array($callage);
	return $tabcallage['bottom_right']['y']*-1;
}
function worldfileLRX($callage){
	$tabcallage=worldfile2array($callage);
	return $tabcallage['top_left']['x'];
}
function worldfileLRY($callage){
	$tabcallage=worldfile2array($callage);
	return $tabcallage['top_left']['y'];
}
function getPropMapHeight($callage, $width){
	$tabcallage=worldfile2array($callage);
	// Calcul d'une hauteur relative ? un callage (proportion)
	return $width*($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x']);
}


// D?finition du callage ? partir de la dimension de l'image
// Option par d?faut / le callage est d?fini ? la main si une projection est utilis?e
function array2worldfile($mArray){	
	return "polygon(0 0,".$mArray['largeur']." ".$mArray['hauteur'].")";
}

function worldfile2array($callage){	
	$tabcallage['shape']=substr($callage,0,strpos($callage,"("));
	
	$coordpair = explode(',',substr($callage,strpos($callage,"(")+1,-1));
	$UL = explode (' ', $coordpair[0]);
	$LR = explode (' ', $coordpair[1]);
	
	$tabcallage['top_left']['x']=$UL[0];
	$tabcallage['top_left']['y']=$UL[1];
	$tabcallage['bottom_right']['x']=$LR[0];
	$tabcallage['bottom_right']['y']=$LR[1];
	
	return $tabcallage;
}



function getImgWidth ($url_carte)
{
	$image = spip_fetch_array(spip_query("SELECT largeur FROM spip_documents WHERE id_document = $url_carte"));
	return $image['largeur'];
}
function getImgHeight ($url_carte)
{
	$image = spip_fetch_array(spip_query("SELECT hauteur FROM spip_documents WHERE id_document = $url_carte"));
	return $image['hauteur'];
}


function getArg($texte,$idArg){
	$args=explode(",",$texte);
	return $args[$idArg];
}
function wkt2imgheight($args, $callage = "",$url_carte){
	$tab=wkt2imgsize($args, $callage,$url_carte);
	return $tab[0];
}
function wkt2imgwidth($args, $callage = "",$url_carte){
	$tab=wkt2imgsize($args, $callage,$url_carte);
	return $tab[1];
}
function wkt2imgsize($args="", $callage = "",$url_carte){
	//recuperer taille reelle carte
	$callage 	= worldfile2array ($callage);
	
	$GeoWidth 	= ($callage['bottom_right']['x']-$callage['top_left']['x']);
	$GeoHeight 	= ($callage['bottom_right']['y']-$callage['top_left']['y']);
	
	
	//recuperer taille de l'image
	$ImgRealWidth = getImgWidth ($url_carte);
	$ImgRealHeight = getImgHeight ($url_carte);
	
	//ou la taille pass?e, ou ? defaut celle de la carte ???
	if ($ImgRealWidth) $ImgWidth = $ImgRealWidth;
	else $ImgWidth = $GeoWidth;
	if ($ImgRealHeight) $ImgHeight = $ImgRealHeight;
	else $ImgHeight = $GeoHeight;
	$ratio=$ImgHeight/$ImgWidth;
	
	//tailles maximum parametr?es ?
	//TODO : optimiser un peu tout ca ...
	$ImgMaxWidth = getArg($args,1);
	$ImgMaxHeight = getArg($args,0);
	if ($ImgMaxWidth==0) $ImgMaxWidth=$ImgWidth;
	if ($ImgMaxHeight==0) $ImgMaxHeight=$ImgHeight;
	
	if (($ImgMaxWidth)&&($ImgMaxWidth<$ImgWidth))
	{
		$ImgWidth=$ImgMaxWidth;
		$ImgHeight=round($ratio*$ImgMaxWidth);
	}
	if (($ImgMaxHeight)&&($ImgMaxHeight<$ImgHeight))
	{
		$ImgHeight=$ImgMaxHeight;
		$ImgWidth=round($ImgMaxHeight/$ratio);
	}
	return array($ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth);
}
/*
 *   +---------------------------------------------+
 *    Nom du Filtre : WKT to SHAPE 
 *   +---------------------------------------------+
 *    Date : mercredi 09 avril 2003
 *    Auteur : 
 *    site :  
 *   +---------------------------------------------+
 *    Fonctions de ce filtre :
 *     Appelez le dans vos squellette tout simplement
 *     par : [(#GEOMETRIE|wkt2shape)]
 *   +---------------------------------------------+
 *  
 * Pour toute suggestion, remarque, proposition d'ajout
 * reportez-vous au forum de l'article :
 * http://www.uzine.net/spip_contrib/
 *
 */
function wkt2shape($geometrie, $format = "HTML"){
	//TODO : securiser format
	$format="wkt2shape_".strtolower($format);//preg_match(",([A-Z]+),", $format, $format);

	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));

	if (function_exists($format)) return $format($wktGeomType);
	else return "";
}
/*
 *   +---------------------------------------------+
 *    Nom du Filtre : WKT to COORDS
 *   +---------------------------------------------+
 *    Date : mercredi 09 avril 2003
 *    Auteur : 
 *    site :  
 *   +---------------------------------------------+
 *    Fonctions de ce filtre :
 *     Appelez le dans vos squellette tout simplement
 *     par : [(#GEOMETRIE|wkt2coords)]
 *   +---------------------------------------------+
 *  
 * Pour toute suggestion, remarque, proposition d'ajout
 * reportez-vous au forum de l'article :
 * http://www.uzine.net/spip_contrib/
 *
 */
function wkt2coords($geometrie, $format = "HTML", $callage = "",$url_carte, $mot_desc = "", $args = ""){
	//TODO : securiser format
	$format="wkt2coords_".strtolower($format);//preg_match(",([A-Z]+),", $format, $format);
	//recuperer geometrie
	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));
	$wktGeom 	= substr($geometrie,strpos($geometrie,"(")+1,-1);
	
	$tab=wkt2imgsize($args, $callage,$url_carte);
	//recuperer taille affich?e 
	$ImgHeight=$tab[0];
	$ImgWidth=$tab[1];
	//recuperer taille reelle carte
	$GeoHeight 	= $tab[2];
	$GeoWidth 	= $tab[3];

	$radius	= 6;	// TODO : Param?tre (ou fonction du callage ?) pr?f?rable car fonction des projections 5 peut ?tre bcp trop petit
	$rgeo 		= round($radius*$GeoWidth/$ImgWidth);
	$callage 	= worldfile2array ($callage);
	
	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage);
	else return "";
}

///////////////////////////////////////////////
// HTML
///////////////////////////////////////////////
function wkt2shape_html($wktGeomType){
			if (strcasecmp($wktGeomType,"POLYGON")==0)
				return "POLY"; 
			if (strcasecmp($wktGeomType,"POINT")==0)
				return "CIRCLE"; 
			// HTML Image map ne supporte pas les lignes
}
function wkt2coords_html($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	

			// Pour obtenir des objets HTML/MAP ...
			// 	S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ','
			$coordpair = explode (',',$wktGeom);
			
			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
 				$coordpair[$i] 	= implode(',',$coord[$i]);
			}
			$wktGeom = implode(',', $coordpair);

			if (strcasecmp($wktGeomType,"POLYGON")==0)
				return $wktGeom;
			else if (strcasecmp($wktGeomType,"POINT")==0)
				return $wktGeom.",".$radius;
			else return "";
}
function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
			// Pour obtenir des objets HTML/DIV ...
			// Pour les polygones, la moyenne des valeurs
			// Pour les points, la valeur
			$coordpair = explode (',',$wktGeom);
			
			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
 				$x 				+= $coord[$i][1];
				$y				+= $coord[$i][0];
			}
			return "left: ".$y/$i."px;top: ".$x/$i."px;";
}

///////////////////////////////////////////////
// SVG
///////////////////////////////////////////////

function wkt2shape_svg($wktGeomType){
			if (strcasecmp($wktGeomType,"POLYGON")==0)
				return "polygon"; 
			else if (strcasecmp($wktGeomType,"POINT")==0)
				return "use"; 
			else if (strcasecmp($wktGeomType,"LINE")==0)
				return "polyline"; 
			else return "";
}

function wkt2coords_svg($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
			// Pour obtenir des objets SVG ...
			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
			// S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ' '
			$coordpair = explode (',',$wktGeom);

			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= $coord[$i][0];
				$coord[$i][1] 	= $coord[$i][1]*-1;
 				$coordpair[$i] 	= implode(',' ,$coord[$i]);
			}
			$wktGeom = implode(' ', $coordpair);

			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0){  	
				return "points=\"".$wktGeom."\"";		
			} elseif (strcasecmp($wktGeomType,"POINT")==0){	
				$coordTab = explode (" ", $wktGeom);
				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
			}
}
function wkt2coords_svggeo($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
			// Pour obtenir des objets SVG ...
			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
			// S?parateur coordonn?es ' ' / S?parateur paires de coordonn?es ','
			$coordpair = explode (',',$wktGeom);
			
			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= $coord[$i][0];
				$coord[$i][1] 	= $coord[$i][1]*-1;
 				$coordpair[$i] 	= implode(' ' ,$coord[$i]);
			}
			$wktGeom = implode(',', $coordpair);

			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0)
			{  	return "points=\"".$wktGeom."\"";		
			}elseif (strcasecmp($wktGeomType,"POINT")==0)
			{	$coordTab = explode (" ", $wktGeom);
				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
			}
}



///////////////////////////////////////////////
// EXPERIMENTAL
///////////////////////////////////////////////

///////////////////////////////////////////////
// DHTML (pour squelette ou formulaire)
///////////////////////////////////////////////
function wkt2coords_jsdhtml($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
			// Pour obtenir des objets HTML/MAP pour la superpo avec l'interface DHTML...
			$coordpair = explode (',',$wktGeom);
			
			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
 				$coordpair[$i] 	= implode(',',$coord[$i]);
			}
			$wktGeom = implode(',', $coordpair);

			return $wktGeom;
}

///////////////////////////////////////////////
// GOOGLE
///////////////////////////////////////////////
function wkt2coords_google($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
// Conservation des Y selon le format WKT car en coordonn?es g?ographique
			$coordpair = explode (',',$wktGeom);
			
			for ($i=0; $i<sizeof($coordpair); $i++)
			{		
				$coord[$i] 		= explode(' ',$coordpair[$i]);
				$coord[$i][0] 	= $coord[$i][0];
				$coord[$i][1] 	= $coord[$i][1]*-1;
 				$wktGoogle[$i]="GPoint(".intval($coord[$i][0]*$rgeo).",".intval($coord[$i][1]*$rgeo).")";
			}
			$wktGoogle = implode(',', $wktGoogle);

			if (strcasecmp($wktGeomType,"POLYGON")==0)
			{  	
				return "GPolyline=([".$wktGoogle."])";		
			}
			elseif (strcasecmp($wktGeomType,"LINE")==0)
			{  	
				return "GPolyline=([".$wktGoogle."])";		
			}
			elseif (strcasecmp($wktGeomType,"POINT")==0)
			{	
				$coordTab = explode (" ", $wktGeom);
				return "GPoint(".intval($coordTab[0]*$rgeo).",".intval($coordTab[1]*$rgeo).")";
			}
}
function worldfile2google($callage){	
	$tabcallage=worldfile2array($callage);
	$x=intval($tabcallage['top_left']['x']-($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x'])/2);
	$y=intval($tabcallage['top_left']['y']-($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/2);
	return "GPoint(".$x.",".$y.")";
}


?>


From stef at berlios.de  Sat Sep 24 02:52:55 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 02:52:55 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto.php3,1.17,1.18
Message-ID: <200509240052.j8O0qtmq001836@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv1510/ecrire

Modified Files:
	inc_carto.php3 
Log Message:
plus que les fonctions specifiques ? l'interface d'admin


Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.17
retrieving revision 1.18
diff -u -d -r1.17 -r1.18
--- inc_carto.php3	5 Sep 2005 14:49:08 -0000	1.17
+++ inc_carto.php3	24 Sep 2005 00:52:52 -0000	1.18
@@ -5,7 +5,6 @@
 if (defined("_ECRIRE_INC_CARTE")) return;
 define("_ECRIRE_INC_CARTE", "1");
 
-// TODO : Faut il rendre fixe la taille de l'interface DHTML ?
 
 // Conversion coordonn?es interface DHTML -> WKT
 // 	- Modification des s?parateurs d?cimaux & s?parateurs de paires de coordonn?es
@@ -40,259 +39,7 @@
 	return $selection_type."(".$wktCoords.")";			// G?om?trie au format WKT
 }
 
-function getImgWidth ($url_carte)
-{
-	$image = spip_fetch_array(spip_query("SELECT largeur FROM spip_documents WHERE id_document = $url_carte"));
-	return $image['largeur'];
-}
-function getImgHeight ($url_carte)
-{
-	$image = spip_fetch_array(spip_query("SELECT hauteur FROM spip_documents WHERE id_document = $url_carte"));
-	return $image['hauteur'];
-}
-
-/*
- *   +---------------------------------------------+
- *    Nom du Filtre : WKT to SHAPE 
- *   +---------------------------------------------+
- *    Date : mercredi 09 avril 2003
- *    Auteur : 
- *    site :  
- *   +---------------------------------------------+
- *    Fonctions de ce filtre :
- *     Appelez le dans vos squellette tout simplement
- *     par : [(#GEOMETRIE|wkt2shape)]
- *   +---------------------------------------------+
- *  
- * Pour toute suggestion, remarque, proposition d'ajout
- * reportez-vous au forum de l'article :
- * http://www.uzine.net/spip_contrib/
- *
- */
-function wkt2shape($geometrie, $format = "HTML"){
-	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));
-	switch ($format){
-		case "HTML":
-			if (strcasecmp($wktGeomType,"POLYGON")==0)
-				return "POLY"; 
-			if (strcasecmp($wktGeomType,"POINT")==0)
-				return "CIRCLE"; 
-			// HTML Image map ne supporte pas les lignes
-		break;
-		case "SVG":
-			if (strcasecmp($wktGeomType,"POLYGON")==0)
-				return "polygon"; 
-			if (strcasecmp($wktGeomType,"POINT")==0)
-				return "use"; 
-			if (strcasecmp($wktGeomType,"LINE")==0)
-				return "polyline"; 
-		break;
-	}
-}
-
-function getArg($texte,$idArg){
-	$args=explode(",",$texte);
-	return $args[$idArg];
-}
-function wkt2imgheight($args, $callage = "",$url_carte){
-	$tab=wkt2imgsize($args, $callage,$url_carte);
-	return $tab[0];
-}
-function wkt2imgwidth($args, $callage = "",$url_carte){
-	$tab=wkt2imgsize($args, $callage,$url_carte);
-	return $tab[1];
-}
-function wkt2imgsize($args="", $callage = "",$url_carte){
-	//recuperer taille reelle carte
-	$callage 	= worldfile2array ($callage);
-	
-	$GeoWidth 	= ($callage['bottom_right']['x']-$callage['top_left']['x']);
-	$GeoHeight 	= ($callage['bottom_right']['y']-$callage['top_left']['y']);
-	
-	
-	//recuperer taille de l'image
-	$ImgRealWidth = getImgWidth ($url_carte);
-	$ImgRealHeight = getImgHeight ($url_carte);
-	
-	//ou la taille pass?e, ou ? defaut celle de la carte ???
-	if ($ImgRealWidth) $ImgWidth = $ImgRealWidth;
-	else $ImgWidth = $GeoWidth;
-	if ($ImgRealHeight) $ImgHeight = $ImgRealHeight;
-	else $ImgHeight = $GeoHeight;
-	$ratio=$ImgHeight/$ImgWidth;
-	
-	//tailles maximum parametr?es ?
-	//TODO : optimiser un peu tout ca ...
-	$ImgMaxWidth = getArg($args,1);
-	$ImgMaxHeight = getArg($args,0);
-	if ($ImgMaxWidth==0) $ImgMaxWidth=$ImgWidth;
-	if ($ImgMaxHeight==0) $ImgMaxHeight=$ImgHeight;
-	
-	if (($ImgMaxWidth)&&($ImgMaxWidth<$ImgWidth))
-	{
-		$ImgWidth=$ImgMaxWidth;
-		$ImgHeight=round($ratio*$ImgMaxWidth);
-	}
-	if (($ImgMaxHeight)&&($ImgMaxHeight<$ImgHeight))
-	{
-		$ImgHeight=$ImgMaxHeight;
-		$ImgWidth=round($ImgMaxHeight/$ratio);
-	}
-	return array($ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth);
-}
-/*
- *   +---------------------------------------------+
- *    Nom du Filtre : WKT to COORDS
- *   +---------------------------------------------+
- *    Date : mercredi 09 avril 2003
- *    Auteur : 
- *    site :  
- *   +---------------------------------------------+
- *    Fonctions de ce filtre :
- *     Appelez le dans vos squellette tout simplement
- *     par : [(#GEOMETRIE|wkt2coords)]
- *   +---------------------------------------------+
- *  
- * Pour toute suggestion, remarque, proposition d'ajout
- * reportez-vous au forum de l'article :
- * http://www.uzine.net/spip_contrib/
- *
- */
-function wkt2coords($geometrie, $format = "HTML", $callage = "",$url_carte, $mot_desc = "", $args = ""){
-	//recuperer geometrie
-	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));
-	$wktGeom 	= substr($geometrie,strpos($geometrie,"(")+1,-1);
-	
-	$tab=wkt2imgsize($args, $callage,$url_carte);
-	//recuperer taille affich?e 
-	$ImgHeight=$tab[0];
-	$ImgWidth=$tab[1];
-	//recuperer taille reelle carte
-	$GeoHeight 	= $tab[2];
-	$GeoWidth 	= $tab[3];
-
-	$radius	= 6;	// TODO : Param?tre (ou fonction du callage ?) pr?f?rable car fonction des projections 5 peut ?tre bcp trop petit
-	$rgeo 		= round($radius*$GeoWidth/$ImgWidth);
-	$callage 	= worldfile2array ($callage);
-	
-	switch ($format){
-		case "HTML":
-			// Pour obtenir des objets HTML/MAP ...
-			// 	S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ','
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
-				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
- 				$coordpair[$i] 	= implode(',',$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0)
-				return $wktGeom;
-			if (strcasecmp($wktGeomType,"POINT")==0)
-				return $wktGeom.",".$radius;
-		break;
-		case "HTMLDIV":
-			// Pour obtenir des objets HTML/DIV ...
-			// Pour les polygones, la moyenne des valeurs
-			// Pour les points, la valeur
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
-				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
- 				$x 				+= $coord[$i][1];
-				$y				+= $coord[$i][0];
-			}
-			return "left: ".$y/$i."px;top: ".$x/$i."px;";
-					
-		break;		
-		case "JSDHTML":
-			// Pour obtenir des objets HTML/MAP pour la superpo avec l'interface DHTML...
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
-				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
- 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
- 				$coordpair[$i] 	= implode(',',$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			return $wktGeom;
-		break;
-		case "SVG":
-		case "SVGGEO":
-			// Pour obtenir des objets SVG ...
-			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
-			// S?parateur coordonn?es ' ' / S?parateur paires de coordonn?es ','
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= $coord[$i][0];
-				$coord[$i][1] 	= $coord[$i][1]*-1;
- 				$coordpair[$i] 	= implode(' ' ,$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0)
-			{  	return "points=\"".$wktGeom."\"";		
-			}elseif (strcasecmp($wktGeomType,"POINT")==0)
-			{	$coordTab = explode (" ", $wktGeom);
-				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
-			}
-		break;
-		case "GOOGLE":
-			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= $coord[$i][0];
-				$coord[$i][1] 	= $coord[$i][1]*-1;
- 				$wktGoogle[$i]="GPoint(".intval($coord[$i][0]*$rgeo).",".intval($coord[$i][1]*$rgeo).")";
-			}
-			$wktGoogle = implode(',', $wktGoogle);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0)
-			{  	
-				return "GPolyline=([".$wktGoogle."])";		
-			}
-			elseif (strcasecmp($wktGeomType,"LINE")==0)
-			{  	
-				return "GPolyline=([".$wktGoogle."])";		
-			}
-			elseif (strcasecmp($wktGeomType,"POINT")==0)
-			{	
-				$coordTab = explode (" ", $wktGeom);
-				return "GPoint(".intval($coordTab[0]*$rgeo).",".intval($coordTab[1]*$rgeo).")";
-			}
-		break;
-	}
-}
-
-
-
-
-
-
-// D?finition du callage ? partir de la dimension de l'image
-// Option par d?faut / le callage est d?fini ? la main si une projection est utilis?e
-function array2worldfile($mArray){	
-	return "polygon(0 0,".$mArray['largeur']." ".$mArray['hauteur'].")";
-}
-
-
+// TODO : Faut il rendre fixe la taille de l'interface DHTML ?
 
 function embed_carto_url($id_carte, $url_parse) {
 	$lURL = $url_parse['path']."/carto.php3?id_carte=".$id_carte."&scale=".$_GET['scale']."&x=".$_GET['x']."&y=".$_GET['y'];



From stef at berlios.de  Sat Sep 24 02:53:48 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 02:53:48 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_mots.php3,1.6,1.7
Message-ID: <200509240053.j8O0rkmq004580@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv4373/ecrire

Modified Files:
	inc_mots.php3 
Log Message:
oubli spip 1.8.2d

Index: inc_mots.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_mots.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_mots.php3	7 Sep 2005 15:01:53 -0000	1.6
+++ inc_mots.php3	24 Sep 2005 00:53:43 -0000	1.7
@@ -525,7 +525,7 @@
 			}
 		}
 		
-		if ($table == 'articles' AND $connect_statut == '0minirezo' AND $flag_editable AND $options == "avancees") {
+		if ($connect_statut == '0minirezo' AND $flag_editable AND $options == "avancees") {
 			echo "<tr><td></td><td colspan='2'>";
 			echo "<div style='width: 200px;'>";
 			$retour = urlencode($GLOBALS['clean_link']->getUrl());



From stef at berlios.de  Sat Sep 24 02:58:42 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 02:58:42 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_texte.php3,1.11,1.12
Message-ID: <200509240058.j8O0wgmq018061@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv18032/ecrire

Modified Files:
	inc_texte.php3 
Log Message:
hack principal : fonction apres_tout.
interdire_script s?par? en 2 avec cette fonction au milieu (si elle existe)
Attention : implique changement de sintaxe des balises :
<mapXX|typecarte(arguments)>

Les arguments sont pass?s entre parentheses

Index: inc_texte.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_texte.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- inc_texte.php3	7 Sep 2005 15:01:53 -0000	1.11
+++ inc_texte.php3	24 Sep 2005 00:58:39 -0000	1.12
@@ -374,7 +374,14 @@
 
 // Securite : empecher l'execution de code PHP
 function interdire_scripts($source) {
-	$source = preg_replace(",<(\%|\?|([[:space:]]*)script),", "&lt;\\1", $source);
+	/////////////////////////////////////////////////////
+	//MODIFICATION SPIPCARTO
+	/////////////////////////////////////////////////////
+	$source = preg_replace(",<(([[:space:]]*)script|base),ims", "&lt;\\1", $source);
+	if (function_exists('apres_tout'))
+		$source = apres_tout($source);
+	$source = preg_replace(",<(\%|\?),ims", "&lt;\\1", $source);
+	/////////////////////////////////////////////////////
 	return $source;
 }
 



From stef at berlios.de  Sat Sep 24 03:00:24 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:00:24 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.7,1.8
Message-ID: <200509240100.j8O10Omq018792@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv18764/ecrire

Modified Files:
	mes_options.php3 
Log Message:
plus clean deja ...
Pas moyen de mettre les declarations dans un include (?)

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- mes_options.php3	10 Aug 2005 12:06:33 -0000	1.7
+++ mes_options.php3	24 Sep 2005 01:00:22 -0000	1.8
@@ -1,69 +1,9 @@
-<?
-//$mysql_profile = true;
-//////////////////////////////////////////////////
+<?php
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 //          MODULE CARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-//FILTRES
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-
-function worldfile2google($callage){	
-	$tabcallage=worldfile2array($callage);
-	$x=intval($tabcallage['top_left']['x']-($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x'])/2);
-	$y=intval($tabcallage['top_left']['y']-($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/2);
-	return "GPoint(".$x.",".$y.")";
-}
-function worldfileWidth($callage){	
-	$tabcallage=worldfile2array($callage);
-	return intval($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x']);
-}
-function worldfileHeight($callage){	
-	$tabcallage=worldfile2array($callage);
-	return intval($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y']);
-}
-function worldfileULX($callage){
-	$tabcallage=worldfile2array($callage);
-	return $tabcallage['bottom_right']['x'];
-}
-function worldfileULY($callage){
-	$tabcallage=worldfile2array($callage);
-	return $tabcallage['bottom_right']['y']*-1;
-}
-function worldfileLRX($callage){
-	$tabcallage=worldfile2array($callage);
-	return $tabcallage['top_left']['x'];
-}
-function worldfileLRY($callage){
-	$tabcallage=worldfile2array($callage);
-	return $tabcallage['top_left']['y'];
-}
-function getPropMapHeight($callage, $width){
-	$tabcallage=worldfile2array($callage);
-	// Calcul d'une hauteur relative ? un callage (proportion)
-	return $width*($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x']);
-}
-
-
-function worldfile2array($callage){	
-	$tabcallage['shape']=substr($callage,0,strpos($callage,"("));
-	
-	$coordpair = explode(',',substr($callage,strpos($callage,"(")+1,-1));
-	$UL = explode (' ', $coordpair[0]);
-	$LR = explode (' ', $coordpair[1]);
-	
-	$tabcallage['top_left']['x']=$UL[0];
-	$tabcallage['top_left']['y']=$UL[1];
-	$tabcallage['bottom_right']['x']=$LR[0];
-	$tabcallage['bottom_right']['y']=$LR[1];
-	
-	return $tabcallage;
-}
 
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
@@ -214,8 +154,13 @@
 	$boucle->from[] =  "spip_carto_objets AS " . $boucle->type_requete;
 	return calculer_boucle($id_boucle, $boucles); 
 }
-function avant_propre($texte) {
+
+include_ecrire("inc_carto_fonctions.php3");
+
+function apres_tout($texte) {
 	include_ecrire('plugins/plug_carto.php');
-    return avant_typo_carto($texte);
+    return apres_tout_carto($texte);
 }
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
 ?>



From stef at berlios.de  Sat Sep 24 03:01:04 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:01:04 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire spip_style.php3,1.8,1.9
Message-ID: <200509240101.j8O114mq018922@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv18894/ecrire

Modified Files:
	spip_style.php3 
Log Message:
commentaire

Index: spip_style.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/spip_style.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- spip_style.php3	18 Aug 2005 23:28:33 -0000	1.8
+++ spip_style.php3	24 Sep 2005 01:01:02 -0000	1.9
@@ -46,8 +46,11 @@
 
 	function http_img_pack($f) { return _DIR_IMG_PACK . $f; }
 ?>
+//////////////////////////////////////////
+//MODIFICATION SPIPCARTO
+//////////////////////////////////////////
 @import "dhtml_tools.css";
-
+//////////////////////////////////////////
 
 /*
  * Police par defaut (bof...)
@@ -866,7 +869,11 @@
 	font-family: verdana, arial, helvetica, sans;
 	font-size: 12px;
 	padding: 6px;
+//////////////////////////////////////////
+//MODIFICATION SPIPCARTO
+//////////////////////////////////////////
 /*	position: relative;*/
+//////////////////////////////////////////
 }
 
 .cadre-titre {



From stef at berlios.de  Sat Sep 24 03:02:42 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:02:42 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.5,1.6
Message-ID: <200509240102.j8O12gmq019209@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv19178/ecrire/plugins

Modified Files:
	plug_carto.php 
Log Message:
changement de nom (apres_tout_carto)
changement de syntaxe (args) au lieu de {args}

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- plug_carto.php	4 Jul 2005 15:54:21 -0000	1.5
+++ plug_carto.php	24 Sep 2005 01:02:40 -0000	1.6
@@ -3,10 +3,10 @@
 // XX est le numero de la carte
 // align fonctionne comme les images (left / center / right)
 
-function avant_typo_carto($texte) {
+function apres_tout_carto($texte) {
 	
 	if (is_int(strpos($texte, '<map')) &&
-	 (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?([{])?([a-zA-Z0-9\,.]+)?([}])?>,", $texte, $regs, PREG_SET_ORDER))) {
+	  (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?([(])?([a-zA-Z0-9\,\-.]+)?([)])?>,", $texte, $regs, PREG_SET_ORDER))) {	
 		global $flag_ecrire;
 		$id_article=$_POST['id_article'];
 		if ($flag_ecrire) {



From stef at berlios.de  Sat Sep 24 03:10:59 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:10:59 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_google.html,1.2,1.3
Message-ID: <200509240111.j8O1Axmq021082@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv21054/squelettes/template

Modified Files:
	carto_google.html 
Log Message:
en cours ...

Index: carto_google.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_google.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_google.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_google.html	24 Sep 2005 01:10:57 -0000	1.3
@@ -1,6 +1,6 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <script src="http://maps.google.com/maps?file=api&v=1&key=ABQIAAAAO9ChODSxBmUvTvMGRXN25xSFeelUExqH7qKuphiWYMTKLs5ebRQgdf0qqnC2d1KXcgEE194B0v9TSQ" type="text/javascript"></script>
-<div id="map" style="width: 500px; height: 400px"></div>
+<div id="map" style="width:500px; height:400px;"></div>
 <script type="text/javascript">
 //<![CDATA[
  function createMarker(point, id) {
@@ -15,8 +15,7 @@
     var map = new GMap(document.getElementById("map"));
 	map.addControl(new GLargeMapControl());
 	map.addControl(new GMapTypeControl());
-	[map.centerAndZoom(new (#CALLAGE|worldfile2google{#GEOMETRIE}), 15);]
-	 map.addControl(new GSmallMapControl());
+	[map.centerAndZoom(new (#CALLAGE|worldfile2google),8);]
 	<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
 	[var point#ID_CARTO_OBJET = new (#GEOMETRIE|wkt2coords{GOOGLE,#CALLAGE,#URL_CARTE});
 	var marker#ID_CARTO_OBJET = createMarker(point#ID_CARTO_OBJET, [(#URL_OBJET|url)]);



From stef at berlios.de  Sat Sep 24 03:12:28 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:12:28 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svgfilex.html,1.5,1.6
Message-ID: <200509240112.j8O1CSmq021178@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv21153/squelettes/template

Modified Files:
	carto_svgfilex.html 
Log Message:
SVG<>GEOSVG

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- carto_svgfilex.html	6 Sep 2005 05:41:40 -0000	1.5
+++ carto_svgfilex.html	24 Sep 2005 01:12:26 -0000	1.6
@@ -203,7 +203,7 @@
 	<!-- #DESCRIPTIF -->
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
 		 </BOUCLE_M>
@@ -214,7 +214,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>



From stef at berlios.de  Sat Sep 24 03:13:17 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 24 Sep 2005 03:13:17 +0200
Subject: [Spip-carto-cvs] spipcarto inc-balises.php3,1.11,1.12
Message-ID: <200509240113.j8O1DHmq021234@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv21209

Modified Files:
	inc-balises.php3 
Log Message:
traitement des url_objet par spip

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- inc-balises.php3	7 Sep 2005 15:01:53 -0000	1.11
+++ inc-balises.php3	24 Sep 2005 01:13:14 -0000	1.12
@@ -60,6 +60,11 @@
 		'URL_SITE' => 'htmlspecialchars(vider_url(%s))',
 		'URL_SYNDIC' => 'htmlspecialchars(vider_url(%s))',
 		'ENV' => 'entites_html(%s)'
+		/////////////////////////////////////////////////////
+		//MODIFICATION SPIPCARTO
+		/////////////////////////////////////////////////////
+		,'URL_OBJET' => 'htmlspecialchars(url(vider_url(%s)))'
+		/////////////////////////////////////////////////////
 	);
 	$ps = $traitements[$p->nom_champ];
 	if (!$ps) return $p->code;



From fxp at berlios.de  Mon Sep 26 07:46:16 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:46:16 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_en.php3,NONE,1.1 spipcarto_fr.php3,NONE,1.1
Message-ID: <200509260546.j8Q5k7mq007284@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv7271/ecrire/lang

Added Files:
	spipcarto_en.php3 spipcarto_fr.php3 
Log Message:
i18n / fr, en

--- NEW FILE: spipcarto_en.php3 ---
<?php

// This is a SPIP language file  --  Ceci est un fichier langue de SPIP

$GLOBALS[$GLOBALS['idx_lang']] = array(
'calque' => 'Layers ',

'cartes_toutes' => 'All maps',
'carte_creer' => 'Create a new map',
'carte_nouvelle' => 'New map',
'carte_numero' => 'Map identifier :', 
'carte_apercu' => 'Map overview', 
'carte_img' => 'Image', 
'carte_lien' => 'Image with link',
'carte_logo' => 'Image with symbols',
'carte_svg' => 'SVG simple',
'carte_svgx' => 'SVG with zoom',
'carte_svggeo' => 'SVG with zoom and webservices (WMS)',
'carte_warning' => 'Warning :',
'carte_supp' => 'Remove current map', 
'carte_supp_confirm' => 'Are you sure to remove this map ?',
'carte_articles_use' => 'Articles using this map',
'carte_titre' => 'Map title', 
'carte_fond' => 'Background image',
'carte_fond_numero' => '(Spip image identifier)',
'carte_callage' => 'Bounding box', 
'carte_srs' => 'Coordinate system', 
'carte_objets' => 'Objects',
'carte_import' => 'You can import, modify or delete map objects.',
'carte_import_objet' => 'Import objects into current map',
'carte_supp_objets' => 'Remove all objects',
'carte_insert' => 'Insert a map',
'carte_insert_texte' => 'You can insert maps into your articles. Select a<br/>map in the list below and copy the shortcut<br/> in your text.',
'carte_raccourci' => 'Copy the shortcut into your article to insert this form.',
'carte_loading' => 'Loading message',
'carte_point' => 'Point',
'carte_line' => 'Line',
'carte_polygon' => 'Polygon',
'carte_draw' => 'Draw ',

'import_objet_sel_texte' => 'Link columns from your text file to object fields.',
'import_objet_sel_gpx' => 'Link columns from your GPX file to object fields.',
'import_texte' => 'Import text file (CSV)',
'import_no_fichier' => 'There\'s no file in the folder upload (use FTP).',
'import_gpx' => 'Import GPS file (GPX)',
'import_warning' => 'Warning, objects that you\'re going to import into your map have to be in the same coordinate system !',

'objet_nouvel' => 'New object',
'objet_nouvel_defaut' => '(\'New\' by default)',
'objet_add' => 'Add object', 
'objet_titre' => 'Title',
'objet_lien' => 'Hyperlink',
'objet_lien_default' => '(null by default)',
'objet_logo' => 'Symbol', 
'objet_geom' => 'Geometry', 
'objet_supp' => 'Remove object',
'objet_x' => 'X ',
'objet_y' => 'Y ',
'objet_coord_default' => '(0 by default)',
'objet_import' => 'Import objects.',
'objet_import_nombre' => 'Number of imported objects added to your map :'

);

?>


--- NEW FILE: spipcarto_fr.php3 ---
<?php

// This is a SPIP language file  --  Ceci est un fichier langue de SPIP

$GLOBALS[$GLOBALS['idx_lang']] = array(
'calque' => 'Calques ',

'cartes_toutes' => 'Toutes les cartes',
'carte_creer' => 'Cr&eacute;er une nouvelle carte',
'carte_nouvelle' => 'Nouvelle carte',
'carte_numero' => 'CARTE NUM&Eacute;RO :', 
'carte_apercu' => 'Aper?u de la carte', 
'carte_img' => 'Image simple', 
'carte_lien' => 'Image avec liens',
'carte_logo' => 'Image avec logos',
'carte_svg' => 'SVG simple',
'carte_svgx' => 'SVG avec zoom',
'carte_svggeo' => 'SVG avec zoom et services web (WMS)',
'carte_warning' => 'Attention :',
'carte_supp' => 'Supprimer cette carte', 
'carte_supp_confirm' => 'Voulez-vous vraiment supprimer cette carte ?',
'carte_articles_use' => 'Articles utilisant cette carte',
'carte_titre' => 'Titre de la carte', 
'carte_fond' => 'Fond de carte',
'carte_fond_numero' => '(Num?ro de l\'image Spip ou URL de l\'image)',
'carte_callage' => 'Callage de la carte', 
'carte_srs' => 'Syst?me de coordonn?es', 
'carte_objets' => 'Objets de la carte',
'carte_import' => 'Vous pouvez ici importer, modifier et supprimer les objets de la carte.',
'carte_import_objet' => 'Importer des objets dans la carte',
'carte_supp_objets' => 'Supprimer tous les objets de la carte',
'carte_insert' => 'Ins&eacute;rer une carte',
'carte_insert_texte' => 'Vous pouvez ins&eacute;rer des cartes dans vos articles. Choisissez une <br/>carte dans la liste ci-dessous et recopiez le raccourci dans le texte <br/>de l\'article.',
'carte_raccourci' => 'Recopiez ce raccourci dans le texte de l\'article pour ins&eacute;rer ce formulaire.',
'carte_loading' => 'Chargement de la carte',
'carte_point' => 'Point',
'carte_line' => 'Ligne',
'carte_polygon' => 'Polygone',
'carte_draw' => 'Dessiner un objet',

'import_objet_sel_texte' => 'S?lectionner les champs du fichier texte ? importer dans les objets de votre carte.',
'import_objet_sel_gpx' => 'S?lectionner les champs du fichier GPX ? importer dans les objets de votre carte.',
'import_texte' => 'Import fichier texte (CSV)',
'import_no_fichier' => 'Il n\'y a pas de fichier dans le r?pertoire upload (Utilisez le FTP).',
'import_gpx' => 'Import fichier GPS (GPX)',
'import_warning' => 'Attention, les objets que vous allez associer ? la carte doivent ?tre dans la m?me projection !',

'objet_nouvel' => 'Nouvel objet',
'objet_nouvel_defaut' => '(\'Nouvel Objet\' par d?faut)',
'objet_add' => 'Ajouter un objet', 
'objet_titre' => 'Titre de l\'objet',
'objet_lien' => 'Lien de l\'objet',
'objet_lien_default' => '(null par d?faut)',
'objet_logo' => 'Logo de l\'objet', 
'objet_geom' => 'G?ometrie', 
'objet_supp' => 'Supprimer cet objet',
'objet_x' => 'Coordonn?es X ',
'objet_y' => 'Coordonn?es Y ',
'objet_coord_default' => '(0 par d?faut)',
'objet_import' => 'Importation des objets.',
'objet_import_nombre' => 'Nombre d\'objets ajout?s ? votre carte :'
);


?>


From fxp at berlios.de  Mon Sep 26 07:51:25 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:51:25 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.16,1.17
Message-ID: <200509260551.j8Q5pPmq009667@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv9603/ecrire

Modified Files:
	carte_edit.php3 
Log Message:
i18n / fr, en

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.16
retrieving revision 1.17
diff -u -d -r1.16 -r1.17
--- carte_edit.php3	5 Sep 2005 14:50:49 -0000	1.16
+++ carte_edit.php3	26 Sep 2005 05:51:22 -0000	1.17
@@ -28,7 +28,7 @@
 
 if ($flag_editable) {
 	if ($new == 'oui') {
-		$titre = _L("Nouvelle carte");
+		$titre = _T("carte_nouvelle");
 		$url_carte = "";
 		$texte = "";
 		$callage = "";
@@ -101,7 +101,7 @@
 	// Ajout d'un objet
 	if ($selection_type) {
 		$geometrie=coords2wkt($selection_type,$selection_coords, worldfile2array($row['callage']), $url_carte); // Si pas de fonction de zoom le callage correspond bien ? la valeur. Sinon avec zoom, il faut passer les coordonn?es g?ographiques de la vue en cours ....
-		$objet_titre = _L("Nouvel objet");
+		$objet_titre = _T("objet_nouvel");
 		$url_objet = "#";
 		//TODO : passer tout ca en spip_abstract ...
 		spip_query("INSERT INTO spip_carto_objets (id_carto_carte,titre,geometrie,url_objet) VALUES (".$id_carte.",'".addslashes($objet_titre)."','".$geometrie."','".$url_objet."')");
@@ -155,16 +155,16 @@
 
 echo "<div align='center'>\n";
 
-echo "<font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._L('CARTE NUM&Eacute;RO :')."</b></font>\n";
+echo "<font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('carte_numero')."</b></font>\n";
 echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='6'><b>$id_carte</b></font>\n";
 if ($url_carte && ($new!="oui")) {
-	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._L('Aper?u de la carte')."</b></font>\n";
-	icone_horizontale( _T('Image simple'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('Image avec liens'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('Image avec logos'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('SVG simple'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('SVG avec zoom'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _L('SVG avec zoom et services web (WMS)'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('carte_apercu')."</b></font>\n";
+	icone_horizontale( _T('carte_img'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('carte_lien'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('carte_logo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('carte_svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('carte_svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('carte_svggeo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
 }
 echo "</div>\n";
 
@@ -182,8 +182,8 @@
 debut_droite();
 
 if ($supp_carte && !$supp_confirme && !$supp_rejet) {
-	echo "<p><strong>"._L("Attention :")."</strong> ";
-	echo _L("Voulez-vous vraiment supprimer cette carte ?")."</p>\n";
+	echo "<p><strong>"._T("carte_warning")."</strong> ";
+	echo _T("carte_supp_confirm")."</p>\n";
 	$link = $carte_supplink;//new Link();
 	//$link->addVar('supp_carte', $supp_carte);
 	echo $link->getform('GET');
@@ -214,7 +214,7 @@
 		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 		echo bouton_block_visible("dhtml_carte");
 		echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-			._L("Ajouter un objet")."</strong>";
+			._T("objet_add")."</strong>";
 		echo "</div>\n";
 		
 		echo debut_block_visible("dhtml_carte");
@@ -238,7 +238,7 @@
 	}
 	
 	//articles li?s
-	afficher_articles(_L("Articles utilisant cette carte"),
+	afficher_articles(_T("carte_articles_use"),
 		", spip_carto_cartes_articles AS lien WHERE lien.id_article=articles.id_article ".
 		"AND id_carto_carte=$id_carte AND statut!='poubelle' ORDER BY titre");
 	
@@ -267,7 +267,7 @@
 	//if (!$nb_reponses) {
 	//	$link->addVar('supp_confirme', 'oui');
 	//}
-	icone(_L("Supprimer cette carte"), $link->getUrl(), "carte-24.gif", "supprimer.gif");
+	icone(_T("carte_supp"), $link->getUrl(), "carte-24.gif", "supprimer.gif");
 	echo "</div>\n";
 }
 
@@ -284,7 +284,7 @@
 	$link->addVar('modif_carte', $id_carte);
 	echo $link->getForm('GET');
 	
-	echo "<strong><label for='titre_carte'>"._L("Titre de la carte")."</label></strong> "._T('info_obligatoire_02');
+	echo "<strong><label for='titre_carte'>"._T("carte_titre")."</label></strong> "._T('info_obligatoire_02');
 	echo "<br />";
 	echo "<input type='text' name='titre' id='titre_carte' CLASS='formo' ".
 		"value=\"".$titre."\" size='40'$js_titre><br />\n";
@@ -309,12 +309,12 @@
 			"value=\"".$id_srs."\" size='40'>";*/
 	}
 	else {
-		echo "<strong><label for='url_carte_carte'>"._L("Fond de carte")."</label></strong> "._T('info_obligatoire_02'). "<br />"._L("(Num?ro de l'image Spip ou URL de l'image)");
+		echo "<strong><label for='url_carte_carte'>"._T("carte_fond")."</label></strong> "._T('info_obligatoire_02'). "<br />"._T("carte_fond_numero");
 		echo "<br />";
 		echo "<input type='text' name='url_carte' id='url_carte_carte' CLASS='formo' ".
 			"value=\"".$url_carte."\" size='40'><br />\n";
 		
-		echo "<strong><label for='callage_carte'>"._L("Callage de la carte")."</label></strong>";
+		echo "<strong><label for='callage_carte'>"._T("carte_callage")."</label></strong>";
 		echo "<br />";
 		echo "<textarea name='callage' id='callage_carte' CLASS='forml' rows='4' cols='40' wrap='soft'>";
 		echo $callage;
@@ -322,7 +322,7 @@
 
 
 		afficher_srs ($id_srs);
-		/*echo "<strong><label for='srs_carte'>"._L("S.R.S. de la carte")."</label></strong> "._T('info_obligatoire_02');
+		/*echo "<strong><label for='srs_carte'>"._T("carte_srs")."</label></strong> "._T('info_obligatoire_02');
 		echo "<br />";
 		echo "<input type='text' name='id_srs' id='srs_carte' CLASS='formo' ".
 			"value=\"".$id_srs."\" size='40'><br />\n";*/
@@ -341,14 +341,14 @@
 		echo "<a name='objets'></a>";
 		echo "<p><hr><p>\n";
 		echo "<div class='verdana3'>";
-		echo "<strong>"._L("Objets de la carte")."</strong><br />\n";
-		echo _L("Vous pouvez ici importer, modifier et supprimer les objets de la carte.");
+		echo "<strong>"._T("carte_objets")."</strong><br />\n";
+		echo _T("carte_import");
 		echo "</div>\n";
 
 		echo "<br />\n";
 		echo "<div align='$spip_lang_right'>";
 		// Icone importer des objets
-		icone(_L("Importer des objets dans la carte"), $carte_importlink->getURL(), "carte-24.gif", "creer.gif");
+		icone(_T("carte_import_objet"), $carte_importlink->getURL(), "carte-24.gif", "creer.gif");
 		echo "</div>\n";
 	}
 
@@ -360,7 +360,7 @@
 		echo "<div align='$spip_lang_right'>";
 		$carte_suppallobjlink = $carte_link;
 		$carte_suppallobjlink->addVar('supp_objet_all', 'ok');
-		icone(_L("Supprimer tous les objets de la carte"), $carte_suppallobjlink->getURL(), "carte-24.gif", "supprimer.gif");
+		icone(_T("carte_supp_objets"), $carte_suppallobjlink->getURL(), "carte-24.gif", "supprimer.gif");
 		echo "</div>\n";
 		
 //map ?
@@ -380,53 +380,57 @@
 			else if ($visible) echo "<a name='objet_visible'></a>";
 			echo "<p>\n";
 			debut_cadre_relief();
-			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
-			
-//			echo $visible ? bouton_block_visible("objet_$id_objet") : bouton_block_invisible("objet_$id_objet");
-			echo "<strong>".$titre_objet."</strong>";
-			echo "<br /></div>";
-//			echo $visible ? debut_block_visible("objet_$id_objet") : debut_block_invisible("objet_$id_objet");
 				
 				// Modifier un objet
 				$link = $carte_link;
 				$link->addVar('modif_objet', $id_objet);
 				echo $link->getForm('GET', '#objet_visible');
 				echo "<div class='verdana2'>";
-				echo "<p>";
-				if ($nouveau) {
-					echo "<script type='text/javascript'><!-- \nvar antifocus_champ = false; // --></script>\n";
-					$js = " onfocus=\"if(!antifocus_champ){this.value='';antifocus_champ=true;}\"";
-				}
-				else $js = "";
-				echo "<strong><label for='titre_$id_objet'>"._L("Titre de l'objet")."</label></strong> :";
-				echo "<br />";
-				echo "<input type='text' name='objet_titre' id='titre_$id_objet' value=\"".
-					$titre_objet."\" class='fondo verdana2' size='30'$js><br />\n";
-				//bloc_edition_objet($t, $carte_link);
-				
-				echo "<strong><label for='desc_$id_objet'>"._T('info_texte')."</label></strong>";
-				echo "<br />";
-				echo "<textarea name='objet_texte' id='desc_$id_objet' CLASS='forml' rows='4' cols='40' wrap='soft'>";
-				echo $texte_objet;
-				echo "</textarea><br />\n";
-	
-				echo "<strong><label for='lien_$id_objet'>"._L("Lien de l'objet")."</label></strong> :";
-				echo "<br />";
-				echo "<input type='text' name='url_objet' id='lien_$id_objet' value=\"".
-					$lien_objet."\" class='fondo verdana2' size='30'$><br />\n";
-	
-				echo "<strong><label for='logo_$id_objet'>"._L("Logo de l'objet")."</label></strong> :";
-				echo "<br />";
-				echo "<input type='text' name='url_logo' id='logo_$id_objet' value=\"".
-					$url_logo."\" class='fondo verdana2' size='30'$><br />\n";
-	
-				echo "<strong><label for='geo_$id_objet'>"._L('G?ometrie')."</label></strong>";
-				echo "<br />";
-				echo "<textarea name='geometrie' id='geo_$id_objet' CLASS='forml' rows='4' cols='40' wrap='soft'>";
-				echo $geometrie;
-				echo "</textarea><br />\n";
-	
-				echo "</p>";
+				echo "<table>";
+					echo "<tr valign='top'><td>";
+					echo "<strong>".$titre_objet."</strong>";
+					echo "</td><td width='20px'></td><td>";					
+					// 		Supprimer un objet
+					$link = $carte_link;
+					$link->addVar('supp_objet', $id_objet);
+					echo "<br/><div style='float:right;'>";
+					icone_horizontale(_T("objet_supp"), $link->getUrl('objets'), "carte-24.gif", "supprimer.gif");
+					echo "</div>\n";
+					echo "</td></tr>";					
+					echo "<tr><td>";
+					if ($nouveau) {
+						echo "<script type='text/javascript'><!-- \nvar antifocus_champ = false; // --></script>\n";
+						$js = " onfocus=\"if(!antifocus_champ){this.value='';antifocus_champ=true;}\"";
+					}
+					else $js = "";
+					echo "<strong><label for='titre_$id_objet'>"._T("objet_titre")."</label></strong> :";
+					echo "<br />";
+					echo "<input type='text' name='objet_titre' id='titre_$id_objet' value=\"".
+						$titre_objet."\" class='fondo verdana2' size='30'$js><br />\n";
+					//bloc_edition_objet($t, $carte_link);
+					
+					echo "<strong><label for='desc_$id_objet'>"._T('info_texte')."</label></strong>";
+					echo "<br />";
+					echo "<textarea name='objet_texte' id='desc_$id_objet' CLASS='forml' rows='4' cols='25' wrap='soft'>";
+					echo $texte_objet;
+					echo "</textarea><br />\n";
+		
+					echo "</td><td width='20px'></td><td>";					
+					echo "<strong><label for='lien_$id_objet'>"._T("objet_lien")."</label></strong> :";
+					echo "<br />";
+					echo "<input type='text' name='url_objet' id='lien_$id_objet' value=\"".
+						$lien_objet."\" class='fondo verdana2' size='30'$><br />\n";
+		
+					echo "<strong><label for='logo_$id_objet'>"._T("objet_logo")."</label></strong> :";
+					echo "<br />";
+					echo "<input type='text' name='url_logo' id='logo_$id_objet' value=\"".
+						$url_logo."\" class='fondo verdana2' size='30'$><br />\n";
+		
+					echo "<strong><label for='geo_$id_objet'>"._T('objet_geom')."</label></strong><br/>";
+					echo "<input type='text' name='geometrie' id='geo_$id_objet' class='fondo verdana2' size='30' value='";
+					echo $geometrie."'/><br/>\n";
+					echo "</td></tr>";
+				echo "</table>";
 	
 				echo "<div align='right'>";
 				echo "<input type='submit' name='Valider' value='"._T('bouton_valider')."' class='fondo verdana2'></div>\n";
@@ -478,22 +482,13 @@
       			echo "</script>";
 //map ?
 //				$laMap.='<area shape="'.wkt2shape($geometrie,"HTML").'" coords="'.wkt2coords($geometrie,"HTML",$callage,$url_carte).'" href="#objet'.$id_objet.'" alt="'.$titre_objet.'"/>';				
-				
 				if ($flag_mots!='non' AND $options == 'avancees') {
 					$tab_id['id_carte']=$id_carte;
 					$tab_id['id_objet']=$id_objet;
 					//TODO : passer les ,ouceau, cherche et supp que si bon mot
 					((!$nouveau) && ($visible)) ? formulaire_mots('carto_objets', $tab_id, $nouv_mot, $supp_mot, $cherche_mot, $flag_editable): formulaire_mots('carto_objets', $tab_id, null, null, null, $flag_editable);
 				}
-	
-				// Supprimer un objet
-				$link = $carte_link;
-				$link->addVar('supp_objet', $id_objet);
-				echo "<div style='float: left;'>";
-				icone_horizontale(_L("Supprimer cet objet"), $link->getUrl('objets'), "carte-24.gif", "supprimer.gif");
-				echo "</div>\n";
 				
-//				echo fin_block();
 				fin_cadre_relief();
 			}
 		}



From fxp at berlios.de  Mon Sep 26 07:52:33 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:52:33 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire cartes.php3,1.3,1.4 carte_import.php3,1.2,1.3
Message-ID: <200509260552.j8Q5qXmq010181@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv10166/ecrire

Modified Files:
	cartes.php3 carte_import.php3 
Log Message:
i18n / fr, en

Index: cartes.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/cartes.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- cartes.php3	18 Aug 2005 23:44:11 -0000	1.3
+++ cartes.php3	26 Sep 2005 05:52:30 -0000	1.4
@@ -5,12 +5,18 @@
 include_ecrire ("inc_carto.php3");
 include_ecrire ("inc_abstract_sql.php3");
 
+
 /***********************************************************************
 * PREFIXE
 ***********************************************************************/
 $table_pref = 'spip';
 if ($GLOBALS['table_prefix']) $table_pref = $GLOBALS['table_prefix'];
 
+	
+	
+	
+
+
 /***********************************************************************
  * installation
  * TODO ici on devrait avoir une abstraction et utilis? la table des 
@@ -82,7 +88,7 @@
 }
 
 
-debut_page(_L("Toutes les cartes"), "documents", "cartes");
+debut_page(_T("cartes_toutes"), "documents", "cartes");
 debut_gauche();
 
 
@@ -90,8 +96,7 @@
 debut_droite();
 
 
-
-afficher_cartes(_L("Toutes les cartes"),
+afficher_cartes(_T("cartes_toutes"),
 	"SELECT cartes.*, COUNT(id_carto_objet) AS objets ".
 	"FROM spip_carto_cartes AS cartes LEFT JOIN spip_carto_objets AS objets ".
 	"ON (cartes.id_carto_carte=objets.id_carto_carte) ".
@@ -110,7 +115,7 @@
 	$link = new Link('carte_edit.php3');
 	$link->addVar('new', 'oui');
 	$link->addVar('retour', $clean_link->getUrl());
-	icone(_L("Cr&eacute;er une nouvelle carte"), $link->getUrl(), "carte-24.gif", "creer.gif");
+	icone(_T("carte_creer"), $link->getUrl(), "carte-24.gif", "creer.gif");
 	echo "</div>";
 }
 

Index: carte_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_import.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carte_import.php3	7 Jul 2005 09:32:32 -0000	1.2
+++ carte_import.php3	26 Sep 2005 05:52:30 -0000	1.3
@@ -1,7 +1,4 @@
 <?php
-
-
-
 include ("inc.php3");
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_mots.php3");
@@ -71,7 +68,7 @@
 	// Ajout d'un objet
 	if ($selection_type) {
 		$geometrie=coords2wkt($selection_type,$selection_coords, worldfile2array($row['callage'])); // Si pas de fonction de zoom le callage correspond bien ? la valeur. Sinon avec zoom, il faut passer les coordonn?es g?ographiques de la vue en cours ....
-		$objet_titre = _L("Nouvel objet");
+		$objet_titre = _T("objet_nouvel");
 		$url_objet = "#";
 		//TODO : passer tout ca en spip_abstract ...
 		spip_query("INSERT INTO spip_carto_objets (id_carto_carte,titre,geometrie,url_objet) VALUES (".$id_carte.",'".addslashes($objet_titre)."','".$geometrie."','".$url_objet."')");
@@ -151,7 +148,7 @@
 							
 				
 					//	2.Analyse du fichier texte  
-					echo "<strong class='verdana2'>"._L("S?lectionner les champs du fichier texte ? importer dans les objets de votre carte.") . "</strong><br/>";
+					echo "<strong class='verdana2'>"._T("import_objet_sel_texte") . "</strong><br/>";
 					echo "<input type='hidden' name='step' value='3'>";
 					echo "<input type='hidden' name='file' value='".$file."'>";
 				
@@ -167,39 +164,39 @@
 					}
 					echo "<ul>";
 					// Cr?ation du formulaire d'importation
-					echo "<li>"._L("Titre de l'objet :")."<select name='col'>" .
-							"<option value='null'>Nouvel Objet</option>\n".
+					echo "<li>"._T("objet_titre")."<select name='col'>" .
+							"<option value='null'>"._T("objet_nouvel")."</option>\n".
 							$collist.
 							"</select>\n".
-							_L("('Nouvel Objet' par d?faut)")."</li>";
+							_T("objet_nouvel_default")."</li>";
 					
-					echo "<li>"._L("Texte :")."<select name='desc'>" .
+					echo "<li>"._T("info_texte")."<select name='desc'>" .
 							"<option value='null'>null</option>\n".
 							$collist.
 							"</select>\n".
 							_L("(null par d?faut)")."</li>";
 			
-					echo "<li>"._L("Lien de l'objet :").
+					echo "<li>"._T("objet_url").
 							"<br/><input id='link_prefix' name='link_prefix' value='' size='6'/>\n" .
 							"<select name='link'>" .
 							"<option value='null'>null</option>\n".
 							$collist.
 							"</select>\n".
 							"<input id='link_sufixe' name='link_sufixe' value='' size='3'/>\n" .
-							_L("(null par d?faut)")."</li>";
+							_T("objet_lien_default")."</li>";
 			
 			
-					echo "<li>"._L("Coordonn?es X :")."<select name='x'>" .
+					echo "<li>"._T("objet_x").":<select name='x'>" .
 							"<option value='0'>0</option>\n".
 							$collist.
 							"</select>\n".
-							_L("(0 par d?faut)")."</li>";
+							_T("objet_coord_default")."</li>";
 					
-					echo "<li>"._L("Coordonn?es Y :")."<select name='y'>" .
+					echo "<li>"._T("objet_y").":<select name='y'>" .
 							"<option value='0'>0</option>\n".
 							$collist.
 							"</select>\n".
-							_L("(0 par d?faut)")."</li>";
+							_T("objet_coord_default")."</li>";
 					echo "</ul>";
 					
 					echo "\n  <div align='".$GLOBALS['spip_lang_right']."'><input name='ok_ftp' type='Submit' value='"._T('bouton_suivant')."' class='fondo'></div>";
@@ -220,7 +217,7 @@
 					// TODO : Parse le fichier 
 					// TODO : Choix des attributs (Mapping GPX -> SPIP-CARTO-OBJET)
 							
-					echo "<strong class='verdana2'>"._L("S?lectionner les champs du fichier GPX ? importer dans les objets de votre carte.") . "</strong><br/>";
+					echo "<strong class='verdana2'>"._T("import_objet_sel_gpx") . "</strong><br/>";
 					echo "<input type='hidden' name='step' value='3'>";
 					echo "<input type='hidden' name='file' value='".$file."'>";
 
@@ -244,31 +241,7 @@
 					$collist .= "<option value='type'>type</option>";
 					
 					// Cr?ation du formulaire d'importation
-					echo "<ul>";
-					echo "<li>"._L("Titre de l'objet :")."<select name='col'>" .
-							"<option value='null'>Nouvel Objet</option>\n".
-							$collist.
-							"</select>\n".
-							_L("('Nouvel Objet' par d?faut)")."</li>";
-					
-					echo "<li>"._L("Texte :")."<select name='desc'>" .
-							"<option value='null'>null</option>\n".
-							$collist.
-							"</select>\n".
-							_L("(null par d?faut)")."</li>";
-			
-					echo "<li>"._L("Lien de l'objet :").
-							"<br/><input id='link_prefix' name='link_prefix' value='' size='6'/>\n" .
-							"<select name='link'>" .
-							"<option value='null'>null</option>\n".
-							$collist.
-							"</select>\n".
-							"<input id='link_sufixe' name='link_sufixe' value='' size='3'/>\n" .
-							_L("(null par d?faut)")."</li>";
-			
-
-					echo "\n  <div align='".$GLOBALS['spip_lang_right']."'><input name='ok_ftp' type='Submit' value='"._T('bouton_suivant')."' class='fondo'></div>";
-					echo "</form>";		
+							
 				}
 				
 			break;
@@ -281,7 +254,7 @@
 			{	case "TXT": 
 					// 	3.Importation du fichier texte en base
 					debut_cadre_relief("carte-24.gif");
-					echo "<strong class='verdana2'>"._L("Importation des objets.") . "</strong> ";
+					echo "<strong class='verdana2'>"._T("objet_import") . "</strong> ";
 				
 					$rec = new csvUtil($dir."/".$file, ";");		// Ouverture du fichier & lecture
 					$i = 1;
@@ -308,7 +281,7 @@
 							spip_query ($sql);
 							// TODO : Tous les cas d'erreur 
 					}		
-					echo "<br/><strong class='verdana2'>"._L("Nombre d'objets ajout?s ? votre carte : "). ($i-$nbErr). "</strong> ";
+					echo "<br/><strong class='verdana2'>"._T("objet_import_nombre"). ($i-$nbErr). "</strong> ";
 					fin_cadre_relief();	
 							
 				break;
@@ -335,7 +308,7 @@
 					"value=\"".$id_carte."\" size='40'>";
 			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 			echo bouton_block_visible("IMPORT-TXT");
-			echo "<strong>"._L("Import fichier texte (CSV)")."</strong>";
+			echo "<strong>"._T("import_texte")."</strong>";
 			echo "<br /></div>";
 			echo debut_block_visible("IMPORT-TXT");			
 			
@@ -355,7 +328,7 @@
 				echo "</div>\n";
 				echo "<input type='hidden' name='step' value='2'";
 			}else
-				echo "<strong class='verdana2'>"._L("Il n'y a pas de fichier dans le r?pertoire upload (Utilisez le FTP).") . "</strong> ";
+				echo "<strong class='verdana2'>"._T("import_no_fichier") . "</strong> ";
 				
 			echo fin_block();
 			fin_cadre_relief();	
@@ -375,7 +348,7 @@
 					"value=\"".$id_carte."\" size='40'>";
 			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 			echo bouton_block_invisible("IMPORT-GPS");
-			echo "<strong>"._L("Import fichier GPS (GPX)")."</strong>";
+			echo "<strong>"._T("import_gpx")."</strong>";
 			echo "<br /></div>";
 			echo debut_block_invisible("IMPORT-GPS");
 			echo "<strong class='verdana2'>"._L("S?lectionner un fichier") . "</strong> ";
@@ -395,7 +368,7 @@
 				echo "</div>\n";
 				echo "<input type='hidden' name='step' value='2'";
 			}else
-				echo "<strong class='verdana2'>"._L("Il n'y a pas de fichier dans le r?pertoire upload (Utilisez le FTP).") . "</strong> ";
+				echo "<strong class='verdana2'>"._T("import_no_fichier") . "</strong> ";
 				
 			
 			echo fin_block();



From fxp at berlios.de  Mon Sep 26 07:53:14 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:53:14 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_import.php3,1.1,1.2
Message-ID: <200509260553.j8Q5rEmq010212@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv10204/ecrire

Modified Files:
	inc_carto_import.php3 
Log Message:
i18n / fr, en

Index: inc_carto_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_import.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- inc_carto_import.php3	11 May 2005 10:08:39 -0000	1.1
+++ inc_carto_import.php3	26 Sep 2005 05:53:11 -0000	1.2
@@ -1,6 +1,4 @@
 <?php
-	
-//
 // Ce fichier ne sera execute qu'une fois
 if (defined("_ECRIRE_INC_CARTE_IMPORT")) return;
 define("_ECRIRE_INC_CARTE_IMPORT", "1");
@@ -11,7 +9,7 @@
 
 	echo "<div class='verdana2' align='justify'>".
 			"<img src='" . _DIR_IMG_PACK . "warning.gif' alt='' width='48' height='48' />".
-			"<p align='center'><B>"._L('Attention, les objets que vous allez associer ? la carte doivent ?tre dans la m?me projection !')."</B></p>";
+			"<p align='center'><B>"._T('import_warning')."</B></p>";
 	echo "</div>";
 
 	fin_boite_info();
@@ -22,7 +20,7 @@
 	
 //
 // Retourner le code HTML d'utilisation de fichiers uploades a la main
-//	Repris de inc_document avec ajout d'un filtre sur les extensions 
+// Repris de inc_document avec ajout d'un filtre sur les extensions 
 
 function texte_upload_file($dir, $inclus = '', $extw = '') {
 	$fichiers = fichiers_upload($dir);
@@ -56,13 +54,10 @@
 			if ($exts[$ext] == 'oui') $texte_upload .= "\n<option value=\"$f\">&nbsp; &nbsp; &nbsp; &nbsp; $lefichier</option>";
 		}
 	}
-
 	return $texte_upload;
 }	
 	
-	
-	
-	
+		
 class csvUtil {
     /*
      * Constructor
@@ -128,10 +123,4 @@
             return $retval;
     }
 }
-
-
-
-
-
-?>
-
+?>
\ No newline at end of file



From fxp at berlios.de  Mon Sep 26 07:55:29 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:55:29 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto.php3,1.18,1.19
Message-ID: <200509260555.j8Q5tTmq010922@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv10854/ecrire

Modified Files:
	inc_carto.php3 
Log Message:
i18n / fr, en

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.18
retrieving revision 1.19
diff -u -d -r1.18 -r1.19
--- inc_carto.php3	24 Sep 2005 00:52:52 -0000	1.18
+++ inc_carto.php3	26 Sep 2005 05:55:27 -0000	1.19
@@ -96,12 +96,12 @@
 			echo "</a><br/>";
 			
 			//articles li?s
-			afficher_articles(_L("Articles utilisant cette carte"),
+			afficher_articles(_T("carte_articles_use"),
 				", spip_carto_cartes_articles AS lien WHERE lien.id_article=articles.id_article ".
 				"AND id_carto_carte=$id_carte AND statut!='poubelle' ORDER BY titre");
 			
 			echo "</a><br/><td></tr>";
-				
+			
 		}
 		spip_free_result($result);
 		
@@ -178,6 +178,15 @@
     var circlecount= 0;
     var points= new Array();
     var pointcount= 0;
+    	
+    function dboxDrawObj (dhtmlBox){
+	  for (var i=0; i<polys.length; i++) dhtmlBox.drawPoly(polys[i],1);
+	  for (var i=0; i<rects.length; i++) dhtmlBox.drawRect(rects[i],1);
+	  for (var i=0; i<lines.length; i++) dhtmlBox.drawLine(lines[i],1);
+	  for (var i=0; i<circles.length; i++) dhtmlBox.drawCircle(circles[i],1);
+	  for (var i=0; i<points.length; i++) dhtmlBox.drawPoint(points[i],1);
+	}
+    
     function dboxInit()
     {
       myform = document.forms[\'carto_form\'];
@@ -206,11 +215,7 @@
   
           
       dhtmlBox.initialize();
-	  for (var i=0; i<polys.length; i++) dhtmlBox.drawPoly(polys[i],1);
-	  for (var i=0; i<rects.length; i++) dhtmlBox.drawRect(rects[i],1);
-	  for (var i=0; i<lines.length; i++) dhtmlBox.drawLine(lines[i],1);
-	  for (var i=0; i<circles.length; i++) dhtmlBox.drawCircle(circles[i],1);
-	  for (var i=0; i<points.length; i++) dhtmlBox.drawPoint(points[i],1);
+	  dboxDrawObj (dhtmlBox);
     }
 
     window.onload = function() {
@@ -227,7 +232,7 @@
      <table>
       <tr> 
        <td align="center" valign="middle" width="'.$width.'px" height="'.$height.'px">
-		<div id="loadbar">Loading message</div>
+		<div id="loadbar">'._T('carte_loading').'</div>
 	   </td>
       </tr>
      </table>
@@ -235,7 +240,7 @@
    </td>
   </tr>
   <tr>
-   <td> Dessiner un objet
+   <td> '._T("carte_draw").'
     <!--<input type="radio" name="tool" value="rectangle,submit,crossHair,zoom_in"  id="zoom_in" onclick="dhtmlBox.changeTool()" />
           zoom_in<br />-->
    </td>
@@ -253,13 +258,13 @@
    </td>
    <td>
     <input type="radio" name="tool" value="point,submit,crossHair,point"   id="point" onclick="dhtmlBox.changeTool()" />
-          Point<br />
+          '._T('carte_point').'<br />
    </td>
    <td>
     <input type="radio" name="tool" value="line,submit,crossHair,line"   id="line" onclick="dhtmlBox.changeTool()" />
-          Ligne<br />
+          '._T('carte_line').'<br />
    </td><td><input type="radio" name="tool" value="polygon,submit,crossHair,polygon"   checked="checked"  id="polygon" onclick="dhtmlBox.changeTool()" />
-          Polygone<br />
+          '._T('carte_polygon').'<br />
    </td>
   </tr>
  </table>
@@ -290,14 +295,12 @@
 	echo "<div style='padding: 2px; background-color: $couleur_claire; text-align: center; color: black;'>";
 	echo bouton_block_invisible("ajouter_carte");
 	echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-		._L("Ins&eacute;rer une carte")."</strong>";
+		._T("carte_insert")."</strong>";
 	echo "</div>\n";
 
 	echo debut_block_invisible("ajouter_carte");
 	echo "<div class='verdana2'>";
-	echo _L("Vous pouvez ins&eacute;rer des cartes dans vos articles. Choisissez une ".
-		"carte dans la liste ci-dessous et recopiez le raccourci dans le texte ".
-		"de l'article.");
+	echo _T("carte_insert_desc");
 	echo "</div>";
 
 	$query = "SELECT id_carto_carte, titre FROM spip_carto_cartes ORDER BY titre";
@@ -316,14 +319,15 @@
 			echo "<a href='".$link->getUrl()."'>";
 			echo $titre."</a>\n";
 			echo "<div class='arial1' align='$spip_lang_right' style='color: black; padding-$spip_lang_left: 4px;' ".
-				"title=\""._L("Recopiez ce raccourci dans le texte de l'article pour ins&eacute;rer ce formulaire.").
+				"title=\""._T("carte_raccourci").
 				"\">";
 			echo "<font color='333333'>";
-			echo "<div align='right'>Simple map : &lt;map$id_carte&gt;</div>";
-			echo "<div align='right'>Avec logo : &lt;map$id_carte|logo&gt;</div>";
-			echo "<div align='right'>Avec lien : &lt;map$id_carte|lien&gt;</div>";
-//			echo "<div align='right'>Avec logo survol : &lt;map$id_carte|logox&gt;</div>";
-//			echo "<div align='right'>Objet SVG : &lt;map$id_carte|svg&gt;</div>";
+			echo "<div align='right'>"._T("carte_simple")." &lt;map$id_carte&gt;</div>";
+			echo "<div align='right'>"._T("carte_logo")." &lt;map$id_carte|logo&gt;</div>";
+			echo "<div align='right'>"._T("carte_lien")." &lt;map$id_carte|lien&gt;</div>";
+			echo "<div align='right'>"._T("carte_svg")." &lt;map$id_carte|svg&gt;</div>";
+ 			echo "<div align='right'>"._T("carte_svgx")." &lt;map$id_carte|svgx&gt;</div>";
+			echo "<div align='right'>"._T("carte_svggeo")." &lt;map$id_carte|svggeo&gt;</div>";
 			echo "</font>\n";
 			echo "</div>";
 		}
@@ -336,7 +340,7 @@
 		echo "\n<br />";
 		$link = new Link("carte_edit.php3?new=oui");
 		$link->addVar('retour', $GLOBALS['clean_link']->getUrl());
-		icone_horizontale(_L("Cr&eacute;er une nouvelle carte"),
+		icone_horizontale(_T("carte_creer"),
 			$link->getUrl(), "carte-24.png", "creer.gif");
 	}
 
@@ -365,7 +369,7 @@
 
 	echo "<a name='srs'></a>";
 	
-	debut_cadre_enfonce("carte-24.gif", false, "", _L('Syst?me de coordonn?es'));
+	debut_cadre_enfonce("carte-24.gif", false, "", _T('carte_srs'));
 	
 	echo "<select name='id_srs' id='id_srs'>";
 	while ($row = spip_fetch_array($result)) {



From fxp at berlios.de  Mon Sep 26 07:59:05 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 07:59:05 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_lang.php3,1.10,1.11
Message-ID: <200509260559.j8Q5x5mq012486@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv12397/ecrire

Modified Files:
	inc_lang.php3 
Log Message:
i18n / fr, en

Index: inc_lang.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_lang.php3,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -d -r1.10 -r1.11
--- inc_lang.php3	7 Sep 2005 15:01:53 -0000	1.10
+++ inc_lang.php3	26 Sep 2005 05:59:02 -0000	1.11
@@ -126,7 +126,7 @@
 	if (_DIR_RESTREINT)
 		$modules = array('spip');
 	else
-		$modules = array('spip', 'ecrire');
+		$modules = array('spip', 'ecrire', 'spipcarto'); // MODIF SPIPCARTO : pour charger les fichiers de langues du module
 
 	// modules demandes explicitement
 	$code_ori = $code; # le garder pour le fallback plus tard



From fxp at berlios.de  Mon Sep 26 08:02:14 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 26 Sep 2005 08:02:14 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto.php3,1.19,1.20
Message-ID: <200509260602.j8Q62Emq013835@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv13806/ecrire

Modified Files:
	inc_carto.php3 
Log Message:
i18n / fr, en

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.19
retrieving revision 1.20
diff -u -d -r1.19 -r1.20
--- inc_carto.php3	26 Sep 2005 05:55:27 -0000	1.19
+++ inc_carto.php3	26 Sep 2005 06:02:06 -0000	1.20
@@ -93,14 +93,14 @@
 			echo "<a href=\"".$link->getUrl()."\">";
 			echo  "<img src='img_pack/$puce' width='7' height='7' border='0'>&nbsp;&nbsp;";
 			echo  typo($titre);
-			echo "</a><br/>";
+			echo "</a></td><td>";
 			
 			//articles li?s
 			afficher_articles(_T("carte_articles_use"),
 				", spip_carto_cartes_articles AS lien WHERE lien.id_article=articles.id_article ".
 				"AND id_carto_carte=$id_carte AND statut!='poubelle' ORDER BY titre");
 			
-			echo "</a><br/><td></tr>";
+			echo "</a></td></tr>";
 			
 		}
 		spip_free_result($result);



From stef at berlios.de  Mon Sep 26 11:24:28 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 26 Sep 2005 11:24:28 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire spip_style.php3,1.9,1.10
Message-ID: <200509260924.j8Q9OSmq010503@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv10441/ecrire

Modified Files:
	spip_style.php3 
Log Message:
commentaires mal fait => bug dans l'interface !
r?par?.

Index: spip_style.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/spip_style.php3,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -d -r1.9 -r1.10
--- spip_style.php3	24 Sep 2005 01:01:02 -0000	1.9
+++ spip_style.php3	26 Sep 2005 09:24:26 -0000	1.10
@@ -46,11 +46,11 @@
 
 	function http_img_pack($f) { return _DIR_IMG_PACK . $f; }
 ?>
-//////////////////////////////////////////
-//MODIFICATION SPIPCARTO
-//////////////////////////////////////////
- at import "dhtml_tools.css";
-//////////////////////////////////////////
+/*////////////////////////////////////////*/
+/*/MODIFICATION SPIPCARTO*/
+/*////////////////////////////////////////*/
+ at import "dhtml_tools.css";*/
+/*////////////////////////////////////////*/
 
 /*
  * Police par defaut (bof...)
@@ -869,11 +869,11 @@
 	font-family: verdana, arial, helvetica, sans;
 	font-size: 12px;
 	padding: 6px;
-//////////////////////////////////////////
-//MODIFICATION SPIPCARTO
-//////////////////////////////////////////
+/*////////////////////////////////////////*/
+/*/MODIFICATION SPIPCARTO*/
+/*////////////////////////////////////////*/
 /*	position: relative;*/
-//////////////////////////////////////////
+/*////////////////////////////////////////*/
 }
 
 .cadre-titre {



From stef at berlios.de  Mon Sep 26 12:16:11 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 26 Sep 2005 12:16:11 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_lang.php3,1.11,1.12
Message-ID: <200509261016.j8QAGBmq019423@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv19399/ecrire

Modified Files:
	inc_lang.php3 
Log Message:
modif pas necessaire,les modules sont pris en charge

Index: inc_lang.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_lang.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- inc_lang.php3	26 Sep 2005 05:59:02 -0000	1.11
+++ inc_lang.php3	26 Sep 2005 10:16:09 -0000	1.12
@@ -126,7 +126,7 @@
 	if (_DIR_RESTREINT)
 		$modules = array('spip');
 	else
-		$modules = array('spip', 'ecrire', 'spipcarto'); // MODIF SPIPCARTO : pour charger les fichiers de langues du module
+		$modules = array('spip', 'ecrire');
 
 	// modules demandes explicitement
 	$code_ori = $code; # le garder pour le fallback plus tard



From stef at berlios.de  Mon Sep 26 12:17:05 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 26 Sep 2005 12:17:05 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_import.php3,1.3,1.4 inc_carto_import.php3,1.2,1.3 cartes.php3,1.4,1.5 carte_edit.php3,1.17,1.18 inc_carto.php3,1.20,1.21
Message-ID: <200509261017.j8QAH5mq019468@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv19444/ecrire

Modified Files:
	carte_import.php3 inc_carto_import.php3 cartes.php3 
	carte_edit.php3 inc_carto.php3 
Log Message:
appel des chaines par _T("spipcarto:machaine pour utiliser le module

Index: carte_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_import.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carte_import.php3	26 Sep 2005 05:52:30 -0000	1.3
+++ carte_import.php3	26 Sep 2005 10:17:03 -0000	1.4
@@ -68,7 +68,7 @@
 	// Ajout d'un objet
 	if ($selection_type) {
 		$geometrie=coords2wkt($selection_type,$selection_coords, worldfile2array($row['callage'])); // Si pas de fonction de zoom le callage correspond bien ? la valeur. Sinon avec zoom, il faut passer les coordonn?es g?ographiques de la vue en cours ....
-		$objet_titre = _T("objet_nouvel");
+		$objet_titre = _T("spipcarto:objet_nouvel");
 		$url_objet = "#";
 		//TODO : passer tout ca en spip_abstract ...
 		spip_query("INSERT INTO spip_carto_objets (id_carto_carte,titre,geometrie,url_objet) VALUES (".$id_carte.",'".addslashes($objet_titre)."','".$geometrie."','".$url_objet."')");
@@ -148,7 +148,7 @@
 							
 				
 					//	2.Analyse du fichier texte  
-					echo "<strong class='verdana2'>"._T("import_objet_sel_texte") . "</strong><br/>";
+					echo "<strong class='verdana2'>"._T("spipcarto:import_objet_sel_texte") . "</strong><br/>";
 					echo "<input type='hidden' name='step' value='3'>";
 					echo "<input type='hidden' name='file' value='".$file."'>";
 				
@@ -164,11 +164,11 @@
 					}
 					echo "<ul>";
 					// Cr?ation du formulaire d'importation
-					echo "<li>"._T("objet_titre")."<select name='col'>" .
-							"<option value='null'>"._T("objet_nouvel")."</option>\n".
+					echo "<li>"._T("spipcarto:objet_titre")."<select name='col'>" .
+							"<option value='null'>"._T("spipcarto:objet_nouvel")."</option>\n".
 							$collist.
 							"</select>\n".
-							_T("objet_nouvel_default")."</li>";
+							_T("spipcarto:objet_nouvel_default")."</li>";
 					
 					echo "<li>"._T("info_texte")."<select name='desc'>" .
 							"<option value='null'>null</option>\n".
@@ -176,27 +176,27 @@
 							"</select>\n".
 							_L("(null par d?faut)")."</li>";
 			
-					echo "<li>"._T("objet_url").
+					echo "<li>"._T("spipcarto:objet_url").
 							"<br/><input id='link_prefix' name='link_prefix' value='' size='6'/>\n" .
 							"<select name='link'>" .
 							"<option value='null'>null</option>\n".
 							$collist.
 							"</select>\n".
 							"<input id='link_sufixe' name='link_sufixe' value='' size='3'/>\n" .
-							_T("objet_lien_default")."</li>";
+							_T("spipcarto:objet_lien_default")."</li>";
 			
 			
-					echo "<li>"._T("objet_x").":<select name='x'>" .
+					echo "<li>"._T("spipcarto:objet_x").":<select name='x'>" .
 							"<option value='0'>0</option>\n".
 							$collist.
 							"</select>\n".
-							_T("objet_coord_default")."</li>";
+							_T("spipcarto:objet_coord_default")."</li>";
 					
-					echo "<li>"._T("objet_y").":<select name='y'>" .
+					echo "<li>"._T("spipcarto:objet_y").":<select name='y'>" .
 							"<option value='0'>0</option>\n".
 							$collist.
 							"</select>\n".
-							_T("objet_coord_default")."</li>";
+							_T("spipcarto:objet_coord_default")."</li>";
 					echo "</ul>";
 					
 					echo "\n  <div align='".$GLOBALS['spip_lang_right']."'><input name='ok_ftp' type='Submit' value='"._T('bouton_suivant')."' class='fondo'></div>";
@@ -217,7 +217,7 @@
 					// TODO : Parse le fichier 
 					// TODO : Choix des attributs (Mapping GPX -> SPIP-CARTO-OBJET)
 							
-					echo "<strong class='verdana2'>"._T("import_objet_sel_gpx") . "</strong><br/>";
+					echo "<strong class='verdana2'>"._T("spipcarto:import_objet_sel_gpx") . "</strong><br/>";
 					echo "<input type='hidden' name='step' value='3'>";
 					echo "<input type='hidden' name='file' value='".$file."'>";
 
@@ -254,7 +254,7 @@
 			{	case "TXT": 
 					// 	3.Importation du fichier texte en base
 					debut_cadre_relief("carte-24.gif");
-					echo "<strong class='verdana2'>"._T("objet_import") . "</strong> ";
+					echo "<strong class='verdana2'>"._T("spipcarto:objet_import") . "</strong> ";
 				
 					$rec = new csvUtil($dir."/".$file, ";");		// Ouverture du fichier & lecture
 					$i = 1;
@@ -281,7 +281,7 @@
 							spip_query ($sql);
 							// TODO : Tous les cas d'erreur 
 					}		
-					echo "<br/><strong class='verdana2'>"._T("objet_import_nombre"). ($i-$nbErr). "</strong> ";
+					echo "<br/><strong class='verdana2'>"._T("spipcarto:objet_import_nombre"). ($i-$nbErr). "</strong> ";
 					fin_cadre_relief();	
 							
 				break;
@@ -308,7 +308,7 @@
 					"value=\"".$id_carte."\" size='40'>";
 			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 			echo bouton_block_visible("IMPORT-TXT");
-			echo "<strong>"._T("import_texte")."</strong>";
+			echo "<strong>"._T("spipcarto:import_texte")."</strong>";
 			echo "<br /></div>";
 			echo debut_block_visible("IMPORT-TXT");			
 			
@@ -328,7 +328,7 @@
 				echo "</div>\n";
 				echo "<input type='hidden' name='step' value='2'";
 			}else
-				echo "<strong class='verdana2'>"._T("import_no_fichier") . "</strong> ";
+				echo "<strong class='verdana2'>"._T("spipcarto:import_no_fichier") . "</strong> ";
 				
 			echo fin_block();
 			fin_cadre_relief();	
@@ -348,7 +348,7 @@
 					"value=\"".$id_carte."\" size='40'>";
 			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 			echo bouton_block_invisible("IMPORT-GPS");
-			echo "<strong>"._T("import_gpx")."</strong>";
+			echo "<strong>"._T("spipcarto:import_gpx")."</strong>";
 			echo "<br /></div>";
 			echo debut_block_invisible("IMPORT-GPS");
 			echo "<strong class='verdana2'>"._L("S?lectionner un fichier") . "</strong> ";
@@ -368,7 +368,7 @@
 				echo "</div>\n";
 				echo "<input type='hidden' name='step' value='2'";
 			}else
-				echo "<strong class='verdana2'>"._T("import_no_fichier") . "</strong> ";
+				echo "<strong class='verdana2'>"._T("spipcarto:import_no_fichier") . "</strong> ";
 				
 			
 			echo fin_block();

Index: inc_carto_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_import.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- inc_carto_import.php3	26 Sep 2005 05:53:11 -0000	1.2
+++ inc_carto_import.php3	26 Sep 2005 10:17:03 -0000	1.3
@@ -9,7 +9,7 @@
 
 	echo "<div class='verdana2' align='justify'>".
 			"<img src='" . _DIR_IMG_PACK . "warning.gif' alt='' width='48' height='48' />".
-			"<p align='center'><B>"._T('import_warning')."</B></p>";
+			"<p align='center'><B>"._T('spipcarto:import_warning')."</B></p>";
 	echo "</div>";
 
 	fin_boite_info();

Index: cartes.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/cartes.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- cartes.php3	26 Sep 2005 05:52:30 -0000	1.4
+++ cartes.php3	26 Sep 2005 10:17:03 -0000	1.5
@@ -88,7 +88,7 @@
 }
 
 
-debut_page(_T("cartes_toutes"), "documents", "cartes");
+debut_page(_T("spipcarto:cartes_toutes"), "documents", "cartes");
 debut_gauche();
 
 
@@ -96,7 +96,7 @@
 debut_droite();
 
 
-afficher_cartes(_T("cartes_toutes"),
+afficher_cartes(_T("spipcarto:cartes_toutes"),
 	"SELECT cartes.*, COUNT(id_carto_objet) AS objets ".
 	"FROM spip_carto_cartes AS cartes LEFT JOIN spip_carto_objets AS objets ".
 	"ON (cartes.id_carto_carte=objets.id_carto_carte) ".
@@ -115,7 +115,7 @@
 	$link = new Link('carte_edit.php3');
 	$link->addVar('new', 'oui');
 	$link->addVar('retour', $clean_link->getUrl());
-	icone(_T("carte_creer"), $link->getUrl(), "carte-24.gif", "creer.gif");
+	icone(_T("spipcarto:carte_creer"), $link->getUrl(), "carte-24.gif", "creer.gif");
 	echo "</div>";
 }
 

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.17
retrieving revision 1.18
diff -u -d -r1.17 -r1.18
--- carte_edit.php3	26 Sep 2005 05:51:22 -0000	1.17
+++ carte_edit.php3	26 Sep 2005 10:17:03 -0000	1.18
@@ -28,7 +28,7 @@
 
 if ($flag_editable) {
 	if ($new == 'oui') {
-		$titre = _T("carte_nouvelle");
+		$titre = _T("spipcarto:carte_nouvelle");
 		$url_carte = "";
 		$texte = "";
 		$callage = "";
@@ -101,7 +101,7 @@
 	// Ajout d'un objet
 	if ($selection_type) {
 		$geometrie=coords2wkt($selection_type,$selection_coords, worldfile2array($row['callage']), $url_carte); // Si pas de fonction de zoom le callage correspond bien ? la valeur. Sinon avec zoom, il faut passer les coordonn?es g?ographiques de la vue en cours ....
-		$objet_titre = _T("objet_nouvel");
+		$objet_titre = _T("spipcarto:objet_nouvel");
 		$url_objet = "#";
 		//TODO : passer tout ca en spip_abstract ...
 		spip_query("INSERT INTO spip_carto_objets (id_carto_carte,titre,geometrie,url_objet) VALUES (".$id_carte.",'".addslashes($objet_titre)."','".$geometrie."','".$url_objet."')");
@@ -155,16 +155,16 @@
 
 echo "<div align='center'>\n";
 
-echo "<font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('carte_numero')."</b></font>\n";
+echo "<font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('spipcarto:carte_numero')."</b></font>\n";
 echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='6'><b>$id_carte</b></font>\n";
 if ($url_carte && ($new!="oui")) {
-	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('carte_apercu')."</b></font>\n";
-	icone_horizontale( _T('carte_img'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('carte_lien'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('carte_logo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('carte_svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('carte_svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('carte_svggeo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('spipcarto:carte_apercu')."</b></font>\n";
+	icone_horizontale( _T('spipcarto:carte_img'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('spipcarto:carte_lien'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('spipcarto:carte_logo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('spipcarto:carte_svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('spipcarto:carte_svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	icone_horizontale( _T('spipcarto:carte_svggeo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
 }
 echo "</div>\n";
 
@@ -182,8 +182,8 @@
 debut_droite();
 
 if ($supp_carte && !$supp_confirme && !$supp_rejet) {
-	echo "<p><strong>"._T("carte_warning")."</strong> ";
-	echo _T("carte_supp_confirm")."</p>\n";
+	echo "<p><strong>"._T("spipcarto:carte_warning")."</strong> ";
+	echo _T("spipcarto:carte_supp_confirm")."</p>\n";
 	$link = $carte_supplink;//new Link();
 	//$link->addVar('supp_carte', $supp_carte);
 	echo $link->getform('GET');
@@ -214,7 +214,7 @@
 		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 		echo bouton_block_visible("dhtml_carte");
 		echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-			._T("objet_add")."</strong>";
+			._T("spipcarto:objet_add")."</strong>";
 		echo "</div>\n";
 		
 		echo debut_block_visible("dhtml_carte");
@@ -238,7 +238,7 @@
 	}
 	
 	//articles li?s
-	afficher_articles(_T("carte_articles_use"),
+	afficher_articles(_T("spipcarto:carte_articles_use"),
 		", spip_carto_cartes_articles AS lien WHERE lien.id_article=articles.id_article ".
 		"AND id_carto_carte=$id_carte AND statut!='poubelle' ORDER BY titre");
 	
@@ -267,7 +267,7 @@
 	//if (!$nb_reponses) {
 	//	$link->addVar('supp_confirme', 'oui');
 	//}
-	icone(_T("carte_supp"), $link->getUrl(), "carte-24.gif", "supprimer.gif");
+	icone(_T("spipcarto:carte_supp"), $link->getUrl(), "carte-24.gif", "supprimer.gif");
 	echo "</div>\n";
 }
 
@@ -284,7 +284,7 @@
 	$link->addVar('modif_carte', $id_carte);
 	echo $link->getForm('GET');
 	
-	echo "<strong><label for='titre_carte'>"._T("carte_titre")."</label></strong> "._T('info_obligatoire_02');
+	echo "<strong><label for='titre_carte'>"._T("spipcarto:carte_titre")."</label></strong> "._T('info_obligatoire_02');
 	echo "<br />";
 	echo "<input type='text' name='titre' id='titre_carte' CLASS='formo' ".
 		"value=\"".$titre."\" size='40'$js_titre><br />\n";
@@ -309,12 +309,12 @@
 			"value=\"".$id_srs."\" size='40'>";*/
 	}
 	else {
-		echo "<strong><label for='url_carte_carte'>"._T("carte_fond")."</label></strong> "._T('info_obligatoire_02'). "<br />"._T("carte_fond_numero");
+		echo "<strong><label for='url_carte_carte'>"._T("spipcarto:carte_fond")."</label></strong> "._T('info_obligatoire_02'). "<br />"._T("spipcarto:carte_fond_numero");
 		echo "<br />";
 		echo "<input type='text' name='url_carte' id='url_carte_carte' CLASS='formo' ".
 			"value=\"".$url_carte."\" size='40'><br />\n";
 		
-		echo "<strong><label for='callage_carte'>"._T("carte_callage")."</label></strong>";
+		echo "<strong><label for='callage_carte'>"._T("spipcarto:carte_callage")."</label></strong>";
 		echo "<br />";
 		echo "<textarea name='callage' id='callage_carte' CLASS='forml' rows='4' cols='40' wrap='soft'>";
 		echo $callage;
@@ -322,7 +322,7 @@
 
 
 		afficher_srs ($id_srs);
-		/*echo "<strong><label for='srs_carte'>"._T("carte_srs")."</label></strong> "._T('info_obligatoire_02');
+		/*echo "<strong><label for='srs_carte'>"._T("spipcarto:carte_srs")."</label></strong> "._T('info_obligatoire_02');
 		echo "<br />";
 		echo "<input type='text' name='id_srs' id='srs_carte' CLASS='formo' ".
 			"value=\"".$id_srs."\" size='40'><br />\n";*/
@@ -341,14 +341,14 @@
 		echo "<a name='objets'></a>";
 		echo "<p><hr><p>\n";
 		echo "<div class='verdana3'>";
-		echo "<strong>"._T("carte_objets")."</strong><br />\n";
-		echo _T("carte_import");
+		echo "<strong>"._T("spipcarto:carte_objets")."</strong><br />\n";
+		echo _T("spipcarto:carte_import");
 		echo "</div>\n";
 
 		echo "<br />\n";
 		echo "<div align='$spip_lang_right'>";
 		// Icone importer des objets
-		icone(_T("carte_import_objet"), $carte_importlink->getURL(), "carte-24.gif", "creer.gif");
+		icone(_T("spipcarto:carte_import_objet"), $carte_importlink->getURL(), "carte-24.gif", "creer.gif");
 		echo "</div>\n";
 	}
 
@@ -360,7 +360,7 @@
 		echo "<div align='$spip_lang_right'>";
 		$carte_suppallobjlink = $carte_link;
 		$carte_suppallobjlink->addVar('supp_objet_all', 'ok');
-		icone(_T("carte_supp_objets"), $carte_suppallobjlink->getURL(), "carte-24.gif", "supprimer.gif");
+		icone(_T("spipcarto:carte_supp_objets"), $carte_suppallobjlink->getURL(), "carte-24.gif", "supprimer.gif");
 		echo "</div>\n";
 		
 //map ?
@@ -394,7 +394,7 @@
 					$link = $carte_link;
 					$link->addVar('supp_objet', $id_objet);
 					echo "<br/><div style='float:right;'>";
-					icone_horizontale(_T("objet_supp"), $link->getUrl('objets'), "carte-24.gif", "supprimer.gif");
+					icone_horizontale(_T("spipcarto:objet_supp"), $link->getUrl('objets'), "carte-24.gif", "supprimer.gif");
 					echo "</div>\n";
 					echo "</td></tr>";					
 					echo "<tr><td>";
@@ -403,7 +403,7 @@
 						$js = " onfocus=\"if(!antifocus_champ){this.value='';antifocus_champ=true;}\"";
 					}
 					else $js = "";
-					echo "<strong><label for='titre_$id_objet'>"._T("objet_titre")."</label></strong> :";
+					echo "<strong><label for='titre_$id_objet'>"._T("spipcarto:objet_titre")."</label></strong> :";
 					echo "<br />";
 					echo "<input type='text' name='objet_titre' id='titre_$id_objet' value=\"".
 						$titre_objet."\" class='fondo verdana2' size='30'$js><br />\n";
@@ -416,17 +416,17 @@
 					echo "</textarea><br />\n";
 		
 					echo "</td><td width='20px'></td><td>";					
-					echo "<strong><label for='lien_$id_objet'>"._T("objet_lien")."</label></strong> :";
+					echo "<strong><label for='lien_$id_objet'>"._T("spipcarto:objet_lien")."</label></strong> :";
 					echo "<br />";
 					echo "<input type='text' name='url_objet' id='lien_$id_objet' value=\"".
 						$lien_objet."\" class='fondo verdana2' size='30'$><br />\n";
 		
-					echo "<strong><label for='logo_$id_objet'>"._T("objet_logo")."</label></strong> :";
+					echo "<strong><label for='logo_$id_objet'>"._T("spipcarto:objet_logo")."</label></strong> :";
 					echo "<br />";
 					echo "<input type='text' name='url_logo' id='logo_$id_objet' value=\"".
 						$url_logo."\" class='fondo verdana2' size='30'$><br />\n";
 		
-					echo "<strong><label for='geo_$id_objet'>"._T('objet_geom')."</label></strong><br/>";
+					echo "<strong><label for='geo_$id_objet'>"._T('spipcarto:objet_geom')."</label></strong><br/>";
 					echo "<input type='text' name='geometrie' id='geo_$id_objet' class='fondo verdana2' size='30' value='";
 					echo $geometrie."'/><br/>\n";
 					echo "</td></tr>";

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.20
retrieving revision 1.21
diff -u -d -r1.20 -r1.21
--- inc_carto.php3	26 Sep 2005 06:02:06 -0000	1.20
+++ inc_carto.php3	26 Sep 2005 10:17:03 -0000	1.21
@@ -96,7 +96,7 @@
 			echo "</a></td><td>";
 			
 			//articles li?s
-			afficher_articles(_T("carte_articles_use"),
+			afficher_articles(_T("spipcarto:carte_articles_use"),
 				", spip_carto_cartes_articles AS lien WHERE lien.id_article=articles.id_article ".
 				"AND id_carto_carte=$id_carte AND statut!='poubelle' ORDER BY titre");
 			
@@ -232,7 +232,7 @@
      <table>
       <tr> 
        <td align="center" valign="middle" width="'.$width.'px" height="'.$height.'px">
-		<div id="loadbar">'._T('carte_loading').'</div>
+		<div id="loadbar">'._T('spipcarto:carte_loading').'</div>
 	   </td>
       </tr>
      </table>
@@ -240,7 +240,7 @@
    </td>
   </tr>
   <tr>
-   <td> '._T("carte_draw").'
+   <td> '._T("spipcarto:carte_draw").'
     <!--<input type="radio" name="tool" value="rectangle,submit,crossHair,zoom_in"  id="zoom_in" onclick="dhtmlBox.changeTool()" />
           zoom_in<br />-->
    </td>
@@ -258,13 +258,13 @@
    </td>
    <td>
     <input type="radio" name="tool" value="point,submit,crossHair,point"   id="point" onclick="dhtmlBox.changeTool()" />
-          '._T('carte_point').'<br />
+          '._T('spipcarto:carte_point').'<br />
    </td>
    <td>
     <input type="radio" name="tool" value="line,submit,crossHair,line"   id="line" onclick="dhtmlBox.changeTool()" />
-          '._T('carte_line').'<br />
+          '._T('spipcarto:carte_line').'<br />
    </td><td><input type="radio" name="tool" value="polygon,submit,crossHair,polygon"   checked="checked"  id="polygon" onclick="dhtmlBox.changeTool()" />
-          '._T('carte_polygon').'<br />
+          '._T('spipcarto:carte_polygon').'<br />
    </td>
   </tr>
  </table>
@@ -295,12 +295,12 @@
 	echo "<div style='padding: 2px; background-color: $couleur_claire; text-align: center; color: black;'>";
 	echo bouton_block_invisible("ajouter_carte");
 	echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-		._T("carte_insert")."</strong>";
+		._T("spipcarto:carte_insert")."</strong>";
 	echo "</div>\n";
 
 	echo debut_block_invisible("ajouter_carte");
 	echo "<div class='verdana2'>";
-	echo _T("carte_insert_desc");
+	echo _T("spipcarto:carte_insert_desc");
 	echo "</div>";
 
 	$query = "SELECT id_carto_carte, titre FROM spip_carto_cartes ORDER BY titre";
@@ -319,15 +319,15 @@
 			echo "<a href='".$link->getUrl()."'>";
 			echo $titre."</a>\n";
 			echo "<div class='arial1' align='$spip_lang_right' style='color: black; padding-$spip_lang_left: 4px;' ".
-				"title=\""._T("carte_raccourci").
+				"title=\""._T("spipcarto:carte_raccourci").
 				"\">";
 			echo "<font color='333333'>";
-			echo "<div align='right'>"._T("carte_simple")." &lt;map$id_carte&gt;</div>";
-			echo "<div align='right'>"._T("carte_logo")." &lt;map$id_carte|logo&gt;</div>";
-			echo "<div align='right'>"._T("carte_lien")." &lt;map$id_carte|lien&gt;</div>";
-			echo "<div align='right'>"._T("carte_svg")." &lt;map$id_carte|svg&gt;</div>";
- 			echo "<div align='right'>"._T("carte_svgx")." &lt;map$id_carte|svgx&gt;</div>";
-			echo "<div align='right'>"._T("carte_svggeo")." &lt;map$id_carte|svggeo&gt;</div>";
+			echo "<div align='right'>"._T("spipcarto:carte_simple")." &lt;map$id_carte&gt;</div>";
+			echo "<div align='right'>"._T("spipcarto:carte_logo")." &lt;map$id_carte|logo&gt;</div>";
+			echo "<div align='right'>"._T("spipcarto:carte_lien")." &lt;map$id_carte|lien&gt;</div>";
+			echo "<div align='right'>"._T("spipcarto:carte_svg")." &lt;map$id_carte|svg&gt;</div>";
+ 			echo "<div align='right'>"._T("spipcarto:carte_svgx")." &lt;map$id_carte|svgx&gt;</div>";
+			echo "<div align='right'>"._T("spipcarto:carte_svggeo")." &lt;map$id_carte|svggeo&gt;</div>";
 			echo "</font>\n";
 			echo "</div>";
 		}
@@ -340,7 +340,7 @@
 		echo "\n<br />";
 		$link = new Link("carte_edit.php3?new=oui");
 		$link->addVar('retour', $GLOBALS['clean_link']->getUrl());
-		icone_horizontale(_T("carte_creer"),
+		icone_horizontale(_T("spipcarto:carte_creer"),
 			$link->getUrl(), "carte-24.png", "creer.gif");
 	}
 
@@ -369,7 +369,7 @@
 
 	echo "<a name='srs'></a>";
 	
-	debut_cadre_enfonce("carte-24.gif", false, "", _T('carte_srs'));
+	debut_cadre_enfonce("carte-24.gif", false, "", _T('spipcarto:carte_srs'));
 	
 	echo "<select name='id_srs' id='id_srs'>";
 	while ($row = spip_fetch_array($result)) {



From mose at berlios.de  Tue Sep 27 02:28:00 2005
From: mose at berlios.de (mose at berlios.de)
Date: Tue, 27 Sep 2005 02:28:00 +0200
Subject: [Spip-carto-cvs] CVSROOT modules,1.6,1.7
Message-ID: <200509270028.j8R0S0mq018002@sheep.berlios.de>

Update of /cvsroot/spip-carto/CVSROOT
In directory sheep:/tmp/cvs-serv17893

Modified Files:
	modules 
Log Message:
ajout du module contrib

Index: modules
===================================================================
RCS file: /cvsroot/spip-carto/CVSROOT/modules,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- modules	8 Feb 2005 15:38:28 -0000	1.6
+++ modules	27 Sep 2005 00:27:56 -0000	1.7
@@ -28,3 +28,4 @@
 spipcarto  spipcarto
 spip-carto spipcarto
 
+contrib contrib



From stef at berlios.de  Tue Sep 27 22:08:03 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:08:03 +0200
Subject: [Spip-carto-cvs] spipcarto downloadfile.class.php,1.2,NONE
Message-ID: <200509272008.j8RK83mq010818@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv10794

Removed Files:
      Tag: START-BRANCH-V1
	downloadfile.class.php 
Log Message:
inutile

--- downloadfile.class.php DELETED ---



From stef at berlios.de  Tue Sep 27 22:11:16 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:11:16 +0200
Subject: [Spip-carto-cvs] spipcarto mes_fonctions.php3,1.12,1.13
Message-ID: <200509272011.j8RKBGmq011326@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv11302

Modified Files:
	mes_fonctions.php3 
Log Message:
inclusion inc_carto plus utile
url marche partout (filtre appliqu? systematiquement)

Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.12
retrieving revision 1.13
diff -u -d -r1.12 -r1.13
--- mes_fonctions.php3	18 Aug 2005 06:31:20 -0000	1.12
+++ mes_fonctions.php3	27 Sep 2005 20:11:14 -0000	1.13
@@ -1,5 +1,9 @@
 <?php
-include "ecrire/inc_carto.php3";
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+//			MODULE SPIPCARTO
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
 
 function ajoute($txt,$offset=1){
 	global $mini_compteur;
@@ -18,21 +22,13 @@
 	return $offset+$compteur*20;
 }
 
-//
-// R??criture des liens des objets spip-carto 
-// si il y a utilisation des raccourcis SPIP 
-// du type imgXX, docXX, artXX, rubXX, ...
-//	
-// TODO : Ne fonctionne pas avec mapXX
-//
 function url ($url){
 	list(,$url) = extraire_lien(array('','','',$url));
 	return $url;
 }
-
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
-//			FIN MODULE CARTO
+//			FIN MODULE SPIPCARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 ?>



From stef at berlios.de  Tue Sep 27 22:13:21 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:13:21 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire http.class.php,1.3,NONE
Message-ID: <200509272013.j8RKDLmq011610@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv11563/ecrire

Removed Files:
      Tag: START-BRANCH-V1
	http.class.php 
Log Message:
inutile

--- http.class.php DELETED ---



From stef at berlios.de  Tue Sep 27 22:16:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:16:47 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_google.html,1.3,NONE carto_test.html,1.2,NONE carto_logox.html,1.2,NONE carto_dessin0.html,1.2,NONE
Message-ID: <200509272016.j8RKGlmq012109@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv12076/squelettes/template

Removed Files:
      Tag: START-BRANCH-V1
	carto_google.html carto_test.html carto_logox.html 
	carto_dessin0.html 
Log Message:
Hors perimetre v1

--- carto_google.html DELETED ---

--- carto_test.html DELETED ---

--- carto_logox.html DELETED ---

--- carto_dessin0.html DELETED ---



From stef at berlios.de  Tue Sep 27 22:16:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:16:47 +0200
Subject: [Spip-carto-cvs] spipcarto/js Copie de navTools.js,1.1,NONE navTools.bak.js,1.1,NONE x_core_nn4.js,1.1,NONE navTools.js,1.1,NONE tree.js,1.1,NONE x_dom_nn4.js,1.1,NONE carto.js,1.1,NONE x_event_nn4.js,1.1,NONE graphTools.js,1.1,NONE
Message-ID: <200509272016.j8RKGlmq012118@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/js
In directory sheep:/tmp/cvs-serv12076/js

Removed Files:
      Tag: START-BRANCH-V1
	Copie de navTools.js navTools.bak.js x_core_nn4.js navTools.js 
	tree.js x_dom_nn4.js carto.js x_event_nn4.js graphTools.js 
Log Message:
Hors perimetre v1

--- Copie de navTools.js DELETED ---

--- navTools.bak.js DELETED ---

--- x_core_nn4.js DELETED ---

--- navTools.js DELETED ---

--- tree.js DELETED ---

--- x_dom_nn4.js DELETED ---

--- carto.js DELETED ---

--- x_event_nn4.js DELETED ---

--- graphTools.js DELETED ---



From stef at berlios.de  Tue Sep 27 22:16:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:16:47 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto_distant.php,1.1,NONE plug_carto_free.php,1.1,NONE
Message-ID: <200509272016.j8RKGlmq012115@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv12076/ecrire/plugins

Removed Files:
      Tag: START-BRANCH-V1
	plug_carto_distant.php plug_carto_free.php 
Log Message:
Hors perimetre v1

--- plug_carto_distant.php DELETED ---

--- plug_carto_free.php DELETED ---



From stef at berlios.de  Tue Sep 27 22:16:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:16:47 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes carto_geosvgwmsfile.html,1.2,NONE formulaire_carte.html,1.1,NONE article.html,1.1,NONE inc-formulaire_carte.php3,1.2,NONE carto_geosvgwms.html,1.1,NONE
Message-ID: <200509272016.j8RKGlmq012112@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv12076/squelettes

Removed Files:
      Tag: START-BRANCH-V1
	carto_geosvgwmsfile.html formulaire_carte.html article.html 
	inc-formulaire_carte.php3 carto_geosvgwms.html 
Log Message:
Hors perimetre v1

--- carto_geosvgwmsfile.html DELETED ---

--- formulaire_carte.html DELETED ---

--- article.html DELETED ---

--- inc-formulaire_carte.php3 DELETED ---

--- carto_geosvgwms.html DELETED ---



From mose at mose.fr  Tue Sep 27 22:40:28 2005
From: mose at mose.fr (mose)
Date: Tue, 27 Sep 2005 22:40:28 +0200
Subject: [Spip-carto-cvs] spipcarto downloadfile.class.php,1.2,NONE
In-Reply-To: <200509272008.j8RK83mq010818@sheep.berlios.de>
References: <200509272008.j8RK83mq010818@sheep.berlios.de>
Message-ID: <20050927204028.GD3466@mose.fr>

le Tue, Sep 27, 2005 at 10:08:03PM +0200 par stef at berlios.de :
> Update of /cvsroot/spip-carto/spipcarto
> In directory sheep:/tmp/cvs-serv10794
> 
> Removed Files:
>       Tag: START-BRANCH-V1

- heu ca devrait etre BRANCH-V1 ici, pas START-BRANCH-V1, non ?



> 	downloadfile.class.php 
> Log Message:
> inutile
> 
> --- downloadfile.class.php DELETED ---
> 
> _______________________________________________
> Spip-carto-cvs mailing list
> Spip-carto-cvs at lists.berlios.de
> http://lists.berlios.de/mailman/listinfo/spip-carto-cvs


From stef at berlios.de  Tue Sep 27 22:53:24 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 22:53:24 +0200
Subject: [Spip-carto-cvs] spipcarto mes_fonctions.php3,1.13,1.13.2.1
Message-ID: <200509272053.j8RKrOmq016130@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv16102

Modified Files:
      Tag: BRANCH-V1
	mes_fonctions.php3 
Log Message:
test CVS

Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.13
retrieving revision 1.13.2.1
diff -u -d -r1.13 -r1.13.2.1
--- mes_fonctions.php3	27 Sep 2005 20:11:14 -0000	1.13
+++ mes_fonctions.php3	27 Sep 2005 20:53:22 -0000	1.13.2.1
@@ -11,13 +11,13 @@
 	$mini_compteur+=$offset;
 	return $mini_compteur;
 }
+
 function plus($txt,$offset=1){
 	global $mini_compteur;
 	if (!isset($mini_compteur))return $offset;
 	return ($mini_compteur+$offset);
 }
 
-
 function guiPos ($compteur, $offset){
 	return $offset+$compteur*20;
 }
@@ -26,6 +26,7 @@
 	list(,$url) = extraire_lien(array('','','',$url));
 	return $url;
 }
+
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 //			FIN MODULE SPIPCARTO



From stef at berlios.de  Tue Sep 27 23:01:04 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:01:04 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire http.class.php,1.3,NONE
Message-ID: <200509272101.j8RL14mq016839@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv16810/ecrire

Removed Files:
      Tag: BRANCH-V1
	http.class.php 
Log Message:
inutile

--- http.class.php DELETED ---



From stef at berlios.de  Tue Sep 27 23:01:05 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:01:05 +0200
Subject: [Spip-carto-cvs] spipcarto Thumbs.db,1.1,NONE .htaccess,1.2,NONE downloadfile.class.php,1.2,NONE
Message-ID: <200509272101.j8RL15mq016843@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv16810

Removed Files:
      Tag: BRANCH-V1
	Thumbs.db .htaccess downloadfile.class.php 
Log Message:
inutile

--- Thumbs.db DELETED ---

--- .htaccess DELETED ---

--- downloadfile.class.php DELETED ---



From stef at berlios.de  Tue Sep 27 23:02:00 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:02:00 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto_distant.php,1.1,NONE plug_carto_free.php,1.1,NONE
Message-ID: <200509272102.j8RL20mq016960@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv16921/ecrire/plugins

Removed Files:
      Tag: BRANCH-V1
	plug_carto_distant.php plug_carto_free.php 
Log Message:
Hors perimetre v1

--- plug_carto_distant.php DELETED ---

--- plug_carto_free.php DELETED ---



From stef at berlios.de  Tue Sep 27 23:02:42 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:02:42 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_google.html,1.3,NONE
Message-ID: <200509272102.j8RL2gmq017007@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv16978/squelettes/template

Removed Files:
      Tag: BRANCH-V1
	carto_google.html 
Log Message:
google passe en contrib pour la v1

--- carto_google.html DELETED ---



From stef at berlios.de  Tue Sep 27 23:02:42 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:02:42 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1,1.1.2.1
Message-ID: <200509272102.j8RL2gmq017010@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv16978/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 
Log Message:
google passe en contrib pour la v1

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -u -d -r1.1 -r1.1.2.1
--- inc_carto_fonctions.php3	24 Sep 2005 00:51:43 -0000	1.1
+++ inc_carto_fonctions.php3	27 Sep 2005 21:02:40 -0000	1.1.2.1
@@ -294,68 +294,4 @@
 			}
 }
 
-
-
-///////////////////////////////////////////////
-// EXPERIMENTAL
-///////////////////////////////////////////////
-
-///////////////////////////////////////////////
-// DHTML (pour squelette ou formulaire)
-///////////////////////////////////////////////
-function wkt2coords_jsdhtml($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
-			// Pour obtenir des objets HTML/MAP pour la superpo avec l'interface DHTML...
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
-				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
- 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
- 				$coordpair[$i] 	= implode(',',$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			return $wktGeom;
-}
-
-///////////////////////////////////////////////
-// GOOGLE
-///////////////////////////////////////////////
-function wkt2coords_google($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
-// Conservation des Y selon le format WKT car en coordonn?es g?ographique
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= $coord[$i][0];
-				$coord[$i][1] 	= $coord[$i][1]*-1;
- 				$wktGoogle[$i]="GPoint(".intval($coord[$i][0]*$rgeo).",".intval($coord[$i][1]*$rgeo).")";
-			}
-			$wktGoogle = implode(',', $wktGoogle);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0)
-			{  	
-				return "GPolyline=([".$wktGoogle."])";		
-			}
-			elseif (strcasecmp($wktGeomType,"LINE")==0)
-			{  	
-				return "GPolyline=([".$wktGoogle."])";		
-			}
-			elseif (strcasecmp($wktGeomType,"POINT")==0)
-			{	
-				$coordTab = explode (" ", $wktGeom);
-				return "GPoint(".intval($coordTab[0]*$rgeo).",".intval($coordTab[1]*$rgeo).")";
-			}
-}
-function worldfile2google($callage){	
-	$tabcallage=worldfile2array($callage);
-	$x=intval($tabcallage['top_left']['x']-($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x'])/2);
-	$y=intval($tabcallage['top_left']['y']-($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/2);
-	return "GPoint(".$x.",".$y.")";
-}
-
-
 ?>



From stef at berlios.de  Tue Sep 27 23:01:59 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:01:59 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes carto_geosvgwmsfile.html,1.2,NONE formulaire_carte.html,1.1,NONE inc-formulaire_carte.php3,1.2,NONE article.html,1.1,NONE carto_geosvgwms.html,1.1,NONE
Message-ID: <200509272101.j8RL1xmq016957@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv16921/squelettes

Removed Files:
      Tag: BRANCH-V1
	carto_geosvgwmsfile.html formulaire_carte.html 
	inc-formulaire_carte.php3 article.html carto_geosvgwms.html 
Log Message:
Hors perimetre v1

--- carto_geosvgwmsfile.html DELETED ---

--- formulaire_carte.html DELETED ---

--- inc-formulaire_carte.php3 DELETED ---

--- article.html DELETED ---

--- carto_geosvgwms.html DELETED ---



From stef at berlios.de  Tue Sep 27 23:02:00 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 27 Sep 2005 23:02:00 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_logox.html,1.2,NONE carto_dessin0.html,1.2,NONE carto_test.html,1.2,NONE
Message-ID: <200509272102.j8RL20mq016963@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv16921/squelettes/template

Removed Files:
      Tag: BRANCH-V1
	carto_logox.html carto_dessin0.html carto_test.html 
Log Message:
Hors perimetre v1

--- carto_logox.html DELETED ---

--- carto_dessin0.html DELETED ---

--- carto_test.html DELETED ---



From stef at berlios.de  Wed Sep 28 17:23:43 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 17:23:43 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1,1.1.2.1 spipcarto_en.php3,1.1,1.1.2.1
Message-ID: <200509281523.j8SFNhmq019596@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv19572/ecrire/lang

Modified Files:
      Tag: BRANCH-V1
	spipcarto_fr.php3 spipcarto_en.php3 
Log Message:
cartes pour i18n icone carte


Index: spipcarto_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_fr.php3,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -u -d -r1.1 -r1.1.2.1
--- spipcarto_fr.php3	26 Sep 2005 05:45:59 -0000	1.1
+++ spipcarto_fr.php3	28 Sep 2005 15:23:40 -0000	1.1.2.1
@@ -5,6 +5,7 @@
 $GLOBALS[$GLOBALS['idx_lang']] = array(
 'calque' => 'Calques ',
 
+'cartes' => 'Cartes',
 'cartes_toutes' => 'Toutes les cartes',
 'carte_creer' => 'Cr&eacute;er une nouvelle carte',
 'carte_nouvelle' => 'Nouvelle carte',

Index: spipcarto_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_en.php3,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -u -d -r1.1 -r1.1.2.1
--- spipcarto_en.php3	26 Sep 2005 05:45:59 -0000	1.1
+++ spipcarto_en.php3	28 Sep 2005 15:23:40 -0000	1.1.2.1
@@ -5,6 +5,7 @@
 $GLOBALS[$GLOBALS['idx_lang']] = array(
 'calque' => 'Layers ',
 
+'cartes' => 'Maps',
 'cartes_toutes' => 'All maps',
 'carte_creer' => 'Create a new map',
 'carte_nouvelle' => 'New map',



From stef at berlios.de  Wed Sep 28 17:24:16 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 17:24:16 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgwmsfile.html,1.5,1.5.2.1 carto_geosvgfile.html,1.5,1.5.2.1
Message-ID: <200509281524.j8SFOGmq019640@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv19613/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto_geosvgwmsfile.html carto_geosvgfile.html 
Log Message:
juste pour bien s?parer SVG et GEOSVG

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- carto_geosvgwmsfile.html	6 Sep 2005 05:41:40 -0000	1.5
+++ carto_geosvgwmsfile.html	28 Sep 2005 15:24:14 -0000	1.5.2.1
@@ -489,7 +489,7 @@
 	 		 <!-- #DESCRIPTIF -->
 				<g id="spipCarto_#ID_MOT">
 				<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-					<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+					<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})[(#_M:DESCRIPTIF)]]"/></a>
 				</BOUCLE_OBJECT>
 				</g>
 			 </BOUCLE_M>
@@ -499,7 +499,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>

Index: carto_geosvgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgfile.html,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- carto_geosvgfile.html	6 Sep 2005 05:41:39 -0000	1.5
+++ carto_geosvgfile.html	28 Sep 2005 15:24:14 -0000	1.5.2.1
@@ -480,7 +480,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>



From stef at berlios.de  Wed Sep 28 17:24:51 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 17:24:51 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_tag-machine.php,1.1,1.1.2.1
Message-ID: <200509281524.j8SFOpmq019790@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv19761/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_tag-machine.php 
Log Message:
oubli en passage 1.8.2d

Index: inc_tag-machine.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_tag-machine.php,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -u -d -r1.1 -r1.1.2.1
--- inc_tag-machine.php	26 Jul 2005 00:13:51 -0000	1.1
+++ inc_tag-machine.php	28 Sep 2005 15:24:49 -0000	1.1.2.1
@@ -90,7 +90,7 @@
 		}
 	  } else {
 		$id_groupe = spip_abstract_insert("spip_groupes_mots",
-										  "(titre, $nom_objet, 0minirezo)",
+										  "(titre, $nom_objet, minirezo)",
 										  "('$groupe','oui','oui')");
 		$warnings[] = array('creer groupe '.$titre_groupe);
 	  }



From stef at berlios.de  Wed Sep 28 17:25:22 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 17:25:22 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_presentation.php3,1.12,1.12.2.1
Message-ID: <200509281525.j8SFPMmq019863@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv19839/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_presentation.php3 
Log Message:
affichage de l'icone cartes pour les redacteurs

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.12
retrieving revision 1.12.2.1
diff -u -d -r1.12 -r1.12.2.1
--- inc_presentation.php3	7 Sep 2005 15:01:53 -0000	1.12
+++ inc_presentation.php3	28 Sep 2005 15:25:19 -0000	1.12.2.1
@@ -2078,7 +2078,14 @@
 	if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) {
 		icone_bandeau_principal (_T('icone_configuration_site'), "configuration.php3", "administration-48.png", "administration", $rubrique, "", "configuration", $sous_rubrique);
 	}
-
+	////////////////////////////////////////////////////
+	//MODIFICATION
+	////////////////////////////////////////////////////
+	else /*if ($connect_statut == '0minirezo')*/ {
+		icone_bandeau_principal (_T("cartes"), "cartes.php3", "carte-24.png", "cartes", $rubrique, "", "cartes", $sous_rubrique);
+	}
+	////////////////////////////////////////////////////
+	
 	echo "<td> &nbsp; </td>";
 
 
@@ -2168,7 +2175,7 @@
 			//les cartes
 			//if (@spip_num_rows(spip_query("SELECT * FROM spip_carto_carte LIMIT 0,1")) > 0) 
 			if (lire_meta('activer_carto')== 'oui') 
-				icone_bandeau_secondaire(_L("Cartes"), "cartes.php3", "carte-24.png", "cartes", $sous_rubrique);
+				icone_bandeau_secondaire(_T("cartes"), "cartes.php3", "carte-24.png", "cartes", $sous_rubrique);
 			////////////////						
 		}
 		echo "</tr></table></div></div>";
@@ -2237,6 +2244,13 @@
 		$decal = $decal + largeur_icone_bandeau_principal(_T('icone_suivi_actualite'));
 	
 	}
+	////////////////////////////////////////////////////
+	//MODIFICATION
+	////////////////////////////////////////////////////
+	else /*if ($connect_statut == '0minirezo')*/ {
+		$decal = $decal + largeur_icone_bandeau_principal(_T('cartes'));
+	}
+	////////////////////////////////////////////////////
 
 
 	if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) {



From stef at berlios.de  Wed Sep 28 17:30:58 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 17:30:58 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.1,1.1.2.2
Message-ID: <200509281530.j8SFUwmq020737@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv20698/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 
Log Message:
bug point SVG + passage de parametre oubli?

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -u -d -r1.1.2.1 -r1.1.2.2
--- inc_carto_fonctions.php3	27 Sep 2005 21:02:40 -0000	1.1.2.1
+++ inc_carto_fonctions.php3	28 Sep 2005 15:30:56 -0000	1.1.2.2
@@ -183,7 +183,7 @@
 	$rgeo 		= round($radius*$GeoWidth/$ImgWidth);
 	$callage 	= worldfile2array ($callage);
 	
-	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage);
+	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc);
 	else return "";
 }
 
@@ -197,7 +197,7 @@
 				return "CIRCLE"; 
 			// HTML Image map ne supporte pas les lignes
 }
-function wkt2coords_html($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_html($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 
 			// Pour obtenir des objets HTML/MAP ...
 			// 	S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ','
@@ -218,7 +218,7 @@
 				return $wktGeom.",".$radius;
 			else return "";
 }
-function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 			// Pour obtenir des objets HTML/DIV ...
 			// Pour les polygones, la moyenne des valeurs
 			// Pour les points, la valeur
@@ -249,7 +249,7 @@
 			else return "";
 }
 
-function wkt2coords_svg($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_svg($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 			// Pour obtenir des objets SVG ...
 			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
 			// S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ' '
@@ -267,11 +267,14 @@
 			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0){  	
 				return "points=\"".$wktGeom."\"";		
 			} elseif (strcasecmp($wktGeomType,"POINT")==0){	
-				$coordTab = explode (" ", $wktGeom);
-				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
+				$coordTab = explode (",", $wktGeom);
+				return " x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
 			}
 }
-function wkt2coords_svggeo($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2shape_svggeo($wktGeomType){
+			return wkt2shape_svg($wktGeomType);
+}
+function wkt2coords_svggeo($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 			// Pour obtenir des objets SVG ...
 			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
 			// S?parateur coordonn?es ' ' / S?parateur paires de coordonn?es ','



From stef at berlios.de  Wed Sep 28 18:23:11 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 28 Sep 2005 18:23:11 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.2,1.1.2.3
Message-ID: <200509281623.j8SGNBmq025804@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv25777/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 
Log Message:
jsdhtml oubli? => affichage des formes dans l'interface DHTML

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -u -d -r1.1.2.2 -r1.1.2.3
--- inc_carto_fonctions.php3	28 Sep 2005 15:30:56 -0000	1.1.2.2
+++ inc_carto_fonctions.php3	28 Sep 2005 16:23:09 -0000	1.1.2.3
@@ -186,7 +186,25 @@
 	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc);
 	else return "";
 }
+///////////////////////////////////////////////
+// JSDHTML
+///////////////////////////////////////////////
+function wkt2coords_jsdhtml($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
+
+			$coordpair = explode (',',$wktGeom);
+			
+			for ($i=0; $i<sizeof($coordpair); $i++)
+			{		
+				$coord[$i] 		= explode(' ',$coordpair[$i]);
+				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
+				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
+ 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
+ 				$coordpair[$i] 	= implode(',',$coord[$i]);
+			}
+			$wktGeom = implode(',', $coordpair);
 
+			return $wktGeom;
+}
 ///////////////////////////////////////////////
 // HTML
 ///////////////////////////////////////////////



From fxp at berlios.de  Wed Sep 28 18:37:51 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Wed, 28 Sep 2005 18:37:51 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgwmsfile.html,1.5.2.1,1.5.2.2
Message-ID: <200509281637.j8SGbpmq004190@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv4089/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto_geosvgwmsfile.html 
Log Message:
GEOSVG est identique ? SVG / Simplification des fonctions 

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.5.2.1
retrieving revision 1.5.2.2
diff -u -d -r1.5.2.1 -r1.5.2.2
--- carto_geosvgwmsfile.html	28 Sep 2005 15:24:14 -0000	1.5.2.1
+++ carto_geosvgwmsfile.html	28 Sep 2005 16:37:47 -0000	1.5.2.2
@@ -499,7 +499,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>



From fxp at berlios.de  Wed Sep 28 18:39:51 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Wed, 28 Sep 2005 18:39:51 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvg.html,1.2,NONE
Message-ID: <200509281639.j8SGdpmq006157@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv6122/squelettes/template

Removed Files:
      Tag: BRANCH-V1
	carto_geosvg.html 
Log Message:
GEOSVG est identique SVG / Simplification des fonctions 

--- carto_geosvg.html DELETED ---



From fxp at berlios.de  Wed Sep 28 18:40:07 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Wed, 28 Sep 2005 18:40:07 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgfile.html,1.5.2.1,NONE
Message-ID: <200509281640.j8SGe7mq006303@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv6232/squelettes/template

Removed Files:
      Tag: BRANCH-V1
	carto_geosvgfile.html 
Log Message:
GEOSVG est identique SVG / Simplification des fonctions 

--- carto_geosvgfile.html DELETED ---



From fxp at berlios.de  Wed Sep 28 18:41:46 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Wed, 28 Sep 2005 18:41:46 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.3,1.1.2.4
Message-ID: <200509281641.j8SGfkmq007113@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv7107/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 
Log Message:
GEOSVG est identique SVG / Simplification des fonctions 

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -u -d -r1.1.2.3 -r1.1.2.4
--- inc_carto_fonctions.php3	28 Sep 2005 16:23:09 -0000	1.1.2.3
+++ inc_carto_fonctions.php3	28 Sep 2005 16:41:44 -0000	1.1.2.4
@@ -289,30 +289,4 @@
 				return " x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
 			}
 }
-function wkt2shape_svggeo($wktGeomType){
-			return wkt2shape_svg($wktGeomType);
-}
-function wkt2coords_svggeo($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
-			// Pour obtenir des objets SVG ...
-			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
-			// S?parateur coordonn?es ' ' / S?parateur paires de coordonn?es ','
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= $coord[$i][0];
-				$coord[$i][1] 	= $coord[$i][1]*-1;
- 				$coordpair[$i] 	= implode(' ' ,$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0)
-			{  	return "points=\"".$wktGeom."\"";		
-			}elseif (strcasecmp($wktGeomType,"POINT")==0)
-			{	$coordTab = explode (" ", $wktGeom);
-				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
-			}
-}
-
 ?>



From stef at berlios.de  Thu Sep 29 01:41:03 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 01:41:03 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_tag-machine.php,1.1,1.2
Message-ID: <200509282341.j8SNesmq028632@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv28581/ecrire

Modified Files:
	inc_tag-machine.php 
Log Message:
oubli en passage 1.8.2d

Index: inc_tag-machine.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_tag-machine.php,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- inc_tag-machine.php	26 Jul 2005 00:13:51 -0000	1.1
+++ inc_tag-machine.php	28 Sep 2005 23:40:50 -0000	1.2
@@ -90,7 +90,7 @@
 		}
 	  } else {
 		$id_groupe = spip_abstract_insert("spip_groupes_mots",
-										  "(titre, $nom_objet, 0minirezo)",
+										  "(titre, $nom_objet, minirezo)",
 										  "('$groupe','oui','oui')");
 		$warnings[] = array('creer groupe '.$titre_groupe);
 	  }



From stef at berlios.de  Thu Sep 29 01:47:58 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 01:47:58 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18,1.18.2.1
Message-ID: <200509282347.j8SNlwmq032111@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv32065/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 
Log Message:
securit? + recuperation dans _request
passage en POST
bug ancre nouveau objet

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18
retrieving revision 1.18.2.1
diff -u -d -r1.18 -r1.18.2.1
--- carte_edit.php3	26 Sep 2005 10:17:03 -0000	1.18
+++ carte_edit.php3	28 Sep 2005 23:47:53 -0000	1.18.2.1
@@ -8,8 +8,26 @@
 //meme si il faut le faire ...
 //include_ecrire("inc_config.php3");
 
+$id_carte = intval($_REQUEST['id_carte']);
+$titre = stripslashes($_REQUEST['titre']);
+$url_carte = stripslashes($_REQUEST['url_carte']);
+$texte = stripslashes($_REQUEST['texte']);
+$callage = stripslashes($_REQUEST['callage']);
+$id_srs = intval($_REQUEST['id_srs']);
+$new =stripslashes($_REQUEST['new']);
+$supp_carte=stripslashes($_REQUEST['supp_carte']);
+$supp_confirme=stripslashes($_REQUEST['supp_confirme']);
+$supp_rejet=stripslashes($_REQUEST['supp_rejet']);
+
+$selection_type=stripslashes($_REQUEST['selection_type']);
+$modif_objet=stripslashes($_REQUEST['modif_objet']);
+$objet_titre=stripslashes($_REQUEST['objet_titre']);
+$objet_texte=stripslashes($_REQUEST['objet_texte']);
+$url_objet=stripslashes($_REQUEST['url_objet']);
+$url_logo=stripslashes($_REQUEST['url_logo']);
+$geometrie=stripslashes($_REQUEST['geometrie']);
+
 $flag_editable=carte_editable($id_carte);
-$id_carte = intval($id_carte);
 $flag_mots = lire_meta("carto_mots");
 //$flag_mots = "oui";
 $nouveau=false;
@@ -186,7 +204,7 @@
 	echo _T("spipcarto:carte_supp_confirm")."</p>\n";
 	$link = $carte_supplink;//new Link();
 	//$link->addVar('supp_carte', $supp_carte);
-	echo $link->getform('GET');
+	echo $link->getform('POST');
 	echo "<input type='submit' name='supp_confirme' value=\""._T('item_oui')."\" class='fondl'>";
 	echo " &nbsp; ";
 	echo "<input type='submit' name='supp_rejet' value=\""._T('item_non')."\" class='fondl'>";
@@ -282,7 +300,7 @@
 	echo "<div class='verdana2'>";
 	$link = $carte_link;
 	$link->addVar('modif_carte', $id_carte);
-	echo $link->getForm('GET');
+	echo $link->getForm('POST');
 	
 	echo "<strong><label for='titre_carte'>"._T("spipcarto:carte_titre")."</label></strong> "._T('info_obligatoire_02');
 	echo "<br />";
@@ -376,7 +394,7 @@
 			$geometrie = entites_html($t['geometrie']);
 	
 			$visible = ($id_objet == $objet_visible);
-			if ($nouveau) echo "<a name='nouveau_objet'></a>";
+			if ($nouveau&&$visible) echo "<a name='nouveau_objet'></a>";
 			else if ($visible) echo "<a name='objet_visible'></a>";
 			echo "<p>\n";
 			debut_cadre_relief();
@@ -384,7 +402,7 @@
 				// Modifier un objet
 				$link = $carte_link;
 				$link->addVar('modif_objet', $id_objet);
-				echo $link->getForm('GET', '#objet_visible');
+				echo $link->getForm('POST', '#objet_visible');
 				echo "<div class='verdana2'>";
 				echo "<table>";
 					echo "<tr valign='top'><td>";



From stef at berlios.de  Thu Sep 29 15:57:29 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 15:57:29 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_en.php3,1.1.2.1,1.1.2.2
Message-ID: <200509291357.j8TDvTmq010585@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv10561/ecrire/lang

Modified Files:
      Tag: BRANCH-V1
	spipcarto_en.php3 
Log Message:
des espaces en fin de fichier => probleme d'entete

Index: spipcarto_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_en.php3,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -u -d -r1.1.2.1 -r1.1.2.2
--- spipcarto_en.php3	28 Sep 2005 15:23:40 -0000	1.1.2.1
+++ spipcarto_en.php3	29 Sep 2005 13:57:26 -0000	1.1.2.2
@@ -63,5 +63,4 @@
 
 );
 
-?>
-
+?>
\ No newline at end of file



From stef at berlios.de  Thu Sep 29 23:14:05 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 23:14:05 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto.php3,1.21,1.21.2.1
Message-ID: <200509292114.j8TLE5mq007077@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv7052/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto.php3 
Log Message:
Traitement particulier pour IE supprim? (?)
un peu de place pour afficher les coordonn?es

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.21
retrieving revision 1.21.2.1
diff -u -d -r1.21 -r1.21.2.1
--- inc_carto.php3	26 Sep 2005 10:17:03 -0000	1.21
+++ inc_carto.php3	29 Sep 2005 21:14:03 -0000	1.21.2.1
@@ -132,31 +132,30 @@
 		$height=300;
 	};
 	
-	$returned='<script type="text/javascript" src="js/x_core_nn4.js"></script>
+	$returned=' <table border="0">
+  <tr> 
+   <td colspan="7"><script type="text/javascript" src="js/x_core_nn4.js"></script>
 <script type="text/javascript" src="js/x_dom_nn4.js"></script>
 <script type="text/javascript" src="js/x_event_nn4.js"></script>
 <script type="text/javascript" src="js/navTools.js"></script>
 <script type="text/javascript" src="js/graphTools.js"></script>
-<form method="get" action="#nouveau_objet" name="carto_form">
- <table border="0">
-  <tr> 
-   <td colspan="7">
+<form method="post" action="#nouveau_objet" name="carto_form">
 <script type="text/javascript">
 /*<![CDATA[*/ 
     var dhtmlDivs = new String();
     document.image = new Image;
     document.image.src = \''.$fichier.'\';
     document.image.usemap=\'#map'.$id_carte.'\';
-   if (xIE) {
+//   if (xIE) {
       dhtmlDivs = \'<div id="mapImageDiv" class="dhtmldiv" style="background-image:url(\'; 
       dhtmlDivs += document.image.src;
       dhtmlDivs += \');visibility:hidden;background-repeat:no-repeat;"></div>\';
-    } else {
+/*    } else {
       dhtmlDivs = \'<div id="mapImageDiv" class="dhtmldiv" style="visibility:hidden"><img \';
       dhtmlDivs += \'src="\' + document.image.src + \'" alt="Main map" title="" \';
-      dhtmlDivs += \'width="'.$width.'px" height="'.$height.'px" /></div>\';
-      
+      dhtmlDivs += \'width="'.$width.'px" height="'.$height.'px" /></div>\';    
     }
+*/
     dhtmlDivs += \'<div id="myCanvasDiv" class="dhtmldiv"></div>\';
     dhtmlDivs += \'<div id="myCanvas2Div" class="dhtmldiv"></div>\';
     dhtmlDivs += \'<div id="myCanvas3Div" class="dhtmldiv"></div>\';
@@ -238,6 +237,9 @@
      </table>
     </div>
    </td>
+  </tr>
+  <tr>
+   <td colspan="7">&nbsp;</td>
   </tr>
   <tr>
    <td> '._T("spipcarto:carte_draw").'



From stef at berlios.de  Thu Sep 29 23:17:39 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 23:17:39 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.4,1.1.2.5
Message-ID: <200509292117.j8TLHdmq007813@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv7789/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 
Log Message:
radius specifique au point en HTML

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.4
retrieving revision 1.1.2.5
diff -u -d -r1.1.2.4 -r1.1.2.5
--- inc_carto_fonctions.php3	28 Sep 2005 16:41:44 -0000	1.1.2.4
+++ inc_carto_fonctions.php3	29 Sep 2005 21:17:37 -0000	1.1.2.5
@@ -233,7 +233,7 @@
 			if (strcasecmp($wktGeomType,"POLYGON")==0)
 				return $wktGeom;
 			else if (strcasecmp($wktGeomType,"POINT")==0)
-				return $wktGeom.",".$radius;
+				return $wktGeom.",6";//.$radius;
 			else return "";
 }
 function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	



From stef at berlios.de  Thu Sep 29 23:18:37 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 23:18:37 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.1,1.18.2.2
Message-ID: <200509292118.j8TLIbmq008018@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv7991/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 
Log Message:
details ...

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.1
retrieving revision 1.18.2.2
diff -u -d -r1.18.2.1 -r1.18.2.2
--- carte_edit.php3	28 Sep 2005 23:47:53 -0000	1.18.2.1
+++ carte_edit.php3	29 Sep 2005 21:18:35 -0000	1.18.2.2
@@ -63,7 +63,7 @@
 			if (!$callage)
 				if ($document_id=intval($url_carte)) {
 					//TODO : gerer type image et peut etre mime
-					$image = spip_fetch_array(spip_query("SELECT * FROM spip_documents WHERE id_document = $document_id"));;
+					$image = spip_fetch_array(spip_query("SELECT * FROM spip_documents WHERE id_document = $document_id"));
 					if ($image) $callage=array2worldfile($image);
 				}
 			//TODO : passer tout ca en spip_abstract ...
@@ -229,10 +229,9 @@
 		echo "<br />";
 		debut_cadre_relief();
 		
-		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
+		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>";
 		echo bouton_block_visible("dhtml_carte");
-		echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-			._T("spipcarto:objet_add")."</strong>";
+		echo "<strong class='verdana3' style='text-transform: uppercase;'>&nbsp;"._T("spipcarto:objet_add")."</strong>";
 		echo "</div>\n";
 		
 		echo debut_block_visible("dhtml_carte");
@@ -313,7 +312,7 @@
 	echo $texte;
 	echo "</textarea><br />\n";
 
-	if ($new) {
+	if ($new=="oui") {
 		echo "<input type='hidden' name='url_carte' id='url_carte_carte' ".
 			"value=\"".$url_carte."\" size='40'>";
 		
@@ -355,7 +354,7 @@
 	//
 	// Modifier / supprimer les objets
 	//
-	if (!$new) {
+	if ($new!="oui") {
 		echo "<a name='objets'></a>";
 		echo "<p><hr><p>\n";
 		echo "<div class='verdana3'>";



From stef at berlios.de  Thu Sep 29 23:20:33 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 23:20:33 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6,1.6.2.1
Message-ID: <200509292120.j8TLKXmq008289@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv8263/ecrire/plugins

Modified Files:
      Tag: BRANCH-V1
	plug_carto.php 
Log Message:
erreur dans le nom de la table.
Manque encore le prefixe ...

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- plug_carto.php	24 Sep 2005 01:02:40 -0000	1.6
+++ plug_carto.php	29 Sep 2005 21:20:31 -0000	1.6.2.1
@@ -10,7 +10,7 @@
 		global $flag_ecrire;
 		$id_article=$_POST['id_article'];
 		if ($flag_ecrire) {
-			$query = "DELETE FROM spip_carto_carte_articles WHERE id_article=$id_article";
+			$query = "DELETE FROM spip_carto_cartes_articles WHERE id_article=$id_article";
 			spip_query($query);
 		}
 		foreach ($regs as $r) {



From stef at berlios.de  Thu Sep 29 23:21:12 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 29 Sep 2005 23:21:12 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_logo.html,1.2,1.2.2.1 carto_lien.html,1.2,1.2.2.1 carto_map.html,1.2,1.2.2.1
Message-ID: <200509292121.j8TLLCmq008401@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv8377/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto_logo.html carto_lien.html carto_map.html 
Log Message:
bug en resize : les positions ne suivaient plus

Index: carto_logo.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_logo.html,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- carto_logo.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_logo.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
@@ -6,16 +6,16 @@
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
 		
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="1"/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"]/>
 		
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
 			<a href="[(#URL_OBJET|url)]">
-			<img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE})]border: 0px;" alt="#TEXTE" 
+			<img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;" alt="#TEXTE" 
 				src="<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>IMG/moton#ID_MOT.gif</BOUCLE_mot>" border="0"/>
 			</a>
 		</BOUCLE_objets2>

Index: carto_lien.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_lien.html,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- carto_lien.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_lien.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
@@ -1,18 +1,16 @@
-
-
 <div style="float: left;visibility: visible; margin: 0px; padding: 0px; height: 500px;">
 	<div style="position: absolute;">
 	<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="1"/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"]/>
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<div style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE})]border: 0px;">
+			<div style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;">
 			<a href="[(#URL_OBJET|url)]" class="cartolabel" alt="#TEXTE">
 			<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>[(#LOGO_MOT)]
 			</BOUCLE_mot> #TITRE

Index: carto_map.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_map.html,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- carto_map.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_map.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
@@ -1,4 +1,4 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
 </BOUCLE_objets></map></B_objets></BOUCLE_carte>



From stef at berlios.de  Fri Sep 30 01:43:02 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 01:43:02 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.2,1.18.2.3 mes_options.php3,1.8,1.8.2.1 inc_carto.php3,1.21.2.1,1.21.2.2
Message-ID: <200509292343.j8TNh2mq024716@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv24645/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 mes_options.php3 inc_carto.php3 
Log Message:
gestion des squelettes de cartes et raccourcis cliquables

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.2
retrieving revision 1.18.2.3
diff -u -d -r1.18.2.2 -r1.18.2.3
--- carte_edit.php3	29 Sep 2005 21:18:35 -0000	1.18.2.2
+++ carte_edit.php3	29 Sep 2005 23:42:58 -0000	1.18.2.3
@@ -177,12 +177,10 @@
 echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='6'><b>$id_carte</b></font>\n";
 if ($url_carte && ($new!="oui")) {
 	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('spipcarto:carte_apercu')."</b></font>\n";
-	icone_horizontale( _T('spipcarto:carte_img'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_lien'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_logo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svggeo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	$sq_cartes=$GLOBALS['sq_cartes'];
+	if (!is_array($sq_cartes)) $sq_cartes=array('map');
+	foreach ($sq_cartes as $sq_carte)
+		icone_horizontale( _T('spipcarto:carte_'.$sq_carte), "../carto.php3?id_carto_carte=".$id_carte."&fond=".$sq_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
 }
 echo "</div>\n";
 

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8
retrieving revision 1.8.2.1
diff -u -d -r1.8 -r1.8.2.1
--- mes_options.php3	24 Sep 2005 01:00:22 -0000	1.8
+++ mes_options.php3	29 Sep 2005 23:42:58 -0000	1.8.2.1
@@ -161,6 +161,8 @@
 	include_ecrire('plugins/plug_carto.php');
     return apres_tout_carto($texte);
 }
+$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
+			
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 ?>

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.21.2.1
retrieving revision 1.21.2.2
diff -u -d -r1.21.2.1 -r1.21.2.2
--- inc_carto.php3	29 Sep 2005 21:14:03 -0000	1.21.2.1
+++ inc_carto.php3	29 Sep 2005 23:42:58 -0000	1.21.2.2
@@ -108,7 +108,7 @@
 		echo "</table>";
 		echo "</div>\n";
 	}
-	return $tous_id;
+	return;// $tous_id;
 }
 
 
@@ -302,39 +302,50 @@
 
 	echo debut_block_invisible("ajouter_carte");
 	echo "<div class='verdana2'>";
-	echo _T("spipcarto:carte_insert_desc");
+	echo _T("spipcarto:carte_insert_texte");
 	echo "</div>";
 
+	$cartes_article=array();
+	$query = "SELECT id_carto_carte FROM spip_carto_cartes_articles where id_article=".$id_article;
+	$result = spip_query($query);
+	while($ligne=spip_fetch_array($result)) {
+		$cartes_article[]=$ligne[0];
+	}
 	$query = "SELECT id_carto_carte, titre FROM spip_carto_cartes ORDER BY titre";
 	$result = spip_query($query);
 	if (spip_num_rows($result)) {
 		echo "<br />\n";
-		echo "<div class='bandeau_rubriques' style='z-index: 1;'>";
-		echo "<div class='plan-articles'>";
 		while ($row = spip_fetch_array($result)) {
 			$id_carte = $row['id_carto_carte'];
+			$inclus=(in_array($id_carte,$cartes_article));
 			$titre = typo($row['titre']);
 			
 			$link = new Link("carte_edit.php3");
 			$link->addVar("id_carte", $id_carte);
 			$link->addVar("retour", $GLOBALS['clean_link']->getUrl());
-			echo "<a href='".$link->getUrl()."'>";
-			echo $titre."</a>\n";
-			echo "<div class='arial1' align='$spip_lang_right' style='color: black; padding-$spip_lang_left: 4px;' ".
+			echo "<div class='verdana3' style='border:1px;background-color: $couleur_claire;'>";
+			echo bouton_block_invisible("lien_carte$id_carte");
+			echo "<a href='".$link->getUrl()."'>".$titre."</a>\n";
+			echo debut_block_invisible("lien_carte$id_carte");
+			echo "<div class='arial1' align='$spip_lang_right' style='background-color: white;color: black; padding: 2px;margin: 0px;' ".
 				"title=\""._T("spipcarto:carte_raccourci").
 				"\">";
-			echo "<font color='333333'>";
-			echo "<div align='right'>"._T("spipcarto:carte_simple")." &lt;map$id_carte&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_logo")." &lt;map$id_carte|logo&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_lien")." &lt;map$id_carte|lien&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_svg")." &lt;map$id_carte|svg&gt;</div>";
- 			echo "<div align='right'>"._T("spipcarto:carte_svgx")." &lt;map$id_carte|svgx&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_svggeo")." &lt;map$id_carte|svggeo&gt;</div>";
-			echo "</font>\n";
+			//liste des squelettes disponible : dans mes_options
+			$sq_cartes=$GLOBALS['sq_cartes'];
+			if (!is_array($sq_cartes)) $sq_cartes=array('map');
+			foreach ($sq_cartes as $sq_carte){
+				echo "<div align='right' style='color:#333333'";
+				if ($inclus) echo "style=\"text-weight: bold;\"> &lt;map".$id_carte."|".$sq_carte."&gt;";
+				else echo "><a href=\"javascript:barre_inserer('<map".$id_carte."|".$sq_carte.">',document.formulaire.texte)\">&lt;map".$id_carte."|".$sq_carte."&gt;</a>";
+				echo "</div>";
+			}
+
+			echo "</div>";
+			echo fin_block();
 			echo "</div>";
 		}
-		echo "</div>";
-		echo "</div>";
+	//	echo "</div>";
+	//	echo "</div>";
 	}
 
 	// Creer une carte



From stef at berlios.de  Fri Sep 30 01:42:58 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 01:42:58 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1.2.1,1.1.2.2 spipcarto_en.php3,1.1.2.2,1.1.2.3
Message-ID: <200509292343.j8TNgwmq024707@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv24645/ecrire/lang

Modified Files:
      Tag: BRANCH-V1
	spipcarto_fr.php3 spipcarto_en.php3 
Log Message:
gestion des squelettes de cartes et raccourcis cliquables

Index: spipcarto_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_fr.php3,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -u -d -r1.1.2.1 -r1.1.2.2
--- spipcarto_fr.php3	28 Sep 2005 15:23:40 -0000	1.1.2.1
+++ spipcarto_fr.php3	29 Sep 2005 23:42:54 -0000	1.1.2.2
@@ -11,12 +11,12 @@
 'carte_nouvelle' => 'Nouvelle carte',
 'carte_numero' => 'CARTE NUM&Eacute;RO :', 
 'carte_apercu' => 'Aper?u de la carte', 
-'carte_img' => 'Image simple', 
+'carte_map' => 'Image simple', 
 'carte_lien' => 'Image avec liens',
 'carte_logo' => 'Image avec logos',
 'carte_svg' => 'SVG simple',
 'carte_svgx' => 'SVG avec zoom',
-'carte_svggeo' => 'SVG avec zoom et services web (WMS)',
+'carte_geosvgwms' => 'SVG avec zoom et services web (WMS)',
 'carte_warning' => 'Attention :',
 'carte_supp' => 'Supprimer cette carte', 
 'carte_supp_confirm' => 'Voulez-vous vraiment supprimer cette carte ?',
@@ -31,7 +31,7 @@
 'carte_import_objet' => 'Importer des objets dans la carte',
 'carte_supp_objets' => 'Supprimer tous les objets de la carte',
 'carte_insert' => 'Ins&eacute;rer une carte',
-'carte_insert_texte' => 'Vous pouvez ins&eacute;rer des cartes dans vos articles. Choisissez une <br/>carte dans la liste ci-dessous et recopiez le raccourci dans le texte <br/>de l\'article.',
+'carte_insert_texte' => 'Vous pouvez ins&eacute;rer des cartes dans vos articles.<br/>Positionnez votre curseur dans le texte de l\'article, choisissez une carte dans la liste ci-dessous et cliquez sur un raccourci pour l\'ins&eacute;rer.',
 'carte_raccourci' => 'Recopiez ce raccourci dans le texte de l\'article pour ins&eacute;rer ce formulaire.',
 'carte_loading' => 'Chargement de la carte',
 'carte_point' => 'Point',

Index: spipcarto_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_en.php3,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -u -d -r1.1.2.2 -r1.1.2.3
--- spipcarto_en.php3	29 Sep 2005 13:57:26 -0000	1.1.2.2
+++ spipcarto_en.php3	29 Sep 2005 23:42:54 -0000	1.1.2.3
@@ -11,12 +11,12 @@
 'carte_nouvelle' => 'New map',
 'carte_numero' => 'Map identifier :', 
 'carte_apercu' => 'Map overview', 
-'carte_img' => 'Image', 
+'carte_map' => 'Image', 
 'carte_lien' => 'Image with link',
 'carte_logo' => 'Image with symbols',
 'carte_svg' => 'SVG simple',
 'carte_svgx' => 'SVG with zoom',
-'carte_svggeo' => 'SVG with zoom and webservices (WMS)',
+'carte_geosvgwms' => 'SVG with zoom and webservices (WMS)',
 'carte_warning' => 'Warning :',
 'carte_supp' => 'Remove current map', 
 'carte_supp_confirm' => 'Are you sure to remove this map ?',
@@ -31,7 +31,7 @@
 'carte_import_objet' => 'Import objects into current map',
 'carte_supp_objets' => 'Remove all objects',
 'carte_insert' => 'Insert a map',
-'carte_insert_texte' => 'You can insert maps into your articles. Select a<br/>map in the list below and copy the shortcut<br/> in your text.',
+'carte_insert_texte' => 'You can insert maps into your articles.<br/>Set focus on text, select a map in the list below and clic the shortcut to insert in your text.',
 'carte_raccourci' => 'Copy the shortcut into your article to insert this form.',
 'carte_loading' => 'Loading message',
 'carte_point' => 'Point',



From stef at berlios.de  Fri Sep 30 02:16:48 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 02:16:48 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6.2.1,1.6.2.2
Message-ID: <200509300016.j8U0Gmmq002256@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv2070/ecrire/plugins

Modified Files:
      Tag: BRANCH-V1
	plug_carto.php 
Log Message:
id_article en get ou en post selon les cas => _request

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.6.2.1
retrieving revision 1.6.2.2
diff -u -d -r1.6.2.1 -r1.6.2.2
--- plug_carto.php	29 Sep 2005 21:20:31 -0000	1.6.2.1
+++ plug_carto.php	30 Sep 2005 00:16:43 -0000	1.6.2.2
@@ -8,7 +8,7 @@
 	if (is_int(strpos($texte, '<map')) &&
 	  (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?([(])?([a-zA-Z0-9\,\-.]+)?([)])?>,", $texte, $regs, PREG_SET_ORDER))) {	
 		global $flag_ecrire;
-		$id_article=$_POST['id_article'];
+		$id_article=$_REQUEST['id_article'];
 		if ($flag_ecrire) {
 			$query = "DELETE FROM spip_carto_cartes_articles WHERE id_article=$id_article";
 			spip_query($query);



From stef at berlios.de  Fri Sep 30 02:17:43 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 02:17:43 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto.html,1.2,1.2.2.1 carto_geosvgwmsfile.html,1.5.2.2,1.5.2.3 carto_svgfile.html,1.4,1.4.2.1 carto_svgx.html,1.3,1.3.2.1 carto_lien.html,1.2.2.1,1.2.2.2 carto_map.html,1.2.2.1,1.2.2.2 carto_svgfilex.html,1.6,1.6.2.1
Message-ID: <200509300017.j8U0Hhmq003154@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv3117/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto.html carto_geosvgwmsfile.html carto_svgfile.html 
	carto_svgx.html carto_lien.html carto_map.html 
	carto_svgfilex.html 
Log Message:
filtre url deja pass? par le compilo

Index: carto.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto.html,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- carto.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto.html	30 Sep 2005 00:17:40 -0000	1.2.2.1
@@ -1,4 +1,4 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 </BOUCLE_objets></map></B_objets></BOUCLE_carte>

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.5.2.2
retrieving revision 1.5.2.3
diff -u -d -r1.5.2.2 -r1.5.2.3
--- carto_geosvgwmsfile.html	28 Sep 2005 16:37:47 -0000	1.5.2.2
+++ carto_geosvgwmsfile.html	30 Sep 2005 00:17:40 -0000	1.5.2.3
@@ -489,7 +489,7 @@
 	 		 <!-- #DESCRIPTIF -->
 				<g id="spipCarto_#ID_MOT">
 				<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-					<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})[(#_M:DESCRIPTIF)]]"/></a>
+					<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})[(#_M:DESCRIPTIF)]]"/></a>
 				</BOUCLE_OBJECT>
 				</g>
 			 </BOUCLE_M>
@@ -499,7 +499,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>

Index: carto_svgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfile.html,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- carto_svgfile.html	6 Sep 2005 05:41:40 -0000	1.4
+++ carto_svgfile.html	30 Sep 2005 00:17:40 -0000	1.4.2.1
@@ -24,7 +24,7 @@
 		 
 		<g id="mainlayer">
 		 	<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-		  		<a xlink:href="[(#URL_OBJET|url)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+		  		<a xlink:href="[(#URL_OBJET)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 		 	</BOUCLE_objets>
 		</g>
 	</svg>

Index: carto_svgx.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgx.html,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- carto_svgx.html	18 Aug 2005 06:33:33 -0000	1.3
+++ carto_svgx.html	30 Sep 2005 00:17:40 -0000	1.3.2.1
@@ -2,7 +2,7 @@
 <embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfilex" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] type="image/svg+xml" name="emap"></embed>
 <noembed>
 	<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 	</BOUCLE_objets></map></B_objets>
 </noembed>
 </BOUCLE_carte>

Index: carto_lien.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_lien.html,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -u -d -r1.2.2.1 -r1.2.2.2
--- carto_lien.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
+++ carto_lien.html	30 Sep 2005 00:17:41 -0000	1.2.2.2
@@ -4,14 +4,14 @@
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"]/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] style="border: 0px;"/>
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
 			<div style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;">
-			<a href="[(#URL_OBJET|url)]" class="cartolabel" alt="#TEXTE">
+			<a href="[(#URL_OBJET)]" class="cartolabel" alt="#TEXTE">
 			<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>[(#LOGO_MOT)]
 			</BOUCLE_mot> #TITRE
 			</a>

Index: carto_map.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_map.html,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -u -d -r1.2.2.1 -r1.2.2.2
--- carto_map.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
+++ carto_map.html	30 Sep 2005 00:17:41 -0000	1.2.2.2
@@ -1,4 +1,4 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 </BOUCLE_objets></map></B_objets></BOUCLE_carte>

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- carto_svgfilex.html	24 Sep 2005 01:12:26 -0000	1.6
+++ carto_svgfilex.html	30 Sep 2005 00:17:41 -0000	1.6.2.1
@@ -203,7 +203,7 @@
 	<!-- #DESCRIPTIF -->
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
 		 </BOUCLE_M>
@@ -214,7 +214,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>



From stef at berlios.de  Fri Sep 30 02:18:43 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 02:18:43 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_logo.html,1.2.2.1,1.2.2.2
Message-ID: <200509300018.j8U0Ihmq003704@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv3658/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto_logo.html 
Log Message:
logo par defaut (croix rouge) + support autre extensions que .gif - filtre url inutile

Index: carto_logo.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_logo.html,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -u -d -r1.2.2.1 -r1.2.2.2
--- carto_logo.html	29 Sep 2005 21:21:09 -0000	1.2.2.1
+++ carto_logo.html	30 Sep 2005 00:18:40 -0000	1.2.2.2
@@ -6,17 +6,17 @@
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
 		
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"]/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] style="border: 0px;"/>
 		
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<a href="[(#URL_OBJET|url)]">
+			<a href="[(#URL_OBJET)]">
 			<img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;" alt="#TEXTE" 
-				src="<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>IMG/moton#ID_MOT.gif</BOUCLE_mot>" border="0"/>
+				src="<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>IMG/[(#LOGO_MOT|fichier)]</BOUCLE_mot>ecrire\img_pack\croix-rouge.gif<//B_mot>" border="0"/>
 			</a>
 		</BOUCLE_objets2>
 	</BOUCLE_carte>



From stef at berlios.de  Fri Sep 30 15:41:22 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 30 Sep 2005 15:41:22 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_documents.php3,1.7,1.7.2.1 inc_getdocument.php3,1.7,1.7.2.1
Message-ID: <200509301341.j8UDfMmq013809@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv13776/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_documents.php3 inc_getdocument.php3 
Log Message:
gestion des images distantes comme document

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -d -r1.7 -r1.7.2.1
--- inc_documents.php3	10 Aug 2005 12:00:38 -0000	1.7
+++ inc_documents.php3	30 Sep 2005 13:41:19 -0000	1.7.2.1
@@ -985,7 +985,7 @@
 	$link->addVar('ajout_doc', 'oui');
 	$link->addVar('mode', 'vignette');
 	$link->addVar('type', $type);
-	afficher_upload($link, $redirect_url, _T('info_telecharger'));
+	afficher_upload($link, $redirect_url, _T('info_telecharger'),'',true,true);
 
 	fin_cadre_relief();
 

Index: inc_getdocument.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_getdocument.php3,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -d -r1.7 -r1.7.2.1
--- inc_getdocument.php3	7 Sep 2005 15:01:53 -0000	1.7
+++ inc_getdocument.php3	30 Sep 2005 13:41:19 -0000	1.7.2.1
@@ -338,7 +338,18 @@
 			$type_image = $a['type_image'];
 
 			$distant = 'oui';
-			$mode = 'document';
+			
+			$type_inclus_image = false;
+			ereg("\.([^.]+)$", $fichier, $match);
+			$ext = addslashes(corriger_extension(strtolower($match[1])));
+			
+			if ($row = spip_fetch_array(spip_query(
+			"SELECT * FROM spip_types_documents
+			WHERE extension='$ext' AND upload='oui'"))) {
+				$type_inclus_image = ($row['inclus'] == 'image');
+			}
+			if ($type_inclus_image) $mode = 'vignette';
+			else $mode = 'document';
 		}
 		else {
 			spip_log("Echec du lien vers le document $source, abandon");



