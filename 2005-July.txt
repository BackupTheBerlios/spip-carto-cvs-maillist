From fxp at berlios.de  Fri Jul  1 08:07:43 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:07:43 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes carto_geosvgwms.html,NONE,1.1
Message-ID: <200507010607.j6167hHf025299@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv25283/squelettes

Added Files:
	carto_geosvgwms.html 
Log Message:
Interface SVG avec connection WMS

--- NEW FILE: carto_geosvgwms.html ---
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<embed src="carto_geosvgwmsfile.php3?id_carto_carte=#ID_CARTO_CARTE" width="600px" height="400px" type="image/svg+xml" name="emap"/>
</BOUCLE_carte>



From fxp at berlios.de  Fri Jul  1 08:08:06 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:08:06 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes carto_geosvgwmsfile.html,NONE,1.1
Message-ID: <200507010608.j61686Hf025830@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv25797/squelettes

Added Files:
	carto_geosvgwmsfile.html 
Log Message:
Interface SVG avec connection WMS

--- NEW FILE: carto_geosvgwmsfile.html ---
<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<svg width="100%" height="100%" viewBox="0 0 850 590" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
	<script type="text/ecmascript" xlink:href="helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="navigation.js"/>
	<script type="text/ecmascript"><![CDATA[


/* slider.js */
//slider properties
function slider(x1,y1,value1,x2,y2,value2,startVal,sliderGroupId,sliderColor,visSliderWidth,invisSliderWidth,sliderSymb,functionToCall,mouseMoveBool) {
	this.x1 = x1;
	this.y1 = y1;
	this.value1 = value1;
	this.x2 = x2;
	this.y2 = y2;
	this.value2 = value2;
	this.startVal = startVal;
	this.value = startVal;
	this.sliderGroupId = sliderGroupId;
	this.sliderGroup = document.getElementById(this.sliderGroupId);
	this.sliderColor = sliderColor;
	this.visSliderWidth = visSliderWidth;
	this.invisSliderWidth = invisSliderWidth;
	this.sliderSymb = sliderSymb;
	this.functionToCall = functionToCall;
	this.mouseMoveBool = mouseMoveBool;
	this.length = toPolarDist((this.x2 - this.x1),(this.y2 - this.y1));
	this.direction = toPolarDir((this.x2 - this.x1),(this.y2 - this.y1));
	this.createSlider();
	this.slideStatus = 0;
	this.ctm = getTransformToRootElement(this.sliderGroup).inverse();
}

//create slider
slider.prototype.createSlider = function() {
	var mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.invisSliderWidth);
	mySliderLine.setAttributeNS(null,"opacity","0");
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_invisibleSliderLine");
	mySliderLine.addEventListener("mousedown",this,false);
	this.sliderGroup.appendChild(mySliderLine);
	mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.visSliderWidth);
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_visibleSliderLine");
	mySliderLine.setAttributeNS(null,"pointer-events","none");
	this.sliderGroup.appendChild(mySliderLine);
	mySliderSymb = document.createElementNS(svgNS,"use");
	mySliderSymb.setAttributeNS(xlinkNS,"xlink:href","#"+this.sliderSymb);
	var myStartDistance = this.length - ((this.value2 - this.startVal) / (this.value2 - this.value1)) * this.length;
	var myPosX = this.x1 + toRectX(this.direction,myStartDistance);
	var myPosY = this.y1 + toRectY(this.direction,myStartDistance);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	mySliderSymb.setAttributeNS(null,"transform",myTransformString);
	mySliderSymb.setAttributeNS(null,"id",this.sliderGroupId+"_sliderSymbol");
	this.sliderGroup.appendChild(mySliderSymb);
}

//remove all slider elements
slider.prototype.removeSlider = function() {
    var mySliderSymb = document.getElementById(this.sliderGroup+"_sliderSymbol");
	this.sliderGroup.removeChild(mySliderSymb);
    var mySliderLine = document.getElementById(this.sliderGroup+"_visibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
    var mySliderLine = document.getElementById(this.sliderGroup+"_invisibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
}

//handle events
slider.prototype.handleEvent = function(evt) {
	this.drag(evt);
}

//drag slider
slider.prototype.drag = function(evt) {
	var svgroot = document.documentElement;
	if (evt.type == "mousedown" || (evt.type == "mousemove" && this.slideStatus == 1)) {
		var myCoords = myMapApp.calcCoord(evt.clientX,evt.clientY);
		//undo the effect of transformations
		var mySVGPoint = svgroot.createSVGPoint();
		mySVGPoint.x = myCoords["x"];
		mySVGPoint.y = myCoords["y"];
		mySVGPoint = mySVGPoint.matrixTransform(this.ctm);
		myCoords["x"] = mySVGPoint.x;
		myCoords["y"] = mySVGPoint.y;
	
		//draw normal line for first vertex
		var ax = this.x2 - this.x1;
		var ay = this.y2 - this.y1;
		//normal vector 1
		var px1 = parseFloat(this.x1) + ay * -1;
		var py1 = parseFloat(this.y1) + ax;
		//normal vector 2
		var px2 = parseFloat(this.x2) + ay * -1;
		var py2 = parseFloat(this.y2) + ax;
				
		if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
			if (evt.type == "mousedown" && evt.detail == 1) {
				this.slideStatus = 1;
				svgroot.addEventListener("mousemove",this,false);
				svgroot.addEventListener("mouseup",this,false);
			}
			myNewPos = intersect2lines(this.x1,this.y1,this.x2,this.y2,myCoords["x"],myCoords["y"],myCoords["x"] + ay * -1,myCoords["y"] + ax);
			var myPercentage = toPolarDist(myNewPos['x'] - this.x1,myNewPos['y'] - this.y1) / this.length;
			this.value = this.value1 + myPercentage * (this.value2 - this.value1);
		}
		else {
			var myNewPos = new Array();
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 0) {
				//more than max
				this.value = this.value2;
				myNewPos['x'] = this.x2;
				myNewPos['y'] = this.y2;
			}
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 1 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
				//less than min
				this.value = this.value1;
				myNewPos['x'] = this.x1;
				myNewPos['y'] = this.y1;
			}
		}
		var myTransformString = "translate("+myNewPos['x']+","+myNewPos['y']+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
		document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
		this.getValue();
	}
	if (evt.type == "mouseup" && evt.detail == 1) {
		if (this.slideStatus == 1) {
			this.slideStatus = 2;
			svgroot.removeEventListener("mousemove",this,false);
			svgroot.removeEventListener("mouseup",this,false);
			this.getValue();
		}
		this.slideStatus = 0;
	}
}

//this code is executed, after the slider is released
//you can use switch/if to detect which slider was used (use this.sliderGroup) for that
slider.prototype.getValue = function() {
	if (this.slideStatus == 1 && this.mouseMoveBool == true) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('change','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
	if (this.slideStatus == 2) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('release','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
}	

//this is to set the value from other scripts
slider.prototype.setValue = function(value) {
	var myPercAlLine = (value - this.value1) / (this.value2 - this.value1);
	this.value = myPercAlLine;
	var myPosX = this.x1 + toRectX(this.direction,this.length * myPercAlLine);
	var myPosY = this.y1 + toRectY(this.direction,this.length * myPercAlLine);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
}	
/* slider.js */




/* mapApp.js */	
//holds data on window size
function mapApp() {
	if (!document.documentElement.getScreenCTM) {
		//initialize ratio
		this.resetFactors();
		//add resize event to document element
		document.documentElement.addEventListener("SVGResize",this,false);
	}
}

mapApp.prototype.handleEvent = function(evt) {
	if (evt.type == "SVGResize") {
		this.resetFactors();
	}
}

mapApp.prototype.resetFactors = function() {
	if (!document.documentElement.getScreenCTM) {
		//case for viewers that don't support .getScreenCTM, such as ASV3
		//calculate ratio and offset values of app window
		var viewBoxArray = document.documentElement.getAttributeNS(null,"viewBox").split(" ");
		var myRatio = viewBoxArray[2]/viewBoxArray[3];
		if ((window.innerWidth/window.innerHeight) > myRatio) { //case window is more wide than myRatio
			this.scaleFactor = viewBoxArray[3] / window.innerHeight;
		}
		else { //case window is more tall than myRatio
			this.scaleFactor = viewBoxArray[2] / window.innerWidth;
		}
		this.offsetX = (window.innerWidth - viewBoxArray[2] * 1 / this.scaleFactor) / 2;
		this.offsetY = (window.innerHeight - viewBoxArray[3] * 1 / this.scaleFactor) / 2;
	}
}

mapApp.prototype.calcCoord = function(coordx,coordy) {
	var coords = new Array();
	if (!document.documentElement.getScreenCTM) {
		//case ASV3 a. Corel
		coords["x"] = (coordx  - this.offsetX) * this.scaleFactor;
		coords["y"] = (coordy - this.offsetY) * this.scaleFactor;
	}
	else {
		matrix=document.documentElement.getScreenCTM();
		coords["x"]= matrix.inverse().a*coordx+matrix.inverse().c*coordy+matrix.inverse().e;
		coords["y"]= matrix.inverse().b*coordx+matrix.inverse().d*coordy+matrix.inverse().f;
	}
	return coords;
}
/* mapApp.js */	
	
		
/* checkbox.js */
function checkBoxScript(evt,myLayer) { //checkBox for toggling layers an contextMenue
	var myLayerObj = document.getElementById(myLayer);
	var myCheckCrossObj = document.getElementById("checkCross"+myLayer);
	var myCheckCrossVisibility = myCheckCrossObj.getAttributeNS(null,"visibility");
	//alert ( "chech" + myCheckCrossVisibility );
	if (evt.type == "click" && evt.detail == 1) {
		if (myCheckCrossVisibility == "visible") {
			myLayerObj.setAttributeNS(null,"visibility","hidden");
			myCheckCrossObj.setAttributeNS(null,"visibility","hidden");
			//you can do if/else or switch statements to set different actions on activating a checkbox here
			//myLayer holds the currentLayer name
			
		}
		else {
			myLayerObj.setAttributeNS(null,"visibility","visible");
			myCheckCrossObj.setAttributeNS(null,"visibility","visible");
			<BOUCLE_WMS_Check(SITES){titre_mot="WMS"}>
			if (myLayer == #ID_SYNDIC) getWMS(#ID_SYNDIC);
			</BOUCLE_WMS_Check>
		}
	}
}
/* checkbox.js */	
		
		
		
		var myMapApp = new mapApp();
		var myMainMap;
		var myRefMapDragger;
		var myZoomSlider;
		function init(evt) {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			myMainMap = new map("mainMap",[(#CALLAGE|worldfileWidth)],0,0.6,0,"m",true,"coordX","coordY",dynamicLayers,digiLayers,"");
			//slider properties: x1,y1,value1,x2,y2,value2,startValue,group in which to build the slider,color of slider
			//width of slider of sliderbar,width of invisible slider bar,width of visible slider
			myZoomSlider = new slider(710,70,myMainMap.minWidth,710,170,myMainMap.maxWidth,myMainMap.maxWidth,"mapZoomSlider","dimgray",2,10,"sliderSymbol","myRefMapDragger.resizeDragger",true);
			//set constraints to draggable rect in reference map
			myRefMapDragger = new dragObj("dragRectForRefMap","referenceMap","myDragCross",4750,true,"coordX","coordY",myMainMap);
			loadProjectSpecific();
		}
		function loadProjectSpecific() {
			//adopt width and height of map extent
			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			//adopt line width of park boundary
			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
			
			// Pour charger un claque WMS ... 
			<BOUCLE_WMS_evt(SITES){titre_mot="WMS"}>
			getWMS(#ID_SYNDIC);
			</BOUCLE_WMS_evt>
		}
		
		function openWin (id) {
			window.open(url, "info");
		}


		//load usgs/terraserver orthoimage
		//you have to use full pixel values, otherwise an error appears
		function getWMS(id) {
			// For each WMS server - loop on WMS website with keyword WMS
			switch (id){
			<BOUCLE_WMS_get(SITES){titre_mot="WMS"}>
				case #ID_SYNDIC:
					url = "#URL_SITE";
				break;
			</BOUCLE_WMS_get>
				default : return;
			}	
			
			var myRasterLayer = document.getElementById(id);
			
			if (myRasterLayer.childNodes.length > 0) {
				var oldImage = document.getElementById(id+"Image");
				myRasterLayer.removeChild(oldImage);
			}
			
			if (document.getElementById(id).getAttributeNS(null,"visibility") == "visible") {
				var myRasterImage = document.createElementNS(svgNS,"image");
				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
				myRasterImage.setAttributeNS(null,"id",id+"Image");
				//var myImageUrl = "http://www.sandre.fr/geo/wmszonage?Layers=CIBA&SRS=EPSG:27572&";
				var myImageUrl = url;

				// WMS are supposed to be Version 1.1.1, returning PNG file.
				myImageUrl += "&transparent=true&version=1.1.1&request=GetMap&service=WMS&BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
				myImageUrl  = myImageUrl.replace('&amp;',"&");
				//alert ("URL : "+myImageUrl);
				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
				myRasterLayer.appendChild(myRasterImage);
			}
		}		


]]></script>
	<defs>
	<!-- section for CSS stylesheet definitions -->
	<!-- you may globally adjust your styles here -->
	<style type="text/css"><![CDATA[
	.allText {font-family:Arial;fill:dimgray;}
	.titleText {font-size:22;font-weight:bold;}
	.subTitleText {font-size:18;font-weight:bold;}
	.normalText {font-size:15;}
	.smallText {font-size:12;}
	.boldText {font-weight:bold;}
	.centerText {text-anchor:middle;}
	.dragRect {fill:lightskyblue;stroke:none;opacity:0.4;}
	.dragSymbol {stroke:darkblue;}
	.normalLinestyle {fill:none;stroke:dimgray;}
	.background {fill:aliceblue;stroke:none;}
	.darkRectstyle {fill:dimgray;stroke:none;}
	.nofill {fill:none;}
	.whitefill {fill:white;}
	.normalfillcol {fill:dimgray;}
	.normallinecol {stroke:dimgray;}
	.nostroke {stroke:none;}
	.verythinline {stroke-width:1;}
	.thinline {stroke-width:1.5;}
	.normalline {stroke-width:2;}
	.mediumThickLine {stroke-width:5;}
  ]]></style>
		<!-- Symbols for checkboxes -->
		<symbol id="checkBoxRect" overflow="visible">
			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
		</symbol>
		<symbol id="checkBoxCross" overflow="visible" class="normallinecol nofill verythinline" pointer-events="none">
			<line x1="-5" y1="-5" x2="5" y2="5"/>
			<line x1="-5" y1="5" x2="5" y2="-5"/>
		</symbol>
		<!-- Symbols for Zoom Magnifyer glasses -->
		<symbol id="magnifyer" overflow="visible" class="whitefill normalline normallinecol">
			<line x1="0" y1="0" x2="-8" y2="20"/>
			<circle r="8"/>
		</symbol>
		<symbol id="magnifyerZoomOut" overflow="visible" class="whitefill normalline normallinecol">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<symbol id="magnifyerZoomIn" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" class="whitefill normalline normallinecol"/>
			<line x1="0" y1="-4" x2="0" y2="4" class="whitefill normalline normallinecol"/>
		</symbol>
		<symbol id="magnifyerFull" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<text y="4.5" class="allText smallText centerText boldText" pointer-events="none">F</text>
		</symbol>
		<symbol id="magnifyerManual" overflow="visible">
			<line x1="0" y1="0" x2="-8" y2="20" class="whitefill normalline normallinecol"/>
			<circle r="8" class="whitefill normalline normallinecol"/>
			<rect x="-3" y="-3" width="6" height="6" class="nofill thinline normallinecol" stroke-dasharray="1.5,1.5"/>
		</symbol>
		<symbol id="magnifyerZoomInWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0"/>
			<line x1="0" y1="-4" x2="0" y2="4"/>
		</symbol>
		<symbol id="magnifyerZoomOutWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<!-- hand symbol for panning -->
		<symbol id="symbPan" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<path class="normallinecol verythinline nofill" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
		</symbol>
		<!-- Symbol for Pan Arrows -->
		<symbol id="symbArrow" overflow="visible" class="nofill verythinline normallinecol" pointer-events="none">
			<polyline points="-3,-5 3,-5 3,1 5,1 0,5 -5,1 -3,1 -3,-5"/>
		</symbol>
		<!-- Symbol for Recentering Map -->
		<symbol id="symbRecenter" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<circle class="normalfillcol nostroke" cx="0" cy="0" r="1" pointer-events="none"/>
			<g class="normallinecol thinline nofill" pointer-events="none">
				<line x1="-7" y1="-7" x2="-3" y2="-3"/>
				<line x1="7" y1="7" x2="3" y2="3"/>
				<line x1="-7" y1="7" x2="-3" y2="3"/>
				<line x1="7" y1="-7" x2="3" y2="-3"/>
			</g>
		</symbol>
		<!-- Symbol for Slider -->
		<symbol id="sliderSymbol" overflow="visible" class="nofill mediumThickLine normallinecol" pointer-events="none">
			<line x1="0" y1="-5" x2="0" y2="5"/>
		</symbol>
		<!-- Symbol for Dragging if zoomed in far -->
		<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" class="nofill dragSymbol" pointer-events="none">
			<line x1="-7000" y1="0" x2="-2500" y2="0"/>
			<line x1="7000" y1="0" x2="2500" y2="0"/>
			<line x1="0" y1="-3300" x2="0" y2="-7800"/>
			<line x1="0" y1="3300" x2="0" y2="7800"/>
		</symbol>
		<!-- Marker for Extent-Arrows -->
		<marker id="myStartArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="-0.5,0 8,-2 8,2"/>
		</marker>
		<marker id="myEndArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
		</marker>
		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 


	</defs>
	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
	
	
	<!-- Main Map Frame -->
	<svg id="mainMap" x="0" y="15" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="553" height="[(#CALLAGE|getPropMapHeight{553})]">
		<!-- this group is necessary for manual panning, it temporarily gets a translate transformation which is later removed on mouseup -->
		<g id="mainMapGroup" transform="translate(0,0)">
			<!-- within this group you should place all map layers, usually, if you have more than one element in a map layer, you would use a group instead of a single element, as in this example -->
			<!-- Background image from spip-carto map -->
			<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]px" height="[(#CALLAGE|worldfileHeight)]px" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
			
			<!-- Background WMS -->
			// For each WMS server - loop on WMS website with keyword WMS
			<BOUCLE_WMS_layer(SITES){titre_mot="WMS"}>
				<g id="#ID_SYNDIC" visibility="hidden" />
			</BOUCLE_WMS_layer>

			<g id="spipCartoObj">
				<!-- Couche d'objets SPIP -->
				<B_objets>
				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" style="opacity:.6;"/></a><!-- style="fill:url(#MyGradient);"-->
				</BOUCLE_objets>
				</B_objets>	
			</g>
		</g>
	</svg>
	
	
	
	<!-- this group holds navigation, title and if you like, legend information -->
	<g>
		<!-- your map title -->
		<text class="allText titleText" x="580" y="30">#TITRE</text>
		<!-- coordinate display -->
		<g class="allText normalText">
			<text id="coordX" x="730" y="145">X:</text>
			<text id="coordY" x="730" y="160">Y:</text>
		</g>
		<!-- display width and height of map extent -->
		<g>
			<!-- vertical line, displays current height of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="561" y1="15" x2="561" y2="[(#CALLAGE|getPropMapHeight{575})]"/>
			<rect class="background" x="555" y="[(#CALLAGE|getPropMapHeight{230})]" width="12" height="100"/>
			<text id="myScaleTextH" class="allText normalText centerText" transform="translate(556,[(#CALLAGE|getPropMapHeight{280})]),rotate(90)">81,000 m</text>
			<!-- horizontal line, displays current width of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="0" y1="[(#CALLAGE|getPropMapHeight{583})]" x2="553.1" y2="[(#CALLAGE|getPropMapHeight{583})]"/>
			<rect class="background" x="236" y="[(#CALLAGE|getPropMapHeight{580})]" width="100" height="12"/>
			<text id="myScaleTextW" class="allText normalText centerText" transform="translate(277,[(#CALLAGE|getPropMapHeight{590})])">64,000 m</text>
			<!-- small rectangle in lower right corner, onclick displays current map extent in real world coordinates -->
			<rect class="darkRectstyle" x="558.5" y="[(#CALLAGE|getPropMapHeight{580})]" width="5" height="5" onclick="showExtent()" />
		</g>
		<!-- control map layer visibility with checkBoxes -->
		<g transform="translate(590 225)">
			<text class="allText subTitleText" x="-10" y="0">Calques :</text>
			<!-- first checkbox -->
			<g transform="translate(0 20)">
				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- second checkbox -->
			<g transform="translate(0 40)">
				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>

			<BOUCLE_WMS_guick(SITES){titre_mot="WMS"}{par nom_site}>
				<g transform="translate(0 [(#COMPTEUR_BOUCLE|guiPos{40})])">
				<use id="checkBox#ID_SYNDIC" xlink:href="#checkBoxRect" visibility="visible"
				onclick="checkBoxScript(evt,'#ID_SYNDIC');"/>
				<use id="checkCross#ID_SYNDIC" xlink:href="#checkBoxCross" 
				visibility="hidden"/>
				</g>
			</BOUCLE_WMS_guick>
			
			<!-- checkbox text labels -->
			<g class="allText normalText">
				<text x="12" y="26">Objets cartographiques</text>
				<text x="12" y="46">Image de fond</text>
				<BOUCLE_WMS_guilabel(SITES){titre_mot="WMS"}{par nom_site}>
				<text x="12" y="[(#COMPTEUR_BOUCLE|guiPos{46})]">[(#NOM_SITE|supprimer_numero)]</text>
				</BOUCLE_WMS_guilabel>		
			</g>
			
			
			
		</g>
		<!-- map impressum and status Bar -->
		<g text-rendering="optimizeLegibility">
			<!-- text with this id is required to show help texts -->
			<text id="statusText" class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{600})]">Info: </text>
			<text class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{620})]">Auteur: spip-carto, 2004</text>
			<text class="allText smallText" x="510" y="[(#CALLAGE|getPropMapHeight{620})]">Source: </text>
		</g>
	</g>
	<!-- small reference map, shares the same coordinate system than the main map -->
	<svg id="referenceMap" x="580" y="45" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="118.52" height="[(#CALLAGE|getPropMapHeight{118.52})]" onmousedown="myRefMapDragger.drag(evt)" onmousemove="myRefMapDragger.drag(evt)" onmouseup="myRefMapDragger.drag(evt)" onmouseout="myRefMapDragger.drag(evt)">
		<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
		<path pointer-events="none" style="fill:none;stroke:salmon;stroke-width:1000" d="M250528.8 -4218899.3l2380.5 -1305.3l1593.4 928.3l1326.1 -752.7l4218.1 -70.2l4072.3 -3965.5l5552.8 -1556.9l313 -1368.6l3042.8 -2535.6l1098.2 945.4l124.7 2135.2l2579.4 431.2l-22.8 1238l3516.2 779.5l-66.6 -1725.9l1001.7 -419l625.5 2735.2l1659.5 476.6l-330.2 1248.2l1330.8 747.9l-583.6 1341.1l1261.8 -103.1l285.3 729.8l1411.9 -2540.5l552.1 995.2l2360 129.9l1432.7 1622l2981.7 1123.5l2940.7 4333.1l-270.6 1128.2l792.4 1201.5l-1726.7 5827.8l785 2018.2l2160 2274.1l2083.2 772.6l-29.7 1587l2579.8 273.2l2903.1 2611.6l-1211.6 1736.7l-304 2424.3l1806.8 664.5l-952.3 432.8l228.8 1126.8l-1164.6 1204.8l1028.8 823.8l134.5 1768.4l-3601.7 2856.7l-1067.8 2250.5l-1294 1012.3l939.2 1643.7l-426.7 1493.5l-1730.1 1237.5l-1330.5 3254.3l-3443.5 3823l-1377.3 499.3l-1732.6 -647.3l-2658.4 9242.1l-2580.3 -63.8l-1626.7 1640.8l-11817 92.4l-111.4 4297.6l-745.7 11.6l-6670.9 -270.2l-1972.9 -5940.7l-1565.6 -523.5l821.7 -7022.1l-765 -!
 27.8l26.9 -795.4l742.7 19.8l74.1 -825.8l-2396.2 -52l748.7 -3186.1l-3846.4 -78l60.9 -5551.1l-1599 -53.4l110.1 -3306.4l-6584.6 -269.6l-573.6 -4908.1l-895.7 -69.6l-3.4 -3096.9l2384.7 -772.2l99.6 -1566.5l1598.9 3l268.3 -6583.2l-5123.5 -132.5l183.9 -10111.9l1168.6 -4214.1l-716.7 -975.6l1461.4 -2002.8l-593.4 -565.8l2659.9 -3238.9z" />
		<!-- rectangle that represents map extent -->
		<rect id="dragRectForRefMap" class="dragRect" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" pointer-events="none"/>
		<!-- if zoomed in very far, we display a cross-symbol here to indicate the map position in the reference map -->
		<use id="myDragCross" x="[(#CALLAGE|worldfileLRX)]" y="-[(#CALLAGE|worldfileHeight)]" xlink:href="#myDragCrossSymbol" visibility="hidden" />
	</svg>
	<!-- this group holds symbol instances for navigation tools -->
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider"/>
		<text class="allText subTitleText" x="735" y="55">Localisation</text>
		<!-- button for zoom-in, above slider -->
		<use x="710" y="55" xlink:href="#magnifyerZoomInWo" onclick="zoomIt(evt,'in');" onmouseover="magnify(evt,1.2,'in');" onmouseout="magnify(evt,1,'in');"/>
		<!-- button for zoom-out, below slider -->
		<use x="710" y="185" xlink:href="#magnifyerZoomOutWo" onclick="zoomIt(evt,'out');" onmouseover="magnify(evt,1.2,'out');" onmouseout="magnify(evt,1,'out');"/>
		<!-- button for full view (f) -->
		<use x="740" y="85" xlink:href="#magnifyerFull" onclick="zoomIt(evt,'full');" onmouseover="magnify(evt,1.2,'full');" onmouseout="magnify(evt,1,'full');"/>
		<!-- button for manual zoom (rectangle) -->
		<use x="770" y="85" xlink:href="#magnifyerManual" onclick="myMainMap.zoomManual(evt)" onmouseover="magnify(evt,1.2,'manual');" onmouseout="magnify(evt,1,'manual');"/>
		<!-- button for manual pan -->
		<use x="800" y="85" xlink:href="#symbPan" onclick="myMainMap.panManual(evt)" onmouseover="magnify(evt,1.2,'panmanual');" onmouseout="magnify(evt,1,'panmanual');"/>
		<!-- button for redefining map center -->
		<use xlink:href="#symbRecenter" x="830" y="85" onmouseover="magnify(evt,1.2,'recenter')" onmouseout="magnify(evt,1,'recenter')" onclick="myMainMap.recenter(evt)"/>
	</g>
</svg>
</BOUCLE_carte>




From fxp at berlios.de  Fri Jul  1 08:08:31 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:08:31 +0200
Subject: [Spip-carto-cvs] spipcarto carto_geosvgwms.php3,NONE,1.1
Message-ID: <200507010608.j6168VHf026307@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv26300

Added Files:
	carto_geosvgwms.php3 
Log Message:
Interface SVG avec connection WMS

--- NEW FILE: carto_geosvgwms.php3 ---
<?php

$fond = "carto_geosvgwms";
$delais = 24*3600;

include ("inc-public.php3");

?>



From fxp at berlios.de  Fri Jul  1 08:08:46 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:08:46 +0200
Subject: [Spip-carto-cvs] spipcarto carto_geosvgwmsfile.php3,NONE,1.1
Message-ID: <200507010608.j6168kHf026385@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv26379

Added Files:
	carto_geosvgwmsfile.php3 
Log Message:
Interface SVG avec connection WMS

--- NEW FILE: carto_geosvgwmsfile.php3 ---
<?php

$fond = "carto_geosvgwmsfile";
$delais = 24*3600;
// cette ligne empeche l'affichage des boutons d'administration
// Et les headers !!!!
$flag_preserver = true;
@header("Content-type: image/svg+xml");

include ("inc-public.php3");

?>



From fxp at berlios.de  Fri Jul  1 08:37:04 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:37:04 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvg.html,1.1,1.2
Message-ID: <200507010637.j616b4Hf005700@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv5639/squelettes/template

Modified Files:
	carto_geosvg.html 
Log Message:


Index: carto_geosvg.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvg.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_geosvg.html	30 Jun 2005 10:09:35 -0000	1.1
+++ carto_geosvg.html	1 Jul 2005 06:36:59 -0000	1.2
@@ -1,3 +1,3 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
-<embed src="carto_geosvgfile.php3?id_carto_carte=#ID_CARTO_CARTE" width="600px" height="400px" type="image/svg+xml" name="emap"/>
+<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=geosvgfile&" width="600px" height="400px" type="image/svg+xml" name="emap"/>
 </BOUCLE_carte>



From fxp at berlios.de  Fri Jul  1 08:37:24 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:37:24 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svg.html,1.1,1.2
Message-ID: <200507010637.j616bOHf005732@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv5724/squelettes/template

Modified Files:
	carto_svg.html 
Log Message:


Index: carto_svg.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svg.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_svg.html	30 Jun 2005 10:09:35 -0000	1.1
+++ carto_svg.html	1 Jul 2005 06:37:21 -0000	1.2
@@ -1,3 +1,3 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
-<embed src="carto_svgfile.php3?id_carto_carte=#ID_CARTO_CARTE" width="600px" height="400px" type="image/svg+xml" name="emap"/>
+<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfile&" width="600px" height="400px" type="image/svg+xml" name="emap"/>
 </BOUCLE_carte>



From fxp at berlios.de  Fri Jul  1 08:38:06 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:38:06 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgwms.html,NONE,1.1
Message-ID: <200507010638.j616c6Hf005803@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv5794/squelettes/template

Added Files:
	carto_geosvgwms.html 
Log Message:


--- NEW FILE: carto_geosvgwms.html ---
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=geosvgwmsfile&" width="600px" height="400px" type="image/svg+xml" name="emap"/>
</BOUCLE_carte>



From fxp at berlios.de  Fri Jul  1 08:38:25 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 08:38:25 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgwmsfile.html,NONE,1.1
Message-ID: <200507010638.j616cPHf005837@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv5822/squelettes/template

Added Files:
	carto_geosvgwmsfile.html 
Log Message:


--- NEW FILE: carto_geosvgwmsfile.html ---
<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<svg width="100%" height="100%" viewBox="0 0 850 590" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
	<script type="text/ecmascript" xlink:href="helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="navigation.js"/>
	<script type="text/ecmascript"><![CDATA[


/* slider.js */
//slider properties
function slider(x1,y1,value1,x2,y2,value2,startVal,sliderGroupId,sliderColor,visSliderWidth,invisSliderWidth,sliderSymb,functionToCall,mouseMoveBool) {
	this.x1 = x1;
	this.y1 = y1;
	this.value1 = value1;
	this.x2 = x2;
	this.y2 = y2;
	this.value2 = value2;
	this.startVal = startVal;
	this.value = startVal;
	this.sliderGroupId = sliderGroupId;
	this.sliderGroup = document.getElementById(this.sliderGroupId);
	this.sliderColor = sliderColor;
	this.visSliderWidth = visSliderWidth;
	this.invisSliderWidth = invisSliderWidth;
	this.sliderSymb = sliderSymb;
	this.functionToCall = functionToCall;
	this.mouseMoveBool = mouseMoveBool;
	this.length = toPolarDist((this.x2 - this.x1),(this.y2 - this.y1));
	this.direction = toPolarDir((this.x2 - this.x1),(this.y2 - this.y1));
	this.createSlider();
	this.slideStatus = 0;
	this.ctm = getTransformToRootElement(this.sliderGroup).inverse();
}

//create slider
slider.prototype.createSlider = function() {
	var mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.invisSliderWidth);
	mySliderLine.setAttributeNS(null,"opacity","0");
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_invisibleSliderLine");
	mySliderLine.addEventListener("mousedown",this,false);
	this.sliderGroup.appendChild(mySliderLine);
	mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.visSliderWidth);
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_visibleSliderLine");
	mySliderLine.setAttributeNS(null,"pointer-events","none");
	this.sliderGroup.appendChild(mySliderLine);
	mySliderSymb = document.createElementNS(svgNS,"use");
	mySliderSymb.setAttributeNS(xlinkNS,"xlink:href","#"+this.sliderSymb);
	var myStartDistance = this.length - ((this.value2 - this.startVal) / (this.value2 - this.value1)) * this.length;
	var myPosX = this.x1 + toRectX(this.direction,myStartDistance);
	var myPosY = this.y1 + toRectY(this.direction,myStartDistance);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	mySliderSymb.setAttributeNS(null,"transform",myTransformString);
	mySliderSymb.setAttributeNS(null,"id",this.sliderGroupId+"_sliderSymbol");
	this.sliderGroup.appendChild(mySliderSymb);
}

//remove all slider elements
slider.prototype.removeSlider = function() {
    var mySliderSymb = document.getElementById(this.sliderGroup+"_sliderSymbol");
	this.sliderGroup.removeChild(mySliderSymb);
    var mySliderLine = document.getElementById(this.sliderGroup+"_visibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
    var mySliderLine = document.getElementById(this.sliderGroup+"_invisibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
}

//handle events
slider.prototype.handleEvent = function(evt) {
	this.drag(evt);
}

//drag slider
slider.prototype.drag = function(evt) {
	var svgroot = document.documentElement;
	if (evt.type == "mousedown" || (evt.type == "mousemove" && this.slideStatus == 1)) {
		var myCoords = myMapApp.calcCoord(evt.clientX,evt.clientY);
		//undo the effect of transformations
		var mySVGPoint = svgroot.createSVGPoint();
		mySVGPoint.x = myCoords["x"];
		mySVGPoint.y = myCoords["y"];
		mySVGPoint = mySVGPoint.matrixTransform(this.ctm);
		myCoords["x"] = mySVGPoint.x;
		myCoords["y"] = mySVGPoint.y;
	
		//draw normal line for first vertex
		var ax = this.x2 - this.x1;
		var ay = this.y2 - this.y1;
		//normal vector 1
		var px1 = parseFloat(this.x1) + ay * -1;
		var py1 = parseFloat(this.y1) + ax;
		//normal vector 2
		var px2 = parseFloat(this.x2) + ay * -1;
		var py2 = parseFloat(this.y2) + ax;
				
		if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
			if (evt.type == "mousedown" && evt.detail == 1) {
				this.slideStatus = 1;
				svgroot.addEventListener("mousemove",this,false);
				svgroot.addEventListener("mouseup",this,false);
			}
			myNewPos = intersect2lines(this.x1,this.y1,this.x2,this.y2,myCoords["x"],myCoords["y"],myCoords["x"] + ay * -1,myCoords["y"] + ax);
			var myPercentage = toPolarDist(myNewPos['x'] - this.x1,myNewPos['y'] - this.y1) / this.length;
			this.value = this.value1 + myPercentage * (this.value2 - this.value1);
		}
		else {
			var myNewPos = new Array();
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 0) {
				//more than max
				this.value = this.value2;
				myNewPos['x'] = this.x2;
				myNewPos['y'] = this.y2;
			}
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 1 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
				//less than min
				this.value = this.value1;
				myNewPos['x'] = this.x1;
				myNewPos['y'] = this.y1;
			}
		}
		var myTransformString = "translate("+myNewPos['x']+","+myNewPos['y']+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
		document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
		this.getValue();
	}
	if (evt.type == "mouseup" && evt.detail == 1) {
		if (this.slideStatus == 1) {
			this.slideStatus = 2;
			svgroot.removeEventListener("mousemove",this,false);
			svgroot.removeEventListener("mouseup",this,false);
			this.getValue();
		}
		this.slideStatus = 0;
	}
}

//this code is executed, after the slider is released
//you can use switch/if to detect which slider was used (use this.sliderGroup) for that
slider.prototype.getValue = function() {
	if (this.slideStatus == 1 && this.mouseMoveBool == true) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('change','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
	if (this.slideStatus == 2) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('release','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
}	

//this is to set the value from other scripts
slider.prototype.setValue = function(value) {
	var myPercAlLine = (value - this.value1) / (this.value2 - this.value1);
	this.value = myPercAlLine;
	var myPosX = this.x1 + toRectX(this.direction,this.length * myPercAlLine);
	var myPosY = this.y1 + toRectY(this.direction,this.length * myPercAlLine);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
}	
/* slider.js */




/* mapApp.js */	
//holds data on window size
function mapApp() {
	if (!document.documentElement.getScreenCTM) {
		//initialize ratio
		this.resetFactors();
		//add resize event to document element
		document.documentElement.addEventListener("SVGResize",this,false);
	}
}

mapApp.prototype.handleEvent = function(evt) {
	if (evt.type == "SVGResize") {
		this.resetFactors();
	}
}

mapApp.prototype.resetFactors = function() {
	if (!document.documentElement.getScreenCTM) {
		//case for viewers that don't support .getScreenCTM, such as ASV3
		//calculate ratio and offset values of app window
		var viewBoxArray = document.documentElement.getAttributeNS(null,"viewBox").split(" ");
		var myRatio = viewBoxArray[2]/viewBoxArray[3];
		if ((window.innerWidth/window.innerHeight) > myRatio) { //case window is more wide than myRatio
			this.scaleFactor = viewBoxArray[3] / window.innerHeight;
		}
		else { //case window is more tall than myRatio
			this.scaleFactor = viewBoxArray[2] / window.innerWidth;
		}
		this.offsetX = (window.innerWidth - viewBoxArray[2] * 1 / this.scaleFactor) / 2;
		this.offsetY = (window.innerHeight - viewBoxArray[3] * 1 / this.scaleFactor) / 2;
	}
}

mapApp.prototype.calcCoord = function(coordx,coordy) {
	var coords = new Array();
	if (!document.documentElement.getScreenCTM) {
		//case ASV3 a. Corel
		coords["x"] = (coordx  - this.offsetX) * this.scaleFactor;
		coords["y"] = (coordy - this.offsetY) * this.scaleFactor;
	}
	else {
		matrix=document.documentElement.getScreenCTM();
		coords["x"]= matrix.inverse().a*coordx+matrix.inverse().c*coordy+matrix.inverse().e;
		coords["y"]= matrix.inverse().b*coordx+matrix.inverse().d*coordy+matrix.inverse().f;
	}
	return coords;
}
/* mapApp.js */	
	
		
/* checkbox.js */
function checkBoxScript(evt,myLayer) { //checkBox for toggling layers an contextMenue
	var myLayerObj = document.getElementById(myLayer);
	var myCheckCrossObj = document.getElementById("checkCross"+myLayer);
	var myCheckCrossVisibility = myCheckCrossObj.getAttributeNS(null,"visibility");
	//alert ( "chech" + myCheckCrossVisibility );
	if (evt.type == "click" && evt.detail == 1) {
		if (myCheckCrossVisibility == "visible") {
			myLayerObj.setAttributeNS(null,"visibility","hidden");
			myCheckCrossObj.setAttributeNS(null,"visibility","hidden");
			//you can do if/else or switch statements to set different actions on activating a checkbox here
			//myLayer holds the currentLayer name
			
		}
		else {
			myLayerObj.setAttributeNS(null,"visibility","visible");
			myCheckCrossObj.setAttributeNS(null,"visibility","visible");
			<BOUCLE_WMS_Check(SITES){titre_mot="WMS"}>
			if (myLayer == #ID_SYNDIC) getWMS(#ID_SYNDIC);
			</BOUCLE_WMS_Check>
		}
	}
}
/* checkbox.js */	
		
		
		
		var myMapApp = new mapApp();
		var myMainMap;
		var myRefMapDragger;
		var myZoomSlider;
		function init(evt) {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			myMainMap = new map("mainMap",[(#CALLAGE|worldfileWidth)],0,0.6,0,"m",true,"coordX","coordY",dynamicLayers,digiLayers,"");
			//slider properties: x1,y1,value1,x2,y2,value2,startValue,group in which to build the slider,color of slider
			//width of slider of sliderbar,width of invisible slider bar,width of visible slider
			myZoomSlider = new slider(710,70,myMainMap.minWidth,710,170,myMainMap.maxWidth,myMainMap.maxWidth,"mapZoomSlider","dimgray",2,10,"sliderSymbol","myRefMapDragger.resizeDragger",true);
			//set constraints to draggable rect in reference map
			myRefMapDragger = new dragObj("dragRectForRefMap","referenceMap","myDragCross",4750,true,"coordX","coordY",myMainMap);
			loadProjectSpecific();
		}
		function loadProjectSpecific() {
			//adopt width and height of map extent
			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			//adopt line width of park boundary
			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
			
			// Pour charger un claque WMS ... 
			<BOUCLE_WMS_evt(SITES){titre_mot="WMS"}>
			getWMS(#ID_SYNDIC);
			</BOUCLE_WMS_evt>
		}
		
		function openWin (id) {
			window.open(url, "info");
		}


		//load usgs/terraserver orthoimage
		//you have to use full pixel values, otherwise an error appears
		function getWMS(id) {
			// For each WMS server - loop on WMS website with keyword WMS
			switch (id){
			<BOUCLE_WMS_get(SITES){titre_mot="WMS"}>
				case #ID_SYNDIC:
					url = "#URL_SITE";
				break;
			</BOUCLE_WMS_get>
				default : return;
			}	
			
			var myRasterLayer = document.getElementById(id);
			
			if (myRasterLayer.childNodes.length > 0) {
				var oldImage = document.getElementById(id+"Image");
				myRasterLayer.removeChild(oldImage);
			}
			
			if (document.getElementById(id).getAttributeNS(null,"visibility") == "visible") {
				var myRasterImage = document.createElementNS(svgNS,"image");
				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
				myRasterImage.setAttributeNS(null,"id",id+"Image");
				//var myImageUrl = "http://www.sandre.fr/geo/wmszonage?Layers=CIBA&SRS=EPSG:27572&";
				var myImageUrl = url;

				// WMS are supposed to be Version 1.1.1, returning PNG file.
				myImageUrl += "&transparent=true&version=1.1.1&request=GetMap&service=WMS&BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
				myImageUrl  = myImageUrl.replace('&amp;',"&");
				//alert ("URL : "+myImageUrl);
				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
				myRasterLayer.appendChild(myRasterImage);
			}
		}		


]]></script>
	<defs>
	<!-- section for CSS stylesheet definitions -->
	<!-- you may globally adjust your styles here -->
	<style type="text/css"><![CDATA[
	.allText {font-family:Arial;fill:dimgray;}
	.titleText {font-size:22;font-weight:bold;}
	.subTitleText {font-size:18;font-weight:bold;}
	.normalText {font-size:15;}
	.smallText {font-size:12;}
	.boldText {font-weight:bold;}
	.centerText {text-anchor:middle;}
	.dragRect {fill:lightskyblue;stroke:none;opacity:0.4;}
	.dragSymbol {stroke:darkblue;}
	.normalLinestyle {fill:none;stroke:dimgray;}
	.background {fill:aliceblue;stroke:none;}
	.darkRectstyle {fill:dimgray;stroke:none;}
	.nofill {fill:none;}
	.whitefill {fill:white;}
	.normalfillcol {fill:dimgray;}
	.normallinecol {stroke:dimgray;}
	.nostroke {stroke:none;}
	.verythinline {stroke-width:1;}
	.thinline {stroke-width:1.5;}
	.normalline {stroke-width:2;}
	.mediumThickLine {stroke-width:5;}
  ]]></style>
		<!-- Symbols for checkboxes -->
		<symbol id="checkBoxRect" overflow="visible">
			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
		</symbol>
		<symbol id="checkBoxCross" overflow="visible" class="normallinecol nofill verythinline" pointer-events="none">
			<line x1="-5" y1="-5" x2="5" y2="5"/>
			<line x1="-5" y1="5" x2="5" y2="-5"/>
		</symbol>
		<!-- Symbols for Zoom Magnifyer glasses -->
		<symbol id="magnifyer" overflow="visible" class="whitefill normalline normallinecol">
			<line x1="0" y1="0" x2="-8" y2="20"/>
			<circle r="8"/>
		</symbol>
		<symbol id="magnifyerZoomOut" overflow="visible" class="whitefill normalline normallinecol">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<symbol id="magnifyerZoomIn" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" class="whitefill normalline normallinecol"/>
			<line x1="0" y1="-4" x2="0" y2="4" class="whitefill normalline normallinecol"/>
		</symbol>
		<symbol id="magnifyerFull" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<text y="4.5" class="allText smallText centerText boldText" pointer-events="none">F</text>
		</symbol>
		<symbol id="magnifyerManual" overflow="visible">
			<line x1="0" y1="0" x2="-8" y2="20" class="whitefill normalline normallinecol"/>
			<circle r="8" class="whitefill normalline normallinecol"/>
			<rect x="-3" y="-3" width="6" height="6" class="nofill thinline normallinecol" stroke-dasharray="1.5,1.5"/>
		</symbol>
		<symbol id="magnifyerZoomInWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0"/>
			<line x1="0" y1="-4" x2="0" y2="4"/>
		</symbol>
		<symbol id="magnifyerZoomOutWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<!-- hand symbol for panning -->
		<symbol id="symbPan" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<path class="normallinecol verythinline nofill" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
		</symbol>
		<!-- Symbol for Pan Arrows -->
		<symbol id="symbArrow" overflow="visible" class="nofill verythinline normallinecol" pointer-events="none">
			<polyline points="-3,-5 3,-5 3,1 5,1 0,5 -5,1 -3,1 -3,-5"/>
		</symbol>
		<!-- Symbol for Recentering Map -->
		<symbol id="symbRecenter" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<circle class="normalfillcol nostroke" cx="0" cy="0" r="1" pointer-events="none"/>
			<g class="normallinecol thinline nofill" pointer-events="none">
				<line x1="-7" y1="-7" x2="-3" y2="-3"/>
				<line x1="7" y1="7" x2="3" y2="3"/>
				<line x1="-7" y1="7" x2="-3" y2="3"/>
				<line x1="7" y1="-7" x2="3" y2="-3"/>
			</g>
		</symbol>
		<!-- Symbol for Slider -->
		<symbol id="sliderSymbol" overflow="visible" class="nofill mediumThickLine normallinecol" pointer-events="none">
			<line x1="0" y1="-5" x2="0" y2="5"/>
		</symbol>
		<!-- Symbol for Dragging if zoomed in far -->
		<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" class="nofill dragSymbol" pointer-events="none">
			<line x1="-7000" y1="0" x2="-2500" y2="0"/>
			<line x1="7000" y1="0" x2="2500" y2="0"/>
			<line x1="0" y1="-3300" x2="0" y2="-7800"/>
			<line x1="0" y1="3300" x2="0" y2="7800"/>
		</symbol>
		<!-- Marker for Extent-Arrows -->
		<marker id="myStartArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="-0.5,0 8,-2 8,2"/>
		</marker>
		<marker id="myEndArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
		</marker>
		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 


	</defs>
	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
	
	
	<!-- Main Map Frame -->
	<svg id="mainMap" x="0" y="15" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="553" height="[(#CALLAGE|getPropMapHeight{553})]">
		<!-- this group is necessary for manual panning, it temporarily gets a translate transformation which is later removed on mouseup -->
		<g id="mainMapGroup" transform="translate(0,0)">
			<!-- within this group you should place all map layers, usually, if you have more than one element in a map layer, you would use a group instead of a single element, as in this example -->
			<!-- Background image from spip-carto map -->
			<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]px" height="[(#CALLAGE|worldfileHeight)]px" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
			
			<!-- Background WMS -->
			// For each WMS server - loop on WMS website with keyword WMS
			<BOUCLE_WMS_layer(SITES){titre_mot="WMS"}>
				<g id="#ID_SYNDIC" visibility="hidden" />
			</BOUCLE_WMS_layer>

			<g id="spipCartoObj">
				<!-- Couche d'objets SPIP -->
				<B_objets>
				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" style="opacity:.6;"/></a><!-- style="fill:url(#MyGradient);"-->
				</BOUCLE_objets>
				</B_objets>	
			</g>
		</g>
	</svg>
	
	
	
	<!-- this group holds navigation, title and if you like, legend information -->
	<g>
		<!-- your map title -->
		<text class="allText titleText" x="580" y="30">#TITRE</text>
		<!-- coordinate display -->
		<g class="allText normalText">
			<text id="coordX" x="730" y="145">X:</text>
			<text id="coordY" x="730" y="160">Y:</text>
		</g>
		<!-- display width and height of map extent -->
		<g>
			<!-- vertical line, displays current height of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="561" y1="15" x2="561" y2="[(#CALLAGE|getPropMapHeight{575})]"/>
			<rect class="background" x="555" y="[(#CALLAGE|getPropMapHeight{230})]" width="12" height="100"/>
			<text id="myScaleTextH" class="allText normalText centerText" transform="translate(556,[(#CALLAGE|getPropMapHeight{280})]),rotate(90)">81,000 m</text>
			<!-- horizontal line, displays current width of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="0" y1="[(#CALLAGE|getPropMapHeight{583})]" x2="553.1" y2="[(#CALLAGE|getPropMapHeight{583})]"/>
			<rect class="background" x="236" y="[(#CALLAGE|getPropMapHeight{580})]" width="100" height="12"/>
			<text id="myScaleTextW" class="allText normalText centerText" transform="translate(277,[(#CALLAGE|getPropMapHeight{590})])">64,000 m</text>
			<!-- small rectangle in lower right corner, onclick displays current map extent in real world coordinates -->
			<rect class="darkRectstyle" x="558.5" y="[(#CALLAGE|getPropMapHeight{580})]" width="5" height="5" onclick="showExtent()" />
		</g>
		<!-- control map layer visibility with checkBoxes -->
		<g transform="translate(590 225)">
			<text class="allText subTitleText" x="-10" y="0">Calques :</text>
			<!-- first checkbox -->
			<g transform="translate(0 20)">
				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- second checkbox -->
			<g transform="translate(0 40)">
				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>

			<BOUCLE_WMS_guick(SITES){titre_mot="WMS"}{par nom_site}>
				<g transform="translate(0 [(#COMPTEUR_BOUCLE|guiPos{40})])">
				<use id="checkBox#ID_SYNDIC" xlink:href="#checkBoxRect" visibility="visible"
				onclick="checkBoxScript(evt,'#ID_SYNDIC');"/>
				<use id="checkCross#ID_SYNDIC" xlink:href="#checkBoxCross" 
				visibility="hidden"/>
				</g>
			</BOUCLE_WMS_guick>
			
			<!-- checkbox text labels -->
			<g class="allText normalText">
				<text x="12" y="26">Objets cartographiques</text>
				<text x="12" y="46">Image de fond</text>
				<BOUCLE_WMS_guilabel(SITES){titre_mot="WMS"}{par nom_site}>
				<text x="12" y="[(#COMPTEUR_BOUCLE|guiPos{46})]">[(#NOM_SITE|supprimer_numero)]</text>
				</BOUCLE_WMS_guilabel>		
			</g>
			
			
			
		</g>
		<!-- map impressum and status Bar -->
		<g text-rendering="optimizeLegibility">
			<!-- text with this id is required to show help texts -->
			<text id="statusText" class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{600})]">Info: </text>
			<text class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{620})]">Auteur: spip-carto, 2004</text>
			<text class="allText smallText" x="510" y="[(#CALLAGE|getPropMapHeight{620})]">Source: </text>
		</g>
	</g>
	<!-- small reference map, shares the same coordinate system than the main map -->
	<svg id="referenceMap" x="580" y="45" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="118.52" height="[(#CALLAGE|getPropMapHeight{118.52})]" onmousedown="myRefMapDragger.drag(evt)" onmousemove="myRefMapDragger.drag(evt)" onmouseup="myRefMapDragger.drag(evt)" onmouseout="myRefMapDragger.drag(evt)">
		<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
		<path pointer-events="none" style="fill:none;stroke:salmon;stroke-width:1000" d="M250528.8 -4218899.3l2380.5 -1305.3l1593.4 928.3l1326.1 -752.7l4218.1 -70.2l4072.3 -3965.5l5552.8 -1556.9l313 -1368.6l3042.8 -2535.6l1098.2 945.4l124.7 2135.2l2579.4 431.2l-22.8 1238l3516.2 779.5l-66.6 -1725.9l1001.7 -419l625.5 2735.2l1659.5 476.6l-330.2 1248.2l1330.8 747.9l-583.6 1341.1l1261.8 -103.1l285.3 729.8l1411.9 -2540.5l552.1 995.2l2360 129.9l1432.7 1622l2981.7 1123.5l2940.7 4333.1l-270.6 1128.2l792.4 1201.5l-1726.7 5827.8l785 2018.2l2160 2274.1l2083.2 772.6l-29.7 1587l2579.8 273.2l2903.1 2611.6l-1211.6 1736.7l-304 2424.3l1806.8 664.5l-952.3 432.8l228.8 1126.8l-1164.6 1204.8l1028.8 823.8l134.5 1768.4l-3601.7 2856.7l-1067.8 2250.5l-1294 1012.3l939.2 1643.7l-426.7 1493.5l-1730.1 1237.5l-1330.5 3254.3l-3443.5 3823l-1377.3 499.3l-1732.6 -647.3l-2658.4 9242.1l-2580.3 -63.8l-1626.7 1640.8l-11817 92.4l-111.4 4297.6l-745.7 11.6l-6670.9 -270.2l-1972.9 -5940.7l-1565.6 -523.5l821.7 -7022.1l-765 -!
 27.8l26.9 -795.4l742.7 19.8l74.1 -825.8l-2396.2 -52l748.7 -3186.1l-3846.4 -78l60.9 -5551.1l-1599 -53.4l110.1 -3306.4l-6584.6 -269.6l-573.6 -4908.1l-895.7 -69.6l-3.4 -3096.9l2384.7 -772.2l99.6 -1566.5l1598.9 3l268.3 -6583.2l-5123.5 -132.5l183.9 -10111.9l1168.6 -4214.1l-716.7 -975.6l1461.4 -2002.8l-593.4 -565.8l2659.9 -3238.9z" />
		<!-- rectangle that represents map extent -->
		<rect id="dragRectForRefMap" class="dragRect" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" pointer-events="none"/>
		<!-- if zoomed in very far, we display a cross-symbol here to indicate the map position in the reference map -->
		<use id="myDragCross" x="[(#CALLAGE|worldfileLRX)]" y="-[(#CALLAGE|worldfileHeight)]" xlink:href="#myDragCrossSymbol" visibility="hidden" />
	</svg>
	<!-- this group holds symbol instances for navigation tools -->
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider"/>
		<text class="allText subTitleText" x="735" y="55">Localisation</text>
		<!-- button for zoom-in, above slider -->
		<use x="710" y="55" xlink:href="#magnifyerZoomInWo" onclick="zoomIt(evt,'in');" onmouseover="magnify(evt,1.2,'in');" onmouseout="magnify(evt,1,'in');"/>
		<!-- button for zoom-out, below slider -->
		<use x="710" y="185" xlink:href="#magnifyerZoomOutWo" onclick="zoomIt(evt,'out');" onmouseover="magnify(evt,1.2,'out');" onmouseout="magnify(evt,1,'out');"/>
		<!-- button for full view (f) -->
		<use x="740" y="85" xlink:href="#magnifyerFull" onclick="zoomIt(evt,'full');" onmouseover="magnify(evt,1.2,'full');" onmouseout="magnify(evt,1,'full');"/>
		<!-- button for manual zoom (rectangle) -->
		<use x="770" y="85" xlink:href="#magnifyerManual" onclick="myMainMap.zoomManual(evt)" onmouseover="magnify(evt,1.2,'manual');" onmouseout="magnify(evt,1,'manual');"/>
		<!-- button for manual pan -->
		<use x="800" y="85" xlink:href="#symbPan" onclick="myMainMap.panManual(evt)" onmouseover="magnify(evt,1.2,'panmanual');" onmouseout="magnify(evt,1,'panmanual');"/>
		<!-- button for redefining map center -->
		<use xlink:href="#symbRecenter" x="830" y="85" onmouseover="magnify(evt,1.2,'recenter')" onmouseout="magnify(evt,1,'recenter')" onclick="myMainMap.recenter(evt)"/>
	</g>
</svg>
</BOUCLE_carte>




From fxp at berlios.de  Fri Jul  1 09:05:34 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 09:05:34 +0200
Subject: [Spip-carto-cvs] spipcarto carto.php3,1.4,1.5
Message-ID: <200507010705.j6175YHf030787@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv30776

Modified Files:
	carto.php3 
Log Message:


Index: carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carto.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ carto.php3	1 Jul 2005 07:05:31 -0000	1.5
@@ -10,6 +10,11 @@
 		die ("Faut pas se gener");
 	}
 
+// cette ligne empeche l'affichage des boutons d'administration
+// Et les headers !!!! 
+$flag_preserver = true;
+
+
 if (isset($contexte_inclus['fond'])) $fond = $rep_fond."/carto_".$contexte_inclus['fond'];
 else if (isset($_GET["fond"])&&($_GET["fond"]!="")) $fond = $rep_fond."/carto_".$_GET["fond"];
 else $fond = $rep_fond."/carto";



From fxp at berlios.de  Fri Jul  1 09:07:53 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Fri, 1 Jul 2005 09:07:53 +0200
Subject: [Spip-carto-cvs] spipcarto mes_fonctions.php3,1.9,1.10
Message-ID: <200507010707.j6177rHf031047@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv31040

Modified Files:
	mes_fonctions.php3 
Log Message:


Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -d -r1.9 -r1.10
--- mes_fonctions.php3	11 May 2005 10:17:20 -0000	1.9
+++ mes_fonctions.php3	1 Jul 2005 07:07:51 -0000	1.10
@@ -3,6 +3,10 @@
 
 
 
+function guiPos ($compteur, $offset){
+	return $offset+$compteur*20;
+}
+
 
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////



From stef at berlios.de  Mon Jul  4 11:15:35 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 4 Jul 2005 11:15:35 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.3,1.4
Message-ID: <200507040915.j649FZqX005360@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv5335/ecrire

Modified Files:
	mes_options.php3 
Log Message:
Integration mots-partout

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- mes_options.php3	29 Mar 2005 15:28:11 -0000	1.3
+++ mes_options.php3	4 Jul 2005 09:15:33 -0000	1.4
@@ -215,4 +215,102 @@
     return avant_typo_carto($texte);
 }
 
+//======================================================================
+// Integration contrib mots partout (Mortimer)
+//======================================================================
+$choses_possibles['carto_objets'] = array(
+									  'titre_chose' => 'Objets',
+									  'id_chose' => 'id_carto_objet',
+									  'table_principale' => 'spip_carto_objets',
+									  
+									  'table_carte' => 'spip_carto_cartes',
+									  'tables_limite' => array(
+															   'carto_objets' => array(
+																				   'table' => 'spip_carto_objets',
+																				   'nom_id' => 'id_carto_objet'),
+															   'carto_cartes' => array(
+																					'table' => 'spip_carto_objets',
+																					'nom_id' =>  'id_carto_carte'),
+															   )
+									  );
+
+function afficher_liste_carto_objets($choses) {
+  echo "<div style='height: 12px;'></div>";
+  echo "<div class='liste'>";
+  bandeau_titre_boite2($titre_table, "carte-24.gif");
+  
+  echo afficher_liste_debut_tableau();
+  
+  $from = array('spip_carto_objets as carto_objets');
+  $select= array();
+  $select[] = 'id_carto_objet';
+  $select[] = 'titre';
+  $select[] = 'url_objet';
+  $select[] ='id_carto_carte';
+//  $select[] = 'statut';
+  $where = array('carto_objets.id_carto_objet IN ('.calcul_in($choses).')');
+  
+  $result = spip_abstract_select($select,$from,$where);
+  $i = 0;
+  while ($row = spip_abstract_fetch($result)) {
+	$i++;
+	$vals = '';
+	
+	$id_carto_objet = $row['id_carto_objet'];
+	$tous_id[] = $id_carto_objet;
+	$titre = $row['titre'];
+	$id_carto_carte = $row['id_carto_carte'];
+	$url_objet = $row['url_objet'];
+	
+	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_carto_objet' id='id_chose$i'/>";
+	
+	// Le titre (et la langue)
+	$s = "<div>";
+	
+	$s .= "<a href=\"carto_cartes.php3?id_carto_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
+	
+	$s .= typo($titre);
+	$s .= "</a>";
+	$s .= "</div>";
+	
+	$vals[] = $s;
+	
+	// L'url
+	$s = "<a href=\"$url_objet\" style=\"display:block;\">lien</a>";
+	$vals[] = $s;
+	
+	// Le numero (moche)
+	if ($options == "avancees") {
+	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_carto_objet</b>";
+	}
+	
+	
+	$table[] = $vals;
+  }
+  spip_free_result($result);
+  
+  if ($options == "avancees") { // Afficher le numero (JMB)
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 80, 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	}
+  } else {
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 100, 100);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100);
+	  $styles = array('', 'arial2', 'arial1');
+	}
+  }
+  afficher_liste($largeurs, $table, $styles);
+  
+  echo afficher_liste_fin_tableau();
+}
+
+//======================================================================
+
 ?>



From stef at berlios.de  Mon Jul  4 11:25:16 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 4 Jul 2005 11:25:16 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.11,1.12
Message-ID: <200507040925.j649PGqX005896@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv5869/ecrire

Modified Files:
	carte_edit.php3 
Log Message:
preview svg (squelette svg pas svg2)
suppression des depliants sur les objets

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.11
retrieving revision 1.12
diff -u -d -r1.11 -r1.12
--- carte_edit.php3	30 Jun 2005 10:09:39 -0000	1.11
+++ carte_edit.php3	4 Jul 2005 09:25:14 -0000	1.12
@@ -163,7 +163,7 @@
 if ($url_carte && ($new!="oui")) icone_horizontale( _T('previsualiser'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec logos'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec liens'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
-if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg2&var_mode=recalcul", "racine-24.gif", "rien.gif");
+if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec geosvg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvg&var_mode=recalcul", "racine-24.gif", "rien.gif");
 
 echo "</div>\n";
@@ -381,10 +381,10 @@
 			debut_cadre_relief();
 			echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
 			
-			echo $visible ? bouton_block_visible("objet_$id_objet") : bouton_block_invisible("objet_$id_objet");
+//			echo $visible ? bouton_block_visible("objet_$id_objet") : bouton_block_invisible("objet_$id_objet");
 			echo "<strong>".$titre_objet."</strong>";
 			echo "<br /></div>";
-			echo $visible ? debut_block_visible("objet_$id_objet") : debut_block_invisible("objet_$id_objet");
+//			echo $visible ? debut_block_visible("objet_$id_objet") : debut_block_invisible("objet_$id_objet");
 				
 				// Modifier un objet
 				$link = $carte_link;
@@ -492,7 +492,7 @@
 				icone_horizontale(_L("Supprimer cet objet"), $link->getUrl('objets'), "carte-24.gif", "supprimer.gif");
 				echo "</div>\n";
 				
-				echo fin_block();
+//				echo fin_block();
 				fin_cadre_relief();
 			}
 		}



From fxp at berlios.de  Mon Jul  4 13:08:48 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 4 Jul 2005 13:08:48 +0200
Subject: [Spip-carto-cvs] spipcarto carto-proto1.1.sql,1.2,1.3
Message-ID: <200507041108.j64B8mqX019731@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv19687

Modified Files:
	carto-proto1.1.sql 
Log Message:
Par d?faut ? la place d'inconnu

Index: carto-proto1.1.sql
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto-proto1.1.sql,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto-proto1.1.sql	11 May 2005 10:17:04 -0000	1.2
+++ carto-proto1.1.sql	4 Jul 2005 11:08:46 -0000	1.3
@@ -91,7 +91,7 @@
 
 ALTER TABLE `spip_groupes_mots` ADD INDEX ( `carto_objets` ) ;
 
-INSERT INTO spip_carto_srs (id_carto_srs, label, code) VALUES ('-1', 'Inconnu', '-1');
+INSERT INTO spip_carto_srs (id_carto_srs, label, code) VALUES ('-1', 'Par d?faut', '-1');
 
 # Projection FRANCE METROPOLITAINE
 INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone II', 'epsg:27572');



From fxp at berlios.de  Mon Jul  4 13:09:32 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 4 Jul 2005 13:09:32 +0200
Subject: [Spip-carto-cvs] spipcarto carto-proto1.1.sql,1.3,1.4
Message-ID: <200507041109.j64B9WqX020018@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv19989

Modified Files:
	carto-proto1.1.sql 
Log Message:


Index: carto-proto1.1.sql
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto-proto1.1.sql,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto-proto1.1.sql	4 Jul 2005 11:08:46 -0000	1.3
+++ carto-proto1.1.sql	4 Jul 2005 11:09:30 -0000	1.4
@@ -94,10 +94,11 @@
 INSERT INTO spip_carto_srs (id_carto_srs, label, code) VALUES ('-1', 'Par d?faut', '-1');
 
 # Projection FRANCE METROPOLITAINE
-INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone II', 'epsg:27572');
-INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone III', 'epsg:27573');
-INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone I', 'epsg:27571');
-INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone IV', 'epsg:27574');
+INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone II ?tendu', 'EPSG:27582');
+INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone II', 'EPSG:27572');
+INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone III', 'EPSG:27573');
+INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone I', 'EPSG:27571');
+INSERT INTO spip_carto_srs (label, code) VALUES ('NTF (Paris) / Lambert zone IV', 'EPSG:27574');
 # PROJECTION DOM TODO
 # PROJECTION MONDE (UTM TODO)
 INSERT INTO spip_carto_srs (label, code) VALUES ('WGS 84', 'epsg:4326');



From fxp at berlios.de  Mon Jul  4 13:10:45 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 4 Jul 2005 13:10:45 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgwmsfile.html,1.1,1.2
Message-ID: <200507041110.j64BAjqX020148@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv20139/squelettes/template

Modified Files:
	carto_geosvgwmsfile.html 
Log Message:
Bug WMS NASA - add style

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_geosvgwmsfile.html	1 Jul 2005 06:38:23 -0000	1.1
+++ carto_geosvgwmsfile.html	4 Jul 2005 11:10:43 -0000	1.2
@@ -328,12 +328,11 @@
 				//var myImageUrl = "http://www.sandre.fr/geo/wmszonage?Layers=CIBA&SRS=EPSG:27572&";
 				var myImageUrl = url;
 
-				// WMS are supposed to be Version 1.1.1, returning PNG file.
+				// WMS are supposed to be Version 1.1.1, returning PNG file. No styles applied
 				myImageUrl += "&transparent=true&version=1.1.1&request=GetMap&service=WMS&BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
 				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
-				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
+				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png&styles=";
 				myImageUrl  = myImageUrl.replace('&amp;',"&");
-				//alert ("URL : "+myImageUrl);
 				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
 				myRasterLayer.appendChild(myRasterImage);
 			}



From fxp at berlios.de  Mon Jul  4 13:11:19 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Mon, 4 Jul 2005 13:11:19 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_geosvgfile.html,1.1,1.2
Message-ID: <200507041111.j64BBJqX020321@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv20228/squelettes/template

Modified Files:
	carto_geosvgfile.html 
Log Message:
Clean getOrthoImage

Index: carto_geosvgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgfile.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_geosvgfile.html	30 Jun 2005 10:09:35 -0000	1.1
+++ carto_geosvgfile.html	4 Jul 2005 11:11:17 -0000	1.2
@@ -332,37 +332,14 @@
 			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
 			//adopt line width of park boundary
 			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
-			// Pour charger un claque WMS ... getOrthoImage();
+			
 		}
 		
 		function openWin (url) {
 			window.open(url, "info");
 		}
 
-
-		//load usgs/terraserver orthoimage
-		//you have to use full pixel values, otherwise an error appears
-		function getOrthoImage() {
-			var myRasterLayer = document.getElementById("DOQ");
-			if (myRasterLayer.childNodes.length > 0) {
-				var oldImage = document.getElementById("DOQImage");
-				myRasterLayer.removeChild(oldImage);
-			}
-			if (document.getElementById("DOQ").getAttributeNS(null,"visibility") == "visible") {
-				var myRasterImage = document.createElementNS(svgNS,"image");
-				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
-				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
-				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
-				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
-				myRasterImage.setAttributeNS(null,"id","DOQImage");
-				var myImageUrl = "http://www.sandre.fr/geo/wmszonage?version=1.1.1&request=GetMap&service=WMS&Layers=CIBA&Styles=&SRS=EPSG:27572&";
-				myImageUrl += "BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
-				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
-				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
-				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
-				myRasterLayer.appendChild(myRasterImage);
-			}
-		}		
+	
 
 
 ]]></script>



From stef at berlios.de  Mon Jul  4 17:17:35 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 4 Jul 2005 17:17:35 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.3,1.4
Message-ID: <200507041517.j64FHZqX026264@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv26232/ecrire/plugins

Modified Files:
	plug_carto.php 
Log Message:
Gestion des arguments supplementaires : <mapX|fond{arg1,arg2}

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- plug_carto.php	30 Jun 2005 10:09:41 -0000	1.3
+++ plug_carto.php	4 Jul 2005 15:17:32 -0000	1.4
@@ -6,7 +6,7 @@
 function avant_typo_carto($texte) {
 	
 	if (is_int(strpos($texte, '<map')) &&
-	 (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?>,", $texte, $regs, PREG_SET_ORDER))) {
+	 (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?([{])?([a-zA-Z0-9\,.]+)?([}])?>,", $texte, $regs, PREG_SET_ORDER))) {
 		global $flag_ecrire;
 		$id_article=$_POST['id_article'];
 		if ($flag_ecrire) {
@@ -39,7 +39,7 @@
 			if ($flag_ecrire && $cartes) {
 				global $couleur_claire;
 				$remplace="<div><table class='gauche'><tr>" .
-						"<td class='cellule36' style='width: 100px;'><a href='../carto.php3?id_carto_carte=".$r[1]."&fond=".$r[3]."' class='selection' target='_blank'><img src='img_pack/carte-24.png' alt=' '/>" .
+						"<td class='cellule36' style='width: 100px;'><a href='../carto.php3?id_carto_carte=".$r[1]."&fond=".$r[3]."&args=".$r[5]."' class='selection' target='_blank'><img src='img_pack/carte-24.png' alt=' '/>" .
 						"<span>Carte ".$r[1]."</span></a></td></tr></table></div>";				
 			}
 			//recuperation de la map en cache



From stef at berlios.de  Mon Jul  4 17:54:23 2005
From: stef at berlios.de (stef at berlios.de)
Date: Mon, 4 Jul 2005 17:54:23 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.4,1.5
Message-ID: <200507041554.j64FsNqX003187@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv3162/ecrire/plugins

Modified Files:
	plug_carto.php 
Log Message:
Gestion des arguments supplementaires : <mapX|fond{arg1,arg2}

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- plug_carto.php	4 Jul 2005 15:17:32 -0000	1.4
+++ plug_carto.php	4 Jul 2005 15:54:21 -0000	1.5
@@ -45,6 +45,7 @@
 			//recuperation de la map en cache
 			else {
 				$lecontexte['id_carto_carte']=$id_carte;
+				$lecontexte['args']=$r[5];
 				if ($r[3]) $lecontexte['fond']="template/carto_".$r[3];
 				else $lecontexte['fond']="template/carto";
 				//$lecontexte['fond']="bloc.php3";



From stef at berlios.de  Tue Jul  5 02:44:50 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:44:50 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang motspartout_fr.php3,NONE,1.1 motspartout_en.php3,NONE,1.1 motspartout_it.php3,NONE,1.1
Message-ID: <200507050044.j650ioqX024287@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv24222/ecrire/lang

Added Files:
	motspartout_fr.php3 motspartout_en.php3 motspartout_it.php3 
Log Message:
integration contrib motspartout

--- NEW FILE: motspartout_fr.php3 ---
<?php

$GLOBALS[$GLOBALS['idx_lang']] = array(
									   'titre_page' => 'Assignation de mots clefs',
									   'ajouter' => 'ajouter',
									   'enlever' => 'enlever',
									   'voir' => 'voir',
									   'limite' => 'limitation',
									   'aucune' => 'aucune',
									   'action' => 'Action',
									   'stricte' => 'stricte',
									   'select' => 'selection',
									   'sans' => 'sans',
									   'pas_de_documents' => 'Il n&#39;y a aucun objet avec ces charact?ristiques',
									   'choses' => 'Ajouter des mots clefs sur:',
									   'dejamotgroupe' => 'il y a d?j? un mot de ce groupe (@groupe@) sur l&#39;objet @chose at .',
									   'ATTENTION' => 'ATTENTION'
									   );

?>

--- NEW FILE: motspartout_en.php3 ---
<?php

$GLOBALS[$GLOBALS['idx_lang']] = array(
									   'titre_page' => 'Keywords assignation',
									   'ajouter' => 'add',
									   'enlever' => 'remove',
									   'voir' => 'see',
									   'limite' => 'limitation',
									   'aucune' => 'none',
									   'action' => 'Action',
									   'stricte' => 'strict',
									   'select' => 'select',
									   'sans' => 'exclude',
									   'pas_de_documents' => 'There is no such object',
									   'choses' => 'Add keywords on:',
									   'dejamotgroupe' => 'There is already a word from this group (@groupe@) on the object @chose at .',
									   'ATTENTION' => 'WARNING'
									   );

?>

--- NEW FILE: motspartout_it.php3 ---
<?php

$GLOBALS[$GLOBALS['idx_lang']] = array(
									   'titre_page' => 'Aggiungere parole chiave',
									   'ajouter' => 'aggiungere',
									   'enlever' => 'cancella',
									   'voir' => 'vedere',
									   'limite' => 'limitazione',
									   'aucune' => 'nessuna',
									   'action' => 'Azione',
									   'stricte' => 'rigorosa',
									   'select' => 'selezione',
									   'sans' => 'escluda',
									   'pas_de_documents' => 'Non ce niente con questi caratteristiche',
									   'choses' => 'Aggiungere parole chiave sopra:',
									   'dejamotgroupe' => 'Ce gia un parole chiave de questo gruppo (@groupe@) sul oggetto @chose at .',
									   'ATTENTION' => 'ATTENZIONE'
									   );

?>



From stef at berlios.de  Tue Jul  5 02:44:50 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:44:50 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,NONE,1.1 inc_presentation.php3,1.7,1.8
Message-ID: <200507050044.j650ioqX024301@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv24222/ecrire

Modified Files:
	inc_presentation.php3 
Added Files:
	mots_partout.php 
Log Message:
integration contrib motspartout

--- NEW FILE: mots_partout.php ---
(This appears to be a binary file; contents omitted.)

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc_presentation.php3	30 Jun 2005 10:09:39 -0000	1.7
+++ inc_presentation.php3	5 Jul 2005 00:44:48 -0000	1.8
@@ -2136,6 +2136,12 @@
 			$articles_mots = lire_meta('articles_mots');
 			if ($articles_mots != "non") {
 				icone_bandeau_secondaire (_T('icone_mots_cles'), "mots_tous.php3", "mot-cle-24.gif", "mots", $sous_rubrique);
+			///////////////////////////////////////
+			//MODIFICATION
+			///////////////////////////////////////
+			if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) 
+				icone_bandeau_secondaire (_T('mot-partout'), "mots_partout.php", "mot-cle-24.gif", "mots++", $sous_rubrique);
+			///////////////////////////////////////
 			}
 
 			$activer_sites = lire_meta('activer_sites');



From stef at berlios.de  Tue Jul  5 02:44:02 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:44:02 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_debug_sql.php3,1.4,1.5
Message-ID: <200507050044.j650i2qX024117@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv24066/ecrire

Modified Files:
	inc_debug_sql.php3 
Log Message:
version cvs : bug doublons

Index: inc_debug_sql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_debug_sql.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_debug_sql.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ inc_debug_sql.php3	5 Jul 2005 00:44:00 -0000	1.5
@@ -170,11 +170,10 @@
 }
 
 // appelee a chaque compilation de boucle (inc-compilo)
-function boucle_debug_compile ($id, $nom, $pretty, $sourcefile, $code) {
+function boucle_debug_compile ($id, $nom, $code) {
 	global $debug_objets;
 
 	$debug_objets['code'][$nom.$id] = $code;
-	$debug_objets['pretty'][$nom.$id] = $pretty;
 }
 
 // appelee a chaque compilation de squelette (inc-compilo)
@@ -193,13 +192,21 @@
 	}
 }
 
-// appelee a chaque analyse syntaxique de squelette (inc-parser)
-function boucle_debug ($id, $nom, $boucle, $id_parent) {
+// appelee a chaque analyse syntaxique de squelette
+function boucle_debug ($nom, $id_parent, $id, $type, $crit, $avant, $milieu, $apres, $altern) {
 	global $debug_objets;
-
 	$debug_objets['courant'] = $nom;
-	$debug_objets['boucle'][$nom.$id] = $boucle;
 	$debug_objets['parent'][$nom.$id] = $id_parent;
+	$debug_objets['pretty'][$nom.$id] = 
+	  "BOUCLE$id($type)" . ereg_replace("[\r\n]", " ", $crit) ;
+	// on synthetise avec la syntaxe standard, mais "<//" pose pb 
+	$debug_objets['boucle'][$nom.$id] = 
+	  (!$avant ? "" : "<B$id>$avant") . 
+	  "<BOUCLE$id($type)$crit>" .
+	  $milieu .
+	  "</BOUCLE$id>" .
+	  (!$apres ? "" : "$apres</B$id>") . 
+	  (!$altern ? "" : "$altern<//B$id>");
 }
 
 function trouve_boucle_debug($n, $nom, $debut=0, $boucle = "")
@@ -317,7 +324,9 @@
 	ob_end_clean();
 
 	@header('Content-Type: text/html; charset='.lire_meta('charset'));
-	echo debut_entete('Spip ' . _T('admin_debug')), 
+	echo debut_entete('Spip ' . $GLOBALS['spip_version_affichee'] . ' ' .
+			  _T('admin_debug') . ' ' .
+			  _T('info_mon_site_spip')), 
 	  "<link rel='stylesheet' href='spip_admin.css' type='text/css'>",
 	  "</head>\n<body style='margin:0 10px;'>",
 	  "\n<div id='spip-debug' style='position: absolute; top: 22px; z-index: 1000;height:97%;left:10px;right:10px;'><div id='spip-boucles'>\n"; 



From stef at berlios.de  Tue Jul  5 02:44:01 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:44:01 +0200
Subject: [Spip-carto-cvs] spipcarto inc-boucles.php3,1.4,1.5 inc-html-squel.php3,1.5,1.6 inc-compilo.php3,1.5,1.6
Message-ID: <200507050044.j650i1qX024113@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv24066

Modified Files:
	inc-boucles.php3 inc-html-squel.php3 inc-compilo.php3 
Log Message:
version cvs : bug doublons

Index: inc-boucles.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-boucles.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-boucles.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ inc-boucles.php3	5 Jul 2005 00:43:55 -0000	1.5
@@ -19,13 +19,15 @@
 if (defined("_INC_BOUCLES")) return;
 define("_INC_BOUCLES", "1");
 
-
 //
 // Boucle sur une table hors SPIP
 //
 function boucle_DEFAUT($id_boucle, &$boucles) {
+	global $table_des_tables;
 	$boucle = &$boucles[$id_boucle];
-	$boucle->from[] =  $boucle->type_requete . " AS " . $boucle->type_requete;
+	$t = $table_des_tables[$boucle->type_requete];
+	$boucle->from[] =  $boucle->type_requete . " AS " . 
+	  ($t ? $t : $boucle->type_requete);
 	return calculer_boucle($id_boucle, $boucles); 
 }
 

Index: inc-html-squel.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-html-squel.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-html-squel.php3	30 Jun 2005 10:09:36 -0000	1.5
+++ inc-html-squel.php3	5 Jul 2005 00:43:56 -0000	1.6
@@ -20,21 +20,20 @@
 # il est charge par un include calcule dans inc-calcul-squel
 # pour permettre differentes syntaxes en entree
 
+define('BALISE_BOUCLE', '<BOUCLE');
+define('BALISE_FIN_BOUCLE', '</BOUCLE');
+define('BALISE_PRE_BOUCLE', '<B');
+define('BALISE_POST_BOUCLE', '</B');
+define('BALISE_ALT_BOUCLE', '<//B');
+
+define('TYPE_RECURSIF', 'boucle');
+define('SPEC_BOUCLE','[[:space:]]*\(([^)]*)\)');
 define('NOM_DE_BOUCLE', "[0-9]+|[-_][-_.a-zA-Z0-9]*");
 # ecriture alambiquee pour rester compatible avec les hexadecimaux des vieux squelettes
 define('NOM_DE_CHAMP', "#((" . NOM_DE_BOUCLE . "):)?(([A-F]*[G-Z_][A-Z_0-9]*)|[A-Z_]+)(\*?)");
 define('CHAMP_ETENDU', '\[([^]\[]*)\(' . NOM_DE_CHAMP . '([^[)]*\)[^]\[]*)\]');
-define('PARAM_DE_BOUCLE','[[:space:]]*[{][[:space:]]*([^{}]*([{][^[}]]*[}][^[}]]*)*)[[:space:]]*[}]');
-define('TYPE_DE_BOUCLE', "[^)]*");
-define('BALISE_DE_BOUCLE',
-	"^<BOUCLE(" .
-	NOM_DE_BOUCLE .
-	')[[:space:]]*\((' .
-	TYPE_DE_BOUCLE .
-	')\)');
-define('PARAM_INCLURE','^[[:space:]]*[{][[:space:]]*([_0-9a-zA-Z]+)[[:space:]]*(=)?');
+
 define('BALISE_INCLURE','<INCLU[DR]E[[:space:]]*\(([^)]*)\)');
-define('DEBUT_DE_BOUCLE','/<B('.NOM_DE_BOUCLE.')>.*?<BOUCLE\1[^-_.a-zA-Z0-9]|<BOUCLE('.NOM_DE_BOUCLE.')/ms');	# preg
 
 function phraser_inclure($texte, $ligne, $result) {
 
@@ -386,7 +385,7 @@
 			      // cette variable sera inseree dans le code
 			      // et son nom sert d'indicateur des maintenant
 			      $result->doublons = '$doublons_index';
-			      $param = 'doublons';
+			      if ($param == 'unique') $param = 'doublons';
 			    }
 			  elseif ($param == 'recherche')
 			    // meme chose (a cause de #nom_de_boucle:URL_*)
@@ -397,7 +396,7 @@
 			    $crit = phraser_critere_infixe($m[1], $m[5],$v,
 							   (($m[1] == 'lang_select') ? $m[1] : trim($m[4])),
 							   $m[3], $m[2]);
-		  } elseif (preg_match("/^([!]?)[[:space:]]*([A-Za-z_][A-Za-z_0-9]*)[[:space:]]*(\??)(.*)$/ism", $param, $m)) {
+			  } elseif (preg_match("/^([!]?)[[:space:]]*([A-Za-z_][A-Za-z_0-9]*)[[:space:]]*(\??)(.*)$/ism", $param, $m)) {
 		  // contient aussi les comparaisons implicites !
 			    array_shift($v);
 			    if ($m[4])
@@ -412,9 +411,10 @@
 			    $crit->not = $m[1];
 			    $crit->cond = $m[3];
 			  }
-			  else 
+			  else {spip_log("pb $param");
 			    erreur_squelette(_T('zbug_critere_inconnu',
 						array('critere' => $param)));
+			  }
 			  $args[] = $crit;
 			}
 		  }
@@ -442,85 +442,94 @@
 
 	$all_res = array();
 
-	while (preg_match(DEBUT_DE_BOUCLE, $texte, $regs)) {
-		$nom_boucle = $regs[1].$regs[2];
-		$p = strpos($texte, '<BOUCLE'.$nom_boucle);
+	while (($p = strpos($texte, BALISE_BOUCLE)) !== false) {
 
-		// envoyer la boucle au debugueur
-		if ($GLOBALS['var_mode']== 'debug') {
-			$preg = "@<B($nom_boucle|OUCLE${nom_boucle}[^-_.a-zA-Z0-9][^>]*)>"
-				. ".*</(BOUCLE|/?B)$nom_boucle>@ms";
-			preg_match($preg, $texte, $match);
-			boucle_debug ($nom_boucle, $nom, $match[0], $id_parent);
+		$result = new Boucle;
+		$result->id_parent = $id_parent;
+
+# attention: reperer la premiere des 2 balises: pre_boucle ou boucle
+# $n == $p possible car <B est un prefixe de <BOUCLE
+		$n = strpos($texte, BALISE_PRE_BOUCLE);
+
+		if ($n === false || ($n >= $p)) {
+		  $debut = substr($texte, 0, $p);
+		  $milieu = substr($texte, $p);
+		  $k = strpos($milieu, '(');
+		  $id_boucle = substr($milieu,
+				       strlen(BALISE_BOUCLE),
+				       $k - strlen(BALISE_BOUCLE));
+		  $milieu = substr($milieu, $k);
+
+		  /* a adapter: si $n pointe sur $id_boucle ...
+		if (strpos($milieu, $s)) {
+			erreur_squelette(_T('zbug_erreur_boucle_syntaxe'),
+				$id_boucle . 
+				_T('zbug_balise_b_aval'));
 		}
+		  */
+		} else {
+		  $debut = substr($texte, 0, $n);
+		  $milieu = substr($texte, $n);
+		  $k = strpos($milieu, '>');
+		  $id_boucle = substr($milieu,
+				       strlen(BALISE_PRE_BOUCLE),
+				       $k - strlen(BALISE_PRE_BOUCLE));
 
-		//
-		// Recuperer la partie principale de la boucle
-		//
-		$debut = substr($texte, 0, $p);
-		$milieu = substr($texte, $p);
-		if (!ereg(BALISE_DE_BOUCLE, $milieu, $match)) {
-			erreur_squelette((_T('zbug_erreur_boucle_syntaxe')), $milieu);
+		  if (!($p = strpos($milieu, BALISE_BOUCLE . $id_boucle . "(")))
+		    erreur_squelette((_T('zbug_erreur_boucle_syntaxe')), $id_boucle);
+		  $result->avant = substr($milieu, $k+1, $p-$k-1);
+		  $milieu = substr($milieu, $p+strlen($id_boucle)+strlen(BALISE_BOUCLE));
 		}
-		$milieu = substr($milieu, strlen($match[0]));
-		$id_boucle = $match[1];
-		$result = new Boucle;
-		$result->id_parent = $id_parent;
 		$result->id_boucle = $id_boucle;
-		$type = $match[2];
+
+		ereg(SPEC_BOUCLE, $milieu, $match);
+                $milieu = substr($milieu, strlen($match[0]));
+		$type = $match[1];
+
 		if ($p = strpos($type, ':'))
 		  {
 		    $result->sql_serveur = substr($type,0,$p);
-		    $type = substr($type,$p+1);
+		    $soustype = strtolower(substr($type,$p+1));
 		  }
-		$type = strtolower($type);
-		if ($type == 'sites') $type = 'syndication'; # alias
+		else
+		  $soustype = strtolower($type);
 
+		if ($soustype == 'sites') $soustype = 'syndication' ; # alias
+		      
 		//
-		// Recuperer les criteres de la boucle (sauf boucle recursive)
+		// analyser les criteres et distinguer la boucle recursive
 		//
-		if (substr($type, 0, 6) == 'boucle') {
-			$result->type_requete = 'boucle';
-			$result->param[0] = substr($match[2], 6);
-			$milieu = substr($milieu, strpos($milieu, '>'));
+		if (substr($soustype, 0, 6) == TYPE_RECURSIF) {
+			$result->type_requete = TYPE_RECURSIF;
+			$result->param[0] = substr($type, strlen(TYPE_RECURSIF));
+			$milieu = substr($milieu, strpos($milieu, '>')+1);
+			$params = "";
 		} else {
-			$result->type_requete = $type;
+			$result->type_requete = $soustype;
 			phraser_args($milieu,">","",$all_res,$result);
+			$params = substr($milieu,0,strpos($milieu,$result->apres));
 			$milieu = substr($result->apres,1);
 			$result->apres = "";
 			phraser_criteres($result->param, $result);
 		}
-		//
-		// Recuperer la partie conditionnelle avant
-		//
-		$s = "<B$id_boucle>";
-		$p = strpos($debut, $s);
-		if ($p !== false) {
-			$result->avant = substr($debut, $p + strlen($s));
-			$debut = substr($debut, 0, $p);
-		}
-		if (strpos($milieu, $s)) {
-			erreur_squelette(_T('zbug_erreur_boucle_syntaxe'),
-				$id_boucle . 
-				_T('zbug_balise_b_aval'));
-		}
 
 		//
 		// Recuperer la fin :
 		//
-		$s = "</BOUCLE$id_boucle>";
+		$s = BALISE_FIN_BOUCLE . $id_boucle . ">";
 		$p = strpos($milieu, $s);
 		if ($p === false) {
 			erreur_squelette(_T('zbug_erreur_boucle_syntaxe'),
 					 _T('zbug_erreur_boucle_fermant',
 						array('id'=>$id_boucle)));
 		}
+
 		$suite = substr($milieu, $p + strlen($s));
 		$milieu = substr($milieu, 0, $p);
 		//
 		// 1. Recuperer la partie conditionnelle apres
 		//
-		$s = "</B$id_boucle>";
+		$s = BALISE_POST_BOUCLE . $id_boucle . ">";
 		$p = strpos($suite, $s);
 		if ($p !== false) {
 			$result->apres = substr($suite, 0, $p);
@@ -530,7 +539,7 @@
 		//
 		// 2. Recuperer la partie alternative
 		//
-		$s = "<//B$id_boucle>";
+		$s = BALISE_ALT_BOUCLE . $id_boucle . ">";
 		$p = strpos($suite, $s);
 		if ($p !== false) {
 			$result->altern = substr($suite, 0, $p);
@@ -540,6 +549,17 @@
 		$m = substr_count($milieu, "\n");
 		$b = substr_count($result->avant, "\n");
 		$a = substr_count($result->apres, "\n");
+
+		// envoyer la boucle au debugueur
+		if ($GLOBALS['var_mode']== 'debug') {
+		  boucle_debug ($nom, $id_parent, $id_boucle, 
+				$type,
+				$params,
+				$result->avant,
+				$milieu,
+				$result->apres,
+				$result->altern);
+		}
 
 		$result->avant = phraser($result->avant, $id_parent,$boucles, $nom, $result->ligne);
 		$result->apres = phraser($result->apres, $id_parent,$boucles, $nom, $result->ligne+$b+$m);

Index: inc-compilo.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-compilo.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-compilo.php3	30 Jun 2005 10:09:36 -0000	1.5
+++ inc-compilo.php3	5 Jul 2005 00:43:56 -0000	1.6
@@ -491,7 +491,7 @@
 
 // affichage du code produit
 
-function code_boucle(&$boucles, $id, $nom, $sourcefile)
+function code_boucle(&$boucles, $id, $nom)
 {
 	$boucle = &$boucles[$id];
 
@@ -525,8 +525,6 @@
 	$pretty = "BOUCLE$id(".strtoupper($boucle->type_requete) . ")" .
 		ereg_replace("[\r\n]", " ", $pretty);
 
-	if ($GLOBALS['var_mode'] == 'debug')
-		boucle_debug_compile ($id, $nom, $pretty, $sourcefile,$boucle->return);
 	return $pretty;	
 }
 
@@ -632,12 +630,16 @@
 			'(&$Cache, &$Pile, &$doublons, &$Numrows, $SP) {' .
 			$f($id, $boucles) .
 			"\n}\n\n";
+		if ($GLOBALS['var_mode'] == 'debug')
+		  boucle_debug_compile ($id, $nom, $boucles[$id]->return);
+
 	}
 
 	$code = "";
 	foreach($boucles as $id => $boucle) {
-		$code .= "\n//\n// <" .
-		  code_boucle($boucles, $id, $nom, $sourcefile).
+		$code .= "\n//\n// <BOUCLE " .
+#		  code_boucle($boucles, $id, $nom). # pas au point
+		  $boucle->type_requete .
 		  ">\n//\n" .
 		  $boucle->return;
 	}



From stef at berlios.de  Tue Jul  5 02:46:16 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:46:16 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svgx.html,NONE,1.1 carto_svgfilex.html,NONE,1.1
Message-ID: <200507050046.j650kGqX025148@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv25039/squelettes/template

Added Files:
	carto_svgx.html carto_svgfilex.html 
Log Message:
version SVG avec une couche par mot

--- NEW FILE: carto_svgx.html ---
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfilex" width="750px" height="550px" type="image/svg+xml" name="emap"></embed>
<noembed>
	<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="#URL_OBJET" alt="#TEXTE"/>
	</BOUCLE_objets></map></B_objets>
</noembed>
</BOUCLE_carte>
--- NEW FILE: carto_svgfilex.html ---
<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<svg width="100%" height="100%" viewBox="0 0 760 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
	<script type="text/ecmascript" xlink:href="helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="navigation.js"/>
	<script type="text/ecmascript" xlink:href="navigationTools.js"/>
	<script type="text/ecmascript"><![CDATA[
		
		
		var myMapApp = new mapApp();
		var myMainMap;
		var myRefMapDragger;
		var myZoomSlider;
		function init(evt) {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			myMainMap = new map("mainMap",[(#CALLAGE|worldfileWidth)],0,0.6,0,"m",true,"coordX","coordY",dynamicLayers,digiLayers,"");
			//slider properties: x1,y1,value1,x2,y2,value2,startValue,group in which to build the slider,color of slider
			//width of slider of sliderbar,width of invisible slider bar,width of visible slider
			myZoomSlider = new slider(710,40,myMainMap.minWidth,710,140,myMainMap.maxWidth,myMainMap.maxWidth,"mapZoomSlider","dimgray",2,10,"sliderSymbol","myRefMapDragger.resizeDragger",true);
			//set constraints to draggable rect in reference map
			myRefMapDragger = new dragObj("dragRectForRefMap","referenceMap","myDragCross",4750,true,"coordX","coordY",myMainMap);
			loadProjectSpecific();
		}
		function loadProjectSpecific() {
			//adopt width and height of map extent
			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			//adopt line width of park boundary
			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
			// Pour charger un claque WMS ... getOrthoImage();
		<BOUCLE__OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <BOUCLE__M(MOTS){id_carto_objet}{par num titre}{doublons a}>
			document.getElementById("spipCarto_#ID_MOT").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
		 </BOUCLE__M>
		</BOUCLE__OBJ>
			
		}
		
		function openWin (url) {
			window.open(url, "info");
		}


		//load usgs/terraserver orthoimage
		//you have to use full pixel values, otherwise an error appears
		function getOrthoImage() {
			var myRasterLayer = document.getElementById("DOQ");
			if (myRasterLayer.childNodes.length > 0) {
				var oldImage = document.getElementById("DOQImage");
				myRasterLayer.removeChild(oldImage);
			}
			if (document.getElementById("DOQ").getAttributeNS(null,"visibility") == "visible") {
				var myRasterImage = document.createElementNS(svgNS,"image");
				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
				myRasterImage.setAttributeNS(null,"id","DOQImage");
				var myImageUrl = "http://www.sandre.fr/geo/wmszonage?version=1.1.1&request=GetMap&service=WMS&Layers=CIBA&Styles=&SRS=EPSG:27572&";
				myImageUrl += "BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
				myRasterLayer.appendChild(myRasterImage);
			}
		}		


]]></script>
	<defs>
	<!-- section for CSS stylesheet definitions -->
	<!-- you may globally adjust your styles here -->
	<style type="text/css"><![CDATA[
	.allText {font-family:Arial;fill:dimgray;}
	.titleText {font-size:22;font-weight:bold;}
	.subTitleText {font-size:18;font-weight:bold;}
	.normalText {font-size:15;}
	.smallText {font-size:12;}
	.boldText {font-weight:bold;}
	.centerText {text-anchor:middle;}
	.dragRect {fill:lightskyblue;stroke:none;opacity:0.4;}
	.dragSymbol {stroke:darkblue;}
	.normalLinestyle {fill:none;stroke:dimgray;}
	.background {fill:aliceblue;stroke:none;}
	.darkRectstyle {fill:dimgray;stroke:none;}
	.nofill {fill:none;}
	.whitefill {fill:white;}
	.normalfillcol {fill:dimgray;}
	.normallinecol {stroke:dimgray;}
	.nostroke {stroke:none;}
	.verythinline {stroke-width:1;}
	.thinline {stroke-width:1.5;}
	.normalline {stroke-width:2;}
	.mediumThickLine {stroke-width:5;}
	.strokeFilled {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0;}
	<INCLURE(style_carto.css)>
	
  ]]></style>
		<!-- Symbols for checkboxes -->
		<symbol id="checkBoxRect" overflow="visible">
			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
		</symbol>
		<symbol id="checkBoxCross" overflow="visible" class="normallinecol nofill verythinline" pointer-events="none">
			<line x1="-5" y1="-5" x2="5" y2="5"/>
			<line x1="-5" y1="5" x2="5" y2="-5"/>
		</symbol>
		<!-- Symbols for Zoom Magnifyer glasses -->
		<symbol id="magnifyer" overflow="visible" class="whitefill normalline normallinecol">
			<line x1="0" y1="0" x2="-8" y2="20"/>
			<circle r="8"/>
		</symbol>
		<symbol id="magnifyerZoomOut" overflow="visible" class="whitefill normalline normallinecol">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<symbol id="magnifyerZoomIn" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" class="whitefill normalline normallinecol"/>
			<line x1="0" y1="-4" x2="0" y2="4" class="whitefill normalline normallinecol"/>
		</symbol>
		<symbol id="magnifyerFull" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<text y="4.5" class="allText smallText centerText boldText" pointer-events="none">F</text>
		</symbol>
		<symbol id="magnifyerManual" overflow="visible">
			<line x1="0" y1="0" x2="-8" y2="20" class="whitefill normalline normallinecol"/>
			<circle r="8" class="whitefill normalline normallinecol"/>
			<rect x="-3" y="-3" width="6" height="6" class="nofill thinline normallinecol" stroke-dasharray="1.5,1.5"/>
		</symbol>
		<symbol id="magnifyerZoomInWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0"/>
			<line x1="0" y1="-4" x2="0" y2="4"/>
		</symbol>
		<symbol id="magnifyerZoomOutWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<!-- hand symbol for panning -->
		<symbol id="symbPan" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<path class="normallinecol verythinline nofill" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
		</symbol>
		<!-- Symbol for Pan Arrows -->
		<symbol id="symbArrow" overflow="visible" class="nofill verythinline normallinecol" pointer-events="none">
			<polyline points="-3,-5 3,-5 3,1 5,1 0,5 -5,1 -3,1 -3,-5"/>
		</symbol>
		<!-- Symbol for Recentering Map -->
		<symbol id="symbRecenter" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<circle class="normalfillcol nostroke" cx="0" cy="0" r="1" pointer-events="none"/>
			<g class="normallinecol thinline nofill" pointer-events="none">
				<line x1="-7" y1="-7" x2="-3" y2="-3"/>
				<line x1="7" y1="7" x2="3" y2="3"/>
				<line x1="-7" y1="7" x2="-3" y2="3"/>
				<line x1="7" y1="-7" x2="3" y2="-3"/>
			</g>
		</symbol>
		<!-- Symbol for Slider -->
		<symbol id="sliderSymbol" overflow="visible" class="nofill mediumThickLine normallinecol" pointer-events="none">
			<line x1="0" y1="-5" x2="0" y2="5"/>
		</symbol>
		<!-- Symbol for Dragging if zoomed in far -->
		<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" class="nofill dragSymbol" pointer-events="none">
			<line x1="-7000" y1="0" x2="-2500" y2="0"/>
			<line x1="7000" y1="0" x2="2500" y2="0"/>
			<line x1="0" y1="-3300" x2="0" y2="-7800"/>
			<line x1="0" y1="3300" x2="0" y2="7800"/>
		</symbol>
		<!-- Marker for Extent-Arrows -->
		<marker id="myStartArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="-0.5,0 8,-2 8,2"/>
		</marker>
		<marker id="myEndArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
		</marker>
		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 


	</defs>
	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
	
	
	<!-- Main Map Frame -->
	<svg id="mainMap" x="0" y="15" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="553" height="[(#CALLAGE|getPropMapHeight{553})]">
		<!-- this group is necessary for manual panning, it temporarily gets a translate transformation which is later removed on mouseup -->
		<g id="mainMapGroup" transform="translate(0,0)">
			<!-- within this group you should place all map layers, usually, if you have more than one element in a map layer, you would use a group instead of a single element, as in this example -->
			<g id="DOQ" visibility="visible" />
			<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]px" height="[(#CALLAGE|worldfileHeight)]px" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />

		<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
	<!-- #DESCRIPTIF -->
			<g id="spipCarto_#ID_MOT">
			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
			</BOUCLE_OBJECT>
			</g>
		 </BOUCLE_M>
		</BOUCLE_OBJ>

			<g id="spipCartoObj">
			
				<!-- Couche d'objets SPIP -->
				<B_objets>
				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a><!-- class="[(#GEOMETRIE|wkt2shape{SVG})default]" style="opacity:.6;" style="fill:url(#MyGradient);"-->
				</BOUCLE_objets>
				</B_objets>	
			</g>
		</g>
	</svg>
	
	
	
	
	<!-- this group holds navigation, title and if you like, legend information -->
	<g>
		<!-- your map title -->
		<text class="allText titleText" x="200" y="1">#TITRE</text>
		<!-- coordinate display -->
		<g class="allText normalText">
			<text id="coordX" x="580" y="230">X:</text>
			<text id="coordY" x="680" y="230">Y:</text>
		</g>
		<!-- display width and height of map extent -->
		<g>
			<!-- vertical line, displays current height of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="561" y1="15" x2="561" y2="[(#CALLAGE|getPropMapHeight{575})]"/>
			<rect class="background" x="555" y="[(#CALLAGE|getPropMapHeight{230})]" width="12" height="100"/>
			<text id="myScaleTextH" class="allText normalText centerText" transform="translate(556,[(#CALLAGE|getPropMapHeight{280})]),rotate(90)">81,000 m</text>
			<!-- horizontal line, displays current width of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="0" y1="[(#CALLAGE|getPropMapHeight{583})]" x2="553.1" y2="[(#CALLAGE|getPropMapHeight{583})]"/>
			<rect class="background" x="236" y="[(#CALLAGE|getPropMapHeight{580})]" width="100" height="12"/>
			<text id="myScaleTextW" class="allText normalText centerText" transform="translate(277,[(#CALLAGE|getPropMapHeight{590})])">64,000 m</text>
			<!-- small rectangle in lower right corner, onclick displays current map extent in real world coordinates -->
			<rect class="darkRectstyle" x="558.5" y="[(#CALLAGE|getPropMapHeight{580})]" width="5" height="5" onclick="showExtent()" />
		</g>
		<!-- control map layer visibility with checkBoxes -->
		<g transform="translate(590 250)">
			<text class="allText subTitleText" x="-10" y="0">Calques</text>

			<!-- checkbox -->
		<BOUCLE_OBJ2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <BOUCLE_M2(MOTS){id_carto_objet}{par num titre}{doublons c}>
			<g transform="translate(0 [(#ID_MOT|ajoute{20})])">
				<use id="checkBoxspipCarto_#ID_MOT" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCarto_#ID_MOT');"/>
				<use id="checkCrossspipCarto_#ID_MOT" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<g class="allText normalText">
				<text x="12" y="[(#ID_MOT|plus{6})]">#TITRE</text>';
			</g>
		 </BOUCLE_M2>
		</BOUCLE_OBJ2>

			<!-- first checkbox -->
			<g transform="translate(0 [(#ID_MOT|plus{20})])">
				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- second checkbox -->
			<g transform="translate(0 [(#ID_MOT|plus{40})])">
				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- third checkbox 
			<g transform="translate(0 [(#ID_MOT|plus{60})])">
				<use id="checkBoxDOQ" xlink:href="#checkBoxRect"
				onclick="checkBoxScript(evt,'DOQ');"/>
				<use id="checkCrossDOQ" xlink:href="#checkBoxCross"
				visibility="visible"/>
			</g>-->
			<!-- checkbox text labels -->
			<g class="allText normalText">
				<text x="12" y="[(#ID_MOT|plus{26})]">Objets SPIP-CARTO</text>
				<text x="12" y="[(#ID_MOT|plus{46})]">Image de fond</text>
				<!-- Check for WMS <text x="12" y="[(#ID_MOT|plus{66})]">Bassin versant</text>-->
			</g>
		</g>
		</B_OBJ2>
		<!-- map impressum and status Bar -->
		<g text-rendering="optimizeLegibility">
			<!-- text with this id is required to show help texts -->
			<text id="statusText" class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{600})]">Info: </text>
			<text class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{620})]">Auteur: spip-carto, 2004</text>
			<text class="allText smallText" x="510" y="[(#CALLAGE|getPropMapHeight{620})]">Source: </text>
		</g>
	</g>
	<!-- small reference map, shares the same coordinate system than the main map -->
	<svg id="referenceMap" x="580" y="45" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="118.52" height="[(#CALLAGE|getPropMapHeight{118.52})]" onmousedown="myRefMapDragger.drag(evt)" onmousemove="myRefMapDragger.drag(evt)" onmouseup="myRefMapDragger.drag(evt)" onmouseout="myRefMapDragger.drag(evt)">
		<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
		<path pointer-events="none" style="fill:none;stroke:salmon;stroke-width:1000" d="M250528.8 -4218899.3l2380.5 -1305.3l1593.4 928.3l1326.1 -752.7l4218.1 -70.2l4072.3 -3965.5l5552.8 -1556.9l313 -1368.6l3042.8 -2535.6l1098.2 945.4l124.7 2135.2l2579.4 431.2l-22.8 1238l3516.2 779.5l-66.6 -1725.9l1001.7 -419l625.5 2735.2l1659.5 476.6l-330.2 1248.2l1330.8 747.9l-583.6 1341.1l1261.8 -103.1l285.3 729.8l1411.9 -2540.5l552.1 995.2l2360 129.9l1432.7 1622l2981.7 1123.5l2940.7 4333.1l-270.6 1128.2l792.4 1201.5l-1726.7 5827.8l785 2018.2l2160 2274.1l2083.2 772.6l-29.7 1587l2579.8 273.2l2903.1 2611.6l-1211.6 1736.7l-304 2424.3l1806.8 664.5l-952.3 432.8l228.8 1126.8l-1164.6 1204.8l1028.8 823.8l134.5 1768.4l-3601.7 2856.7l-1067.8 2250.5l-1294 1012.3l939.2 1643.7l-426.7 1493.5l-1730.1 1237.5l-1330.5 3254.3l-3443.5 3823l-1377.3 499.3l-1732.6 -647.3l-2658.4 9242.1l-2580.3 -63.8l-1626.7 1640.8l-11817 92.4l-111.4 4297.6l-745.7 11.6l-6670.9 -270.2l-1972.9 -5940.7l-1565.6 -523.5l821.7 -7022.1l-765 -!
 27.8l26.9 -795.4l742.7 19.8l74.1 -825.8l-2396.2 -52l748.7 -3186.1l-3846.4 -78l60.9 -5551.1l-1599 -53.4l110.1 -3306.4l-6584.6 -269.6l-573.6 -4908.1l-895.7 -69.6l-3.4 -3096.9l2384.7 -772.2l99.6 -1566.5l1598.9 3l268.3 -6583.2l-5123.5 -132.5l183.9 -10111.9l1168.6 -4214.1l-716.7 -975.6l1461.4 -2002.8l-593.4 -565.8l2659.9 -3238.9z" />
		<!-- rectangle that represents map extent -->
		<rect id="dragRectForRefMap" class="dragRect" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" pointer-events="none"/>
		<!-- if zoomed in very far, we display a cross-symbol here to indicate the map position in the reference map -->
		<use id="myDragCross" x="[(#CALLAGE|worldfileLRX)]" y="-[(#CALLAGE|worldfileHeight)]" xlink:href="#myDragCrossSymbol" visibility="hidden" />
	</svg>
	<!-- this group holds symbol instances for navigation tools -->
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider1"/>
		<use x="710" y="25" xlink:href="#magnifyerZoomInWo" onclick="zoomIt(evt,'in');" onmouseover="magnify(evt,1.2,'in');" onmouseout="magnify(evt,1,'in');"/>
		<!-- button for zoom-out, below slider -->
		<use x="710" y="155" xlink:href="#magnifyerZoomOutWo" onclick="zoomIt(evt,'out');" onmouseover="magnify(evt,1.2,'out');" onmouseout="magnify(evt,1,'out');"/>
	</g>
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider"/>
		<text class="allText subTitleText" x="580" y="170">Localisation</text>
		<!-- button for full view (f) -->
		<use x="610" y="190" xlink:href="#magnifyerFull" onclick="zoomIt(evt,'full');" onmouseover="magnify(evt,1.2,'full');" onmouseout="magnify(evt,1,'full');"/>
		<!-- button for manual zoom (rectangle) -->
		<use x="640" y="190" xlink:href="#magnifyerManual" onclick="myMainMap.zoomManual(evt)" onmouseover="magnify(evt,1.2,'manual');" onmouseout="magnify(evt,1,'manual');"/>
		<!-- button for manual pan -->
		<use x="670" y="190" xlink:href="#symbPan" onclick="myMainMap.panManual(evt)" onmouseover="magnify(evt,1.2,'panmanual');" onmouseout="magnify(evt,1,'panmanual');"/>
		<!-- button for redefining map center -->
		<use xlink:href="#symbRecenter" x="700" y="190" onmouseover="magnify(evt,1.2,'recenter')" onmouseout="magnify(evt,1,'recenter')" onclick="myMainMap.recenter(evt)"/>
	</g>
</svg>
</BOUCLE_carte>


From stef at berlios.de  Tue Jul  5 02:46:17 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 02:46:17 +0200
Subject: [Spip-carto-cvs] spipcarto style_carto.css,NONE,1.1 navigationTools.js,NONE,1.1 mes_fonctions.php3,1.10,1.11
Message-ID: <200507050046.j650kHqX025149@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv25039

Modified Files:
	mes_fonctions.php3 
Added Files:
	style_carto.css navigationTools.js 
Log Message:
version SVG avec une couche par mot

--- NEW FILE: style_carto.css ---
.polygondefault {fill:red;fill-opacity:.6;}
.polygoncat1 {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0;}
.polygoncat2 {stroke:green;stroke-width:2;fill:transparent;fill-opacity:0;}

--- NEW FILE: navigationTools.js ---

/*
Scripts for SVG only webmapping application navigation tools
Copyright (C) <2004>  <Andreas Neumann>
Version 1.03, 2005-02-22
neumann at karto.baug.ethz.ch
http://www.carto.net/
http://www.carto.net/neumann/

Credits: numerous people on svgdevelopers at yahoogroups.com

This ECMA script library is free software; you can redistribute it and/or
modify it under the terms of the GNU Lesser General Public
License as published by the Free Software Foundation; either
version 2.1 of the License, or (at your option) any later version.

This library is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public
License along with this library (http://www.carto.net/papers/svg/navigationTools/lesser_gpl.txt); if not, write to the Free Software
Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

----

current version: 1.02

version history:
1.0 initial version
1.01 added cleanUp() method to map and dragObj objects, some fixes in the documentation
1.02 fixed problems with double clicks, the second click of a double click is now ignored, using the evt.detail property
1.03 introduced timestamp and nrLayerToLoad array for dynamic loading (getUrl)

original document site: http://www.carto.net/papers/svg/navigationTools/
Please contact the author in case you want to use code or ideas commercially.
If you use this code, please include this copyright header, the included full
LGPL 2.1 text and read the terms provided in the LGPL 2.1 license
(http://www.gnu.org/copyleft/lesser.txt)

-------------------------------

Please report bugs and send improvements to neumann at karto.baug.ethz.ch
If you use these scripts, please link to the original (http://www.carto.net/papers/svg/navigationTools/)
somewhere in the source-code-comment or the "about" of your project and give credits, thanks!

*/


/* slider.js */
//slider properties
function slider(x1,y1,value1,x2,y2,value2,startVal,sliderGroupId,sliderColor,visSliderWidth,invisSliderWidth,sliderSymb,functionToCall,mouseMoveBool) {
	this.x1 = x1;
	this.y1 = y1;
	this.value1 = value1;
	this.x2 = x2;
	this.y2 = y2;
	this.value2 = value2;
	this.startVal = startVal;
	this.value = startVal;
	this.sliderGroupId = sliderGroupId;
	this.sliderGroup = document.getElementById(this.sliderGroupId);
	this.sliderColor = sliderColor;
	this.visSliderWidth = visSliderWidth;
	this.invisSliderWidth = invisSliderWidth;
	this.sliderSymb = sliderSymb;
	this.functionToCall = functionToCall;
	this.mouseMoveBool = mouseMoveBool;
	this.length = toPolarDist((this.x2 - this.x1),(this.y2 - this.y1));
	this.direction = toPolarDir((this.x2 - this.x1),(this.y2 - this.y1));
	this.createSlider();
	this.slideStatus = 0;
	this.ctm = getTransformToRootElement(this.sliderGroup).inverse();
}

//create slider
slider.prototype.createSlider = function() {
	var mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.invisSliderWidth);
	mySliderLine.setAttributeNS(null,"opacity","0");
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_invisibleSliderLine");
	mySliderLine.addEventListener("mousedown",this,false);
	this.sliderGroup.appendChild(mySliderLine);
	mySliderLine = document.createElementNS(svgNS,"line");
	mySliderLine.setAttributeNS(null,"x1",this.x1);
	mySliderLine.setAttributeNS(null,"y1",this.y1);
	mySliderLine.setAttributeNS(null,"x2",this.x2);
	mySliderLine.setAttributeNS(null,"y2",this.y2);
	mySliderLine.setAttributeNS(null,"stroke",this.sliderColor);
	mySliderLine.setAttributeNS(null,"stroke-width",this.visSliderWidth);
	mySliderLine.setAttributeNS(null,"id",this.sliderGroupId+"_visibleSliderLine");
	mySliderLine.setAttributeNS(null,"pointer-events","none");
	this.sliderGroup.appendChild(mySliderLine);
	mySliderSymb = document.createElementNS(svgNS,"use");
	mySliderSymb.setAttributeNS(xlinkNS,"xlink:href","#"+this.sliderSymb);
	var myStartDistance = this.length - ((this.value2 - this.startVal) / (this.value2 - this.value1)) * this.length;
	var myPosX = this.x1 + toRectX(this.direction,myStartDistance);
	var myPosY = this.y1 + toRectY(this.direction,myStartDistance);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	mySliderSymb.setAttributeNS(null,"transform",myTransformString);
	mySliderSymb.setAttributeNS(null,"id",this.sliderGroupId+"_sliderSymbol");
	this.sliderGroup.appendChild(mySliderSymb);
}

//remove all slider elements
slider.prototype.removeSlider = function() {
    var mySliderSymb = document.getElementById(this.sliderGroup+"_sliderSymbol");
	this.sliderGroup.removeChild(mySliderSymb);
    var mySliderLine = document.getElementById(this.sliderGroup+"_visibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
    var mySliderLine = document.getElementById(this.sliderGroup+"_invisibleSliderLine");
	this.sliderGroup.removeChild(mySliderLine);
}

//handle events
slider.prototype.handleEvent = function(evt) {
	this.drag(evt);
}

//drag slider
slider.prototype.drag = function(evt) {
	var svgroot = document.documentElement;
	if (evt.type == "mousedown" || (evt.type == "mousemove" && this.slideStatus == 1)) {
		var myCoords = myMapApp.calcCoord(evt.clientX,evt.clientY);
		//undo the effect of transformations
		var mySVGPoint = svgroot.createSVGPoint();
		mySVGPoint.x = myCoords["x"];
		mySVGPoint.y = myCoords["y"];
		mySVGPoint = mySVGPoint.matrixTransform(this.ctm);
		myCoords["x"] = mySVGPoint.x;
		myCoords["y"] = mySVGPoint.y;
	
		//draw normal line for first vertex
		var ax = this.x2 - this.x1;
		var ay = this.y2 - this.y1;
		//normal vector 1
		var px1 = parseFloat(this.x1) + ay * -1;
		var py1 = parseFloat(this.y1) + ax;
		//normal vector 2
		var px2 = parseFloat(this.x2) + ay * -1;
		var py2 = parseFloat(this.y2) + ax;
				
		if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
			if (evt.type == "mousedown" && evt.detail == 1) {
				this.slideStatus = 1;
				svgroot.addEventListener("mousemove",this,false);
				svgroot.addEventListener("mouseup",this,false);
			}
			myNewPos = intersect2lines(this.x1,this.y1,this.x2,this.y2,myCoords["x"],myCoords["y"],myCoords["x"] + ay * -1,myCoords["y"] + ax);
			var myPercentage = toPolarDist(myNewPos['x'] - this.x1,myNewPos['y'] - this.y1) / this.length;
			this.value = this.value1 + myPercentage * (this.value2 - this.value1);
		}
		else {
			var myNewPos = new Array();
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 0 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 0) {
				//more than max
				this.value = this.value2;
				myNewPos['x'] = this.x2;
				myNewPos['y'] = this.y2;
			}
			if (leftOfTest(myCoords["x"],myCoords["y"],this.x1,this.y1,px1,py1) == 1 && leftOfTest(myCoords["x"],myCoords["y"],this.x2,this.y2,px2,py2) == 1) {
				//less than min
				this.value = this.value1;
				myNewPos['x'] = this.x1;
				myNewPos['y'] = this.y1;
			}
		}
		var myTransformString = "translate("+myNewPos['x']+","+myNewPos['y']+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
		document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
		this.getValue();
	}
	if (evt.type == "mouseup" && evt.detail == 1) {
		if (this.slideStatus == 1) {
			this.slideStatus = 2;
			svgroot.removeEventListener("mousemove",this,false);
			svgroot.removeEventListener("mouseup",this,false);
			this.getValue();
		}
		this.slideStatus = 0;
	}
}

//this code is executed, after the slider is released
//you can use switch/if to detect which slider was used (use this.sliderGroup) for that
slider.prototype.getValue = function() {
	if (this.slideStatus == 1 && this.mouseMoveBool == true) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("change",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('change','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
	if (this.slideStatus == 2) {
		if (typeof(this.functionToCall) == "function") {
			this.functionToCall("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "object") {
			this.functionToCall.getSliderVal("release",this.sliderGroupId,this.value);
		}
		if (typeof(this.functionToCall) == "string") {
			eval(this.functionToCall+"('release','"+this.sliderGroupId+"',"+this.value+")");
		}
	}
}	

//this is to set the value from other scripts
slider.prototype.setValue = function(value) {
	var myPercAlLine = (value - this.value1) / (this.value2 - this.value1);
	this.value = myPercAlLine;
	var myPosX = this.x1 + toRectX(this.direction,this.length * myPercAlLine);
	var myPosY = this.y1 + toRectY(this.direction,this.length * myPercAlLine);
	var myTransformString = "translate("+myPosX+","+myPosY+") rotate(" + Math.round(this.direction / Math.PI * 180) + ")";
	document.getElementById(this.sliderGroupId+"_sliderSymbol").setAttributeNS(null,"transform",myTransformString);
}	
/* slider.js */




/* mapApp.js */	
//holds data on window size
function mapApp() {
	if (!document.documentElement.getScreenCTM) {
		//initialize ratio
		this.resetFactors();
		//add resize event to document element
		document.documentElement.addEventListener("SVGResize",this,false);
	}
}

mapApp.prototype.handleEvent = function(evt) {
	if (evt.type == "SVGResize") {
		this.resetFactors();
	}
}

mapApp.prototype.resetFactors = function() {
	if (!document.documentElement.getScreenCTM) {
		//case for viewers that don't support .getScreenCTM, such as ASV3
		//calculate ratio and offset values of app window
		var viewBoxArray = document.documentElement.getAttributeNS(null,"viewBox").split(" ");
		var myRatio = viewBoxArray[2]/viewBoxArray[3];
		if ((window.innerWidth/window.innerHeight) > myRatio) { //case window is more wide than myRatio
			this.scaleFactor = viewBoxArray[3] / window.innerHeight;
		}
		else { //case window is more tall than myRatio
			this.scaleFactor = viewBoxArray[2] / window.innerWidth;
		}
		this.offsetX = (window.innerWidth - viewBoxArray[2] * 1 / this.scaleFactor) / 2;
		this.offsetY = (window.innerHeight - viewBoxArray[3] * 1 / this.scaleFactor) / 2;
	}
}

mapApp.prototype.calcCoord = function(coordx,coordy) {
	var coords = new Array();
	if (!document.documentElement.getScreenCTM) {
		//case ASV3 a. Corel
		coords["x"] = (coordx  - this.offsetX) * this.scaleFactor;
		coords["y"] = (coordy - this.offsetY) * this.scaleFactor;
	}
	else {
		matrix=document.documentElement.getScreenCTM();
		coords["x"]= matrix.inverse().a*coordx+matrix.inverse().c*coordy+matrix.inverse().e;
		coords["y"]= matrix.inverse().b*coordx+matrix.inverse().d*coordy+matrix.inverse().f;
	}
	return coords;
}
/* mapApp.js */	
	
		
/* checkbox.js */
function checkBoxScript(evt,myLayer) { //checkBox for toggling layers an contextMenue
	var myLayerObj = document.getElementById(myLayer);
	var myCheckCrossObj = document.getElementById("checkCross"+myLayer);
	var myCheckCrossVisibility = myCheckCrossObj.getAttributeNS(null,"visibility");
	if (evt.type == "click" && evt.detail == 1) {
		if (myCheckCrossVisibility == "visible") {
			myLayerObj.setAttributeNS(null,"visibility","hidden");
			myCheckCrossObj.setAttributeNS(null,"visibility","hidden");
			//you can do if/else or switch statements to set different actions on activating a checkbox here
			//myLayer holds the currentLayer name
			/*if (myLayer == "DOQ") {
				getOrthoImage();
			}*/
		}
		else {
			myLayerObj.setAttributeNS(null,"visibility","visible");
			myCheckCrossObj.setAttributeNS(null,"visibility","visible");
		}
	}
}
/* checkbox.js */	
		

Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.10
retrieving revision 1.11
diff -u -d -r1.10 -r1.11
--- mes_fonctions.php3	1 Jul 2005 07:07:51 -0000	1.10
+++ mes_fonctions.php3	5 Jul 2005 00:46:14 -0000	1.11
@@ -1,6 +1,17 @@
 <?php
 include "ecrire/inc_carto.php3";
 
+function ajoute($txt,$offset=1){
+	global $mini_compteur;
+	if (!isset($mini_compteur))$mini_compteur=0;
+	$mini_compteur+=$offset;
+	return $mini_compteur;
+}
+function plus($txt,$offset=1){
+	global $mini_compteur;
+	if (!isset($mini_compteur))return $offset;
+	return ($mini_compteur+$offset);
+}
 
 
 function guiPos ($compteur, $offset){



From stef at berlios.de  Tue Jul  5 10:56:48 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 10:56:48 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svgfilex.html,1.1,1.2
Message-ID: <200507050856.j658umqX002911@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv2880/squelettes/template

Modified Files:
	carto_svgfilex.html 
Log Message:
bug css

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_svgfilex.html	5 Jul 2005 00:46:13 -0000	1.1
+++ carto_svgfilex.html	5 Jul 2005 08:56:46 -0000	1.2
@@ -95,8 +95,7 @@
 	.thinline {stroke-width:1.5;}
 	.normalline {stroke-width:2;}
 	.mediumThickLine {stroke-width:5;}
-	.strokeFilled {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0;}
-	<INCLURE(style_carto.css)>
+	<INCLURE(style_carto_svgfilex.css)>
 	
   ]]></style>
 		<!-- Symbols for checkboxes -->
@@ -212,7 +211,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a><!-- class="[(#GEOMETRIE|wkt2shape{SVG})default]" style="opacity:.6;" style="fill:url(#MyGradient);"-->
+				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>



From stef at berlios.de  Tue Jul  5 10:56:48 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 5 Jul 2005 10:56:48 +0200
Subject: [Spip-carto-cvs] spipcarto style_carto_svgfilex.css,NONE,1.1 style_carto.css,1.1,NONE
Message-ID: <200507050856.j658umqX002908@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv2880

Added Files:
	style_carto_svgfilex.css 
Removed Files:
	style_carto.css 
Log Message:
bug css

--- NEW FILE: style_carto_svgfilex.css ---
.polygon {fill:lightskyblue;stroke:none;opacity:0.4;}
.polygoncat1 {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0;}
.polygoncat2 {stroke:green;stroke-width:2;fill:transparent;fill-opacity:0;}

--- style_carto.css DELETED ---



From fxp at berlios.de  Thu Jul  7 11:32:35 2005
From: fxp at berlios.de (fxp at berlios.de)
Date: Thu, 7 Jul 2005 11:32:35 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_import.php3,1.1,1.2
Message-ID: <200507070932.j679WZqX021681@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv21674/ecrire

Modified Files:
	carte_import.php3 
Log Message:


Index: carte_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_import.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carte_import.php3	11 May 2005 10:08:25 -0000	1.1
+++ carte_import.php3	7 Jul 2005 09:32:32 -0000	1.2
@@ -289,8 +289,8 @@
 					$nb = $rec->numRows();
 					while ($i<$nb) {
 							if (!is_null($rec->getField($i,$col)) && 
-								is_numeric($rec->getField($i,$x)) && 
-								is_numeric($rec->getField($i,$y)))		// Champ code non null et x et y num?rique
+								is_numeric((float)str_replace($rec->getField($i,$x), ',', '.')) && 
+								is_numeric((float)str_replace($rec->getField($i,$y), ',', '.')))		// Champ code non null et x et y num?rique
 							{	$sql = sprintf ("Insert into spip_carto_objets (id_carto_carte, titre, texte, url_objet, url_logo, geometrie) values 		(%d, '%s', '%s', '%s', '', 'point(%f %f)');\n",
 									($carte=="null"?"0":$id_carte),
 									($col=="null"?"Nouvel Objet":addslashes ($rec->getField($i,$col))),
@@ -299,6 +299,7 @@
 									($x=="0"?0:$rec->getField($i, $x)),
 									($y=="0"?0:$rec->getField($i, $y))
 									);
+								//echo $sql;
 							}else
 								$nbErr++;
 							



From stef at berlios.de  Thu Jul 21 23:47:17 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:17 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spip_eu.php3,1.1,1.2 spip_en.php3,1.4,1.5 spip_gl.php3,1.3,1.4 spip_fa.php3,1.4,1.5 ecrire_it.php3,1.3,1.4 ecrire_fa.php3,1.3,1.4 ecrire_es.php3,1.4,1.5 spip_oc_va.php3,1.3,1.4 spip_zh.php3,1.3,1.4 spip_ro.php3,1.1,1.2 spip_tr.php3,1.1,1.2 spip_es.php3,1.4,1.5 ecrire_fr.php3,1.3,1.4 spip_ja.php3,1.1,1.2 ecrire_ro.php3,1.1,1.2 spip_fr.php3,1.4,1.5 spip_it.php3,1.4,1.5 spip_oc_prv.php3,1.3,1.4 ecrire_lb.php3,1.4,1.5 spip_ca.php3,1.4,1.5 ecrire_en.php3,1.3,1.4 ecrire_ar.php3,1.3,1.4 ecrire_tr.php3,1.1,1.2 spip_oc_ni.php3,1.3,1.4 ecrire_ja.php3,1.1,1.2 spip_lb.php3,1.4,1.5 ecrire_ca.php3,1.3,1.4 spip_ar.php3,1.4,1.5
Message-ID: <200507212147.j6LLlHqX023983@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv22230/ecrire/lang

Modified Files:
	spip_eu.php3 spip_en.php3 spip_gl.php3 spip_fa.php3 
	ecrire_it.php3 ecrire_fa.php3 ecrire_es.php3 spip_oc_va.php3 
	spip_zh.php3 spip_ro.php3 spip_tr.php3 spip_es.php3 
	ecrire_fr.php3 spip_ja.php3 ecrire_ro.php3 spip_fr.php3 
	spip_it.php3 spip_oc_prv.php3 ecrire_lb.php3 spip_ca.php3 
	ecrire_en.php3 ecrire_ar.php3 ecrire_tr.php3 spip_oc_ni.php3 
	ecrire_ja.php3 spip_lb.php3 ecrire_ca.php3 spip_ar.php3 
Log Message:
synchro CVS 20050719

Index: spip_eu.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_eu.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spip_eu.php3	30 Jun 2005 10:09:37 -0000	1.1
+++ spip_eu.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -59,7 +59,7 @@
 'bouton_changer' => 'Aldatu',
 'bouton_chercher' => 'Bilatu',
 'bouton_choisir' => 'Aukeratu',
-'bouton_enregistrer' => '<MODIF>Enregistrer',
+'bouton_enregistrer' => 'Grabatu',
 'bouton_radio_desactiver_messagerie_interne' => 'Barne mezularitza desaktibatu',
 'bouton_radio_envoi_annonces' => 'Iragarki editorialak igorri ',
 'bouton_radio_non_envoi_annonces' => 'Ez igorri iragarkirik',
@@ -185,7 +185,7 @@
 
 
 // F
-'fichier_introuvable' => '<MODIF>Fichier @fichier@ introuvable',
+'fichier_introuvable' => '@fichier@ aurkitzeko moduan ez dagoen artxiboa',
 'form_deja_inscrit' => 'Inskribaturik zaude jadanik.',
 'form_email_non_valide' => 'Postaelektronikoaren helbideak ez du balio.',
 'form_forum_access_refuse' => 'Ezin zara lekuhonetan sartu dagoeneko.',
@@ -349,13 +349,13 @@
 'info_contact_developpeur' => 'Programatzaile batekin kontaktuan jarri behar duzu.',
 'info_contenance' => 'Gune honek duena:',
 'info_contribution' => 'foroko ekarpenak',
-'info_copyright' => '<MODIF>@spip@ software librea da, @lien_gpl@ banatua.',
+'info_copyright' => '@spip@ software librea da, @lien_gpl@ banatua.',
 'info_copyright_doc' => 'Argibide gehiago izateko, jo helbide honetara: <a href=\'http://www.spip.net/eu\'>http://www.spip.net/eu</a>.',
 'info_copyright_gpl' => 'GPL lizentziarekin',
 'info_cours_edition' => 'Bukatu gabe dauden zure artikuluak',
 'info_creer_repertoire' => 'Fitxategi edo karpeta bat sortu behar duzu, eta hari izen hau jarri:',
 'info_creer_repertoire_2' => 'ecrire/data/, direktorioan eta gero',
-'info_creer_vignette' => '<MODIF>creaci?n autom?tica de la miniatura',
+'info_creer_vignette' => 'miniaturaren sorkuntza automatikoa',
 'info_deplier' => 'Destolestu',
 'info_descriptif_nombre' => 'deskribapena(k):',
 'info_description' => 'Deskribapena:',
@@ -605,7 +605,7 @@
 'texte_inc_auth_2' => 'berriro konektatu',
 'texte_inc_auth_3' => ',ebentualki zure nabigatzailea itxi eta berrabiarazi.',
 'texte_inc_config' => 'Orrialdehauetan egindako aldaketek zure gunearen funtzionamenduan eragin nabariadute. SPIP sistemaren funtzionamendura ohituta ez zauden bitartean, ezhartzea parte gomendatzen dizugu.Modu orokorrean, orrialde hauetako kudeaketa zure guneko web arduradun nagusiariuztea biziki gomendatzen da.',
-'texte_inc_meta_1' => '<MODIF>Jarraitu, tokiaren administrarimoduan,',
+'texte_inc_meta_1' => 'Sistemak errore bat aurkitu du <code>ecrire/data/meta_cache.php3</code> artxiboa idaztean. Webgunearen administratzailea zarenez,',
 'texte_inc_meta_2' => 'idazteko baimenak egiaztatu barik',
 'texte_inc_meta_3' => '<code>ecrire/data/</code> direktorioarena',
 'texte_statut_en_cours_redaction' => 'Idazteko bidean',

Index: spip_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_en.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_en.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ spip_en.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modify this section',
 'admin_recalculer' => 'Refresh this page',
 'alerte_maj_impossible' => '<b>Warning!</b> Failed to update the MySQL database to version @version@, maybe due to a permissions problem on the database. Please contact your ISP.',
+'analyse_xml' => 'Parsing XML',
 'avis_archive_incorrect' => 'archive file is not a valid SPIP file',
 'avis_archive_invalide' => 'archive file is not valid',
 'avis_attention' => 'CAUTION!',

Index: spip_gl.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_gl.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_gl.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_gl.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar este tema',
 'admin_recalculer' => 'Recargar a p&aacute;xina',
 'alerte_maj_impossible' => '<b>Alerta&nbsp;!</b> A actualizaci&oacute;n da base MySQL sobre a versi&oacute;n @version@ &eacute; imposible, poder&iacute;a ser por causa dun problema de permisos de modificaci&oacute;n da base de datos. Contacte co seu aloxador.',
+'analyse_xml' => 'An&aacute;lise XML',
 'avis_archive_incorrect' => 'o ficheiro arquivado non &eacute; un ficheiro SPIP',
 'avis_archive_invalide' => 'o ficheiro arquivado non &eacute; v&aacute;lido',
 'avis_attention' => 'ATENCI&Oacute;N!',

Index: spip_fa.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_fa.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_fa.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_fa.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => '&#1575;&#1610;&#1606; &#1576;&#1582;&#1588; &#1585;&#1575; &#1575;&#1589;&#1604;&#1575;&#1581; &#1603;&#1606;&#1610;&#1583;',
 'admin_recalculer' => '&#1575;&#1610;&#1606; &#1589;&#1601;&#1581;&#1607; &#1585;&#1575; &#1606;&#1608; &#1603;&#1606;&#1610;&#1583;',
 'alerte_maj_impossible' => '<b>!&#1607;&#1588;&#1583;&#1575;&#1585;</b>  &#1606;&#1608; &#1705;&#1585;&#1583;&#1606; &#1583;&#1575;&#1583;&#1607; &#1662;&#1740;  MySQL &#1576;&#1585;&#1575;&#1740; &#1606;&#1587;&#1582;&#1607; &#1740;   @version@&#1576;&#1582;&#1575;&#1591;&#1585; &#1606;&#1583;&#1575;&#1588;&#1578;&#1606; &#1575;&#1580;&#1575;&#1586;&#1607; &#1575;&#1587;&#1578;&#1601;&#1575;&#1583;&#1607; &#1594;&#1610;&#1585; &#1605;&#1605;&#1705;&#1606; &#1605;&#1610;&#1576;&#1575;&#1588;&#1583;. ',
+'analyse_xml' => '&#1578;&#1580;&#1586;&#1740;&#1607; XML',
 'avis_archive_incorrect' => ' &#1606;&#1605;&#1609; &#1576;&#1575;&#1588;&#1583; SPIP   &#1601;&#1575;&#1610;&#1604; &#1576;&#1575;&#1610;&#1711;&#1575;&#1606;&#1609; &#1601;&#1575;&#1610;&#1604;  ',
 'avis_archive_invalide' => '&#1601;&#1575;&#1610;&#1604; &#1576;&#1575;&#1610;&#1711;&#1575;&#1606;&#1609; &#1605;&#1593;&#1578;&#1576;&#1585; &#1606;&#1605;&#1610;&#1576;&#1575;&#1588;&#1583;',
 'avis_attention' => '&#1578;&#1608;&#1580;&#1607;&nbsp;!',

Index: ecrire_it.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_it.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_it.php3	30 Jun 2005 10:09:36 -0000	1.3
+++ ecrire_it.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -83,7 +83,7 @@
 'bouton_radio_moderation_priori' => 'Moderazione a priori (i
 contributi saranno pubblicati previa autorizazione degli
 amministratori).',
-'bouton_radio_modere_abonnement' => 'moderato su abbonamento',
+'bouton_radio_modere_abonnement' => 'solo su abbonamento',
 'bouton_radio_modere_posteriori' => 'moderato a posteriori',
 'bouton_radio_modere_priori' => 'moderato a priori',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Non comparire nell\'elenco dei redattori collegati ',
@@ -248,7 +248,6 @@
 'info_ajout_participant' => 'Si &egrave; aggiunto il seguente partecipante:',
 'info_ajouter_rubrique' => 'Aggiungi un\'altra rubrica da amministrare:',
 'info_annonce_nouveautes' => 'Annuncio delle novit&agrave;',
-'info_annuler_blocage_priori' => 'Annullare questa censura preventiva',
 'info_anterieur' => 'anteriore',
 'info_appliquer_choix_moderation' => 'Questa scelta di moderazione verr&agrave; applicata:',
 'info_article' => 'articolo',
@@ -270,6 +269,7 @@
 'info_avertissement' => 'Avvertimento',
 'info_base_installee' => 'La struttura del vostro database &egrave; installata.',
 'info_base_restauration' => 'Il database &egrave; in fase di ripristino.',
+'info_bloquer' => 'bloccare',
 'info_breves' => 'Il tuo sito dovr&agrave; utilizzare il sistema di brevi?',
 'info_breves_03' => 'brevi',
 'info_breves_liees_mot' => 'Le brevi collegate a questa parola chiave',
@@ -308,7 +308,6 @@
 di eliminare la parola chiave
 <B>@titre_mot@</b> (@type_mot@). Essendo quest\'ultima collegata a
 <b>@texte_lie@</b>, &egrave; necessario confermare la decisione:',
-'info_demander_blocage_priori' => 'Richiedi una censura preventiva',
 'info_derniere_etape' => 'Ultima fase: <B>Finito!',
 'info_derniere_syndication' => 'L\'ultima <em>syndication</em> di questo sito &egrave; stata effettuata il',
 'info_derniers_articles_publies' => 'I tuoi ultimi articoli pubblicati',
@@ -481,6 +480,7 @@
 'info_procedure_maj_version' => '&egrave; necessario avviare la procedura di aggiornamento per adattare
 il database alla nuova versione di SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'pubblicare',
 'info_publies' => 'I tuoi articoli pubblicati',
 'info_question_accepter_visiteurs' => 'I modelli di pagina del sito prevedono la registrazione di utenti senza accesso all\'area riservata. Attivare la seguente funzionalit&agrave;:',
 'info_question_gerer_statistiques' => 'Il sito deve gestire le statistiche delle visite?',
@@ -744,6 +744,12 @@
 
 // S
 'statut_admin_restreint' => '(admin restreint)',
+'syndic_choix_moderation' => 'Come comportarsi con i prossimi link provenienti da questo sito?',
+'syndic_choix_oublier' => 'Come comportarsi con i link che non compaiono pi&amp;ugrave; nel file di syndication?',
+'syndic_lien_obsolete' => 'link non pi&amp;ugrave; valido',
+'syndic_option_miroir' => 'bloccarli automaticamente',
+'syndic_option_oubli' => 'cancellarli (dopo @mois@&nbsp;mesi)',
+'syndic_options' => 'Opzioni per la syndication:',
 
 
 // T
@@ -806,8 +812,6 @@
 'texte_date_publication_anterieure' => 'DATA DI REDAZIONE ANTERIORE',
 'texte_date_publication_anterieure_nonaffichee' => 'Non visualizzare la data di redazione anteriore.',
 'texte_date_publication_article' => 'DATA DI PUBBLICAZIONE:',
-'texte_demander_blocage_priori' => 'I prossimi link in
-provenienza da questo sito saranno bloccati a priori.',
 'texte_descriptif_petition' => 'Descrizione della petizione',
 'texte_descriptif_rapide' => 'Descrizione rapida',
 'texte_documents_joints' => '&Egrave; possibile autorizzare l\'aggiunta di documenti (file di testo, fogli elettronici, immagini, file multimediali, ecc.) agli articoli e/o alle rubriche. Questi file possono poi essere richiamati nel testo dell\'articolo, o visualizzati separatamente.<p />',
@@ -842,8 +846,6 @@
 qui sotto indica i criteri predefiniti dei siti in syndication.
 Sar&agrave; comunque possibile sbloccare singolarmente ogni link,
 o scegliere di bloccare i link di ogni singolo sito.',
-'texte_liens_syndication' => 'I prossimi link provenienti da questo sito saranno visualizzati immediatamente
-sul sito pubblico.',
 'texte_login_ldap_1' => '(Lascia vuoto per un accesso anonimo, o inserisci il percorso completo, per esempio &laquo;<tt>uid=rossi, ou=users, dc=mio-dominio, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Attenzione! Questo &egrave; l\'ID con il quale sei attualmente collegato.
 Utilizza questo modulo con cognizione di causa...',

Index: ecrire_fa.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_fa.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_fa.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_fa.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -230,8 +230,6 @@
 'info_ajout_participant' => ':&nbsp;&#1588;&#1585;&#1603;&#1578; &#1603;&#1606;&#1606;&#1583;&#1607; &#1576;&#1593;&#1583;&#1609; &#1575;&#1590;&#1575;&#1601;&#1607; &#1588;&#1583;&#1607;',
 'info_ajouter_rubrique' => '&#1610;&#1603; &#1576;&#1582;&#1588; &#1583;&#1610;&#1711;&#1585; &#1585;&#1575; &#1576;&#1585;&#1575;&#1609; &#1575;&#1583;&#1575;&#1607; &#1603;&#1585;&#1583;&#1606; &#1575;&#1590;&#1575;&#1601;&#1607; &#1603;&#1606;&#1610;&#1583;',
 'info_annonce_nouveautes' => '&#1582;&#1576;&#1585; &#1578;&#1575;&#1586;&#1607; &#1607;&#1575;',
-'info_annuler_blocage_priori' => '&#1575;&#1610;&#1606; &#1606;&#1602;&#1589; &#1585;&#1575; 
- &#1576;&#1585;&#1591;&#1585;&#1601; &#1603;&#1606;&#1610;&#1583;',
 'info_anterieur' => '&#1662;&#1610;&#1588;&#1610;&#1606;',
 'info_appliquer_choix_moderation' => ':&nbsp;&#1575;&#1610;&#1606; &#1575;&#1606;&#1578;&#1582;&#1575;&#1576; &#1605;&#1593;&#1578;&#1583;&#1604; &#1585;&#1575; &#1576;&#1603;&#1575;&#1585; &#1576;&#1585;&#1610;&#1583;',
 'info_article' => '&#1605;&#1602;&#1575;&#1604;&#1607;',
@@ -253,6 +251,7 @@
 'info_avertissement' => '&#1578;&#1584;&#1603;&#1585;',
 'info_base_installee' => '.&#1587;&#1575;&#1582;&#1578;&#1575;&#1585; &#1583;&#1575;&#1583;&#1607; &#1662;&#1609; &#1607;&#1575;&#1610;&#1578;&#1575;&#1606; &#1606;&#1589;&#1576; &#1588;&#1583;&#1607;',
 'info_base_restauration' => '.&#1583;&#1575;&#1583;&#1607; &#1662;&#1609; &#1607;&#1575; &#1583;&#1585; &#1581;&#1575;&#1604; &#1576;&#1575;&#1586;&#1587;&#1575;&#1586;&#1609; &#1605;&#1610;&#1576;&#1575;&#1588;&#1606;&#1583;',
+'info_bloquer' => '&#1576;&#1576;&#1606;&#1583;&#1740;&#1583;',
 'info_breves' => '&#1570;&#1610;&#1575; &#1587;&#1575;&#1610;&#1578; &#1588;&#1605;&#1575; &#1575;&#1586; &#1587;&#1610;&#1587;&#1578;&#1605; &#1605;&#1602;&#1575;&#1604;&#1607; &#1607;&#1575;&#1609; &#1603;&#1608;&#1578;&#1575;&#1607; &#1575;&#1587;&#1578;&#1601;&#1575;&#1583;&#1607; &#1605;&#1610;&#1603;&#1606;&#1583;&nbsp;&#1567;',
 'info_breves_03' => '&#1605;&#1602;&#1575;&#1604;&#1607; &#1607;&#1575;&#1609; &#1603;&#1608;&#1578;&#1575;&#1607;',
 'info_breves_liees_mot' => '&#1605;&#1602;&#1575;&#1604;&#1607; &#1607;&#1575;&#1609; &#1603;&#1608;&#1578;&#1575;&#1607; &#1605;&#1585;&#1576;&#1608;&#1591; &#1576;&#1607; &#1575;&#1610;&#1606; &#1608;&#1575;&#1688;&#1607;-&#1603;&#1604;&#1610;&#1583;',
@@ -288,8 +287,6 @@
 'info_date_publication_anterieure' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1606;&#1711;&#1575;&#1585;&#1588; &#1602;&#1576;&#1604;&#1609; :',
 'info_date_referencement' => ':&nbsp;&#1578;&#1575;&#1585;&#1610;&#1582; &#1662;&#1610;&#1608;&#1606;&#1583; &#1575;&#1610;&#1606; &#1587;&#1575;&#1610;&#1578;',
 'info_delet_mots_cles' => '&#1588;&#1605;&#1575; &#1583;&#1585;&#1582;&#1608;&#1575;&#1587;&#1578; &#1581;&#1584;&#1601; &#1575;&#1610;&#1606; &#1608;&#1575;&#1688;&#1607;-&#1603;&#1604;&#1610;&#1583; &#1585;&#1575; &#1603;&#1585;&#1583;&#1607; &#1575;&#1610;&#1583;<B>@titre_mot@</b> (@type_mot@).&#1588;&#1605;&#1575; &#1576;&#1575;&#1610;&#1583; &#1575;&#1610;&#1606; &#1581;&#1584;&#1601; &#1585;&#1575; &#1578;&#1571;&#1574;&#1610;&#1583; &#1603;&#1606;&#1610;&#1583;&#1548; &#1586;&#1610;&#1585;&#1575; &#1575;&#1610;&#1606; &#1608;&#1575;&#1688;&#1607;-&#1603;&#1604;&#1610;&#1583; &#1576;&#1607; &#1575;&#1610;&#1606; &#1605;&#1578;&#1606; &#1605;&#1585;&#1576;&#1608;&#1591; &#1575;&#1587;&#1578; :<b>@texte_lie@</b>',
-'info_demander_blocage_priori' => '&#1583;&#1585;&#1582;&#1608;&#1575;&#1587;&#1578;
-&#1578;&#1608;&#1602;&#1601;',
 'info_derniere_etape' => '&#1570;&#1582;&#1585;&#1610;&#1606; &#1605;&#1585;&#1581;&#1604;&#1607;:&#1662;&#1575;&#1610;&#1575;&#1606; <B> !',
 'info_derniere_syndication' => ':&#1570;&#1582;&#1585;&#1610;&#1606; &#1662;&#1610;&#1608;&#1606;&#1583; &#1587;&#1575;&#1610;&#1578;&#1609; &#1575;&#1606;&#1580;&#1575;&#1605; &#1588;&#1583;&#1607; &#1583;&#1585; &#1578;&#1575;&#1585;&#1610;&#1582; ',
 'info_derniers_articles_publies' => '&#1570;&#1582;&#1585;&#1610;&#1606; &#1605;&#1602;&#1575;&#1604;&#1607; &#1607;&#1575;&#1609; &#1605;&#1606;&#1578;&#1588;&#1585; &#1588;&#1583;&#1607; &#1588;&#1605;&#1575; &#1583;&#1585; &#1575;&#1610;&#1606;&#1578;&#1585;&#1606;&#1578;',
@@ -444,6 +441,7 @@
 'info_procedez_par_etape' => '&#1605;&#1585;&#1581;&#1604;&#1607; &#1576;&#1607; &#1605;&#1585;&#1581;&#1604;&#1607; &#1575;&#1602;&#1583;&#1575;&#1605; &#1603;&#1606;&#1610;&#1583;',
 'info_procedure_maj_version' => '&#1585;&#1608;&#1606;&#1583; &#1576;&#1607; &#1585;&#1608;&#1586; &#1603;&#1585;&#1583;&#1606; &#1576;&#1575;&#1610;&#1583; &#1576;&#1607; &#1580;&#1585;&#1610;&#1575;&#1606; &#1576;&#1610;&#1601;&#1578;&#1583; &#1578;&#1575; &#1583;&#1575;&#1583;&#1607; &#1662;&#1609; &#1607;&#1575; &#1576;&#1578;&#1608;&#1575;&#1606;&#1606;&#1583; &#1576;&#1575; &#1606;&#1587;&#1582;&#1607; &#1580;&#1583;&#1610;&#1583; &#1605;&#1606;&#1591;&#1576;&#1602; &#1588;&#1608;&#1606;&#1583;.',
 'info_ps' => 'P.S',
+'info_publier' => '&#1605;&#1606;&#1578;&#1588;&#1585; &#1705;&#1606;&#1740;&#1583;',
 'info_publies' => '&#1605;&#1602;&#1575;&#1604;&#1607; &#1607;&#1575;&#1609; &#1605;&#1606;&#1578;&#1588;&#1585; &#1588;&#1583;&#1607; &#1578;&#1575;&#1606; &#1585;&#1608;&#1609; &#1578;&#1575;&#1585;&#1606;&#1605;&#1575;',
 'info_question_accepter_visiteurs' => '&#1575;&#1711;&#1585; &#1575;&#1587;&#1603;&#1604;&#1578; &#1587;&#1575;&#1610;&#1578;&#1578;&#1575;&#1606; &#1579;&#1576;&#1578; &#1588;&#1605;&#1575;&#1585; &#1576;&#1575;&#1586;&#1583;&#1610;&#1583;&#1603;&#1606;&#1606;&#1583;&#1711;&#1575;&#1606;  &#1585;&#1575; &#1576;&#1609; &#1570;&#1606;&#1603;&#1607; &#1575;&#1580;&#1575;&#1586;&#1607; &#1609; &#1608;&#1585;&#1608;&#1583; &#1576;&#1607; &#1602;&#1587;&#1605;&#1578; &#1582;&#1589;&#1608;&#1589;&#1609; &#1587;&#1575;&#1610;&#1578; &#1585;&#1575; &#1583;&#1575;&#1588;&#1578;&#1607; &#1576;&#1575;&#1588;&#1606;&#1583; &#1585;&#1575;  &#1583;&#1575;&#1585;&#1575;&#1587;&#1578; &#1582;&#1608;&#1575;&#1607;&#1588;&#1605;&#1606;&#1583; &#1575;&#1587;&#1578; &#1711;&#1586;&#1610;&#1606;&#1607; &#1609; &#1586;&#1610;&#1585; &#1585;&#1575; &#1601;&#1593;&#1575;&#1604; &#1603;&#1606;&#1610;&#1583;:',
 'info_question_gerer_statistiques' => '&#1570;&#1610;&#1575; &#1605;&#1610;&#1582;&#1608;&#1575;&#1607;&#1610;&#1583; &#1587;&#1575;&#1610;&#1578;&#1578;&#1575;&#1606; &#1570;&#1605;&#1575;&#1585; &#1576;&#1610;&#1606;&#1606;&#1583; &#1711;&#1575;&#1606; &#1585;&#1575; &#1575;&#1583;&#1575;&#1585;&#1607; &#1603;&#1606;&#1583;&#1567;',
@@ -698,6 +696,12 @@
 
 // S
 'statut_admin_restreint' => '(&#1575;&#1583;&#1575;&#1585;&#1607; &#1605;&#1581;&#1583;&#1608;&#1583;)',
+'syndic_choix_moderation' => '&#1576;&#1585;&#1575;&#1740; &#1662;&#1740;&#1608;&#1606;&#1583;&#1607;&#1575;&#1740; &#1576;&#1593;&#1583;&#1740; &#1575;&#1586; &#1587;&#1608;&#1740; &#1575;&#1740;&#1606; &#1587;&#1575;&#1740;&#1578; &#1670;&#1607; &#1705;&#1575;&#1585; &#1605;&#1740;&#1705;&#1606;&#1740;&#1583;&#1567;',
+'syndic_choix_oublier' => '&#1576;&#1585;&#1575;&#1740; &#1662;&#1740;&#1608;&#1606;&#1583;&#1607;&#1575;&#1740;&#1740; &#1705;&#1607; &#1583;&#1585; &#1601;&#1575;&#1740;&#1604; &#1587;&#1575;&#1740;&#1578;&#1607;&#1575;&#1740; &#1605;&#1585;&#1580;&#1593; &#1740;&#1575;&#1601;&#1578; &#1606;&#1605;&#1740;&#1588;&#1608;&#1606;&#1583; &#1670;&#1607; &#1605;&#1740;&#1705;&#1606;&#1740;&#1583;&nbsp;&#1567;',
+'syndic_lien_obsolete' => '&#1662;&#1740;&#1608;&#1606;&#1583; &#1576;&#1740;&#1601;&#1575;&#1740;&#1583;&#1607;',
+'syndic_option_miroir' => '&#1576;&#1591;&#1608;&#1585; &#1582;&#1608;&#1583;&#1705;&#1575;&#1585; &#1605;&#1587;&#1583;&#1608;&#1583; &#1705;&#1606;&#1740;&#1583;',
+'syndic_option_oubli' => '&#1662;&#1575;&#1705; &#1705;&#1606;&#1740;&#1583; (&#1662;&#1587; &#1575;&#1586; @mois@&nbsp;&#1605;&#1575;&#1607;)',
+'syndic_options' => '&#1711;&#1586;&#1740;&#1606;&#1588; &#1587;&#1575;&#1740;&#1578;&#1607;&#1575;&#1740; &#1605;&#1585;&#1580;&#1593; :',
 
 
 // T
@@ -742,7 +746,6 @@
 'texte_date_publication_anterieure' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1606;&#1711;&#1575;&#1585;&#1588; &#1602;&#1576;&#1604;&#1609;:',
 'texte_date_publication_anterieure_nonaffichee' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1606;&#1711;&#1575;&#1585;&#1588; &#1602;&#1576;&#1604;&#1609; &#1585;&#1575; &#1575;&#1593;&#1604;&#1575;&#1606; &#1606;&#1603;&#1606;&#1610;&#1583;.',
 'texte_date_publication_article' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1575;&#1606;&#1578;&#1588;&#1575;&#1585; &#1576;&#1585;&#1608;&#1609; &#1578;&#1575;&#1585;&#1606;&#1605;&#1575;:',
-'texte_demander_blocage_priori' => '&#1662;&#1610;&#1608;&#1606;&#1583;&#1607;&#1575;&#1609; &#1576;&#1593;&#1583;&#1609; &#1575;&#1586; &#1605;&#1576;&#1583;&#1575; &#1575;&#1610;&#1606; &#1587;&#1575;&#1610;&#1578; &#1592;&#1575;&#1607;&#1585;&#1575; &#1605;&#1587;&#1583;&#1608;&#1583; &#1588;&#1583;&#1607; &#1575;&#1606;&#1583;. ',
 'texte_descriptif_petition' => '&#1578;&#1608;&#1589;&#1610;&#1601; &#1587;&#1582;&#1606;&#1711;&#1575;&#1607;',
 'texte_descriptif_rapide' => '&#1578;&#1608;&#1589;&#1610;&#1601; &#1587;&#1585;&#1610;&#1593;',
 'texte_documents_joints' => '&#1588;&#1605;&#1575; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1610;&#1583; &#1575;&#1587;&#1606;&#1575;&#1583; &#1585;&#1575; &#1603;&#1607; &#1588;&#1575;&#1605;&#1604; &#1601;&#1575;&#1610;&#1604;&#1607;&#1575;&#1548; &#1578;&#1589;&#1575;&#1608;&#1610;&#1585;&#1548; &#1605;&#1608;&#1604;&#1578;&#1609; &#1605;&#1583;&#1610;&#1575; &#1608;... &#1605;&#1610;&#1588;&#1608;&#1583; &#1585;&#1575; &#1576;&#1607; &#1605;&#1602;&#1575;&#1604;&#1575;&#1578; &#1608; &#1610;&#1575; &#1576;&#1607; &#1576;&#1582;&#1588;&#1607;&#1575; &#1575;&#1590;&#1575;&#1601;&#1607; &#1603;&#1606;&#1610;&#1583;. &#1575;&#1610;&#1606; &#1601;&#1575;&#1610;&#1604;&#1607;&#1575; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1606;&#1583; &#1576;&#1607; &#1605;&#1602;&#1575;&#1604;&#1607; &#1662;&#1610;&#1608;&#1606;&#1583; &#1586;&#1583;&#1607; &#1588;&#1608;&#1606;&#1583; &#1610;&#1575; &#1575;&#1610;&#1606;&#1603;&#1607; &#1576;&#1591;&#1608;&#1585; &#1580;&#1583;&#1575!
 ;&#1711;&#1575;&#1606;&#1607; &#1592;&#1575;&#1607;&#1585; &#1588;&#1608;&#1606;&#1583;.',
@@ -762,7 +765,6 @@
 'texte_jeu_caractere_2' => '&#1575;&#1610;&#1606; &#1585;&#1711;&#1604;&#1575;&#1688; &#1578;&#1575;&#1579;&#1610;&#1585;&#1609; &#1576;&#1605;&#1575;&#1587;&#1576;&#1602; &#1606;&#1583;&#1575;&#1585;&#1583;. &#1583;&#1585; &#1606;&#1578;&#1610;&#1580;&#1607; &#1605;&#1578;&#1606; &#1607;&#1575;&#1610;&#1609; &#1603;&#1607; &#1602;&#1576;&#1604;&#1575; &#1608;&#1575;&#1585;&#1583; &#1587;&#1575;&#1610;&#1578; &#1588;&#1583;&#1606;&#1583;&#1548; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1606;&#1583; &#1583;&#1585; &#1662;&#1609; &#1575;&#1589;&#1604;&#1575;&#1581; &#1585;&#1711;&#1604;&#1575;&#1688;&#1548; &#1576;&#1589;&#1608;&#1585;&#1578; &#1606;&#1575;&#1583;&#1585;&#1587;&#1578; &#1606;&#1605;&#1575;&#1610;&#1575;&#1606; &#1588;&#1608;&#1606;&#1583;.&#1583;&#1585; &#1607;&#1585; &#1589;&#1608;&#1585;&#1578; &#1588;&#1605;&#1575; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1610;&#1583; &#1576;&#1583;&#1608;&#1606; &#1607;&#1610;&#1670; &#1605;&#1588;&#1603;&#1604;&#160!
 9; &#1576;&#1607; &#1585;&#1711;&#1604;&#1575;&#1688; &#1587;&#1575;&#1576;&#1602; &#1576;&#1585;&#1711;&#1585;&#1583;&#1610;&#1583;.',
 'texte_lien_hypertexte' => '&#1575;&#1711;&#1585; &#1662;&#1610;&#1575;&#1605;&#1578;&#1575;&#1606; &#1576;&#1607; &#1610;&#1603; &#1605;&#1602;&#1575;&#1604;&#1607; &#1583;&#1585; &#1578;&#1575;&#1585;&#1606;&#1605;&#1575; &#1605;&#1585;&#1576;&#1608;&#1591; &#1605;&#1610;&#1588;&#1608;&#1583;&#1548; &#1610;&#1575; &#1576;&#1607; &#1610;&#1603; &#1589;&#1601;&#1581;&#1607; &#1576;&#1575; &#1575;&#1591;&#1604;&#1575;&#1593;&#1575;&#1578; &#1576;&#1610;&#1588;&#1578;&#1585;&#1548; &#1582;&#1608;&#1575;&#1607;&#1588;&#1605;&#1606;&#1583; &#1575;&#1587;&#1578; &#1603;&#1607; &#1593;&#1606;&#1608;&#1575;&#1606; &#1589;&#1601;&#1581;&#1607; &#1608; &#1570;&#1583;&#1585;&#1587; &#1570;&#1606;&#1585;&#1575; &#1583;&#1585; &#1586;&#1610;&#1585; &#1605;&#1588;&#1582;&#1589; &#1603;&#1606;&#1610;&#1583;.',
 'texte_liens_sites_syndiques' => '&#1662;&#1610;&#1608;&#1606;&#1583;&#1607;&#1575;&#1609; &#1605;&#1585;&#1576;&#1608;&#1591; &#1576;&#1607; &#1587;&#1575;&#1610;&#1578;&#1607;&#1575;&#1609; &#1605;&#1585;&#1580;&#1593; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1606;&#1583; &#1605;&#1587;&#1583;&#1608;&#1583; &#1588;&#1608;&#1606;&#1583;&#1548; &#1587;&#1662;&#1587; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1610;&#1583; &#1570;&#1606;&#1607;&#1575; &#1585;&#1575; &#1578;&#1603; &#1578;&#1603; &#1576;&#1575;&#1586; &#1603;&#1606;&#1610;&#1583; &#1610;&#1575; &#1575;&#1610;&#1606;&#1603;&#1607; &#1587;&#1575;&#1610;&#1578; &#1576;&#1607; &#1587;&#1575;&#1610;&#1578; &#1662;&#1610;&#1608;&#1606;&#1583;&#1607;&#1575;&#1609; &#1570;&#1610;&#1606;&#1583;&#1607; &#1585;&#1575; &#1605;&#1587;&#1583;&#1608;&#1583; &#1603;&#1606;&#1610;&#1583;. ',
-'texte_liens_syndication' => '&#1662;&#1610;&#1608;&#1606;&#1583;&#1607;&#1575;&#1609; &#1570;&#1610;&#1606;&#1583;&#1607; &#1575;&#1586; &#1605;&#1576;&#1583;&#1575; &#1575;&#1610;&#1606; &#1587;&#1575;&#1610;&#1578; &#1601;&#1608;&#1585;&#1575; &#1576;&#1585;&#1608;&#1609; &#1587;&#1575;&#1610;&#1578; &#1607;&#1605;&#1711;&#1575;&#1606;&#1609; &#1606;&#1605;&#1575;&#1610;&#1575;&#1606; &#1582;&#1608;&#1575;&#1607;&#1606;&#1583; &#1588;&#1583;.',
 'texte_login_ldap_1' => '(&#1576;&#1585;&#1575;&#1609; &#1608;&#1585;&#1608;&#1583; &#1576;&#1609; &#1606;&#1575;&#1605;&#1548; &#1582;&#1575;&#1604;&#1609; &#1576;&#1711;&#1584;&#1575;&#1585;&#1610;&#1583;&#1548; &#1610;&#1575; &#1578;&#1605;&#1575;&#1605; &#1605;&#1587;&#1610;&#1585; &#1585;&#1575; &#1583;&#1585;&#1580; &#1603;&#1606;&#1610;&#1583;&#1548; &#1576;&#1585;&#1575;&#1609; &#1605;&#1579;&#1575;&#1604;&laquo;&nbsp;<tt>uid=dupont, ou=users, dc=mon-domaine, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => '&#1578;&#1608;&#1580;&#1607; ! &#1588;&#1605;&#1575; &#1576;&#1575; &#1575;&#1610;&#1606; &#1603;&#1583; &#1605;&#1578;&#1589;&#1604; &#1588;&#1583;&#1610;&#1583;. &#1575;&#1586; &#1575;&#1610;&#1606; &#1662;&#1585;&#1587;&#1588;&#1606;&#1575;&#1605;&#1607; &#1576;&#1575; &#1575;&#1581;&#1578;&#1610;&#1575;&#1591; &#1575;&#1587;&#1578;&#1601;&#1575;&#1583;&#1607; &#1603;&#1606;&#1610;&#1583;.',
 'texte_message_edit' => '&#1578;&#1608;&#1580;&#1607; ! &#1575;&#1610;&#1606; &#1662;&#1610;&#1575;&#1605; &#1605;&#1610;&#1578;&#1608;&#1575;&#1606;&#1583; &#1578;&#1608;&#1587;&#1591; &#1607;&#1605;&#1607; &#1711;&#1585;&#1583;&#1575;&#1606;&#1606;&#1583;&#1711;&#1575;&#1606; &#1587;&#1575;&#1610;&#1578; &#1575;&#1589;&#1604;&#1575;&#1581; &#1588;&#1608;&#1583;&#1548; &#1608; &#1576;&#1585;&#1575;&#1609; &#1607;&#1605;&#1607; &#1606;&#1608;&#1610;&#1587;&#1606;&#1583;&#1711;&#1575;&#1606; &#1602;&#1575;&#1576;&#1604; &#1585;&#1608;&#1610;&#1578; &#1575;&#1587;&#1578;. &#1575;&#1586; &#1575;&#1593;&#1604;&#1575;&#1606;&#1575;&#1578; &#1601;&#1602;&#1591; &#1576;&#1585;&#1575;&#1609; &#1593;&#1585;&#1590;&#1607; &#1608;&#1602;&#1575;&#1610;&#1593; &#1605;&#1607;&#1605; &#1587;&#1575;&#1610;&#1578; &#1575;&#1587;&#1578;&#1601;&#1575;&#1583;&#1607; &#1603;&#1606;&#1610;&#1583;.',

Index: ecrire_es.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_es.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- ecrire_es.php3	30 Jun 2005 10:09:38 -0000	1.4
+++ ecrire_es.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -73,9 +73,9 @@
 'bouton_radio_envoi_annonces_adresse' => 'Enviar los anuncios a la direcci&oacute;n:',
 'bouton_radio_envoi_liste_nouveautes' => 'Enviar la lista de novedades',
 'bouton_radio_moderation_priori' => 'Moderado a priori (las contribuciones no aparecen hasta ser validadas por una persona con derechos de administraci&oacute;n en el sitio).',
-'bouton_radio_modere_abonnement' => 'moderado (s&oacute;lo para abonados)',
-'bouton_radio_modere_posteriori' => 'moderado a posteriori',
-'bouton_radio_modere_priori' => 'moderado a priori',
+'bouton_radio_modere_abonnement' => '<MODIF>moderado (s&oacute;lo para abonados)',
+'bouton_radio_modere_posteriori' => '<MODIF>moderado a posteriori',
+'bouton_radio_modere_priori' => '<MODIF>moderado a priori',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'No aparecer en la lista de redactores y redactoras',
 'bouton_radio_non_envoi_annonces_editoriales' => 'No enviar anuncios editoriales',
 'bouton_radio_non_syndication' => 'Ninguna sindicaci&oacute;n',
@@ -229,7 +229,6 @@
 'info_ajout_participant' => 'El participante siguiente ha sido a&ntilde;adido:',
 'info_ajouter_rubrique' => 'A&ntilde;adir otra secci&oacute;n para administrar',
 'info_annonce_nouveautes' => 'Anunciar novedades',
-'info_annuler_blocage_priori' => 'Anular el bloqueo a priori',
 'info_anterieur' => 'anterior',
 'info_appliquer_choix_moderation' => 'Aplicar este tipo de moderaci&oacute;n',
 'info_article' => 'art&iacute;culo',
@@ -251,6 +250,7 @@
 'info_avertissement' => 'Advertencia',
 'info_base_installee' => 'La estructura de tu base de datos ha sido instalada',
 'info_base_restauration' => 'La base est&aacute; siendo restaurada',
+'info_bloquer' => '<NEW>bloquer',
 'info_breves' => 'Puedes utilizar el sisteme de breves',
 'info_breves_03' => 'breves',
 'info_breves_liees_mot' => 'Las breves ligadas a esta palabra clave',
@@ -288,7 +288,6 @@
 'info_delet_mots_cles' => 'Has solicitado la supresi&oacute;n de la palabra clave 
 <B>@titre_mot@</b> (@type_mot@) que esta ligada a 
 <b>@texte_lie@</b>. Por favor, confirma tu decisi&oacute;n.',
-'info_demander_blocage_priori' => 'Pedir un bloqueo a priori',
 'info_derniere_etape' => 'Ultima etapa: <B>Hemos terminado!',
 'info_derniere_syndication' => 'La &uacute;ltima sindicaci&oacute;n de este sitio fue realizada el',
 'info_derniers_articles_publies' => 'Tus &uacute;ltimos art&iacute;culos publicados',
@@ -446,6 +445,7 @@
 'info_procedez_par_etape' => 'proceder etapa por etapa',
 'info_procedure_maj_version' => 'la actulizaci&oacute;n debe ser realizada para adaptar la base de datos a esta nueva versi&oacute;n de SPIP.',
 'info_ps' => 'P.S',
+'info_publier' => '<NEW>publier',
 'info_publies' => 'Tus art&iacute;culos publicados',
 'info_question_accepter_visiteurs' => 'Si en los esqueletos de tu sitio est&aacute; previsto el registro de visitantes sin acceso al espacio privado, tendr&aacute;s que activar la opci&oacute;n siguiente:',
 'info_question_gerer_statistiques' => '&iquest;Deseas que tu sitio gestione las estad&iacute;sticas de las visitas?',
@@ -700,6 +700,12 @@
 
 // S
 'statut_admin_restreint' => '(administrador restringido)',
+'syndic_choix_moderation' => '<NEW>Que faire des prochains liens en provenance de ce site&nbsp;?',
+'syndic_choix_oublier' => '<NEW>Que faire des liens qui ne figurent plus dans le fichier de syndication&nbsp;?',
+'syndic_lien_obsolete' => '<NEW>lien obsol&egrave;te',
+'syndic_option_miroir' => '<NEW>les bloquer automatiquement',
+'syndic_option_oubli' => '<NEW>les effacer (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => '<NEW>Options de syndication&nbsp;:',
 
 
 // T
@@ -745,7 +751,6 @@
 'texte_date_publication_anterieure' => 'Fecha de redacci&oacute;n anterior:',
 'texte_date_publication_anterieure_nonaffichee' => 'No mostrar fecha de redacci&oacute;n anterior.',
 'texte_date_publication_article' => 'Fecha de publicaci&oacute;n en l&iacute;nea:',
-'texte_demander_blocage_priori' => 'Los pr&oacute;ximos enlaces procedentes de este sitio ser&aacute;n, a priori, bloqueados.',
 'texte_descriptif_petition' => 'Descripci&oacute;n de la petici&oacute;n',
 'texte_descriptif_rapide' => 'Descripci&oacute;n r&aacute;pida',
 'texte_documents_joints' => 'Puedes autorizar el a&ntilde;adir documentos (archivos de ofim&aacute;tica, im&aacute;genes,
@@ -768,7 +773,6 @@
 'texte_jeu_caractere_2' => 'Este reglaje no tiene efecto retroactivo. Por lo tanto, los textos incluidos anteriormente pueden mostrarse incorrectamente despu&eacute;s de una modificaci&oacute;n del reglaje. En todos los casos, puedes, sin riesgos, volver a la configuraci&oacute;n anterior.',
 'texte_lien_hypertexte' => '(Si tu mensaje se refiere a un art&iacute;culo publicado en la Web, o a una p&aacute;gina que contiene m&aacute;s informaciones, indica a continuaci&oacute;n el t&iacute;tulo de la p&aacute;gina y su direcci&oacute;n URL.)',
 'texte_liens_sites_syndiques' => 'Los enlaces salidos de los sitios sindicados pueden ser bloqueados a priori; el ajuste indicado a continuaci&oacute;n se refiere al ajuste por defecto de los sitios sindicados despu&eacute;s de su creaci&oacute;n. De todos modos, posteriormente se puede desbloquear cada enlace individualmente, o escoger, sitio a sitio, bloquear los enlaces que viene de tal o cual sitio.',
-'texte_liens_syndication' => 'Los pr&oacute;ximos enlaces con procedencia de este sitio se mostrar&aacute;n inmediatamente en el sitio p&uacute;blico.',
 'texte_login_ldap_1' => '(Dejar en blanco para un acceso an&oacute;nimo, o indicar la ruta completa, por ejemplo "<tt>uid=perez, ou=users, dc=mi-dominio, dc=com</tt>".)',
 'texte_login_precaution' => '&iexcl;Atenci&oacute;n! Este es el identificante con el cual est&aacute;s conectado actualmente.
 Utiliza este formulario con precauci&oacute;n...',

Index: spip_oc_va.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_va.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_va.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ spip_oc_va.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -32,7 +32,7 @@
 'avis_echec_syndication_02' => 'La sindicacion a mau capitat: impossible d\'accedir v&egrave;rs lo backend d\'aqueu sit.',
 'avis_erreur' => 'Error: veatz &ccedil;ai sos',
 'avis_erreur_connexion' => 'Error de connexion',
-'avis_erreur_cookie' => 'probl&egrave;ma de cookie',
+'avis_erreur_cookie' => '<MODIF>probl&egrave;ma de cookie',
 'avis_erreur_fonction_contexte' => 'Error de programacion. Chau pas apelar aquela foncion dins aqueu cont&egrave;xt.',
 'avis_erreur_mysql' => 'Error MySQL ',
 'avis_erreur_sauvegarde' => 'Error dins la sauvagarda (@type@ @id_objet@)! ',
@@ -258,8 +258,8 @@
 'form_prop_sujet' => 'Subj&egrave;cte',
 'form_prop_url_site' => 'Adrei&ccedil;a (URL) dau sit',
 'forum_acces_refuse' => 'Po&egrave;tz pas pus accedir v&egrave;rs aqueles forums.',
-'forum_attention_dix_caracteres' => '<b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
-'forum_attention_trois_caracteres' => '<b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
+'forum_attention_dix_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
+'forum_attention_trois_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
 'forum_avez_selectionne' => 'Av&egrave;tz seleccionat:',
 'forum_cliquer_retour' => 'Clicatz <a href=\'@retour_forum@\'>aic&iacute;</a> per contunhar.',
 'forum_forum' => 'forum',

Index: spip_zh.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_zh.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_zh.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_zh.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -24,6 +24,7 @@
 'admin_modifier_rubrique' => '&#20462;&#25913;&#27492;&#26639;',
 'admin_recalculer' => '&#21047;&#26032;&#39029;&#38754;',
 'alerte_maj_impossible' => '<b>&#35686;&#21578;!</b> &#26356;&#26032;MySQL&#21040;&#29256;&#26412; @version@&#22833;&#36133;, &#21487;&#33021;&#26159;&#25968;&#25454;&#24211;&#26435;&#38480;&#38382;&#39064;. &#35831;&#32852;&#31995;&#24744;&#30340;ISP(INTERNET&#26381;&#21153;&#25552;&#20379;&#21830;) .',
+'analyse_xml' => '<NEW>Analyse XML',
 'avis_archive_incorrect' => '&#25171;&#21253;&#25991;&#20214;&#19981;&#26159;&#26377;&#25928;&#30340;SPIP&#25991;&#20214;',
 'avis_archive_invalide' => '&#25171;&#21253;&#25991;&#20214;&#26080;&#25928;',
 'avis_attention' => '&#27880;&#24847;!',

Index: spip_ro.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_ro.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spip_ro.php3	30 Jun 2005 10:09:37 -0000	1.1
+++ spip_ro.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -32,7 +32,7 @@
 'avis_echec_syndication_02' => 'Sindicalizarea a e&#351;uat: imposibil de accesat backend-ul acestui site.',
 'avis_erreur' => 'Eroare: vede&#355;i mai jos',
 'avis_erreur_connexion' => 'Eroare de conexiune',
-'avis_erreur_cookie' => 'Eroare de conexiune MySQL',
+'avis_erreur_cookie' => 'problem&#259; de cookie',
 'avis_erreur_fonction_contexte' => 'Eroare de programare. Aceast&#259; func&#355;ie nu trebuie chemat&#259; &icirc;n acest context.',
 'avis_erreur_mysql' => 'Eroare MySQL',
 'avis_erreur_sauvegarde' => 'Eroare &icirc;n timpul salv&#259;rii (@type@ @id_objet@) !',
@@ -60,6 +60,7 @@
 'bouton_changer' => 'Schimba&#355;i',
 'bouton_chercher' => 'C&#259;uta&#355;i',
 'bouton_choisir' => 'Alege&#355;i',
+'bouton_enregistrer' => '&Icirc;nregistra&#355;i',
 'bouton_radio_desactiver_messagerie_interne' => 'Dezactiva&#355;i mesageria intern&#259;',
 'bouton_radio_envoi_annonces' => 'Trimite&#355;i anun&#355;urile editoriale',
 'bouton_radio_non_envoi_annonces' => 'Nu trimite&#355;i anun&#355;uri',
@@ -185,6 +186,7 @@
 
 
 // F
+'fichier_introuvable' => 'Fi&#351;ier @fichier@ de neg&#259;sit',
 'form_deja_inscrit' => 'Sunte&#355;i deja &icirc;nscris.',
 'form_email_non_valide' => 'Adresa dumneavoastr&#259; de email nu este valabil&#259;.',
 'form_forum_access_refuse' => 'Nu mai ave&#355;i dreptul de acces la acest site.',
@@ -251,8 +253,8 @@
 'form_prop_sujet' => 'Subiect',
 'form_prop_url_site' => 'Adresa (URL-ul) site-ului',
 'forum_acces_refuse' => 'Nu mai ave&#355;i acces la aceste forum-uri.',
-'forum_attention_dix_caracteres' => '<b>Aten&#355;ie&nbsp;!</b> mesajul dumneavoastr&#259; con&#355;ine mai pu&#355;in de zece caractere.',
-'forum_attention_trois_caracteres' => '<b>Aten&#355;ie&nbsp;!</b> titlul dumneavoastr&#259; con&#355;ine mai pu&#355;in de trei caractere.',
+'forum_attention_dix_caracteres' => '<b>Aten&#355;ie&nbsp;!</b> mesajul dumneavoastr&#259; trebuie s&#259; con&#355;in&#259; cel pu&#355;in  zece caractere.',
+'forum_attention_trois_caracteres' => '<b>Aten&#355;ie&nbsp;!</b> titlul dumneavoastr&#259; trebuie s&#259; con&#355;in&#259; cel pu&#355;in trei caractere.',
 'forum_avez_selectionne' => 'A&#355;i selec&#355;ionat&nbsp;:',
 'forum_cliquer_retour' => 'Face&#355;i click <a href=\'@retour_forum@\'>aici</a> pentru a continua.',
 'forum_forum' => 'forum',

Index: spip_tr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_tr.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spip_tr.php3	30 Jun 2005 10:09:38 -0000	1.1
+++ spip_tr.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Bu b&ouml;l&uuml;m&uuml; de&#287;i&#351;tiriniz',
 'admin_recalculer' => 'Bu sayfayi yeniden yaratiniz',
 'alerte_maj_impossible' => '<b>Dikkat&nbsp;!</b> MySQL veri tabaninin @version@ s&uuml;r&uuml;m&uuml;ne g&uuml;ncellenmesi imkansiz. Sorun haklardan kaynaklaniyor olabilir, l&uuml;tfen sitenizi barindiran sirkete basvurunuz.',
+'analyse_xml' => 'XML analizi',
 'avis_archive_incorrect' => 'arsiv dosyasi SPIP dosyasi degil',
 'avis_archive_invalide' => 'dosya ge&ccedil;erli degil',
 'avis_attention' => 'D&#304;KKAT&nbsp;!',

Index: spip_es.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_es.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_es.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_es.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar esta secci&oacute;n',
 'admin_recalculer' => 'Actualizar esta p&aacute;gina',
 'alerte_maj_impossible' => '<b>&iexcl;Alerta!</b> La actualizaci&oacute;n de la base MySQL hacia la versi&oacute;n  @version@ es imposible, quiz&aacute; por un problema de derechos de modificaci&oacute;n en la base de datos. Por favor, contacta al administrador de tu hospedaje.',
+'analyse_xml' => '<NEW>Analyse XML',
 'avis_archive_incorrect' => 'El archivo de respaldo no es un archivo SPIP.',
 'avis_archive_invalide' => 'el archivo de respaldo no es v&aacute;lido',
 'avis_attention' => '&iexcl;ATENCI&Oacute;N!',

Index: ecrire_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_fr.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_fr.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_fr.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -84,9 +84,9 @@
 'bouton_radio_moderation_priori' => 'Mod&eacute;ration &agrave; priori (les
 	contributions ne s\'affichent publiquement qu\'apr&egrave;s validation par les
 	administrateurs).',
-'bouton_radio_modere_abonnement' => 'mod&eacute;r&eacute; sur abonnement',
-'bouton_radio_modere_posteriori' => 'mod&eacute;r&eacute; &agrave; posteriori',
-'bouton_radio_modere_priori' => 'mod&eacute;r&eacute; &agrave; priori',
+'bouton_radio_modere_abonnement' => 'sur abonnement',
+'bouton_radio_modere_posteriori' => 'mod&eacute;ration &agrave; posteriori',
+'bouton_radio_modere_priori' => 'mod&eacute;ration &agrave; priori',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Ne pas appara&icirc;tre dans la liste des r&eacute;dacteurs',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Ne pas envoyer d\'annonces &eacute;ditoriales',
 'bouton_radio_non_syndication' => 'Pas de syndication',
@@ -252,8 +252,6 @@
 'info_ajout_participant' => 'Le participant suivant est ajout&eacute;&nbsp;:',
 'info_ajouter_rubrique' => 'Ajouter une autre rubrique &agrave; administrer&nbsp;:',
 'info_annonce_nouveautes' => 'Annonce des nouveaut&eacute;s',
-'info_annuler_blocage_priori' => 'Annuler
-				ce blocage a priori',
 'info_anterieur' => 'ant&eacute;rieure',
 'info_appliquer_choix_moderation' => 'Appliquer ce choix de mod&eacute;ration&nbsp;:',
 'info_article' => 'article',
@@ -275,6 +273,7 @@
 'info_avertissement' => 'Avertissement',
 'info_base_installee' => 'La structure de votre base de donn&eacute;es est install&eacute;e.',
 'info_base_restauration' => 'La base est en cours de restauration.',
+'info_bloquer' => 'bloquer',
 'info_breves' => 'Votre site utilise-t-il le syst&egrave;me de br&egrave;ves&nbsp;?',
 'info_breves_03' => 'br&egrave;ves',
 'info_breves_liees_mot' => 'Les br&egrave;ves li&eacute;es &agrave; ce mot-cl&eacute;',
@@ -312,8 +311,6 @@
 'info_delet_mots_cles' => 'Vous avez	demand&eacute; &agrave; supprimer le mot-cl&eacute;
 <B>@titre_mot@</B> (@type_mot@). Ce mot-cl&eacute; &eacute;tant li&eacute; &agrave;
 <b>@texte_lie@</b> vous devez confirmer cette d&eacute;cision&nbsp;:',
-'info_demander_blocage_priori' => 'Demander
-				un blocage a priori',
 'info_derniere_etape' => 'Derni&egrave;re &eacute;tape : <B>C\'est termin&eacute; !',
 'info_derniere_syndication' => 'La derni&egrave;re syndication de ce site a &eacute;t&eacute; effectu&eacute;e le',
 'info_derniers_articles_publies' => 'Vos derniers articles publi&eacute;s en ligne',
@@ -493,6 +490,7 @@
 'info_procedure_maj_version' => 'la proc&eacute;dure de mise &agrave; jour doit &ecirc;tre lanc&eacute;e afin d\'adapter
 	la base de donn&eacute;es &agrave; la nouvelle version de SPIP.',
 'info_ps' => 'P.S',
+'info_publier' => 'publier',
 'info_publies' => 'Vos articles publi&eacute;s en ligne',
 'info_question_accepter_visiteurs' => 'Si les squelettes de votre site pr&eacute;voient l\'enregistrement de visiteurs sans acc&egrave;s &agrave; l\'espace priv&eacute;, veuillez activer l\'option ci-dessous&nbsp;:',
 'info_question_gerer_statistiques' => 'Votre site doit-il g&eacute;rer les statistiques des visites&nbsp;?',
@@ -757,6 +755,12 @@
 
 // S
 'statut_admin_restreint' => '(admin restreint)',
+'syndic_choix_moderation' => 'Que faire des prochains liens en provenance de ce site&nbsp;?',
+'syndic_choix_oublier' => 'Que faire des liens qui ne figurent plus dans le fichier de syndication&nbsp;?',
+'syndic_lien_obsolete' => 'lien obsol&egrave;te',
+'syndic_option_miroir' => 'les bloquer automatiquement',
+'syndic_option_oubli' => 'les effacer (apr&egrave;s @mois@&nbsp;mois)',
+'syndic_options' => 'Options de syndication&nbsp;:',
 
 
 // T
@@ -820,8 +824,6 @@
 'texte_date_publication_anterieure' => 'Date de r&eacute;daction ant&eacute;rieure&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Ne pas afficher de date de r&eacute;daction ant&eacute;rieure.',
 'texte_date_publication_article' => 'DATE DE PUBLICATION EN LIGNE&nbsp;:',
-'texte_demander_blocage_priori' => 'Les prochains liens en
-				provenance de ce site seront bloqu&eacute;s a priori.',
 'texte_descriptif_petition' => 'Descriptif de la p&eacute;tition',
 'texte_descriptif_rapide' => 'Descriptif rapide',
 'texte_documents_joints' => 'Vous pouvez autoriser l\'ajout de documents (fichiers bureautiques, images,
@@ -863,8 +865,6 @@
 			d&eacute;bloquer chaque lien individuellement, ou de
 			choisir, site par site, de bloquer les liens &agrave; venir
 			de tel ou tel site.',
-'texte_liens_syndication' => 'Les prochains liens en
-				provenance de ce site seront affich&eacute;s imm&eacute;diatement sur le site public.',
 'texte_login_ldap_1' => '(Laisser vide pour un acc&egrave;s anonyme, ou entrer le chemin complet, par exemple &laquo;&nbsp;<tt>uid=dupont, ou=users, dc=mon-domaine, dc=com</tt>&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Attention&nbsp;! Ceci est le login sous lequel vous &ecirc;tes connect&eacute; actuellement.
 	Utilisez ce formulaire avec pr&eacute;caution...',

Index: spip_ja.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_ja.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spip_ja.php3	30 Jun 2005 10:09:37 -0000	1.1
+++ spip_ja.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -16,11 +16,11 @@
 'access_interface_graphique' => '&#23436;&#20840;&#12394;&#12464;&#12521;&#12501;&#12451;&#12459;&#12523;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&#12395;&#25147;&#12427;',
 'access_mode_texte' => '&#12471;&#12531;&#12503;&#12523;&#12394;&#12486;&#12461;&#12473;&#12488;&#12452;&#12531;&#12479;&#12540;&#12501;&#12455;&#12540;&#12473;&#12391;&#34920;&#31034;',
 'admin_debug' => '&#12487;&#12496;&#12483;&#12464;',
-'admin_modifier_article' => '&#12371;&#12398;&#35352;&#20107;&#12434;&#25913;&#12417;&#12427;',
-'admin_modifier_auteur' => '&#12371;&#12398;&#33879;&#32773;&#12395;&#12388;&#12356;&#12390;&#20462;&#27491;',
-'admin_modifier_breve' => '&#12371;&#12398;&#12491;&#12517;&#12540;&#12473;&#12434;&#25913;&#12417;&#12427;',
-'admin_modifier_mot' => '&#12461;&#12540;&#12527;&#12540;&#12489;&#12434;&#22793;&#26356;&#12377;&#12427;',
-'admin_modifier_rubrique' => '&#12371;&#12398;&#12475;&#12463;&#12471;&#12519;&#12531;&#12434;&#25913;&#12417;&#12427;',
+'admin_modifier_article' => '&#12371;&#12398;&#35352;&#20107;&#12434;&#20462;&#27491;',
+'admin_modifier_auteur' => '&#12371;&#12398;&#33879;&#32773;&#12434;&#20462;&#27491;',
+'admin_modifier_breve' => '&#12371;&#12398;&#12491;&#12517;&#12540;&#12473;&#12434;&#20462;&#27491;',
+'admin_modifier_mot' => '&#12371;&#12398;&#12461;&#12540;&#12527;&#12540;&#12489;&#12434;&#20462;&#27491;',
+'admin_modifier_rubrique' => '&#12371;&#12398;&#12475;&#12463;&#12471;&#12519;&#12531;&#12434;&#20462;&#27491;',
 'admin_recalculer' => '&#12506;&#12540;&#12472;&#12398;&#20877;&#35501;&#12415;&#36796;&#12415;',
 'alerte_maj_impossible' => '<b>&#35686;&#21578;</b> My SQL&#12399;&#12289;&#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12434;@version@ &#12395;&#12450;&#12483;&#12503;&#12487;&#12540;&#12488;&#20986;&#26469;&#12414;&#12379;&#12435;&#12391;&#12375;&#12383;&#12290; &#12487;&#12540;&#12479;&#12505;&#12540;&#12473;&#12398;&#12450;&#12463;&#12475;&#12473;&#27177;&#12395;&#21839;&#38988;&#12364;&#12354;&#12427;&#12392;&#24605;&#12431;&#12428;&#12414;&#12377;&#12290;&#12452;&#12531;&#12479;&#12540;&#12493;&#12483;&#12488;&#12469;&#12540;&#12499;&#12473;&#12503;&#12525;&#12496;&#12452;&#12480;&#12395;&#12362;&#21839;&#12356;&#21512;&#12431;&#12379;&#12367;&#12384;&#12373;&#12356;&#12290;',
 'avis_archive_incorrect' => '&#12450;&#12540;&#12459;&#12452;&#12502;&#12364;&#12289;SPIP&#12501;&#12449;&#12452;&#12523;&#12391;&#12399;&#12354;&#12426;&#12414;&#12379;&#12435;&#12290;',
@@ -409,7 +409,7 @@
 'info_inclusion_vignette' => '&#21547;&#12414;&#12428;&#12427;&#12499;&#12493;&#12483;&#12488;(&#21322;&#36523;&#20889;&#30495;&#12289;&#27169;&#27096;&#12394;&#12393;):',
 'info_installation_systeme_publication' => '&#20986;&#29256;&#12471;&#12473;&#12486;&#12512;&#12452;&#12531;&#12473;&#12488;&#12524;&#12540;&#12471;&#12519;&#12531; ...',
 'info_installer_documents' => '&#12354;&#12394;&#12383;&#12399;<i>upload</i>&#12501;&#12457;&#12523;&#12480;&#12395;&#12354;&#12427;&#12377;&#12409;&#12390;&#12398;&#12489;&#12461;&#12517;&#12513;&#12531;&#12488;&#12434;&#33258;&#21205;&#30340;&#12395;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#20986;&#26469;&#12414;&#12377;&#12290;',
-'info_installer_ftp' => '&#31649;&#29702;&#32773;&#12392;&#12375;&#12390;&#12289;&#12354;&#12394;&#12383;&#12399;(FTP&#12395;&#12424;&#12387;&#12390;)ecrire/upload&#12501;&#12457;&#12523;&#12480;&#12395;&#12501;&#12449;&#12452;&#12523;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#24460;&#12377;&#12368;&#12395;&#12289;&#12381;&#12428;&#12425;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12373;&#12428;&#12383;&#12501;&#12449;&#12452;&#12523;&#12434;&#36984;&#25246;&#12377;&#12427;&#12371;&#12392;&#12364;&#20986;&#26469;&#12414;&#12377;&#12290;',
+'info_installer_ftp' => '&#31649;&#29702;&#32773;&#12394;&#12425;ecrire/upload&#12501;&#12457;&#12523;&#12480;&#12395;&#65288;FTP&#12391;&#65289;&#12501;&#12449;&#12452;&#12523;&#12434;&#32622;&#12356;&#12390;&#12362;&#12369;&#12400;&#12289;&#24460;&#12391;&#12371;&#12371;&#12363;&#12425;&#30452;&#25509;&#12381;&#12398;&#12501;&#12449;&#12452;&#12523;&#12434;&#36984;&#25246;&#12391;&#12365;&#12427;&#12424;&#12358;&#12395;&#12394;&#12426;&#12414;&#12377;&#12290;',
 'info_installer_images' => '&#12354;&#12394;&#12383;&#12399;JPEG&#12289;GIF&#12289;PNG&#12501;&#12457;&#12540;&#12510;&#12483;&#12488;&#12398;&#30011;&#20687;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#20986;&#26469;&#12414;&#12377;&#12290;',
 'info_installer_images_dossier' => '/ecrire/upload &#12501;&#12457;&#12523;&#12480;&#12395;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;&#12375;&#12383;&#12501;&#12449;&#12452;&#12523;&#12434;&#12371;&#12371;&#12391;&#36984;&#25246;&#12377;&#12427;&#12371;&#12392;&#12364;&#20986;&#26469;&#12414;&#12377;&#12290;',
 'info_installer_tous_documents' => '&#12377;&#12409;&#12390;&#12398;&#12489;&#12461;&#12517;&#12513;&#12531;&#12488;&#12434;&#12452;&#12531;&#12473;&#12488;&#12540;&#12523;',

Index: ecrire_ro.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_ro.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- ecrire_ro.php3	30 Jun 2005 10:09:37 -0000	1.1
+++ ecrire_ro.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -106,7 +106,7 @@
 // C
 'cache_mode_compresse' => 'Fi&#351;ierele de tampon sunt &icirc;nregistrate &icirc;n mod comprimat.',
 'cache_mode_non_compresse' => 'Fi&#351;ierele de tampon sunt &icirc;nregistrate &icirc;n mod necomprimat.',
-'cache_modifiable_webmestre' => 'Ace&#351;ti parametrii sunt modificabili de c&#259;tre webmaster-ul acestui site.',
+'cache_modifiable_webmestre' => 'Acest parametru est modificabil de c&#259;tre webmaster-ul acestui site.',
 'calendrier_synchro' => 'Dac&#259; folosi&#355;i un soft de agend&#259; compatibil <b>iCal</b>, pute&#355;i s&#259;-l sincroniza&#355;i cu informa&#355;iile de pe site.',
 
 
@@ -118,6 +118,7 @@
 'diff_texte_ajoute' => 'Text ad&#259;ugat',
 'diff_texte_deplace' => 'Text deplasat',
 'diff_texte_supprime' => 'Text &#351;ters',
+'double_clic_inserer_doc' => 'Face&#355;i dublu-clic pentru a insera aceast&#259; scurt&#259;tur&#259; &icirc;n text',
 
 
 // E
@@ -291,7 +292,7 @@
 'info_creer_base' => '<b>Crea&#355;i</b> o nou&#259; baze de date&nbsp;:',
 'info_dans_groupe' => '&Icirc;n grupul :',
 'info_dans_rubrique' => '&Icirc;n rubrica :',
-'info_date_publication_anterieure' => 'Data public&#259;rii anterioare :',
+'info_date_publication_anterieure' => 'Data redact&#259;rii anterioare :',
 'info_date_referencement' => 'DATA DE REFEREN&#354;IERE A ACESTUI SITE&nbsp;:',
 'info_delet_mots_cles' => 'A&#355;i cerut &#351;tergerea cuv&acirc;ntului-cheie
 <b>@titre_mot@</b> (@type_mot@). Acest cuv&acirc;nt-cheie fiind legat de
@@ -360,6 +361,7 @@
 'info_identification_publique' => 'Identitatea dumneavoastr&#259; public&#259;...',
 'info_image_process' => 'V&#259; rug&#259;m s&#259; selec&#355;iona&#355;i cea mai bun&#259; metod&#259; de generare a vini&eacute;telor f&#259;c&acirc;nd click pe imaginea corespunz&#259;toare.',
 'info_image_process2' => '<b>Nota Bene</b> <i> Dac&#259; nici o imagine nu este afi&#351;at&#259;, &icirc;nseamn&#259; ca server-ul care g&#259;zduie&#351;te site-ul dumneavoastr&#259; nu a fost configurat s&#259; foloseasc&#259; unelte de acest tip. Dac&#259; dori&#355;i s&#259; folosi&#355;i aceste func&#355;ii, v&#259; rug&#259;m s&#259;-l contacta&#355;i pe responsabilul tehnic &#351;i s&#259; &icirc;i cere&#355;i instalarea extensiilor &laquo;GD&raquo; sau &laquo;Imagick&raquo;.</i>',
+'info_images_auto' => 'Imagini calculate automat',
 'info_informations_personnelles' => 'Cea de-a cincea etap&#259; : <b>Informa&#355;ii personale</b>',
 'info_inscription_automatique' => '&Icirc;nscrierea automatic&#259; a noi redactori',
 'info_jeu_caractere' => 'Setul de caractere al site-ului',
@@ -493,6 +495,7 @@
 'info_redacteurs' => 'Redactori',
 'info_redaction_en_cours' => '&Icirc;N REDACTARE',
 'info_redirection' => 'Redirijare',
+'info_referencer_doc_distant' => 'Referen&#355;ia&#355;i un document pe internet&nbsp;:',
 'info_refuses' => 'Articolele dumneavoastr&#259; refuzate',
 'info_reglage_ldap' => 'Op&#355;iuni : <b>Reglajele importului LDAP</b>',
 'info_renvoi_article' => '<b>Redirijare.</b> Acest articol trimite la pagina:',
@@ -598,6 +601,9 @@
 'info_visiteur_2' => '&nbsp;al site-ului public',
 'info_visiteurs' => 'Vizitatori',
 'info_visiteurs_02' => 'Vizitatorii site-ului public',
+'install_echec_annonce' => 'Instalarea va e&#351;ua probabil sau va conduce la un site nefunc&#355;ional...',
+'install_extension_mbstring' => 'SPIP nu fonc&#355;ioneaz&#259; cu&nbsp;:',
+'install_extension_php_obligatoire' => 'SPIP are nevoie de extensia php&nbsp;:',
 'install_select_langue' => 'Selec&#355;iona&#355;i o limb&#259; &#351;i face&#355;i click pe butonul &laquo;&nbsp;urm&#259;torul&nbsp;&raquo; pentru a lansa procedura de instalare.',
 'intem_redacteur' => 'redactor',
 'item_accepter_inscriptions' => 'Accepta&#355;i &icirc;nscrierile',
@@ -728,6 +734,7 @@
 
 
 // T
+'taille_cache_image' => 'Imaginile calculate automat de c&#259;tre SPIP (viniete de documente, titluri prezentate sub form&#259; grafic&#259;, func&#355;ii matematice &icirc;n format TeX...) ocup&#259; &icirc;n directorul @dir@ un total de @taille at .',
 'taille_cache_infinie' => 'Acest site nu prevede limitarea m&#259;rimii directorului <code>CACHE/</code>.',
 'taille_cache_maxi' => 'SPIP &icirc;ncearc&#259; s&#259; limiteze m&#259;rimea directorului <code>CACHE/</code> al acestui site la aproximativ <b>@octets@</b> de date.',
 'taille_cache_octets' => 'M&#259;rimea tamponului este acum de @octets at .',
@@ -779,8 +786,8 @@
 'texte_creer_rubrique' => '&Icirc;nainte de a putea scrie articole,
    trebuie s&#259; crea&#355;i o rubric&#259;.',
 'texte_date_creation_article' => 'DATA CRE&#258;RII ARTICOLULUI&nbsp;:',
-'texte_date_publication_anterieure' => 'DATA PUBLIC&#258;RII ANTERIOARE&nbsp;:',
-'texte_date_publication_anterieure_nonaffichee' => 'Nu afi&#351;a&#355;i data de publicare anterioar&#259;.',
+'texte_date_publication_anterieure' => 'DATA REDACT&#258;RII ANTERIOARE&nbsp;:',
+'texte_date_publication_anterieure_nonaffichee' => 'Nu afi&#351;a&#355;i data redact&#259;rii anterioare.',
 'texte_date_publication_article' => 'DATA PUBLIC&#258;RII &Icirc;N LINIE&nbsp;:',
 'texte_demander_blocage_priori' => 'Urm&#259;toarele leg&#259;turi provenind de la
    acest site vor fi blocate &agrave; priori.',
@@ -1002,6 +1009,7 @@
 'titre_sites_tous' => 'Site-urile referen&#355;iate',
 'titre_suivi_petition' => 'Urm&#259;rirea peti&#355;iilor',
 'titre_syndication' => 'Sindicalizarea site-urilor',
+'tout_dossier_upload' => 'Tot dosarul @upload@',
 'trad_article_inexistant' => 'Nu exist&#259; un articol care s&#259; aib&#259; acest numar.',
 'trad_article_traduction' => 'Toate versiunile acestui articol&nbsp;:',
 'trad_deja_traduit' => 'Articolul este d&eacute;j&agrave; o traducere a articolului de fa&#355;&#259;.',

Index: spip_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_fr.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_fr.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_fr.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modifier cette rubrique',
 'admin_recalculer' => 'Recalculer cette page',
 'alerte_maj_impossible' => '<b>Alerte&nbsp;!</b> La mise &agrave; jour de la base MySQL vers la version @version@ est impossible, peut-&ecirc;tre &agrave; cause d\'un probl&egrave;me de droit de modification sur la base de donn&eacute;es. Veuillez contacter votre h&eacute;bergeur.',
+'analyse_xml' => 'Analyse XML',
 'avis_archive_incorrect' => 'le fichier archive n\'est pas un fichier SPIP',
 'avis_archive_invalide' => 'le fichier archive n\'est pas valide',
 'avis_attention' => 'ATTENTION&nbsp;!',

Index: spip_it.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_it.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_it.php3	30 Jun 2005 10:09:38 -0000	1.4
+++ spip_it.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modifica la rubrica',
 'admin_recalculer' => 'Rigenera la pagina',
 'alerte_maj_impossible' => '<b>Attenzione!</b> L\'aggiornamento del database MySQL alla versione @version@ &egrave; impossibile, forse non si possiedono i diritti di modifica nel database. Contattare il proprio fornitore di hosting.',
+'analyse_xml' => 'Analisi XML',
 'avis_archive_incorrect' => 'il file archivio non &egrave; un file SPIP',
 'avis_archive_invalide' => 'il file archivio non &egrave; valido',
 'avis_attention' => 'ATTENZIONE!',

Index: spip_oc_prv.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_prv.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_prv.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ spip_oc_prv.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -32,7 +32,7 @@
 'avis_echec_syndication_02' => 'La sindicacion s\'es encalada: impossible d\'accedir au backend d\'aqueu sit.',
 'avis_erreur' => 'Error: vejatz &ccedil;ai sota',
 'avis_erreur_connexion' => 'Error de connexion',
-'avis_erreur_cookie' => '',
+'avis_erreur_cookie' => '<MODIF>',
 'avis_erreur_fonction_contexte' => 'Error de programacion. Cau pas apelar aquela foncion dins aqueu cont&egrave;xt.',
 'avis_erreur_mysql' => 'Error MySQL ',
 'avis_erreur_sauvegarde' => 'Error dins la sauvagarda (@type@ @id_objet@)! ',
@@ -258,8 +258,8 @@
 'form_prop_sujet' => 'Subj&egrave;cte',
 'form_prop_url_site' => 'Adrei&ccedil;a (URL) dau sit',
 'forum_acces_refuse' => 'Pod&egrave;tz pus accedir a aquelei forums.',
-'forum_attention_dix_caracteres' => '<b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
-'forum_attention_trois_caracteres' => '<b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
+'forum_attention_dix_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre messatge ten mens de d&egrave;tz caract&egrave;rs.',
+'forum_attention_trois_caracteres' => '<MODIF><b>Atencion!</b> v&ograve;stre t&iacute;tol ten mens de tres caract&egrave;rs.',
 'forum_avez_selectionne' => 'Av&egrave;tz seleccionat:',
 'forum_cliquer_retour' => 'Clicatz <a href=\'@retour_forum@\'>aic&iacute;</a> per contunhar.',
 'forum_forum' => 'forum',

Index: ecrire_lb.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_lb.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- ecrire_lb.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ ecrire_lb.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -104,7 +104,7 @@
 // C
 'cache_mode_compresse' => 'D\'Fichier\'en am Cache si komprim&eacute;iert gesp&auml;ichert.',
 'cache_mode_non_compresse' => 'D\'Fichier\'en am Cache si n&euml;t komprim&eacute;iert gesp&auml;ichert.',
-'cache_modifiable_webmestre' => 'D\'Parameteren vum Cache k&euml;nnen vum Webmaster vum Site ge&auml;nnert ginn.',
+'cache_modifiable_webmestre' => 'D&euml;sen Parameter kann vum Webmaster vum Site ge&auml;nnert ginn.',
 'calendrier_synchro' => 'Wann dir en <b>iCal</b>-kompatiblen Agenda benotzt, da k&euml;nnt der d\'Informatiounen mat d&euml;sem Site synchronis&eacute;ieren.',
 
 
@@ -116,6 +116,7 @@
 'diff_texte_ajoute' => 'Text derb&auml;i setzen',
 'diff_texte_deplace' => 'Text ger&eacute;ckelt',
 'diff_texte_supprime' => 'Text gel&auml;scht',
+'double_clic_inserer_doc' => 'Duebel-Klick fir d&euml;s Ofkirzung an den Text ze iwerhuelen',
 
 
 // E
@@ -283,7 +284,7 @@
 'info_creer_base' => 'Eng nei Datebank <b>derb&auml;i setzen</b>:',
 'info_dans_groupe' => 'Am Grupp:',
 'info_dans_rubrique' => 'An der Rubrik:',
-'info_date_publication_anterieure' => '&Eacute;ischten Publikatiounsdatum:',
+'info_date_publication_anterieure' => '&Eacute;ischten Redaktiounsdatum:',
 'info_date_referencement' => 'D&Euml;SE SITE GOUF REFERENZ&Eacute;IERT:',
 'info_delet_mots_cles' => 'Dir w&euml;llt d\'Schl&euml;sselwuert
 <B>@titre_mot@</B> (@type_mot@) l&auml;schen. D&euml;st Wuert ass un
@@ -346,6 +347,7 @@
 'info_identification_publique' => '&Auml;r &ouml;ffentl&euml;ch Identit&eacute;it...',
 'info_image_process' => 'Wielt d&eacute;i bescht Method fir Vignetten ze maachen an deem dier op d\'Bild klickt.',
 'info_image_process2' => '<b>N.B.</b> <i>Wan dier kee Bild gesidd, dann ass de Server n&euml;t fir d&euml;s Fonktionnalit&eacute;it konfigur&eacute;iert. Wann dir se w&euml;llt benotzen, kontakt&eacute;iert een Techniker a froot fir d\'Extensiounen "GD" oder "Imagick".</i>',
+'info_images_auto' => 'Automat&euml;sch berechend Biller',
 'info_informations_personnelles' => 'F&ouml;nnefte Schr&euml;tt: <B>Pers&eacute;inl&euml;ch Informatiounen</B>',
 'info_inscription_automatique' => 'Nei Redakteren automat&euml;sch aschreiwen',
 'info_jeu_caractere' => 'Buchstawen-Kode vum Site',
@@ -464,6 +466,7 @@
 'info_redacteurs' => 'Redakteren',
 'info_redaction_en_cours' => 'AN DER AARBECHT',
 'info_redirection' => '&Euml;mledung',
+'info_referencer_doc_distant' => 'En Dokument vum Internet referenz&eacute;ieren:',
 'info_refuses' => '&Auml;r refus&eacute;iert Artikelen',
 'info_reglage_ldap' => 'Optiounen: <B>Astellen vum LDAP-Import</B>',
 'info_renvoi_article' => '<B>&Euml;mledung.</B> D&euml;sen Artikel weist op d\'S&auml;it:',
@@ -567,6 +570,9 @@
 'info_visiteur_2' => 'vum &ouml;ffentl&euml;che Site',
 'info_visiteurs' => 'Visiteuren',
 'info_visiteurs_02' => 'Visiteuren vum &ouml;ffentl&euml;che Site',
+'install_echec_annonce' => 'D\'Installatioun w&auml;rt warscheinlech n&euml;t fonktionn&eacute;ieren oder zu engem fehlerhaften Site f&eacute;ieren...',
+'install_extension_mbstring' => 'SPIP fonktionn&eacute;iert n&euml;t mat:',
+'install_extension_php_obligatoire' => 'SPIP brauch d\'PHP-Extensioun:',
 'install_select_langue' => 'Wielt eng Sprooch a klickt op de Kn&auml;ppchen "Weider" fir d\'Installatioun ze starten.',
 'intem_redacteur' => 'Redakter',
 'item_accepter_inscriptions' => 'Aschreiwungen unhuelen',
@@ -697,6 +703,7 @@
 
 
 // T
+'taille_cache_image' => 'D&eacute;i automat&euml;sch berechent Biller (Vignetten vun Dokumenter, graphesch Titelen, mathematesch Formelen am TeX-Format...) brauchen am R&eacute;pertoire @dir@ eng Plaz vun @taille at .',
 'taille_cache_infinie' => 'D&euml;se Site huet keng Limite fir d\'Gr&eacute;isst vum Dossier <code>CACHE/</code>.',
 'taille_cache_maxi' => 'SPIP prob&eacute;iert d\'Gr&eacute;isst vum Dossier <code>CACHE/</code> vun d&euml;sem Site op ongef&eacute;ier <b>@octets@</b> ze limit&eacute;ieren.',
 'taille_cache_octets' => 'D\'Gr&eacute;isst vum Cache ass elo @octets at .',
@@ -735,8 +742,8 @@
 'texte_crash_base' => 'Wann &auml;r Datebank ofgestiertz ass, da k&euml;nnt d&euml;r eng automatesch Reparatur prob&eacute;ieren.',
 'texte_creer_rubrique' => 'Ier dier k&euml;nnt en Artikel schreiwen, musst dier eng Rubrik derb&auml;i setzen.',
 'texte_date_creation_article' => 'ARTIKEL DERB&Auml;I GESAT DEN:',
-'texte_date_publication_anterieure' => '&Eacute;ISCHTEN PUBLIKATIOUNS-DATUM:',
-'texte_date_publication_anterieure_nonaffichee' => '&Eacute;ischten Publikatiouns-Datum n&euml;t weisen.',
+'texte_date_publication_anterieure' => '&Eacute;ISCHTEN REDAKTIOUNS-DATUM:',
+'texte_date_publication_anterieure_nonaffichee' => '&Eacute;ischten Redaktiouns-Datum n&euml;t weisen.',
 'texte_date_publication_article' => 'PUBLIZ&Eacute;IRT DEN:',
 'texte_demander_blocage_priori' => 'D&eacute;i n&auml;chst Linken vun d&euml;sem Site ginn fir d\'&eacute;ischt emol block&eacute;iert.',
 'texte_descriptif_petition' => 'Beschreiwung vun der Petitioun',

Index: spip_ca.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_ca.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_ca.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_ca.php3	21 Jul 2005 21:47:13 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => 'Modificar aquesta secci&oacute;',
 'admin_recalculer' => 'Recarregar aquesta p&agrave;gina',
 'alerte_maj_impossible' => '<b>Alerta&nbsp;!</b> L\'actualitzaci&oacute;  de la base de dades MySQL cap a  la versi&oacute; @version@ &eacute;s impossible, pot ser degut a un problema amb els drets de modificaci&oacute; de la base de dades. Si us plau contacteu amb el vostre prove&iuml;dor d\'hostatge.',
+'analyse_xml' => 'An&agrave;lisi XML',
 'avis_archive_incorrect' => 'el fitxer no &eacute;s pas un fitxer SPIP',
 'avis_archive_invalide' => 'el fitxer no &eacute;s pas v&agrave;lid',
 'avis_attention' => ' ATENCI&Oacute;&nbsp;!',
@@ -654,7 +655,7 @@
 'texte_inc_meta_3' => 'del directori <code>ecrire/data/</code>.',
 'texte_statut_en_cours_redaction' => 'en curs de redacci&oacute;',
 'texte_statut_poubelle' => 'a la paperera',
-'texte_statut_propose_evaluation' => 'proposat per l\'evaluaci&oacute;',
+'texte_statut_propose_evaluation' => 'proposat per a l\'avaluaci&oacute;',
 'texte_statut_publie' => 'publicat en l&iacute;nia',
 'texte_statut_refuse' => 'refusat',
 'titre_ajouter_mot_cle' => 'AFEGIR UN MOT CLAU:',

Index: ecrire_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_en.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_en.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_en.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -81,12 +81,12 @@
   being able to post contributions).',
 'bouton_radio_envoi_annonces_adresse' => 'Send announcements to the address:',
 'bouton_radio_envoi_liste_nouveautes' => 'Send latest news list',
-'bouton_radio_moderation_priori' => 'Beforehand moderation (
-	contributions will be shown only after validation by
-	administrators).',
-'bouton_radio_modere_abonnement' => 'moderation by subscription',
-'bouton_radio_modere_posteriori' => 'afterwards moderation',
-'bouton_radio_modere_priori' => 'beforehand moderation',
+'bouton_radio_moderation_priori' => 'Pre-moderation (
+ contributions will be shown only after validation by
+ administrators).',
+'bouton_radio_modere_abonnement' => 'registration required',
+'bouton_radio_modere_posteriori' => 'post-moderation',
+'bouton_radio_modere_priori' => 'pre-moderation',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Do not appear in the list of connected editors',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Do not send any editorial announcements',
 'bouton_radio_non_syndication' => 'No syndication',
@@ -97,8 +97,8 @@
 'bouton_radio_personnalise' => 'Custom character set: choose this option if you want to use a specific character set',
 'bouton_radio_petition_activee' => 'Petition activated',
 'bouton_radio_publication_immediate' => 'Immediate publication of messages
-	(contributions will be shown the moment they are sent, administrators can
-	delete them then).',
+ (contributions will be shown as soon as they are sent, administrators can
+ then delete them).',
 'bouton_radio_sauvegarde_compressee' => 'save as compressed in <b>ecrire/data/dump.xml.gz</b>',
 'bouton_radio_sauvegarde_non_compressee' => 'save as uncompressed in <b>ecrire/data/dump.xml</b>',
 'bouton_radio_supprimer_petition' => 'Delete the petition',
@@ -248,8 +248,6 @@
 'info_ajout_participant' => 'The following participant has been added:',
 'info_ajouter_rubrique' => 'Add another section to manage:',
 'info_annonce_nouveautes' => 'Latest news announcements',
-'info_annuler_blocage_priori' => 'Cancel
-				this beforehand blocking',
 'info_anterieur' => 'previous',
 'info_appliquer_choix_moderation' => 'Apply this choice of moderation:',
 'info_article' => 'article',
@@ -271,6 +269,7 @@
 'info_avertissement' => 'Warning',
 'info_base_installee' => 'The structure of your database is installed.',
 'info_base_restauration' => 'Restoration of the database in progress.',
+'info_bloquer' => 'block',
 'info_breves' => 'Does your site use the news system?',
 'info_breves_03' => 'news items',
 'info_breves_liees_mot' => 'News associated with this keyword',
@@ -308,8 +307,6 @@
 'info_delet_mots_cles' => 'You requested the deletion of keyword
 <B>@titre_mot@</b> (@type_mot@). This keyword being linked to
 <b>@texte_lie@</b>you must confirm this decision:',
-'info_demander_blocage_priori' => 'Request
-				a blocking beforehand',
 'info_derniere_etape' => 'Last step: <B>Done!',
 'info_derniere_syndication' => 'The last syndication of this site was carried out on',
 'info_derniers_articles_publies' => 'Your latest published articles',
@@ -332,10 +329,9 @@
 'info_etape_suivante_1' => 'You can move to the next step.',
 'info_etape_suivante_2' => 'You can move to the next step.',
 'info_exportation_base' => 'export database to @archive@',
-'info_facilite_suivi_activite' => 'To ease the follow-up of the site\'s editorial;
-		activities, SPIP sends by mail, to an editor\'s mailing list for instance,
-		the announcement of
-		publications requests and articles validations.',
+'info_facilite_suivi_activite' => 'To facilitate the follow-up of the site\'s editorial;
+  activities, SPIP can send notification by email, to an editor\'s mailing list for instance,
+  of publication requests and article validations.',
 'info_fichiers_authent' => 'Authentication file ".htpasswd"',
 'info_fonctionnement_forum' => 'Forum operation:',
 'info_forum_administrateur' => 'administrators\' forum',
@@ -488,6 +484,7 @@
 'info_procedure_maj_version' => 'the upgrade procedure should be ran to adapt
 	the database to the new version of SPIP.',
 'info_ps' => 'P.S.',
+'info_publier' => 'publish',
 'info_publies' => 'Your articles published online',
 'info_question_accepter_visiteurs' => 'If your site\'s templates allow visitors to register without entering the private area, please activate the following option:',
 'info_question_gerer_statistiques' => 'Should your site manage visits statistics?',
@@ -752,6 +749,12 @@
 
 // S
 'statut_admin_restreint' => '(restricted admin)',
+'syndic_choix_moderation' => 'What should be done with the next links from this site?',
+'syndic_choix_oublier' => 'What should be done with links which are no longer present in the syndication file?',
+'syndic_lien_obsolete' => 'obsolete link',
+'syndic_option_miroir' => 'block them automatically',
+'syndic_option_oubli' => 'delete them (after @mois@&nbsp;months)',
+'syndic_options' => 'Syndication options:',
 
 
 // T
@@ -818,8 +821,6 @@
 'texte_date_publication_anterieure' => 'Date of earlier publishing:',
 'texte_date_publication_anterieure_nonaffichee' => 'Hide date of earlier publishing.',
 'texte_date_publication_article' => 'DATE OF ONLINE PUBLICATION:',
-'texte_demander_blocage_priori' => 'Future links
-				coming from this site will be blocked beforehand.',
 'texte_descriptif_petition' => 'Petition description',
 'texte_descriptif_rapide' => 'Brief description',
 'texte_documents_joints' => 'You can allow the addition of documents (office files, images,
@@ -861,8 +862,6 @@
 			block each link individually, or to
 			choose, for each site, to block the links coming
 			from any particular site.',
-'texte_liens_syndication' => 'Future links
-				coming from this site will be displayed immediately on the public site.',
 'texte_login_ldap_1' => '(Keep empty for anonymous access or enter complete path, for instance &laquo;<tt>uid=smith, ou=users, dc=my-domain, dc=com</tt>&raquo;.)',
 'texte_login_precaution' => 'Warning! This is the login with which you are connected now.
 	Use this form with caution...',

Index: ecrire_ar.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_ar.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_ar.php3	30 Jun 2005 10:09:37 -0000	1.3
+++ ecrire_ar.php3	21 Jul 2005 21:47:13 -0000	1.4
@@ -84,7 +84,7 @@
 'bouton_radio_moderation_priori' => '&#1605;&#1585;&#1575;&#1602;&#1576;&#1577; &#1573;&#1587;&#1578;&#1576;&#1575;&#1602;&#1610;&#1577; (
 &#1604;&#1575; &#1578;&#1592;&#1607;&#1585; &#1575;&#1604;&#1605;&#1588;&#1575;&#1585;&#1603;&#1575;&#1578; &#1573;&#1604;&#1575; &#1576;&#1593;&#1583; &#1578;&#1589;&#1583;&#1610;&#1602;&#1607;&#1575; &#1605;&#1606; &#1602;&#1576;&#1604;
 &#1575;&#1604;&#1605;&#1583;&#1585;&#1575;&#1569;).',
-'bouton_radio_modere_abonnement' => '&#1605;&#1585;&#1575;&#1602;&#1576;&#1577; &#1576;&#1575;&#1604;&#1573;&#1588;&#1578;&#1585;&#1575;&#1603;',
+'bouton_radio_modere_abonnement' => '&#1575;&#1588;&#1578;&#1585;&#1575;&#1603; &#1573;&#1580;&#1576;&#1575;&#1585;&#1610;',
 'bouton_radio_modere_posteriori' => '&#1605;&#1585;&#1575;&#1602;&#1576;&#1577; &#1576;&#1593;&#1583;&#1610;&#1577;',
 'bouton_radio_modere_priori' => '&#1605;&#1585;&#1575;&#1602;&#1576;&#1577; &#1573;&#1587;&#1578;&#1576;&#1575;&#1602;&#1610;&#1577;',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => '&#1593;&#1583;&#1605; &#1575;&#1604;&#1592;&#1607;&#1608;&#1585; &#1601;&#1610; &#1602;&#1575;&#1574;&#1605;&#1577; &#1575;&#1604;&#1605;&#1581;&#1585;&#1585;&#1610;&#1606;',
@@ -93,7 +93,7 @@
 'bouton_radio_occidental' => '&#1575;&#1604;&#1591;&#1602;&#1605; &#1575;&#1604;&#1604;&#1575;&#1578;&#1610;&#1606;&#1610; (<tt>iso-8859-1</tt>): &#1610;&#1593;&#1585;&#1590; &#1575;&#1587;&#1575;&#1587;&#1575;&#1611;
    &#1604;&#1594;&#1575;&#1578; &#1571;&#1608;&#1585;&#1608;&#1576;&#1575; &#1575;&#1604;&#1594;&#1585;&#1576;&#1610;&#1577; (&#1575;&#1604;&#1575;&#1606;&#1603;&#1604;&#1610;&#1586;&#1610;&#1577; &#1608;&#1575;&#1604;&#1601;&#1585;&#1606;&#1587;&#1610;&#1577; &#1608;&#1575;&#1604;&#1575;&#1604;&#1605;&#1575;&#1606;&#1610;&#1577;...).
    &#1575;&#1604;&#1575; &#1575;&#1606; SPIP &#1610;&#1587;&#1605;&#1581; &#1576;&#1575;&#1604;&#1578;&#1581;&#1603;&#1605; &#1580;&#1610;&#1583;&#1575;&#1611; &#1576;&#1604;&#1594;&#1575;&#1578; &#1575;&#1582;&#1585;&#1609;.',
-'bouton_radio_pas_petition' => '&#1604;&#1575; &#1578;&#1608;&#1580;&#1583; &#1593;&#1585;&#1575;&#1574;&#1590;',
+'bouton_radio_pas_petition' => '&#1576;&#1583;&#1608;&#1606; &#1593;&#1585;&#1575;&#1574;&#1590;',
 'bouton_radio_personnalise' => '&#1591;&#1602;&#1605; &#1581;&#1585;&#1608;&#1601; &#1588;&#1582;&#1589;&#1610;: &#1602;&#1605; &#1576;&#1578;&#1581;&#1583;&#1610;&#1583; &#1607;&#1584;&#1575; &#1575;&#1604;&#1582;&#1610;&#1575;&#1585; &#1575;&#1584;&#1575; &#1575;&#1585;&#1583;&#1578;
 &#1575;&#1587;&#1578;&#1582;&#1583;&#1575;&#1605; &#1591;&#1602;&#1605; &#1581;&#1585;&#1608;&#1601; &#1582;&#1575;&#1589;',
 'bouton_radio_petition_activee' => '&#1578;&#1605; &#1578;&#1601;&#1593;&#1610;&#1604; &#1575;&#1604;&#1593;&#1585;&#1610;&#1590;&#1577;',
@@ -252,8 +252,6 @@
 'info_ajout_participant' => '&#1578;&#1605;&#1578; &#1573;&#1590;&#1575;&#1601;&#1577; &#1575;&#1604;&#1605;&#1588;&#1575;&#1585;&#1603; &#1575;&#1604;&#1578;&#1575;&#1604;&#1610; :',
 'info_ajouter_rubrique' => '&#1573;&#1590;&#1575;&#1601;&#1577; &#1602;&#1587;&#1605; &#1570;&#1582;&#1585; &#1575;&#1604;&#1609; &#1575;&#1604;&#1573;&#1583;&#1575;&#1585;&#1577;:',
 'info_annonce_nouveautes' => '&#1573;&#1593;&#1604;&#1575;&#1606; &#1593;&#1606; &#1570;&#1582;&#1585; &#1575;&#1604;&#1571;&#1582;&#1576;&#1575;&#1585;',
-'info_annuler_blocage_priori' => '&#1573;&#1604;&#1594;&#1575;&#1569;
-				&#1607;&#1584;&#1575; &#1575;&#1604;&#1589;&#1583; &#1575;&#1604;&#1575;&#1587;&#1578;&#1576;&#1575;&#1602;&#1610;',
 'info_anterieur' => '&#1575;&#1604;&#1587;&#1575;&#1576;&#1602;',
 'info_appliquer_choix_moderation' => '&#1578;&#1591;&#1576;&#1610;&#1602; &#1582;&#1610;&#1575;&#1585; &#1575;&#1604;&#1605;&#1585;&#1575;&#1602;&#1576;&#1577; &#1607;&#1584;&#1575;:',
 'info_article' => '&#1605;&#1602;&#1575;&#1604;',
@@ -275,6 +273,7 @@
 'info_avertissement' => '&#1578;&#1581;&#1584;&#1610;&#1585;',
 'info_base_installee' => '<B>&#1578;&#1605; &#1578;&#1579;&#1576;&#1610;&#1578; &#1576;&#1606;&#1610;&#1577; &#1602;&#1575;&#1593;&#1583;&#1577; &#1575;&#1604;&#1576;&#1610;&#1575;&#1606;&#1575;&#1578;. ',
 'info_base_restauration' => '&#1575;&#1604;&#1602;&#1575;&#1593;&#1583;&#1577; &#1602;&#1610;&#1583; &#1575;&#1604;&#1575;&#1587;&#1578;&#1585;&#1580;&#1575;&#1593;',
+'info_bloquer' => '&#1573;&#1610;&#1602;&#1575;&#1601;',
 'info_breves' => '&#1607;&#1604; &#1610;&#1587;&#1578;&#1582;&#1583;&#1605; &#1605;&#1608;&#1602;&#1593;&#1603; &#1606;&#1592;&#1575;&#1605; &#1575;&#1604;&#1571;&#1582;&#1576;&#1575;&#1585;&#1567;',
 'info_breves_03' => '&#1575;&#1604;&#1571;&#1582;&#1576;&#1575;&#1585;',
 'info_breves_liees_mot' => '&#1575;&#1604;&#1571;&#1582;&#1576;&#1575;&#1585; &#1575;&#1604;&#1605;&#1585;&#1578;&#1576;&#1591;&#1577; &#1576;&#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1601;&#1578;&#1575;&#1581;',
@@ -312,8 +311,6 @@
 'info_delet_mots_cles' => '&#1591;&#1604;&#1576;&#1578; &#1581;&#1584;&#1601; &#1575;&#1604;&#1605;&#1601;&#1578;&#1575;&#1581;
 <B>@titre_mot@</b> (@type_mot@). &#1576;&#1605;&#1575; &#1571;&#1606; &#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1601;&#1578;&#1575;&#1581; &#1605;&#1585;&#1578;&#1576;&#1591;
 &#1576;&#1600;<b>@texte_lie@</b>&#1548; &#1610;&#1580;&#1576; &#1578;&#1571;&#1603;&#1610;&#1583; &#1607;&#1584;&#1575; &#1575;&#1604;&#1602;&#1585;&#1575;&#1585;:',
-'info_demander_blocage_priori' => '&#1591;&#1604;&#1576;
-				&#1589;&#1583;&#1617; &#1573;&#1587;&#1578;&#1576;&#1575;&#1602;&#1610;',
 'info_derniere_etape' => '&#1575;&#1604;&#1582;&#1591;&#1608;&#1577; &#1575;&#1604;&#1571;&#1582;&#1610;&#1585;&#1577;: <B>&#1573;&#1606;&#1578;&#1607;&#1609;!',
 'info_derniere_syndication' => '&#1578;&#1605; &#1578;&#1606;&#1601;&#1610;&#1584; &#1570;&#1582;&#1585; &#1578;&#1585;&#1582;&#1610;&#1589; &#1604;&#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593; &#1601;&#1610;',
 'info_derniers_articles_publies' => '&#1571;&#1581;&#1583;&#1579; &#1605;&#1602;&#1575;&#1604;&#1575;&#1578;&#1603; &#1575;&#1604;&#1605;&#1606;&#1588;&#1608;&#1585;&#1577;',
@@ -494,6 +491,7 @@
 'info_procedure_maj_version' => '&#1610;&#1580;&#1576; &#1578;&#1606;&#1601;&#1610;&#1584; &#1593;&#1605;&#1604;&#1610;&#1577; &#1575;&#1604;&#1578;&#1585;&#1602;&#1610;&#1577; &#1604;&#1578;&#1603;&#1610;&#1610;&#1601;
 &#1602;&#1575;&#1593;&#1583;&#1577; &#1575;&#1604;&#1576;&#1610;&#1575;&#1606;&#1575;&#1578; &#1605;&#1593; &#1573;&#1589;&#1583;&#1575;&#1585; SPIP &#1575;&#1604;&#1580;&#1583;&#1610;&#1583;.',
 'info_ps' => '&#1605;&#1604;&#1575;&#1581;&#1592;&#1577;',
+'info_publier' => '&#1606;&#1588;&#1585;',
 'info_publies' => '&#1605;&#1602;&#1575;&#1604;&#1575;&#1578;&#1603; &#1575;&#1604;&#1605;&#1606;&#1588;&#1608;&#1585;&#1577;',
 'info_question_accepter_visiteurs' => '&#1575;&#1584;&#1575; &#1603;&#1575;&#1606;&#1578; &#1589;&#1601;&#1581;&#1575;&#1578; &#1605;&#1608;&#1602;&#1593;&#1603; &#1575;&#1604;&#1606;&#1605;&#1608;&#1584;&#1580;&#1610;&#1577; &#1578;&#1601;&#1587;&#1581; &#1575;&#1604;&#1605;&#1580;&#1575;&#1604; &#1604;&#1604;&#1586;&#1608;&#1575;&#1585; &#1575;&#1604;&#1584;&#1610;&#1606; &#1604;&#1575; &#1610;&#1578;&#1605;&#1578;&#1593;&#1608;&#1606; &#1576;&#1581;&#1602; &#1575;&#1604;&#1583;&#1582;&#1608;&#1604; &#1575;&#1604;&#1609; &#1575;&#1604;&#1605;&#1580;&#1575;&#1604; &#1575;&#1604;&#1582;&#1575;&#1589; &#1604;&#1578;&#1587;&#1580;&#1610;&#1604; &#1575;&#1606;&#1601;&#1587;&#1607;&#1605;&#1548; &#1602;&#1605; &#1576;&#1578;&#1601;&#1593;&#1610;&#1604; &#1575;&#1604;&#1582;&#1610;&#1575;&#1585; &#1575;&#1604;&#1578;&#1575;&#1604;&#1610;:',
 'info_question_gerer_statistiques' => '&#1607;&#1604; &#1578;&#1585;&#1610;&#1583; &#1571;&#1606; &#1610;&#1583;&#1610;&#1585; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593; &#1573;&#1581;&#1589;&#1575;&#1569;&#1575;&#1578; &#1575;&#1604;&#1586;&#1610;&#1575;&#1585;&#1575;&#1578;&#1567;',
@@ -759,6 +757,12 @@
 
 // S
 'statut_admin_restreint' => ')&#1573;&#1583;&#1575;&#1585;&#1577; &#1605;&#1581;&#1583;&#1608;&#1583;&#1577;(',
+'syndic_choix_moderation' => '&#1605;&#1575;&#1584;&#1575; &#1578;&#1585;&#1610;&#1583; &#1575;&#1606; &#1578;&#1601;&#1593;&#1604; &#1576;&#1575;&#1604;&#1608;&#1589;&#1604;&#1575;&#1578; &#1575;&#1604;&#1605;&#1602;&#1576;&#1604;&#1577; &#1575;&#1604;&#1602;&#1575;&#1583;&#1605;&#1577; &#1605;&#1606; &#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593;&#1567;',
+'syndic_choix_oublier' => '&#1605;&#1575;&#1584;&#1575; &#1578;&#1585;&#1610;&#1583; &#1575;&#1606; &#1578;&#1601;&#1593;&#1604; &#1576;&#1575;&#1604;&#1608;&#1589;&#1604;&#1575;&#1578; &#1575;&#1604;&#1578;&#1610; &#1604;&#1605; &#1578;&#1593;&#1583; &#1608;&#1575;&#1585;&#1583;&#1577; &#1601;&#1610; &#1605;&#1604;&#1601; &#1575;&#1604;&#1578;&#1585;&#1582;&#1610;&#1589;&#1567;',
+'syndic_lien_obsolete' => '&#1608;&#1589;&#1604;&#1577; &#1602;&#1583;&#1610;&#1605;&#1577;',
+'syndic_option_miroir' => '&#1575;&#1610;&#1602;&#1575;&#1601;&#1607;&#1575; &#1570;&#1604;&#1610;&#1575;&#1611;',
+'syndic_option_oubli' => '&#1581;&#1584;&#1601;&#1607;&#1575; (&#1576;&#1593;&#1583; @mois@ &#1588;&#1607;&#1585;)',
+'syndic_options' => '&#1582;&#1610;&#1575;&#1585;&#1575;&#1578; &#1575;&#1604;&#1578;&#1585;&#1582;&#1610;&#1589;:',
 
 
 // T
@@ -825,8 +829,6 @@
 'texte_date_publication_anterieure' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1575;&#1604;&#1606;&#1588;&#1585; &#1575;&#1604;&#1587;&#1575;&#1576;&#1602;:',
 'texte_date_publication_anterieure_nonaffichee' => '&#1573;&#1582;&#1601;&#1575;&#1569; &#1578;&#1575;&#1585;&#1610;&#1582; &#1575;&#1604;&#1606;&#1588;&#1585; &#1575;&#1604;&#1587;&#1575;&#1576;&#1602;.',
 'texte_date_publication_article' => '&#1578;&#1575;&#1585;&#1610;&#1582; &#1575;&#1604;&#1606;&#1588;&#1585;:',
-'texte_demander_blocage_priori' => '&#1587;&#1610;&#1578;&#1605; &#1589;&#1583; &#1575;&#1604;&#1608;&#1589;&#1604;&#1575;&#1578; &#1575;&#1604;&#1605;&#1587;&#1578;&#1602;&#1576;&#1604;&#1610;&#1577;
-				&#1575;&#1604;&#1570;&#1578;&#1610;&#1577; &#1605;&#1606; &#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593; &#1573;&#1587;&#1578;&#1576;&#1575;&#1602;&#1610;&#1575;&#1611;.',
 'texte_descriptif_petition' => '&#1608;&#1589;&#1601; &#1575;&#1604;&#1593;&#1585;&#1610;&#1590;&#1577;',
 'texte_descriptif_rapide' => '&#1608;&#1589;&#1601; &#1605;&#1602;&#1578;&#1590;&#1576;',
 'texte_documents_joints' => '&#1610;&#1605;&#1603;&#1606;&#1603; &#1575;&#1604;&#1587;&#1605;&#1575;&#1581; &#1576;&#1573;&#1590;&#1575;&#1601;&#1577; &#1605;&#1587;&#1578;&#1606;&#1583;&#1575;&#1578; (&#1605;&#1604;&#1601;&#1575;&#1578; &#1605;&#1603;&#1578;&#1576;&#1610;&#1577;&#1548; &#1589;&#1608;&#1585;&#1548;
@@ -869,8 +871,6 @@
 &#1589;&#1583; &#1603;&#1604; &#1608;&#1589;&#1604;&#1577; &#1576;&#1605;&#1601;&#1585;&#1583;&#1607;&#1575; &#1575;&#1608;
 &#1575;&#1582;&#1578;&#1610;&#1575;&#1585; &#1589;&#1583; &#1603;&#1604; &#1575;&#1604;&#1608;&#1589;&#1604;&#1575;&#1578; &#1575;&#1604;&#1570;&#1578;&#1610;&#1577; &#1605;&#1606; 
 &#1575;&#1610; &#1605;&#1608;&#1602;&#1593; &#1605;&#1593;&#1610;&#1606; &#1576;&#1605;&#1601;&#1585;&#1583;&#1607;.',
-'texte_liens_syndication' => '&#1587;&#1610;&#1578;&#1605; &#1593;&#1585;&#1590; &#1575;&#1604;&#1608;&#1589;&#1604;&#1575;&#1578; &#1575;&#1604;&#1605;&#1587;&#1578;&#1602;&#1576;&#1604;&#1610;&#1577;
-				&#1575;&#1604;&#1570;&#1578;&#1610;&#1577; &#1605;&#1606; &#1607;&#1584;&#1575; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593; &#1605;&#1576;&#1575;&#1588;&#1585;&#1577; &#1601;&#1610; &#1575;&#1604;&#1605;&#1608;&#1602;&#1593; &#1575;&#1604;&#1593;&#1605;&#1608;&#1605;&#1610;.',
 'texte_login_ldap_1' => ')&#1571;&#1578;&#1585;&#1603;&#1607; &#1601;&#1575;&#1585;&#1594;&#1575;&#1611; &#1604;&#1604;&#1583;&#1582;&#1608;&#1604; &#1575;&#1604;&#1605;&#1594;&#1601;&#1604; &#1571;&#1608; &#1602;&#1605; &#1576;&#1573;&#1583;&#1582;&#1575;&#1604; &#1575;&#1604;&#1605;&#1587;&#1575;&#1585; &#1575;&#1604;&#1603;&#1575;&#1605;&#1604;&#1548; &#1605;&#1579;&#1604;&#1575;&#1611; &laquo;<tt>uid=salim, ou=users, dc=mon-domaine, dc=com</tt>&raquo;).',
 'texte_login_precaution' => '&#1578;&#1581;&#1584;&#1610;&#1585;! &#1607;&#1584;&#1575; &#1607;&#1608; &#1575;&#1604;&#1605;&#1593;&#1585;&#1617;&#1601; &#1575;&#1604;&#1584;&#1610; &#1578;&#1578;&#1589;&#1604; &#1605;&#1606; &#1582;&#1604;&#1575;&#1604;&#1607; &#1575;&#1604;&#1570;&#1606;.
 &#1573;&#1587;&#1578;&#1582;&#1583;&#1605; &#1607;&#1584;&#1607; &#1575;&#1604;&#1575;&#1587;&#1578;&#1605;&#1575;&#1585;&#1577; &#1576;&#1581;&#1584;&#1585;...',

Index: ecrire_tr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_tr.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- ecrire_tr.php3	30 Jun 2005 10:09:37 -0000	1.1
+++ ecrire_tr.php3	21 Jul 2005 21:47:13 -0000	1.2
@@ -78,8 +78,8 @@
 'bouton_radio_envoi_liste_nouveautes' => 'Yenilikler listesini yolla',
 'bouton_radio_moderation_priori' => '&Ouml;nceden onay (yaz&#305;lan iletiler onayland&#305;ktan sonra yay&#305;nlan&#305;yor).',
 'bouton_radio_modere_abonnement' => 'abonelik sistemiyle y&ouml;netilir',
-'bouton_radio_modere_posteriori' => 'sonradan onay',
-'bouton_radio_modere_priori' => '&ouml;nceden onay',
+'bouton_radio_modere_posteriori' => 'sonradan onayla y&ouml;netim',
+'bouton_radio_modere_priori' => '&ouml;nceden onayla y&ouml;netim',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'Yazarlar listesinde g&ouml;z&uuml;kme',
 'bouton_radio_non_envoi_annonces_editoriales' => 'Yazar a&ccedil;&#305;klamalas&#305; yollama',
 'bouton_radio_non_syndication' => 'Yay&#305;n (syndication) yok',
@@ -240,8 +240,6 @@
 'info_ajout_participant' => 'Eklenen kat&#305;l&#305;mc&#305; :',
 'info_ajouter_rubrique' => 'Y&ouml;netecek ba&#351;ka bir b&ouml;l&uuml;m ekle:',
 'info_annonce_nouveautes' => 'Yeniliklerin il&acirc;n&#305; :',
-'info_annuler_blocage_priori' => 'Bu &ouml;nsel kilitlenmenin
-                                      ipt&acirc;l edilmesi',
 'info_anterieur' => 'Bir &ouml;nceki',
 'info_appliquer_choix_moderation' => 'Bu &#305;l&#305;mlama se&ccedil;ene&#287;inin uygulanmas&#305; :',
 'info_article' => 'makale ',
@@ -263,6 +261,7 @@
 'info_avertissement' => 'Uyar&#305;',
 'info_base_installee' => 'Veri taban&#305;n&#305;z&#305;n yap&#305;s&#305; y&uuml;klendi',
 'info_base_restauration' => 'Veri taban&#305;n&#305;n eski haline getirilme i&#351;lemi s&uuml;r&uuml;yor',
+'info_bloquer' => 'engelle',
 'info_breves' => 'Siteniz haber sistemini kullan&#305;yor mu ?',
 'info_breves_03' => 'haberler',
 'info_breves_liees_mot' => 'Bu anahtar s&ouml;zc&uuml;&#287;e ba&#287;l&#305; haberler',
@@ -299,8 +298,6 @@
 'info_date_referencement' => 'BU SI&#304;TEYE ATIFTA BULUNULMA TAR&#304;H&#304;:',
 'info_delet_mots_cles' => '<b>@titre_mot@</b>(@type_mot@) anahtar s&ouml;zc&uuml;&#287;&uuml;n&uuml;n ipt&acirc;lini istediniz. Bu anahtar s&ouml;zc&uuml;k  
 <b>@texte_lie@<b> \'e ba&#287;l&#305; oldu&#287;undan, bu karar&#305; teyit etmeniz gerekiyor&nbsp;:',
-'info_demander_blocage_priori' => '&Ouml;nsel 
-                                    kilitleme iste',
 'info_derniere_etape' => 'Son a&#351;ama : Bitti !',
 'info_derniere_syndication' => 'Bu sitenin son sendikala&#351;mas&#305;n&#305;n ger&ccedil;ekle&#351;ti&#287;i tarih:',
 'info_derniers_articles_publies' => 'Yay&#305;nlanan son makaleleriniz',
@@ -473,6 +470,7 @@
 'info_procedure_maj_version' => 'Veri taban&#305;n&#305; yeni SPIP uyarlamas&#305;na uyarlamak i&ccedil;in
               seviye y&uuml;kseltme i&#351;lemi ba&#351;lat&#305;lmal&#305;.',
 'info_ps' => 'Not :',
+'info_publier' => 'yay&#305;nla',
 'info_publies' => '&Ccedil;evrimi&ccedil;i (online) yay&#305;nlanan makaleleriniz',
 'info_question_accepter_visiteurs' => 'E&#287;er sitenizin &#351;ablonu &ouml;zel alana eri&#351;imi olmayan ziyaret&ccedil;ilerin kayd&#305;n&#305; &ouml;ng&ouml;r&uuml;yorsa, a&#351;a&#287;&#305;daki se&ccedil;ene&#287;i &ccedil;al&#305;&#351;t&#305;r&#305;n&#305;z&nbsp;:',
 'info_question_gerer_statistiques' => 'Siteniz ziyaretlerin istatisti&#287;ini y&ouml;netmeli mi ?',
@@ -735,6 +733,12 @@
 
 // S
 'statut_admin_restreint' => '(s&#305;n&#305;rl&#305; y&ouml;netim)',
+'syndic_choix_moderation' => 'Bu siteden ileride gelecek ba&#287;lar&#305; ne yapmal&#305;&nbsp;?',
+'syndic_choix_oublier' => '&Ouml;neri (sendikasyon) dosyas&#305;nda art&#305;k bulunmayan ba&#287;lar&#305; ne yapmal&#305;&nbsp;?',
+'syndic_lien_obsolete' => '&ouml;l&uuml; ba&#287;',
+'syndic_option_miroir' => 'hepsini otomatik olarak engelle',
+'syndic_option_oubli' => 'hepsini sil (@mois@&nbsp;mois sonra)',
+'syndic_options' => '&Ouml;neri (sendikasyon) se&ccedil;enekleri&nbsp;:',
 
 
 // T
@@ -797,8 +801,6 @@
 'texte_date_publication_anterieure' => 'Bir &ouml;nceki yay&#305;n tarihi&nbsp;:',
 'texte_date_publication_anterieure_nonaffichee' => 'Yay&#305;n tarihinin g&ouml;r&uuml;nt&uuml;lenmemesi',
 'texte_date_publication_article' => '&Ccedil;EVR&#304;M&#304;&Ccedil;&#304; (ONLINE) YAYINLANMA TAR&#304;H&#304;:',
-'texte_demander_blocage_priori' => 'Bu siteden gelecek olan bundan sonraki
-    ba&#287;lant&#305;lar &ouml;nsel olarak kilitlenecektir.',
 'texte_descriptif_petition' => 'Dilek&ccedil;enin tan&#305;m&#305;',
 'texte_descriptif_rapide' => 'H&#305;zl&#305; tan&#305;m',
 'texte_documents_joints' => 'Makale ve/veya b&ouml;l&uuml;mlere dok&uuml;man eklenmesine izin verebilirsiniz
@@ -818,7 +820,6 @@
 'texte_jeu_caractere_2' => 'Bu ayar&#305;n geriye d&ouml;n&uuml;k etkisi yoktur. Dolay&#305;s&#305;yla, ayarda bir de&#287;i&#351;iklik sonras&#305;nda, daha &ouml;nce girilmi&#351; olan metinler yanl&#305;&#351; g&ouml;r&uuml;nt&uuml;lenebilir. Her hal&uuml;karda, bir zarar vermeden bir &ouml;nceki ayara d&ouml;nebilirsiniz.',
 'texte_lien_hypertexte' => '(E&#287;er iletiniz Web\'de yay&#305;nlanan bir makaleye, ya da daha fazla bilgi veren bir sayfaya at&#305;fta bulunuyorsa, l&uuml;tfen buraya sayfan&#305;n ba&#351;l&#305;&#287;&#305;n&#305; ve URL adresini belirtiniz.)',
 'texte_liens_sites_syndiques' => 'Sendikal&#305; sitelerden ileri gelen ba&#287;lant&#305;lar &ouml;nsel olarak kilitlenebilir&nbsp;; a&#351;a&#287;&#305;daki ayarlama yarat&#305;lmalar&#305;ndan sonra sendikala&#351;an sitelerin varsay&#305;lan ayarlamas&#305;n&#305; belirtir. Sonradan her bir ba&#287;lant&#305;n&#305;n kilidini tek tek a&ccedil;mak, ya da her site i&ccedil;in, gelecekteki ba&#287;lant&#305;lar&#305; kilitlemeyi tek tek se&ccedil;mek herhal&uuml;karda olanakl&#305;d&#305;r.',
-'texte_liens_syndication' => 'Bu siteden gelecek bundan sonraki ba&#287;lar derhal kamu sitesinde g&ouml;r&uuml;nt&uuml;lenecektir.',
 'texte_login_ldap_1' => '(Ya anonim bir eri&#351;im i&ccedil;in bo&#351; b&#305;rak&#305;lmas&#305;, ya da t&uuml;m yolun belirtilmesi, &ouml;rne&#287;in; &laquo;&nbsp;uid=dupont, ou=users, dc=mon-domaine, dc=com&nbsp;&raquo;.)',
 'texte_login_precaution' => 'Dikkat&nbsp;! Bu, &#351;u andaki ba&#287;lant&#305; i&ccedil;in kullan&#305;lan logindir.
  Bu formu tedbirli kullan&#305;n&#305;z...',

Index: spip_oc_ni.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_oc_ni.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_oc_ni.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ spip_oc_ni.php3	21 Jul 2005 21:47:14 -0000	1.4
@@ -58,6 +58,7 @@
 'bouton_changer' => 'Cambiar',
 'bouton_chercher' => 'Cercar',
 'bouton_choisir' => 'Chausir',
+'bouton_enregistrer' => 'Registrar',
 'bouton_radio_desactiver_messagerie_interne' => 'Desactivar la messatgeria interna',
 'bouton_radio_envoi_annonces' => 'Mandar lu anoncis editoriaus',
 'bouton_radio_non_envoi_annonces' => 'Mandar pas d\'anoncis',
@@ -183,6 +184,7 @@
 
 
 // F
+'fichier_introuvable' => '<NEW>Non s\'es pogut trobar lo fichier @fichier at .',
 'form_deja_inscrit' => 'Si&egrave;tz ja inscrich(a).',
 'form_email_non_valide' => 'La voastra adre&ccedil;a e-mail es pas valida.',
 'form_forum_access_refuse' => 'Pod&egrave;tz plus accedir a aqueu sit.',

Index: ecrire_ja.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_ja.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- ecrire_ja.php3	30 Jun 2005 10:09:38 -0000	1.1
+++ ecrire_ja.php3	21 Jul 2005 21:47:15 -0000	1.2
@@ -58,7 +58,7 @@
 'bouton_checkbox_qui_attribue_mot_cle_visiteurs' => '&#12497;&#12502;&#12522;&#12483;&#12463;&#12394;&#12469;&#12452;&#12488;&#12398;&#35370;&#21839;&#32773;&#12364;&#12501;&#12457;&#12540;&#12521;&#12512;&#12395;&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#25237;&#31295;&#12375;&#12383;&#12392;&#12365;',
 'bouton_checkbox_signature_unique_email' => 'e-mail&#12450;&#12489;&#12524;&#12473;&#12372;&#12392;&#12398;&#12383;&#12387;&#12383;&#65297;&#12388;&#12398;&#32626;&#21517;',
 'bouton_checkbox_signature_unique_site' => '&#12454;&#12455;&#12502;&#12469;&#12452;&#12488;&#12372;&#12392;&#12398;&#12383;&#12387;&#12383;&#65297;&#12388;&#12398;&#32626;&#21517;',
-'bouton_demande_publication' => '&#12371;&#12398;&#35352;&#20107;&#12398;&#20844;&#38283;&#12434;&#12522;&#12463;&#12456;&#12473;&#12488;&#12377;&#12427;',
+'bouton_demande_publication' => '&#12371;&#12398;&#35352;&#20107;&#12398;&#20844;&#38283;&#12434;&#35201;&#27714;&#12377;&#12427;',
 'bouton_effacer_index' => '&#12452;&#12531;&#12487;&#12483;&#12463;&#12473;&#12398;&#21066;&#38500;',
 'bouton_effacer_tout' => '&#12377;&#12409;&#12390;&#12398;&#21066;&#38500;',
 'bouton_envoi_message_02' => '&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#36865;&#12427;',
@@ -196,11 +196,11 @@
 'icone_envoyer_message' => '&#12371;&#12398;&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#36865;&#12427;',
 'icone_evolution_visites' => '&#35370;&#21839;&#29575;<br>@visites@&#35370;&#21839;',
 'icone_modif_groupe_mots' => '&#12371;&#12398;&#12461;&#12540;&#12527;&#12540;&#12489;&#12464;&#12523;&#12540;&#12503;&#12434;&#22793;&#26356;&#12377;&#12427;',
-'icone_modifier_article' => '&#12371;&#12398;&#35352;&#20107;&#12434;&#25913;&#12417;&#12427;',
-'icone_modifier_breve' => '&#12371;&#12398;&#12491;&#12517;&#12540;&#12473;&#12434;&#25913;&#12417;&#12427;',
-'icone_modifier_message' => '&#12371;&#12398;&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#20462;&#27491;&#12377;&#12427;',
-'icone_modifier_rubrique' => '&#12371;&#12398;&#12475;&#12463;&#12471;&#12519;&#12531;&#12434;&#25913;&#12417;&#12427;',
-'icone_modifier_site' => '&#12371;&#12398;&#12469;&#12452;&#12488;&#12434;&#22793;&#26356;&#65288;&#20462;&#27491;&#65289;&#12377;&#12427;',
+'icone_modifier_article' => '&#12371;&#12398;&#35352;&#20107;&#12434;&#20462;&#27491;',
+'icone_modifier_breve' => '&#12371;&#12398;&#12491;&#12517;&#12540;&#12473;&#12434;&#20462;&#27491;',
+'icone_modifier_message' => '&#12371;&#12398;&#12513;&#12483;&#12475;&#12540;&#12472;&#12434;&#20462;&#27491;',
+'icone_modifier_rubrique' => '&#12371;&#12398;&#12475;&#12463;&#12471;&#12519;&#12531;&#12434;&#20462;&#27491;',
+'icone_modifier_site' => '&#12371;&#12398;&#12469;&#12452;&#12488;&#12434;&#20462;&#27491;',
 'icone_poster_message' => '&#12513;&#12483;&#12475;&#12540;&#12472;&#12398;&#25237;&#31295;',
 'icone_publier_breve' => '&#12371;&#12398;&#12491;&#12517;&#12540;&#12473;&#12434;&#25522;&#12370;&#12427;',
 'icone_referencer_nouveau_site' => '&#26032;&#12375;&#12356;&#12469;&#12452;&#12488;&#12434;&#21442;&#29031;&#12377;&#12427;',

Index: spip_lb.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_lb.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_lb.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_lb.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -32,6 +32,7 @@
 'avis_echec_syndication_02' => 'D\'Syndicatioun huet n&euml;t fonktionn&eacute;iert: onm&eacute;iglech de Backend vun d&euml;sem Site ze ereechen.',
 'avis_erreur' => 'Fehler: kuckt hei driwwer',
 'avis_erreur_connexion' => 'Verbindungs-Fehler',
+'avis_erreur_cookie' => 'Problem mat dem Cookie',
 'avis_erreur_fonction_contexte' => 'Programm-Fehler. D&euml;s Fonktioun d&auml;rf n&euml;t an d&euml;sem Kontext opgeruff ginn.',
 'avis_erreur_mysql' => 'MySQL-Fehler',
 'avis_erreur_sauvegarde' => 'Fehler am Backup (@type@ @id_objet@)!',
@@ -58,6 +59,7 @@
 'bouton_changer' => '&Auml;nneren',
 'bouton_chercher' => 'Sichen',
 'bouton_choisir' => 'Auswielen',
+'bouton_enregistrer' => 'Sp&auml;icheren',
 'bouton_radio_desactiver_messagerie_interne' => 'D&eacute;i intern Messagerie ausschalten',
 'bouton_radio_envoi_annonces' => 'Editorial Annoncen sch&eacute;cken',
 'bouton_radio_non_envoi_annonces' => 'Keng Neiegkeeten sch&eacute;cken',
@@ -181,6 +183,7 @@
 
 
 // F
+'fichier_introuvable' => 'De Fichier @fichier@ kann n&euml;t font ginn',
 'form_deja_inscrit' => 'Dir sidd schon ugemelt.',
 'form_email_non_valide' => '&Auml;r Email-Adress ass n&euml;t richteg.',
 'form_forum_access_refuse' => 'Dir hutt keen Zougang m&eacute;i zu d&euml;sem Site.',
@@ -246,8 +249,8 @@
 'form_prop_sujet' => 'Sujet',
 'form_prop_url_site' => 'Adress (URL) vum Site',
 'forum_acces_refuse' => 'Dir hutt keen Zougang m&eacute;i zu d&euml;se Forum\'en.',
-'forum_attention_dix_caracteres' => '<b>Opgepasst!</b> &Auml;re Message huet manner w&eacute;i 10 Buchstawen.',
-'forum_attention_trois_caracteres' => '<b>Opgepasst!</b> &Auml;ren Titel huet manner w&eacute;i 3 Buchstawen.',
+'forum_attention_dix_caracteres' => '<b>Opgepasst!</b> &Auml;re Message muss op manst 10 Buchstawen hun.',
+'forum_attention_trois_caracteres' => '<b>Opgepasst!</b> &Auml;ren Titel muss op manst 3 Buchstawen hun.',
 'forum_avez_selectionne' => 'Dir hutt gewielt:',
 'forum_cliquer_retour' => '<a href=\'@retour_forum@\'>Hei klicken</a> fir weider.',
 'forum_forum' => 'Forum',

Index: ecrire_ca.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/ecrire_ca.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- ecrire_ca.php3	30 Jun 2005 10:09:38 -0000	1.3
+++ ecrire_ca.php3	21 Jul 2005 21:47:15 -0000	1.4
@@ -85,9 +85,9 @@
  contribucions no apareixen p&uacute;blicament fins que no han estat
  validades des de l\'adminsitraci&oacute; del
  lloc).',
-'bouton_radio_modere_abonnement' => 'moderat (nom&eacute;s per abonats)',
-'bouton_radio_modere_posteriori' => 'moderat a posteriori',
-'bouton_radio_modere_priori' => 'moderat a priori',
+'bouton_radio_modere_abonnement' => 'per subscripci&oacute;',
+'bouton_radio_modere_posteriori' => 'moderaci&oacute; a posteriori',
+'bouton_radio_modere_priori' => 'moderaci&oacute; a priori',
 'bouton_radio_non_apparaitre_liste_redacteurs_connectes' => 'No apar&egrave;ixer a la llista de redactors/es ',
 'bouton_radio_non_envoi_annonces_editoriales' => 'No enviar anuncis editorials',
 'bouton_radio_non_syndication' => 'Cap sindicaci&oacute;',
@@ -243,7 +243,6 @@
 'info_ajout_participant' => 'El seg&uuml;ent participant ha estat afegit:',
 'info_ajouter_rubrique' => 'Afegir una altra secci&oacute; per administrar:',
 'info_annonce_nouveautes' => 'Av&iacute;s de les novetats',
-'info_annuler_blocage_priori' => 'Anular el bloqueig a priori',
 'info_anterieur' => 'anterior',
 'info_appliquer_choix_moderation' => 'Aplicar aquesta opci&oacute; de moderaci&oacute;:',
 'info_article' => 'article',
@@ -265,6 +264,7 @@
 'info_avertissement' => 'Av&iacute;s',
 'info_base_installee' => 'L\'estructura de la vostra bases de dades s\'ha instal&middot;lat.',
 'info_base_restauration' => 'La restauraci&oacute; de la base de dades est&agrave; en curs.',
+'info_bloquer' => 'blocar',
 'info_breves' => 'El vostre lloc fa servir el sistema de breus?',
 'info_breves_03' => 'breus',
 'info_breves_liees_mot' => 'Les breus lligades a aquesta paraula clau',
@@ -302,8 +302,6 @@
 'info_delet_mots_cles' => 'Heu sol&middot;licitat la supressi&oacute; de la
  paraula clau <B>@titre_mot@</B> (@type_mot@). Donat que la paraula-clau est&agrave; lligada a
 <b>@texte_lie@</b> heu de confirmar aquesta decisi&oacute;:',
-'info_demander_blocage_priori' => 'Sol&middot;licitar
-    un blocatge a priori',
 'info_derniere_etape' => '&Uacute;ltim pas: <B>S\'ha acabat!',
 'info_derniere_syndication' => 'La &uacute;ltima sindicaci&oacute; d\'aquest lloc ha estat realitzada el',
 'info_derniers_articles_publies' => 'El m&eacute;s nou dels vostres articles editats',
@@ -467,6 +465,7 @@
 'info_procedez_par_etape' => 'procediu pas per pas',
 'info_procedure_maj_version' => 'El proc&eacute;s d\'actualitzaci&oacute; s\'ha de tornar a arrancar per tal d\'adaptar la base de dades a la nova versi&oacute; d\'SPIP.',
 'info_ps' => 'P.D.',
+'info_publier' => 'publicar',
 'info_publies' => 'Els vostres articles publicats en l&iacute;nia',
 'info_question_accepter_visiteurs' => 'Si a les plantilles (esquelets) del vostre lloc Web es preveu l\'enregistrament de visitants sense acc&eacute;s a l\'espai privat, vulgueu activar la seg&uuml;ent opci&oacute;:',
 'info_question_gerer_statistiques' => 'El vostre lloc ha de gestionar les estad&iacute;stiques de les visites?',
@@ -723,6 +722,12 @@
 
 // S
 'statut_admin_restreint' => '(admin restringida)',
+'syndic_choix_moderation' => 'Qu&egrave; fer dels seg&uuml;ents enlla&ccedil;os que procedeixin d\'aquest lloc Web?',
+'syndic_choix_oublier' => 'Qu&egrave; fer dels enlla&ccedil;os que ja no figuren en el fitxer de sindicaci&oacute;?',
+'syndic_lien_obsolete' => 'enlla&ccedil; obsolet',
+'syndic_option_miroir' => 'blocar-los autom&agrave;ticament',
+'syndic_option_oubli' => 'esborrar-los (despr&eacute;s @mois@&nbsp;mois)',
+'syndic_options' => 'Opcions de sindicaci&oacute;:',
 
 
 // T
@@ -779,8 +784,6 @@
 'texte_date_publication_anterieure' => 'Data de redacci&oacute; anterior:',
 'texte_date_publication_anterieure_nonaffichee' => 'No publicar els articles de data de redacci&oacute; anterior.',
 'texte_date_publication_article' => 'DATA DE PUBLICACI&Oacute; EN L&Iacute;NIA&nbsp;:',
-'texte_demander_blocage_priori' => 'Els pr&ograve;xims enlla&ccedil;os 
- procedents d\'aquest lloc ser&agrave;n bloquejats a priori.',
 'texte_descriptif_petition' => 'Descripci&oacute; de la petici&oacute;',
 'texte_descriptif_rapide' => 'Descripci&oacute; r&agrave;pida',
 'texte_documents_joints' => 'Es pot permetre afegir documents (fitxers ofim&agrave;tics, imatges, multim&egrave;dia, etc.) als articles i/o a les seccions. Aquests fitxers poden estar referenciats dins l\'article, o mostrats separadament.<p>',
@@ -807,7 +810,6 @@
 que apareix a continuaci&oacute; indica  la regla per defecte dels llocs sindicats despr&eacute;s de la seua creaci&oacute;. &Eacute;s
 possible inmediatament desbloquejar cada enlla&ccedil; de forma individual, o 
 triar, web per web, bloquejar els enlla&ccedil;os que vinguen d\'un o altre web.',
-'texte_liens_syndication' => 'Els pr&ograve;xims enlla&ccedil;os que provinguen d\'aquesta web seran afegits inmediatament al lloc p&uacute;blic.',
 'texte_login_ldap_1' => '(Deixar buit per un acc&eacute;s an&ograve;nim, o ficar l\'ordre sencera, per exemple "&nbsp;<tt>uid=Ferrer, ou=users, dc=el-meu-domini, dc=com</tt>".)',
 'texte_login_precaution' => 'Atenci&oacute;! Aquest &eacute;s el login o nom d\'usuari amb el qual esteu connectats actualment.
 Useu aquest formulari amb precauci&oacute;...',
@@ -917,7 +919,7 @@
 'titre_connexion_ldap' => 'Opcions: <B>Vostre connexi&oacute; LDAP</B>',
 'titre_dernier_article_syndique' => 'Darrers articles sindicats',
 'titre_documents_joints' => 'Documents adjunts',
-'titre_evolution_visite' => 'Evaluaci&oacute; de les visites',
+'titre_evolution_visite' => 'Evoluci&oacute; de les visites',
 'titre_forum_suivi' => 'Seguiment dels f&ograve;rums',
 'titre_gauche_mots_edit' => 'MOT N&Uacute;MERO:',
 'titre_groupe_mots' => 'GRUP DE MOTS:',

Index: spip_ar.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spip_ar.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- spip_ar.php3	30 Jun 2005 10:09:37 -0000	1.4
+++ spip_ar.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -23,6 +23,7 @@
 'admin_modifier_rubrique' => '&#1578;&#1593;&#1583;&#1610;&#1604; &#1607;&#1584;&#1575; &#1575;&#1604;&#1602;&#1587;&#1605;',
 'admin_recalculer' => '&#1573;&#1593;&#1575;&#1583;&#1577; &#1578;&#1581;&#1583;&#1610;&#1579; &#1607;&#1584;&#1607; &#1575;&#1604;&#1589;&#1601;&#1581;&#1577;',
 'alerte_maj_impossible' => '<b>&#1578;&#1581;&#1584;&#1610;&#1585;!</b> &#1578;&#1585;&#1602;&#1610;&#1577; &#1602;&#1575;&#1593;&#1583;&#1577; MySQL &#1575;&#1604;&#1609; &#1575;&#1604;&#1575;&#1589;&#1583;&#1575;&#1585; @version@ &#1605;&#1578;&#1593;&#1584;&#1585;. &#1602;&#1583; &#1610;&#1603;&#1608;&#1606; &#1575;&#1604;&#1587;&#1576;&#1576; &#1605;&#1588;&#1603;&#1604;&#1577; &#1601;&#1610; &#1575;&#1604;&#1575;&#1584;&#1608;&#1606;&#1575;&#1578;. &#1575;&#1604;&#1585;&#1580;&#1575;&#1569; &#1575;&#1604;&#1575;&#1578;&#1589;&#1575;&#1604; &#1576;&#1605;&#1590;&#1610;&#1601; &#1605;&#1608;&#1602;&#1593;&#1603;.',
+'analyse_xml' => '&#1578;&#1581;&#1604;&#1610;&#1604; XML',
 'avis_archive_incorrect' => '&#1605;&#1604;&#1601; &#1575;&#1604;&#1575;&#1585;&#1588;&#1610;&#1601; &#1604;&#1610;&#1587; &#1605;&#1604;&#1601; SPIP',
 'avis_archive_invalide' => '&#1605;&#1604;&#1601; &#1575;&#1604;&#1575;&#1585;&#1588;&#1610;&#1601; &#1594;&#1610;&#1585; &#1589;&#1575;&#1604;&#1581;',
 'avis_attention' => '&#1578;&#1581;&#1584;&#1610;&#1585;!',



From stef at berlios.de  Thu Jul 21 23:47:19 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:19 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes article.html,NONE,1.1
Message-ID: <200507212147.j6LLlJqX024088@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv22230/squelettes

Added Files:
	article.html 
Log Message:
synchro CVS 20050719

--- NEW FILE: article.html ---
<BOUCLE_article_principal(ARTICLES) {id_article}><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html dir="#LANG_DIR" lang="#LANG">
<head>
<title>[(#TITRE|textebrut)]</title>
<meta http-equiv="Content-Type" content="text/html; charset=#CHARSET" />
<!-- Ceci est la feuille de style par defaut pour les types internes a SPIP -->
<link rel="stylesheet" href="spip_style.css" type="text/css" />

<!-- Les feuilles de style specifiques aux presents squelettes -->
<link rel="stylesheet" href="#DOSSIER_SQUELETTE/typographie.css" type="text/css" />

<!-- media="..." permet de ne pas utiliser ce style sous Netscape 4 (sinon plantage) -->
<link rel="stylesheet" href="#DOSSIER_SQUELETTE/habillage.css" type="text/css" media="projection, screen, tv" />
<!-- media="print" permet d'utiliser cette feuille de style quand vous imprimez depuis votre navigateur -->
<link rel="stylesheet" href="#DOSSIER_SQUELETTE/impression.css" type="text/css" media="print" />
</head>

<body>
<div id="navigation">

<h1 class="structure"><:navigation:></h1>

<!-- Menu de navigation general -->

<div class="menu">
<ul class="general">
	<li class="menu-titre">
	[<a href="(#URL_SITE_SPIP)" title="<:accueil_site:>"><b>#NOM_SITE_SPIP</b></a>]
	</li>
	<li class="menu-item">
	<a href="plan.php3"><:plan_site:></a>
	</li>
	<li class="menu-item">
	<a href="resume.php3" title="<:articles_populaires:>"><:en_resume:></a>
	</li>
	<li class="menu-item">
	<a href="ecrire/"><:espace_prive:></a>
	</li>
</ul>
</div>

<!-- Formulaire de recherche -->

[(#FORMULAIRE_RECHERCHE)]

<!-- Menu de navigation rubriques -->

<B_rubriques>
<div class="menu">
<ol class="rubriques">
<BOUCLE_rubriques(HIERARCHIE) {id_article}>
<li>
<div class="menu-titre"><a href="#URL_RUBRIQUE" [title="(#DESCRIPTIF|textebrut|entites_html)"]>#TITRE</a></div>
<B_sous_rubriques>
	<ul class="menu-liste">
<BOUCLE_sous_rubriques(RUBRIQUES) {meme_parent} {exclus} {par date} {inverse} {0,3}>
	<li class="menu-item"><a href="#URL_RUBRIQUE" [title="(#DESCRIPTIF|textebrut|entites_html)"]>#TITRE</a></li>
</BOUCLE_sous_rubriques>
	</ul>
</B_sous_rubriques>
</li>
</BOUCLE_rubriques>
</ol>
</div>
</B_rubriques>


<!-- Menu de navigation mots-cles -->

<B_mots>
<div class="menu">

<h1 class="structure"><:mots_clefs:></h1>

<ul class="divers" title="<:mots_clefs:>">
<BOUCLE_mots(MOTS) {id_article} {par titre}>
<li>
<div class="menu-titre"><a href="#URL_MOT" [title="(#DESCRIPTIF|textebrut|entites_html)"]>#TITRE</a></div>
<B_articles_mots>
	<ul class="menu-liste">
<BOUCLE_articles_mots(ARTICLES) {id_mot} {par hasard} {0,4}>
	<li class="menu-item"><a href="#URL_ARTICLE" title="[(#DESCRIPTIF|textebrut|entites_html)]">#TITRE</a></li>
</BOUCLE_articles_mots>
	</ul>
</B_articles_mots>
</li>
</BOUCLE_mots>
</ul>
</div>
</B_mots>


<!-- Liens des forums -->
<BOUCLE_forums_decompte(FORUMS){id_article}{plat}></BOUCLE_forums_decompte>
[<div class="menu" title="<:derniers_commentaires:>">

<h1 class="structure"><:derniers_commentaires:></h1>

<ul class="forums">

<li class="menu-titre"><:messages_forum:>: (#TOTAL_BOUCLE)</li>]
<//B_forums_decompte>
<BOUCLE_forums_liens(FORUMS){id_article}{par date}{inverse}{0,5}>
    <li class="menu-item">[<i>(#DATE|affdate_court)</i>:]
    <a href="#forum#ID_FORUM">#TITRE</a>
    </li>
</BOUCLE_forums_liens>
</ul>
</div>
</B_forums_liens>


	<!-- Auteurs de l'article -->

	<B_auteurs>

	<div class="menu">
	<h2 class="structure"><:memes_auteurs:></h2>
	<ul class="divers">
	<BOUCLE_auteurs(AUTEURS) {id_article} {par nom}>
		<li>
		<div class="menu-titre"><a href="#URL_AUTEUR">#NOM</a></div>
		<ul>
		[<li class="menu-item" style="text-align: center"><a href="(#URL_SITE)">#NOM_SITE</a></li>]
		[<li class="menu-item" style="text-align: center">(#BIO)</li>]
	<B_articles_auteur>
	<BOUCLE_articles_auteur(ARTICLES) {id_auteur} {par popularite} {inverse} {0,5}>
		<li class="menu-item"><a href="#URL_ARTICLE" [title="(#DESCRIPTIF|textebrut|entites_html)"]>#TITRE</a></li>
	</BOUCLE_articles_auteur>
		</ul>
		</li>
	</BOUCLE_auteurs>
	</ul>
	</div>

	</B_auteurs>

	<!-- Articles dans la meme rubrique -->

	<B_articles_rubrique>

	<div class="menu">
	<div class="breves">
		<h2 class="structure"><:meme_rubrique:></h2>
		<div class="menu-titre">
		<:meme_rubrique:>
		</div>
		<ul>
	<BOUCLE_articles_rubrique(ARTICLES) {id_rubrique} {par hasard} {exclus} {0,8}>
		<li class="menu-item">
		<a href="#URL_ARTICLE" [title="(#DESCRIPTIF|textebrut|entites_html)"]>#TITRE</a>
		</li>
	</BOUCLE_articles_rubrique>
		</ul>
	</div>
	</div>

	</B_articles_rubrique>
  [<div class='reponse_formulaire'>
	<a name='sp#ID_ARTICLE' id='sp#ID_ARTICLE'></a>
    (#FORMULAIRE_SIGNATURE)
  </div>]

</div>


<!-- Une : derniers articles publies -->

<div class="contenu" id="principal">

<div class="cartouche">
[
(#LOGO_ARTICLE|left||reduire_image{120,120})][
<div class="surtitre">#DEBUT_SURLIGNE(#SURTITRE)#FIN_SURLIGNE</div>
]<h1 class="titre-texte">#DEBUT_SURLIGNE#TITRE#FIN_SURLIGNE</h1>[
<div class="surtitre">#DEBUT_SURLIGNE(#SOUSTITRE)#FIN_SURLIGNE</div>
]
[(#DATE|nom_jour)] [(#DATE|affdate).]
</div>

<div style="line-height: 0em">&nbsp;</div><!-- Bug Mozilla http://bugzilla.mozilla.org/show_bug.cgi?id=200510 -->


[
<div class="chapo">#DEBUT_SURLIGNE(#CHAPO)#FIN_SURLIGNE</div>
][<div class="texte">#DEBUT_SURLIGNE(#TEXTE)#FIN_SURLIGNE</div>
][<div class="ps">#DEBUT_SURLIGNE(#PS)#FIN_SURLIGNE</div>][
<div class="notes">#DEBUT_SURLIGNE(#NOTES)#FIN_SURLIGNE</div>
]


<BOUCLE_afficher_document(DOCUMENTS){id_document}{mode=document}{extension==(png|jpg|gif)$}{doublons}>
<hr>
[<h3 class="spip">(#TITRE)</h3>]
[<div>(#DESCRIPTIF)</div>]

[<div>(#EMBED_DOCUMENT)</div>]
</BOUCLE_afficher_document>

<B_documents_portfolio>
<div><hr>
<BOUCLE_documents_portfolio(DOCUMENTS){id_article}{mode=document}{extension==(png|jpg|gif)$}{doublons}>
	<div style="float: left;">
	[<a href="#URL_ARTICLE[(#URL_ARTICLE|strpos{?}|?{&amp;,?})]id_document=#ID_DOCUMENT">(#LOGO_DOCUMENT{0,60})</a>]
[<div style="clear: both;"><b>(#TITRE)</b></div>][<div style="clear: both;">(#DESCRIPTIF)</div>]
	</div>
</BOUCLE_documents_portfolio>
</div>
<div style="clear: both;"></div>
</B_documents_portfolio>

<B_documents_joints>
<div><hr>
<BOUCLE_documents_joints(DOCUMENTS) {id_article} {mode=document} {doublons}>
	<div style="float: left;">
	[(#LOGO_DOCUMENT|#URL_DOCUMENT)][<div style="clear: both;"><b>(#TITRE)</b></div>][<div style="clear: both;">(#DESCRIPTIF)</div>]
	</div>
</BOUCLE_documents_joints>
</div>
<div style="clear: both;"></div>
</B_documents_joints>


<!-- Signatures petition -->

<BOUCLE_signatures_decompte(SIGNATURES) {id_article}></BOUCLE_signatures_decompte>
[<div class="signatures-titre"><:signatures_petition:>: (#TOTAL_BOUCLE)</div>

<table class="signatures">
<thead class="structure">
<tr>
	<th><:date:></th>
	<th><:nom:></th>
	<th><:message:></th>
</tr>
</thead>
<tbody>]
<//B_signatures_decompte>
<BOUCLE_signatures(SIGNATURES) {id_article} {par date} {inverse} {debut_signatures,30}>
<tr>
	<td class="signature-date">[(#DATE|affdate_court)]</td>
	<td class="signature-nom">#NOM[ <a href="#URL_SITE">(#NOM_SITE)</a>]</td>
	[<td class="signature-message">(#MESSAGE)</td>]
</tr>
</BOUCLE_signatures>
</tbody>
</table>
</B_signatures>


<!-- Forums -->

[<div class="forum-repondre"><b><a  href="forum.php3?(#PARAMETRES_FORUM)"><:repondre_article:></a></b></div>]
<br />

<B_forums>
<h1 class="structure"><:Forum:></h1>

<ul class="forum-total">

<BOUCLE_forums(FORUMS){id_article}{par date}{inverse}>

<li>
<div class="forum-fil">

<div class="forum">
<div class="forum-chapo">
<div class="forum-titre"><a name="forum#ID_FORUM"></a>#TITRE</div>
[(#DATE|affdate)][, <:par_auteur:> <a href="mailto:[(#EMAIL|entites_html)]">(#NOM)</a>]
</div>
<div class="forum-item">
#TEXTE
[<div class="forum-titre"><a href="(#URL_SITE)" class="spip_out">#NOM_SITE</a></div>]
[<div class="forum-repondre-message"><a href="forum.php3?(#PARAMETRES_FORUM)"><:repondre_message:></a></div>]
</div>
</div>

<B_forums_fils>
	<ul>
	<BOUCLE_forums_fils(FORUMS){id_parent}{par date}>

	<li>
	<div class="forum">
	<div class="forum-chapo">
	<div class="forum-titre"><a name="forum#ID_FORUM"></a>#TITRE</div>
	[(#DATE|affdate)][, <:par_auteur:> <a href="mailto:#EMAIL">(#NOM)</a>]
	</div>
	<div class="forum-item">
	#TEXTE
	[<div class="forum-titre"><a href="(#URL_SITE)" class="spip_out">#NOM_SITE</a></div>]
	[<div class="forum-repondre-message"><a href="forum.php3?(#PARAMETRES_FORUM)"><:repondre_message:></a></div>]
	</div>

	</div>

	<BOUCLE_Forums_Boucle(boucle_forums_fils)></BOUCLE_Forums_Boucle>
	</li>

	</BOUCLE_forums_fils>
	</ul>
</B_forums_fils>

</div>
</li>
</BOUCLE_forums>

</ul>
</B_forums>

</div>

</body>
</html>
</BOUCLE_article_principal>



From stef at berlios.de  Thu Jul 21 23:47:19 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:19 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/js Copie de navTools.js,1.1,NONE
Message-ID: <200507212147.j6LLlJqX024082@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/js
In directory sheep:/tmp/cvs-serv22230/ecrire/js

Removed Files:
	Copie de navTools.js 
Log Message:
synchro CVS 20050719

--- Copie de navTools.js DELETED ---



From stef at berlios.de  Thu Jul 21 23:47:18 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:18 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_test.html,NONE,1.1 Copy of carto_svgfilex.html,NONE,1.1 carto_map.html,NONE,1.1 style_carto_svgfilex.css,NONE,1.1 Copy (2) of carto_svgfilex.html,NONE,1.1 carto_svgx.html,1.1,1.2 cartov2.html,1.1,NONE carto_svg2.html,1.1,NONE
Message-ID: <200507212147.j6LLlIqX024059@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv22230/squelettes/template

Modified Files:
	carto_svgx.html 
Added Files:
	carto_test.html Copy of carto_svgfilex.html carto_map.html 
	style_carto_svgfilex.css Copy (2) of carto_svgfilex.html 
Removed Files:
	cartov2.html carto_svg2.html 
Log Message:
synchro CVS 20050719

--- NEW FILE: carto_test.html ---
<div style="position: relative;visibility: visible; margin: 0px; padding: 0px;"><div style="position: absolute;"><BOUCLE_carte(CARTO_CARTES){id_carto_carte}><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}><area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords)]" href="#URL_OBJET" alt="#TITRE"/></BOUCLE_objets></map></B_objets><img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="1"/><BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}><a href="#URL_OBJET"><img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2style)]border: 0px;" alt="#TEXTE" src="<BOUCLE_mot(MOTS){id_carto_objet=#ID_CARTO_OBJET}>IMG/moton[(#ID_MOT)].gif</BOUCLE_mot>" border="0"/></a></BOUCLE_objets2></BOUCLE_carte></div></div>
--- NEW FILE: Copy of carto_svgfilex.html ---
<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<svg width="100%" height="100%" viewBox="0 0 760 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
	<script type="text/ecmascript" xlink:href="helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="navigation.js"/>
	<script type="text/ecmascript" xlink:href="navigationTools.js"/>
	<script type="text/ecmascript"><![CDATA[
		
		
		var myMapApp = new mapApp();
		var myMainMap;
		var myRefMapDragger;
		var myZoomSlider;
		function init(evt) {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			myMainMap = new map("mainMap",[(#CALLAGE|worldfileWidth)],0,0.6,0,"m",true,"coordX","coordY",dynamicLayers,digiLayers,"");
			//slider properties: x1,y1,value1,x2,y2,value2,startValue,group in which to build the slider,color of slider
			//width of slider of sliderbar,width of invisible slider bar,width of visible slider
			myZoomSlider = new slider(710,70,myMainMap.minWidth,710,170,myMainMap.maxWidth,myMainMap.maxWidth,"mapZoomSlider","dimgray",2,10,"sliderSymbol","myRefMapDragger.resizeDragger",true);
			//set constraints to draggable rect in reference map
			myRefMapDragger = new dragObj("dragRectForRefMap","referenceMap","myDragCross",4750,true,"coordX","coordY",myMainMap);
			loadProjectSpecific();
		}
		function loadProjectSpecific() {
			//adopt width and height of map extent
			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			//adopt line width of park boundary
			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
			// Pour charger un claque WMS ... getOrthoImage();
		<BOUCLE__OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <BOUCLE__M(MOTS){id_carto_objet}{par num titre}{doublons}>
			document.getElementById("spipCarto_#ID_MOT").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
		 </BOUCLE__M>
		</BOUCLE__OBJ>
		}
		
		function openWin (url) {
			window.open(url, "info");
		}


		//load usgs/terraserver orthoimage
		//you have to use full pixel values, otherwise an error appears
		function getOrthoImage() {
			var myRasterLayer = document.getElementById("DOQ");
			if (myRasterLayer.childNodes.length > 0) {
				var oldImage = document.getElementById("DOQImage");
				myRasterLayer.removeChild(oldImage);
			}
			if (document.getElementById("DOQ").getAttributeNS(null,"visibility") == "visible") {
				var myRasterImage = document.createElementNS(svgNS,"image");
				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
				myRasterImage.setAttributeNS(null,"id","DOQImage");
				var myImageUrl = "http://www.sandre.fr/geo/wmszonage?version=1.1.1&request=GetMap&service=WMS&Layers=CIBA&Styles=&SRS=EPSG:27572&";
				myImageUrl += "BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
				myRasterLayer.appendChild(myRasterImage);
			}
		}		


]]></script>
	<defs>
	<!-- section for CSS stylesheet definitions -->
	<!-- you may globally adjust your styles here -->
	<style type="text/css"><![CDATA[
	.allText {font-family:Arial;fill:dimgray;}
	.titleText {font-size:22;font-weight:bold;}
	.subTitleText {font-size:18;font-weight:bold;}
	.normalText {font-size:15;}
	.smallText {font-size:12;}
	.boldText {font-weight:bold;}
	.centerText {text-anchor:middle;}
	.dragRect {fill:lightskyblue;stroke:none;opacity:0.4;}
	.dragSymbol {stroke:darkblue;}
	.normalLinestyle {fill:none;stroke:dimgray;}
	.background {fill:aliceblue;stroke:none;}
	.darkRectstyle {fill:dimgray;stroke:none;}
	.nofill {fill:none;}
	.whitefill {fill:white;}
	.normalfillcol {fill:dimgray;}
	.normallinecol {stroke:dimgray;}
	.nostroke {stroke:none;}
	.verythinline {stroke-width:1;}
	.thinline {stroke-width:1.5;}
	.normalline {stroke-width:2;}
	.mediumThickLine {stroke-width:5;}
	<INCLURE(style_carto.css)>
	
  ]]></style>
		<!-- Symbols for checkboxes -->
		<symbol id="checkBoxRect" overflow="visible">
			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
		</symbol>
		<symbol id="checkBoxCross" overflow="visible" class="normallinecol nofill verythinline" pointer-events="none">
			<line x1="-5" y1="-5" x2="5" y2="5"/>
			<line x1="-5" y1="5" x2="5" y2="-5"/>
		</symbol>
		<!-- Symbols for Zoom Magnifyer glasses -->
		<symbol id="magnifyer" overflow="visible" class="whitefill normalline normallinecol">
			<line x1="0" y1="0" x2="-8" y2="20"/>
			<circle r="8"/>
		</symbol>
		<symbol id="magnifyerZoomOut" overflow="visible" class="whitefill normalline normallinecol">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<symbol id="magnifyerZoomIn" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" class="whitefill normalline normallinecol"/>
			<line x1="0" y1="-4" x2="0" y2="4" class="whitefill normalline normallinecol"/>
		</symbol>
		<symbol id="magnifyerFull" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<text y="4.5" class="allText smallText centerText boldText" pointer-events="none">F</text>
		</symbol>
		<symbol id="magnifyerManual" overflow="visible">
			<line x1="0" y1="0" x2="-8" y2="20" class="whitefill normalline normallinecol"/>
			<circle r="8" class="whitefill normalline normallinecol"/>
			<rect x="-3" y="-3" width="6" height="6" class="nofill thinline normallinecol" stroke-dasharray="1.5,1.5"/>
		</symbol>
		<symbol id="magnifyerZoomInWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0"/>
			<line x1="0" y1="-4" x2="0" y2="4"/>
		</symbol>
		<symbol id="magnifyerZoomOutWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<!-- hand symbol for panning -->
		<symbol id="symbPan" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<path class="normallinecol verythinline nofill" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
		</symbol>
		<!-- Symbol for Pan Arrows -->
		<symbol id="symbArrow" overflow="visible" class="nofill verythinline normallinecol" pointer-events="none">
			<polyline points="-3,-5 3,-5 3,1 5,1 0,5 -5,1 -3,1 -3,-5"/>
		</symbol>
		<!-- Symbol for Recentering Map -->
		<symbol id="symbRecenter" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<circle class="normalfillcol nostroke" cx="0" cy="0" r="1" pointer-events="none"/>
			<g class="normallinecol thinline nofill" pointer-events="none">
				<line x1="-7" y1="-7" x2="-3" y2="-3"/>
				<line x1="7" y1="7" x2="3" y2="3"/>
				<line x1="-7" y1="7" x2="-3" y2="3"/>
				<line x1="7" y1="-7" x2="3" y2="-3"/>
			</g>
		</symbol>
		<!-- Symbol for Slider -->
		<symbol id="sliderSymbol" overflow="visible" class="nofill mediumThickLine normallinecol" pointer-events="none">
			<line x1="0" y1="-5" x2="0" y2="5"/>
		</symbol>
		<!-- Symbol for Dragging if zoomed in far -->
		<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" class="nofill dragSymbol" pointer-events="none">
			<line x1="-7000" y1="0" x2="-2500" y2="0"/>
			<line x1="7000" y1="0" x2="2500" y2="0"/>
			<line x1="0" y1="-3300" x2="0" y2="-7800"/>
			<line x1="0" y1="3300" x2="0" y2="7800"/>
		</symbol>
		<!-- Marker for Extent-Arrows -->
		<marker id="myStartArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="-0.5,0 8,-2 8,2"/>
		</marker>
		<marker id="myEndArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
		</marker>
		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 


	</defs>
	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
	
	
	<!-- Main Map Frame -->
	<svg id="mainMap" x="0" y="15" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="553" height="[(#CALLAGE|getPropMapHeight{553})]">
		<!-- this group is necessary for manual panning, it temporarily gets a translate transformation which is later removed on mouseup -->
		<g id="mainMapGroup" transform="translate(0,0)">
			<!-- within this group you should place all map layers, usually, if you have more than one element in a map layer, you would use a group instead of a single element, as in this example -->
			<g id="DOQ" visibility="visible" />
			<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]px" height="[(#CALLAGE|worldfileHeight)]px" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
			
		<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <!-- attention : #ID_CARTO_OBJET -->
		 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
			<g id="spipCarto_#ID_MOT">
			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}>
			<!-- Couche d'objets SPIP -->
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a>
			</BOUCLE_OBJECT>
			</g>
		 </BOUCLE_M>
		</BOUCLE_OBJ>

			<g id="spipCartoObj">
			
				<!-- Couche d'objets SPIP -->
				<B_objets>
				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a><!-- style="opacity:.6;" style="fill:url(#MyGradient);"-->
				</BOUCLE_objets>
				</B_objets>	
			</g>
		</g>
	</svg>
	
	
	
	
	<!-- this group holds navigation, title and if you like, legend information -->
	<g>
		<!-- your map title -->
		<text class="allText titleText" x="580" y="10">#TITRE</text>
		<!-- coordinate display -->
		<g class="allText normalText">
			<text id="coordX" x="580" y="200">X:</text>
			<text id="coordY" x="580" y="215">Y:</text>
		</g>
		<!-- display width and height of map extent -->
		<g>
			<!-- vertical line, displays current height of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="561" y1="15" x2="561" y2="[(#CALLAGE|getPropMapHeight{575})]"/>
			<rect class="background" x="555" y="[(#CALLAGE|getPropMapHeight{230})]" width="12" height="100"/>
			<text id="myScaleTextH" class="allText normalText centerText" transform="translate(556,[(#CALLAGE|getPropMapHeight{280})]),rotate(90)">81,000 m</text>
			<!-- horizontal line, displays current width of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="0" y1="[(#CALLAGE|getPropMapHeight{583})]" x2="553.1" y2="[(#CALLAGE|getPropMapHeight{583})]"/>
			<rect class="background" x="236" y="[(#CALLAGE|getPropMapHeight{580})]" width="100" height="12"/>
			<text id="myScaleTextW" class="allText normalText centerText" transform="translate(277,[(#CALLAGE|getPropMapHeight{590})])">64,000 m</text>
			<!-- small rectangle in lower right corner, onclick displays current map extent in real world coordinates -->
			<rect class="darkRectstyle" x="558.5" y="[(#CALLAGE|getPropMapHeight{580})]" width="5" height="5" onclick="showExtent()" />
		</g>
		<!-- control map layer visibility with checkBoxes -->
		<g transform="translate(590 300)">
			<text class="allText subTitleText" x="-10" y="0">Calques</text>

			<!-- checkbox -->
		<BOUCLE_OBJ2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <!-- attention : #ID_CARTO_OBJET -->
		 <BOUCLE_M2(MOTS){id_carto_objet}{par num titre}{doublons c}>
			<g transform="translate(0 20)">
				<use id="checkBoxspipCarto_#ID_MOT" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCarto_#ID_MOT');"/>
				<use id="checkCrossspipCarto_#ID_MOT" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
		 </BOUCLE_M2>
		</BOUCLE_OBJ2>

			<!-- first checkbox -->
			<g transform="translate(0 20)">
				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- second checkbox -->
			<g transform="translate(0 40)">
				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- third checkbox 
			<g transform="translate(0 60)">
				<use id="checkBoxDOQ" xlink:href="#checkBoxRect"
				onclick="checkBoxScript(evt,'DOQ');"/>
				<use id="checkCrossDOQ" xlink:href="#checkBoxCross"
				visibility="visible"/>
			</g>-->
			<!-- checkbox text labels -->
			<g class="allText normalText">
				<text x="12" y="26">Objet SPIP-CARTO</text>
				<text x="12" y="46">Image de fonc</text>
				<!-- Check for WMS <text x="12" y="66">Bassin versant</text>-->
			</g>
		</g>
		<!-- map impressum and status Bar -->
		<g text-rendering="optimizeLegibility">
			<!-- text with this id is required to show help texts -->
			<text id="statusText" class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{600})]">Info: </text>
			<text class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{620})]">Auteur: spip-carto, 2004</text>
			<text class="allText smallText" x="510" y="[(#CALLAGE|getPropMapHeight{620})]">Source: </text>
		</g>
	</g>
	<!-- small reference map, shares the same coordinate system than the main map -->
	<svg id="referenceMap" x="580" y="45" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="118.52" height="[(#CALLAGE|getPropMapHeight{118.52})]" onmousedown="myRefMapDragger.drag(evt)" onmousemove="myRefMapDragger.drag(evt)" onmouseup="myRefMapDragger.drag(evt)" onmouseout="myRefMapDragger.drag(evt)">
		<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
		<path pointer-events="none" style="fill:none;stroke:salmon;stroke-width:1000" d="M250528.8 -4218899.3l2380.5 -1305.3l1593.4 928.3l1326.1 -752.7l4218.1 -70.2l4072.3 -3965.5l5552.8 -1556.9l313 -1368.6l3042.8 -2535.6l1098.2 945.4l124.7 2135.2l2579.4 431.2l-22.8 1238l3516.2 779.5l-66.6 -1725.9l1001.7 -419l625.5 2735.2l1659.5 476.6l-330.2 1248.2l1330.8 747.9l-583.6 1341.1l1261.8 -103.1l285.3 729.8l1411.9 -2540.5l552.1 995.2l2360 129.9l1432.7 1622l2981.7 1123.5l2940.7 4333.1l-270.6 1128.2l792.4 1201.5l-1726.7 5827.8l785 2018.2l2160 2274.1l2083.2 772.6l-29.7 1587l2579.8 273.2l2903.1 2611.6l-1211.6 1736.7l-304 2424.3l1806.8 664.5l-952.3 432.8l228.8 1126.8l-1164.6 1204.8l1028.8 823.8l134.5 1768.4l-3601.7 2856.7l-1067.8 2250.5l-1294 1012.3l939.2 1643.7l-426.7 1493.5l-1730.1 1237.5l-1330.5 3254.3l-3443.5 3823l-1377.3 499.3l-1732.6 -647.3l-2658.4 9242.1l-2580.3 -63.8l-1626.7 1640.8l-11817 92.4l-111.4 4297.6l-745.7 11.6l-6670.9 -270.2l-1972.9 -5940.7l-1565.6 -523.5l821.7 -7022.1l-765 -!
 27.8l26.9 -795.4l742.7 19.8l74.1 -825.8l-2396.2 -52l748.7 -3186.1l-3846.4 -78l60.9 -5551.1l-1599 -53.4l110.1 -3306.4l-6584.6 -269.6l-573.6 -4908.1l-895.7 -69.6l-3.4 -3096.9l2384.7 -772.2l99.6 -1566.5l1598.9 3l268.3 -6583.2l-5123.5 -132.5l183.9 -10111.9l1168.6 -4214.1l-716.7 -975.6l1461.4 -2002.8l-593.4 -565.8l2659.9 -3238.9z" />
		<!-- rectangle that represents map extent -->
		<rect id="dragRectForRefMap" class="dragRect" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" pointer-events="none"/>
		<!-- if zoomed in very far, we display a cross-symbol here to indicate the map position in the reference map -->
		<use id="myDragCross" x="[(#CALLAGE|worldfileLRX)]" y="-[(#CALLAGE|worldfileHeight)]" xlink:href="#myDragCrossSymbol" visibility="hidden" />
	</svg>
	<!-- this group holds symbol instances for navigation tools -->
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider1"/>
		<use x="710" y="55" xlink:href="#magnifyerZoomInWo" onclick="zoomIt(evt,'in');" onmouseover="magnify(evt,1.2,'in');" onmouseout="magnify(evt,1,'in');"/>
		<!-- button for zoom-out, below slider -->
		<use x="710" y="185" xlink:href="#magnifyerZoomOutWo" onclick="zoomIt(evt,'out');" onmouseover="magnify(evt,1.2,'out');" onmouseout="magnify(evt,1,'out');"/>
	</g>
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider"/>
		<text class="allText subTitleText" x="580" y="240">Localisation</text>
		<!-- button for full view (f) -->
		<use x="610" y="260" xlink:href="#magnifyerFull" onclick="zoomIt(evt,'full');" onmouseover="magnify(evt,1.2,'full');" onmouseout="magnify(evt,1,'full');"/>
		<!-- button for manual zoom (rectangle) -->
		<use x="640" y="260" xlink:href="#magnifyerManual" onclick="myMainMap.zoomManual(evt)" onmouseover="magnify(evt,1.2,'manual');" onmouseout="magnify(evt,1,'manual');"/>
		<!-- button for manual pan -->
		<use x="670" y="260" xlink:href="#symbPan" onclick="myMainMap.panManual(evt)" onmouseover="magnify(evt,1.2,'panmanual');" onmouseout="magnify(evt,1,'panmanual');"/>
		<!-- button for redefining map center -->
		<use xlink:href="#symbRecenter" x="700" y="260" onmouseover="magnify(evt,1.2,'recenter')" onmouseout="magnify(evt,1,'recenter')" onclick="myMainMap.recenter(evt)"/>
	</g>
</svg>
</BOUCLE_carte>
--- NEW FILE: carto_map.html ---
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,#ENV{args}})]" href="#URL_OBJET" alt="#TEXTE"/>
</BOUCLE_objets></map></B_objets></BOUCLE_carte>
--- NEW FILE: style_carto_svgfilex.css ---
.polygondefault {fill:red;fill-opacity:.6;}
.polygoncat1 {stroke:red;stroke-width:2;fill:transparent;fill-opacity:0;}
.polygoncat2 {stroke:green;stroke-width:2;fill:transparent;fill-opacity:0;}

--- NEW FILE: Copy (2) of carto_svgfilex.html ---
<?php echo '<'.'?xml version="1.0" encoding="#CHARSET"?'.">\n"; ?>
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
<svg width="100%" height="100%" viewBox="0 0 760 500" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:attrib="http://www.carto.net/attrib" onload="init(evt);" zoomAndPan="enable" encoding="ISO-8859-1">
	<script type="text/ecmascript" xlink:href="helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="navigation.js"/>
	<script type="text/ecmascript" xlink:href="navigationTools.js"/>
	<script type="text/ecmascript"><![CDATA[
		
		
		var myMapApp = new mapApp();
		var myMainMap;
		var myRefMapDragger;
		var myZoomSlider;
		function init(evt) {
			//dynamic layer array that allow loading from database
			var dynamicLayers = new Array();
			//initialize digiLayers (layers that allow digitizing)
			var digiLayers = new Array();
			myMainMap = new map("mainMap",[(#CALLAGE|worldfileWidth)],0,0.6,0,"m",true,"coordX","coordY",dynamicLayers,digiLayers,"");
			//slider properties: x1,y1,value1,x2,y2,value2,startValue,group in which to build the slider,color of slider
			//width of slider of sliderbar,width of invisible slider bar,width of visible slider
			myZoomSlider = new slider(710,70,myMainMap.minWidth,710,170,myMainMap.maxWidth,myMainMap.maxWidth,"mapZoomSlider","dimgray",2,10,"sliderSymbol","myRefMapDragger.resizeDragger",true);
			//set constraints to draggable rect in reference map
			myRefMapDragger = new dragObj("dragRectForRefMap","referenceMap","myDragCross",4750,true,"coordX","coordY",myMainMap);
			loadProjectSpecific();
		}
		function loadProjectSpecific() {
			//adopt width and height of map extent
			document.getElementById("myScaleTextW").firstChild.nodeValue = formatNumberString(myMainMap.curWidth.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			document.getElementById("myScaleTextH").firstChild.nodeValue = formatNumberString(myMainMap.curHeight.toFixed(myMainMap.nrDecimals)) + myMainMap.units;
			//adopt line width of park boundary
			document.getElementById("spipCartoObj").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
			// Pour charger un claque WMS ... getOrthoImage();
		<BOUCLE__OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <BOUCLE__M(MOTS){id_carto_objet}{par num titre}{doublons}>
			document.getElementById("spipCarto_#ID_MOT").setAttributeNS(null,"stroke-width",myMainMap.curWidth*0.005);	
		 </BOUCLE__M>
		</BOUCLE__OBJ>
		}
		
		function openWin (url) {
			window.open(url, "info");
		}


		//load usgs/terraserver orthoimage
		//you have to use full pixel values, otherwise an error appears
		function getOrthoImage() {
			var myRasterLayer = document.getElementById("DOQ");
			if (myRasterLayer.childNodes.length > 0) {
				var oldImage = document.getElementById("DOQImage");
				myRasterLayer.removeChild(oldImage);
			}
			if (document.getElementById("DOQ").getAttributeNS(null,"visibility") == "visible") {
				var myRasterImage = document.createElementNS(svgNS,"image");
				myRasterImage.setAttributeNS(null,"x",myMainMap.curxOrig);
				myRasterImage.setAttributeNS(null,"y",myMainMap.curyOrig);
				myRasterImage.setAttributeNS(null,"width",myMainMap.curWidth);
				myRasterImage.setAttributeNS(null,"height",myMainMap.curHeight);
				myRasterImage.setAttributeNS(null,"id","DOQImage");
				var myImageUrl = "http://www.sandre.fr/geo/wmszonage?version=1.1.1&request=GetMap&service=WMS&Layers=CIBA&Styles=&SRS=EPSG:27572&";
				myImageUrl += "BBOX=" + parseInt(myMainMap.curxOrig) + "," + (parseInt(myMainMap.curyOrig + myMainMap.curHeight) * -1);
				myImageUrl += "," + parseInt(myMainMap.curxOrig + myMainMap.curWidth) + "," + (parseInt(myMainMap.curyOrig) * -1);
				myImageUrl += "&width=" + myMainMap.pixWidth + "&height=" + myMainMap.pixHeight + "&format=image/png";
				myRasterImage.setAttributeNS(xlinkNS,"xlink:href",myImageUrl);
				myRasterLayer.appendChild(myRasterImage);
			}
		}		


]]></script>
	<defs>
	<!-- section for CSS stylesheet definitions -->
	<!-- you may globally adjust your styles here -->
	<style type="text/css"><![CDATA[
	.allText {font-family:Arial;fill:dimgray;}
	.titleText {font-size:22;font-weight:bold;}
	.subTitleText {font-size:18;font-weight:bold;}
	.normalText {font-size:15;}
	.smallText {font-size:12;}
	.boldText {font-weight:bold;}
	.centerText {text-anchor:middle;}
	.dragRect {fill:lightskyblue;stroke:none;opacity:0.4;}
	.dragSymbol {stroke:darkblue;}
	.normalLinestyle {fill:none;stroke:dimgray;}
	.background {fill:aliceblue;stroke:none;}
	.darkRectstyle {fill:dimgray;stroke:none;}
	.nofill {fill:none;}
	.whitefill {fill:white;}
	.normalfillcol {fill:dimgray;}
	.normallinecol {stroke:dimgray;}
	.nostroke {stroke:none;}
	.verythinline {stroke-width:1;}
	.thinline {stroke-width:1.5;}
	.normalline {stroke-width:2;}
	.mediumThickLine {stroke-width:5;}
	<INCLURE(style_carto.css)>
	
  ]]></style>
		<!-- Symbols for checkboxes -->
		<symbol id="checkBoxRect" overflow="visible">
			<rect x="-6" y="-6" width="12" height="12" class="whitefill normallinecol thinline"/>
		</symbol>
		<symbol id="checkBoxCross" overflow="visible" class="normallinecol nofill verythinline" pointer-events="none">
			<line x1="-5" y1="-5" x2="5" y2="5"/>
			<line x1="-5" y1="5" x2="5" y2="-5"/>
		</symbol>
		<!-- Symbols for Zoom Magnifyer glasses -->
		<symbol id="magnifyer" overflow="visible" class="whitefill normalline normallinecol">
			<line x1="0" y1="0" x2="-8" y2="20"/>
			<circle r="8"/>
		</symbol>
		<symbol id="magnifyerZoomOut" overflow="visible" class="whitefill normalline normallinecol">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<symbol id="magnifyerZoomIn" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<line x1="-4" y1="0" x2="4" y2="0" class="whitefill normalline normallinecol"/>
			<line x1="0" y1="-4" x2="0" y2="4" class="whitefill normalline normallinecol"/>
		</symbol>
		<symbol id="magnifyerFull" overflow="visible">
			<use xlink:href="#magnifyer"/>
			<text y="4.5" class="allText smallText centerText boldText" pointer-events="none">F</text>
		</symbol>
		<symbol id="magnifyerManual" overflow="visible">
			<line x1="0" y1="0" x2="-8" y2="20" class="whitefill normalline normallinecol"/>
			<circle r="8" class="whitefill normalline normallinecol"/>
			<rect x="-3" y="-3" width="6" height="6" class="nofill thinline normallinecol" stroke-dasharray="1.5,1.5"/>
		</symbol>
		<symbol id="magnifyerZoomInWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0"/>
			<line x1="0" y1="-4" x2="0" y2="4"/>
		</symbol>
		<symbol id="magnifyerZoomOutWo" overflow="visible" class="whitefill normalline normallinecol">
			<circle r="8"/>
			<line x1="-4" y1="0" x2="4" y2="0" style="stroke:dimgray;stroke-width:2;"/>
		</symbol>
		<!-- hand symbol for panning -->
		<symbol id="symbPan" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<path class="normallinecol verythinline nofill" d="M-2 6 C -2.2 2.5 -8.0 -0 -5.7 -1.9 C -4.3 -2.5 -3.3 -0.5 -2.5 0.7 C -3.2 -2.1 -5.5 -5.2 -3.6 -5.8 C -2.1 -6.3 -1.6 -3.6 -1.1 -1.9 C -0.9 -4.2 -1.6 -6.4 -0.2 -6.6 C 1.4 -6.8 0.9 -3 1.1 -1.9 C 1.5 -3.5 1.2 -6.1 2.5 -6.1 C 3.9 -6.1 3.5 -3.2 3.6 -1.6 C 4 -2.9 4.1 -4.3 5.3 -4.4 C 7.3 -3.5 4 2.2 3 6z"/>
		</symbol>
		<!-- Symbol for Pan Arrows -->
		<symbol id="symbArrow" overflow="visible" class="nofill verythinline normallinecol" pointer-events="none">
			<polyline points="-3,-5 3,-5 3,1 5,1 0,5 -5,1 -3,1 -3,-5"/>
		</symbol>
		<!-- Symbol for Recentering Map -->
		<symbol id="symbRecenter" overflow="visible">
			<circle r="9" class="normallinecol normalline whitefill"/>
			<circle class="normalfillcol nostroke" cx="0" cy="0" r="1" pointer-events="none"/>
			<g class="normallinecol thinline nofill" pointer-events="none">
				<line x1="-7" y1="-7" x2="-3" y2="-3"/>
				<line x1="7" y1="7" x2="3" y2="3"/>
				<line x1="-7" y1="7" x2="-3" y2="3"/>
				<line x1="7" y1="-7" x2="3" y2="-3"/>
			</g>
		</symbol>
		<!-- Symbol for Slider -->
		<symbol id="sliderSymbol" overflow="visible" class="nofill mediumThickLine normallinecol" pointer-events="none">
			<line x1="0" y1="-5" x2="0" y2="5"/>
		</symbol>
		<!-- Symbol for Dragging if zoomed in far -->
		<symbol id="myDragCrossSymbol" overflow="visible" stroke-width="2000" class="nofill dragSymbol" pointer-events="none">
			<line x1="-7000" y1="0" x2="-2500" y2="0"/>
			<line x1="7000" y1="0" x2="2500" y2="0"/>
			<line x1="0" y1="-3300" x2="0" y2="-7800"/>
			<line x1="0" y1="3300" x2="0" y2="7800"/>
		</symbol>
		<!-- Marker for Extent-Arrows -->
		<marker id="myStartArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="-0.5,0 8,-2 8,2"/>
		</marker>
		<marker id="myEndArrow" overflow="visible" orient="auto">
			<polyline class="nostroke normalfillcol" points="0.5,0 -8,-2 -8,2"/>
		</marker>
		<linearGradient id="MyGradient" gradientTransform="rotate(45)"> 
			<stop offset="0%" style="stop-color:white"/> 
			<stop offset="30%" style="stop-color:red"/> 
			<stop offset="100%" style="stop-color:black"/> 
		</linearGradient> 


	</defs>
	<rect x="-500" y="-500" width="3000" height="[(#CALLAGE|getPropMapHeight{3000})]" stroke="none" class="background" />
	
	
	<!-- Main Map Frame -->
	<svg id="mainMap" x="0" y="15" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="553" height="[(#CALLAGE|getPropMapHeight{553})]">
		<!-- this group is necessary for manual panning, it temporarily gets a translate transformation which is later removed on mouseup -->
		<g id="mainMapGroup" transform="translate(0,0)">
			<!-- within this group you should place all map layers, usually, if you have more than one element in a map layer, you would use a group instead of a single element, as in this example -->
			<g id="DOQ" visibility="visible" />
			<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]px" height="[(#CALLAGE|worldfileHeight)]px" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
			
		<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <!-- attention : #ID_CARTO_OBJET -->
		 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
			<g id="spipCarto_#ID_MOT">
			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}>
			<!-- Couche d'objets SPIP -->
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a>
			</BOUCLE_OBJECT>
			</g>
		 </BOUCLE_M>
		</BOUCLE_OBJ>

			<g id="spipCartoObj">
			
				<!-- Couche d'objets SPIP -->
				<B_objets>
				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
				<a target='new' xlink:href='#URL_OBJET'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="strokeFilled"/></a><!-- style="opacity:.6;" style="fill:url(#MyGradient);"-->
				</BOUCLE_objets>
				</B_objets>	
			</g>
		</g>
	</svg>
	
	
	
	
	<!-- this group holds navigation, title and if you like, legend information -->
	<g>
		<!-- your map title -->
		<text class="allText titleText" x="580" y="10">#TITRE</text>
		<!-- coordinate display -->
		<g class="allText normalText">
			<text id="coordX" x="580" y="200">X:</text>
			<text id="coordY" x="580" y="215">Y:</text>
		</g>
		<!-- display width and height of map extent -->
		<g>
			<!-- vertical line, displays current height of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="561" y1="15" x2="561" y2="[(#CALLAGE|getPropMapHeight{575})]"/>
			<rect class="background" x="555" y="[(#CALLAGE|getPropMapHeight{230})]" width="12" height="100"/>
			<text id="myScaleTextH" class="allText normalText centerText" transform="translate(556,[(#CALLAGE|getPropMapHeight{280})]),rotate(90)">81,000 m</text>
			<!-- horizontal line, displays current width of map extent -->
			<line class="normalLinestyle" style="stroke-width:1.5;marker-start:url(#myStartArrow);marker-end:url(#myEndArrow);" x1="0" y1="[(#CALLAGE|getPropMapHeight{583})]" x2="553.1" y2="[(#CALLAGE|getPropMapHeight{583})]"/>
			<rect class="background" x="236" y="[(#CALLAGE|getPropMapHeight{580})]" width="100" height="12"/>
			<text id="myScaleTextW" class="allText normalText centerText" transform="translate(277,[(#CALLAGE|getPropMapHeight{590})])">64,000 m</text>
			<!-- small rectangle in lower right corner, onclick displays current map extent in real world coordinates -->
			<rect class="darkRectstyle" x="558.5" y="[(#CALLAGE|getPropMapHeight{580})]" width="5" height="5" onclick="showExtent()" />
		</g>
		<!-- control map layer visibility with checkBoxes -->
		<g transform="translate(590 300)">
			<text class="allText subTitleText" x="-10" y="0">Calques</text>

			<!-- checkbox -->
		<BOUCLE_OBJ2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
		 <!-- attention : #ID_CARTO_OBJET -->
		 <BOUCLE_M2(MOTS){id_carto_objet}{par num titre}{doublons c}>
			<g transform="translate(0 20)">
				<use id="checkBoxspipCarto_#ID_MOT" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCarto_#ID_MOT');"/>
				<use id="checkCrossspipCarto_#ID_MOT" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
		 </BOUCLE_M2>
		</BOUCLE_OBJ2>

			<!-- first checkbox -->
			<g transform="translate(0 20)">
				<use id="checkBoxspipCartoObj" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'spipCartoObj');"/>
				<use id="checkCrossspipCartoObj" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- second checkbox -->
			<g transform="translate(0 40)">
				<use id="checkBoxShadedRelief" xlink:href="#checkBoxRect" onclick="checkBoxScript(evt,'ShadedRelief');"/>
				<use id="checkCrossShadedRelief" xlink:href="#checkBoxCross" visibility="visible"/>
			</g>
			<!-- third checkbox 
			<g transform="translate(0 60)">
				<use id="checkBoxDOQ" xlink:href="#checkBoxRect"
				onclick="checkBoxScript(evt,'DOQ');"/>
				<use id="checkCrossDOQ" xlink:href="#checkBoxCross"
				visibility="visible"/>
			</g>-->
			<!-- checkbox text labels -->
			<g class="allText normalText">
				<text x="12" y="26">Objet SPIP-CARTO</text>
				<text x="12" y="46">Image de fonc</text>
				<!-- Check for WMS <text x="12" y="66">Bassin versant</text>-->
			</g>
		</g>
		<!-- map impressum and status Bar -->
		<g text-rendering="optimizeLegibility">
			<!-- text with this id is required to show help texts -->
			<text id="statusText" class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{600})]">Info: </text>
			<text class="allText smallText" x="1" y="[(#CALLAGE|getPropMapHeight{620})]">Auteur: spip-carto, 2004</text>
			<text class="allText smallText" x="510" y="[(#CALLAGE|getPropMapHeight{620})]">Source: </text>
		</g>
	</g>
	<!-- small reference map, shares the same coordinate system than the main map -->
	<svg id="referenceMap" x="580" y="45" viewBox="[(#CALLAGE|worldfileLRX)] [(#CALLAGE|worldfileULY)] [(#CALLAGE|worldfileWidth)] [(#CALLAGE|worldfileHeight)]" width="118.52" height="[(#CALLAGE|getPropMapHeight{118.52})]" onmousedown="myRefMapDragger.drag(evt)" onmousemove="myRefMapDragger.drag(evt)" onmouseup="myRefMapDragger.drag(evt)" onmouseout="myRefMapDragger.drag(evt)">
		<image id="ShadedRelief" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" xlink:href="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" />
		<path pointer-events="none" style="fill:none;stroke:salmon;stroke-width:1000" d="M250528.8 -4218899.3l2380.5 -1305.3l1593.4 928.3l1326.1 -752.7l4218.1 -70.2l4072.3 -3965.5l5552.8 -1556.9l313 -1368.6l3042.8 -2535.6l1098.2 945.4l124.7 2135.2l2579.4 431.2l-22.8 1238l3516.2 779.5l-66.6 -1725.9l1001.7 -419l625.5 2735.2l1659.5 476.6l-330.2 1248.2l1330.8 747.9l-583.6 1341.1l1261.8 -103.1l285.3 729.8l1411.9 -2540.5l552.1 995.2l2360 129.9l1432.7 1622l2981.7 1123.5l2940.7 4333.1l-270.6 1128.2l792.4 1201.5l-1726.7 5827.8l785 2018.2l2160 2274.1l2083.2 772.6l-29.7 1587l2579.8 273.2l2903.1 2611.6l-1211.6 1736.7l-304 2424.3l1806.8 664.5l-952.3 432.8l228.8 1126.8l-1164.6 1204.8l1028.8 823.8l134.5 1768.4l-3601.7 2856.7l-1067.8 2250.5l-1294 1012.3l939.2 1643.7l-426.7 1493.5l-1730.1 1237.5l-1330.5 3254.3l-3443.5 3823l-1377.3 499.3l-1732.6 -647.3l-2658.4 9242.1l-2580.3 -63.8l-1626.7 1640.8l-11817 92.4l-111.4 4297.6l-745.7 11.6l-6670.9 -270.2l-1972.9 -5940.7l-1565.6 -523.5l821.7 -7022.1l-765 -!
 27.8l26.9 -795.4l742.7 19.8l74.1 -825.8l-2396.2 -52l748.7 -3186.1l-3846.4 -78l60.9 -5551.1l-1599 -53.4l110.1 -3306.4l-6584.6 -269.6l-573.6 -4908.1l-895.7 -69.6l-3.4 -3096.9l2384.7 -772.2l99.6 -1566.5l1598.9 3l268.3 -6583.2l-5123.5 -132.5l183.9 -10111.9l1168.6 -4214.1l-716.7 -975.6l1461.4 -2002.8l-593.4 -565.8l2659.9 -3238.9z" />
		<!-- rectangle that represents map extent -->
		<rect id="dragRectForRefMap" class="dragRect" x="[(#CALLAGE|worldfileLRX)]" y="[(#CALLAGE|worldfileULY)]" width="[(#CALLAGE|worldfileWidth)]" height="[(#CALLAGE|worldfileHeight)]" pointer-events="none"/>
		<!-- if zoomed in very far, we display a cross-symbol here to indicate the map position in the reference map -->
		<use id="myDragCross" x="[(#CALLAGE|worldfileLRX)]" y="-[(#CALLAGE|worldfileHeight)]" xlink:href="#myDragCrossSymbol" visibility="hidden" />
	</svg>
	<!-- this group holds symbol instances for navigation tools -->
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider1"/>
		<use x="710" y="55" xlink:href="#magnifyerZoomInWo" onclick="zoomIt(evt,'in');" onmouseover="magnify(evt,1.2,'in');" onmouseout="magnify(evt,1,'in');"/>
		<!-- button for zoom-out, below slider -->
		<use x="710" y="185" xlink:href="#magnifyerZoomOutWo" onclick="zoomIt(evt,'out');" onmouseover="magnify(evt,1.2,'out');" onmouseout="magnify(evt,1,'out');"/>
	</g>
	<g>
		<!-- empty group where zoomSlider is later appended -->
		<g id="mapZoomSlider"/>
		<text class="allText subTitleText" x="580" y="240">Localisation</text>
		<!-- button for full view (f) -->
		<use x="610" y="260" xlink:href="#magnifyerFull" onclick="zoomIt(evt,'full');" onmouseover="magnify(evt,1.2,'full');" onmouseout="magnify(evt,1,'full');"/>
		<!-- button for manual zoom (rectangle) -->
		<use x="640" y="260" xlink:href="#magnifyerManual" onclick="myMainMap.zoomManual(evt)" onmouseover="magnify(evt,1.2,'manual');" onmouseout="magnify(evt,1,'manual');"/>
		<!-- button for manual pan -->
		<use x="670" y="260" xlink:href="#symbPan" onclick="myMainMap.panManual(evt)" onmouseover="magnify(evt,1.2,'panmanual');" onmouseout="magnify(evt,1,'panmanual');"/>
		<!-- button for redefining map center -->
		<use xlink:href="#symbRecenter" x="700" y="260" onmouseover="magnify(evt,1.2,'recenter')" onmouseout="magnify(evt,1,'recenter')" onclick="myMainMap.recenter(evt)"/>
	</g>
</svg>
</BOUCLE_carte>
Index: carto_svgx.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgx.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- carto_svgx.html	5 Jul 2005 00:46:13 -0000	1.1
+++ carto_svgx.html	21 Jul 2005 21:47:16 -0000	1.2
@@ -1,5 +1,5 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
-<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfilex" width="750px" height="550px" type="image/svg+xml" name="emap"></embed>
+<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfilex" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] type="image/svg+xml" name="emap"></embed>
 <noembed>
 	<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
 	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="#URL_OBJET" alt="#TEXTE"/>

--- cartov2.html DELETED ---

--- carto_svg2.html DELETED ---



From stef at berlios.de  Thu Jul 21 23:47:18 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:18 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_signatures.php3,NONE,1.1 filtery.js,NONE,1.1 mots_type.php3,1.3,1.4 inc_mots.php3,1.4,1.5 inc_serialbase.php3,1.3,1.4 inc_debug_sql.php3,1.5,1.6 inc_documents.php3,1.5,1.6 forum_envoi.php3,1.4,1.5 auteur_infos.php3,1.5,1.6 inc_acces.php3,1.5,1.6 mes_options.php3,1.4,1.5 mots_edit.php3,1.4,1.5 controle_petition.php3,1.2,1.3 inc_filtres.php3,1.6,1.7 inc_forum.php3,1.6,1.7 inc_version.php3,1.8,1.9 articles.php3,1.5,1.6 auteurs_edit.php3,1.5,1.6 rubriques_edit.php3,1.4,1.5 js_menu_rubriques.php,1.3,1.4 inc_majbase.php3,1.4,1.5 inc_barre.php3,1.2,1.3 inc_texte.php3,1.7,1.8 inc_sites.php3,1.5,1.6 articles_edit.php3,1.5,1.6 carte_edit.php3,1.12,1.13 inc_tidy.php,1.4,1.5 inc_getdocument.php3,1.5,1.6 inc_spip_sax.php,1.1,1.2 mots_tous.php3,1.2,1.3 inc_carto.php3,1.13,1.14 inc_abstract_sql.php3,1.2,1.3 inc_import.php3,1.5,1.6 inc_auth.php3,1.3,1.4 inc_db_mysql.php3,1.4,1.5 sites_edit.php3,1.4,1.5 inc_presentation.php3,1.8,1.9 sites.php3,1.3,1.4
Message-ID: <200507212147.j6LLlIqX024016@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv22230/ecrire

Modified Files:
	mots_type.php3 inc_mots.php3 inc_serialbase.php3 
	inc_debug_sql.php3 inc_documents.php3 forum_envoi.php3 
	auteur_infos.php3 inc_acces.php3 mes_options.php3 
	mots_edit.php3 controle_petition.php3 inc_filtres.php3 
	inc_forum.php3 inc_version.php3 articles.php3 
	auteurs_edit.php3 rubriques_edit.php3 js_menu_rubriques.php 
	inc_majbase.php3 inc_barre.php3 inc_texte.php3 inc_sites.php3 
	articles_edit.php3 carte_edit.php3 inc_tidy.php 
	inc_getdocument.php3 inc_spip_sax.php mots_tous.php3 
	inc_carto.php3 inc_abstract_sql.php3 inc_import.php3 
	inc_auth.php3 inc_db_mysql.php3 sites_edit.php3 
	inc_presentation.php3 sites.php3 
Added Files:
	inc_signatures.php3 filtery.js 
Log Message:
synchro CVS 20050719

--- NEW FILE: inc_signatures.php3 ---
<?php

/***************************************************************************\
 *  SPIP, Systeme de publication pour l'internet                           *
 *                                                                         *
 *  Copyright (c) 2001-2005                                                *
 *  Arnaud Martin, Antoine Pitrou, Philippe Riviere, Emmanuel Saint-James  *
 *                                                                         *
 *  Ce programme est un logiciel libre distribue sous licence GNU/GPL.     *
 *  Pour plus de details voir le fichier COPYING.txt ou l'aide en ligne.   *
\***************************************************************************/


//
// Ce fichier ne sera execute qu'une fois
if (defined("_ECRIRE_INC_SIGNATURES")) return;
define("_ECRIRE_INC_SIGNATURES", "1");

include_ecrire('inc_urls.php3');

function controle_signatures($script, $id, $debut, $where, $order, $limit=10) {
	global $couleur_foncee;
	
	$where = tronconne_signatures($script, $id, $debut, $where, $limit);
	$request = spip_query("SELECT * FROM spip_signatures " .
			      ($where ? " WHERE $where" : "") .
			      ($order ? " ORDER BY $order" : "") .
			      " LIMIT " . ($debut ? "$debut," : "") . $limit);

 	while($row=spip_fetch_array($request)){
		$id_signature = $row['id_signature'];
		$id_article = $row['id_article'];
		$date_time = $row['date_time'];
		$nom_email= typo(echapper_tags($row['nom_email']));
		$ad_email = echapper_tags($row['ad_email']);
		$nom_site = typo(echapper_tags($row['nom_site']));
		$url_site = echapper_tags($row['url_site']);
		$statut = $row['statut'];
		
		echo "<P>";
		
		if ($statut=="poubelle"){
			echo "<TABLE WIDTH=100% CELLPADDING=2 CELLSPACING=0 BORDER=0><TR><TD BGCOLOR='#FF0000'>";
		}
		
		echo "<TABLE WIDTH=100% CELLPADDING=3 CELLSPACING=0><TR><TD BGCOLOR='$couleur_foncee' class='verdana2' style='color: white;'><b>",
		  ($nom_site ? "$nom_site / " : ""),
		  $nom_email,
		  "</b></TD></TR>",
		  "<TR><TD BGCOLOR='#FFFFFF' class='serif'>";
				
		if ($statut=="publie"){
			icone (_T('icone_supprimer_signature'), "$script?supp_petition=$id_signature&debut=$debut", "forum-interne-24.gif", "supprimer.gif", "right");
		}
		if ($statut=="poubelle"){
			icone (_T('icone_valider_signature'), "$script?add_petition=$id_signature&debut=$debut", "forum-interne-24.gif", "creer.gif", "right");
		}
		
		echo "<FONT SIZE=2>".date_relative($date_time)."</FONT><BR>";
		if ($statut=="poubelle"){
			echo "<FONT SIZE=1 COLOR='red'>"._T('info_message_efface')."</FONT><BR>";
		}
		if (strlen($url_site)>6 AND strlen($nom_site)>0){
			echo "<FONT SIZE=1>"._T('info_site_web')."</FONT> <A HREF='$url_site'>$nom_site</A><BR>";
		}
		if (strlen($ad_email)>0){
			echo "<FONT SIZE=1>"._T('info_adresse_email')."</FONT> <A HREF='mailto:$ad_email'>$ad_email</A><BR>";
		}

		echo "<p>",message_de_signature($row),"</p>";
		
		list($titre) = spip_fetch_array(spip_query("SELECT titre FROM spip_articles WHERE id_article=$id_article"));	

		if (!$id)
		  echo "<span class='arial1' style='float: $spip_lang_right; color: black; padding-$spip_lang_left: 4px;'><b>",
		    _T('info_numero_abbreviation'),
		    $id_article,
		    " </b></span>";
		
		echo "<a href='",
		  (($statut == 'publie') ? 
		   "../spip_redirect.php3" :
		   "articles.php3"),
		  "?id_article=$id_article",
		  "'>",
		  typo($titre),
		  "</a>";

		echo "</TD></TR></TABLE>";
		
		if ($statut=="poubelle"){
			echo "</TD></TR></TABLE>";
		}
	}
}

function tronconne_signatures($script, $id_article, $debut, $where, $limit)
{
	if ($id_article) {
		$script .= "?id_article=$id_article&";
		$where .= ($where ? " AND " : "") . "id_article=$id_article";
	}
	else $script .= '?';

	$res = spip_query("SELECT COUNT(*) AS cnt FROM spip_signatures WHERE $where AND date_time>DATE_SUB(NOW(),INTERVAL 180 DAY)");

	$total = ($row = spip_fetch_array($res)) ? $row['cnt'] : 0;

	if ($total > $limit) {
		for ($i = 0; $i < $total; $i += $limit){
			if ($i > 0) echo " | ";
			if ($i == $debut)
				echo "<FONT SIZE=3><B>$i</B></FONT>";
			else
			  echo "<A HREF='$script","debut=$i'>$i</A>";
		}
	}
	return $where;
}

?>

--- NEW FILE: filtery.js ---
/*
  Author: Justin Whitford
  Source: www.evolt.org
*/
function filtery(pattern, list){
  /*
  if the dropdown list passed in hasn't
  already been backed up, we'll do that now
  */
  if (!list.bak){
    /*
    We're going to attach an array to the select object
    where we'll keep a backup of the original dropdown list
    */
    list.bak = new Array();
    for (n=0; n<list.length; n++){
      list.bak[list.bak.length] = new Array(list[n].value, list[n].text);
    }
    bakselected = list.selectedIndex;
  }

  /*
  We're going to iterate through the backed up dropdown
  list. If an item matches, it is added to the list of
  matches. If not, then it is added to the list of non matches.
  */
  match = new Array();
  nomatch = new Array();
  
  if (pattern.length != 0) {
	  for (n=0; n<list.bak.length; n++){
		if(list.bak[n][1].toLowerCase().indexOf(pattern.toLowerCase())!=-1 || list.bak[n][0] == pattern ){
		  match[match.length] = new Array(list.bak[n][0], list.bak[n][1]);
		}else{
		  nomatch[nomatch.length] = new Array(list.bak[n][0], list.bak[n][1]);
		}
	  }
  }

  /*
  Now we completely rewrite the dropdown list.
  First we write in the matches, then we write
  in the non matches
  */
  
  if (match.length > 0) {
	  list.options.length = match.length;
	  for (n=0; n<match.length; n++){
		list[n].value = match[n][0];
		list[n].text = match[n][1];
	  }

    list.selectedIndex=0;
  
  }
  else {
	  list.options.length = list.bak.length;
	  for (n=0; n<list.bak.length; n++){
		list[n].value =  list.bak[n][0];
		list[n].text =  list.bak[n][1];
	  }
  list.selectedIndex = bakselected;
  }

}

Index: mots_type.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_type.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- mots_type.php3	30 Jun 2005 10:09:39 -0000	1.3
+++ mots_type.php3	21 Jul 2005 21:47:15 -0000	1.4
@@ -41,6 +41,8 @@
 		$type = $row['titre'];
 		$ancien_type = $type;
 		$titre = typo($type);
+		$descriptif = $row['descriptif'];
+		$texte = $row['texte'];
 		$unseul = $row['unseul'];
 		$obligatoire = $row['obligatoire'];
 		$articles = $row['articles'];
@@ -52,9 +54,9 @@
 		//////////////////////////////
 		$carto_objets = $row['carto_objets'];
 		//////////////////////////////
-		$acces_minirezo = $row['0minirezo'];
-		$acces_comite = $row['1comite'];
-		$acces_forum = $row['6forum'];
+		$acces_minirezo = $row['minirezo'];
+		$acces_comite = $row['comite'];
+		$acces_forum = $row['forum'];
 	}
 }
 
@@ -93,6 +95,26 @@
 	debut_cadre_formulaire();
 	echo "<b>"._T('info_changer_nom_groupe')."</b><br>\n";
 	echo "<INPUT TYPE='Text' SIZE=40 CLASS='formo' NAME='change_type' VALUE=\"$type\" $onfocus>\n";
+
+	if ($options == 'avancees' OR $descriptif) {
+		echo "<B>"._T('texte_descriptif_rapide')."</B><BR>";
+		echo "<TEXTAREA NAME='descriptif' CLASS='forml' ROWS='4' COLS='40' wrap=soft>";
+		echo $descriptif;
+		echo "</TEXTAREA><P>\n";
+	}
+	else
+		echo "<INPUT TYPE='hidden' NAME='descriptif' VALUE=\"$descriptif\">";
+
+	if ($options == 'avancees' OR $texte) {
+		echo "<B>"._T('info_texte_explicatif')."</B><BR>";
+		echo "<TEXTAREA NAME='texte' ROWS='8' CLASS='forml' COLS='40' wrap=soft>";
+		echo $texte;
+		echo "</TEXTAREA><P>\n";
+	}
+	else
+		echo "<INPUT TYPE='hidden' NAME='texte' VALUE=\"$texte\">";
+
+
 	echo "<p><div align='right'><INPUT TYPE='submit' CLASS='fondo' NAME='Valider' VALUE='"._T('bouton_valider')."'></div>";
 	fin_cadre_formulaire();
 }

Index: inc_mots.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_mots.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_mots.php3	30 Jun 2005 10:09:40 -0000	1.4
+++ inc_mots.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -134,14 +134,15 @@
 		$id_objet=$id_objet['id_objet'];
 	}
 	////////////////////////////////
+	list($nombre_mots) = spip_fetch_array(spip_query("SELECT COUNT(*) FROM spip_mots AS mots, spip_mots_$table AS lien WHERE lien.$id_table=$id_objet AND mots.id_mot=lien.id_mot"));
 
-	$query = "SELECT mots.* FROM spip_mots AS mots, spip_mots_$table AS lien WHERE lien.$id_table=$id_objet AND mots.id_mot=lien.id_mot";
-	$nombre_mots = spip_num_rows(spip_query($query));
-
-	$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND $connect_statut = 'oui'";
-	$nombre_groupes = spip_num_rows(spip_query($query_groupes));
+	if (!$nombre_mots) {
+		if (!$flag_editable) return;
+		list($nombre_groupes) = spip_fetch_array(spip_query("SELECT COUNT(*) FROM spip_groupes_mots WHERE $table = 'oui'
+		AND ".substr($connect_statut,1)." = 'oui'"));
 
-	if (!$nombre_mots AND (!$nombre_groupes OR !$flag_editable)) return;
+		if (!$nombre_groupes) return;
+	}
 
 	echo "<a name='mots".$id_objet."'></a>";
 	if ($flag_editable){
@@ -314,8 +315,8 @@
 				$titre_groupe = entites_html($row_groupe['titre']);
 				$unseul = $row_groupe['unseul'];
 				$obligatoire = $row_groupe['obligatoire'];
-				$acces_admin =  $row_groupe['0minirezo'];
-				$acces_redacteur = $row_groupe['1comite'];
+				$acces_admin =  $row_groupe['minirezo'];
+				$acces_redacteur = $row_groupe['comite'];
 	
 				$flag_groupe = ($flag_editable AND (($connect_statut == '1comite' AND $acces_redacteur == 'oui') OR ($connect_statut == '0minirezo' AND $acces_admin == 'oui')));
 			}
@@ -397,7 +398,7 @@
 	if ($id_groupes_vus) $id_groupes_vus = join($id_groupes_vus, ",");
 	else $id_groupes_vus = "0";
 
-	$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND $connect_statut = 'oui' AND obligatoire = 'oui' AND id_groupe NOT IN ($id_groupes_vus)";
+	$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND ".substr($connect_statut,1)." = 'oui' AND obligatoire = 'oui' AND id_groupe NOT IN ($id_groupes_vus)";
 	$nb_groupes = spip_num_rows(spip_query($query_groupes));
 
 	//
@@ -434,7 +435,7 @@
 
 		echo "<table border='0' width='100%' style='text-align: $spip_lang_right'>";
 
-		$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND $connect_statut = 'oui' AND (unseul != 'oui'  OR (unseul = 'oui' AND id_groupe NOT IN ($id_groupes_vus))) ORDER BY titre";
+		$query_groupes = "SELECT * FROM spip_groupes_mots WHERE $table = 'oui' AND ".substr($connect_statut,1)." = 'oui' AND (unseul != 'oui'  OR (unseul = 'oui' AND id_groupe NOT IN ($id_groupes_vus))) ORDER BY titre";
 		$result_groupes = spip_query($query_groupes);
 
 		// Afficher un menu par groupe de mots
@@ -449,9 +450,9 @@
 			$breves = $row_groupes['breves'];
 			$rubriques = $row_groupes['rubriques'];
 			$syndic = $row_groupes['syndic'];
-			$acces_minirezo = $row_groupes['0minirezo'];
-			$acces_comite = $row_groupes['1comite'];
-			$acces_forum = $row_groupes['6forum'];
+			$acces_minirezo = $row_groupes['minirezo'];
+			$acces_comite = $row_groupes['comite'];
+			$acces_forum = $row_groupes['forum'];
 			
 			$query = "SELECT * FROM spip_mots WHERE id_groupe = '$id_groupe' ";
 			if ($les_mots) $query .= "AND id_mot NOT IN ($les_mots) ";

Index: inc_serialbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_serialbase.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc_serialbase.php3	30 Jun 2005 10:09:40 -0000	1.3
+++ inc_serialbase.php3	21 Jul 2005 21:47:15 -0000	1.4
@@ -154,15 +154,17 @@
 $spip_groupes_mots = array(
 		"id_groupe"	=> "bigint(21) NOT NULL",
 		"titre"	=> "text NOT NULL",
+		"descriptif"	=> "text NOT NULL",
+		"texte"	=> "longblob NOT NULL",
 		"unseul"	=> "varchar(3) NOT NULL",
 		"obligatoire"	=> "varchar(3) NOT NULL",
 		"articles"	=> "varchar(3) NOT NULL",
 		"breves"	=> "varchar(3) NOT NULL",
 		"rubriques"	=> "varchar(3) NOT NULL",
 		"syndic"	=> "varchar(3) NOT NULL",
-		"0minirezo"	=> "varchar(3) NOT NULL",
-		"1comite"	=> "varchar(3) NOT NULL",
-		"6forum"	=> "varchar(3) NOT NULL",
+		"minirezo"	=> "varchar(3) NOT NULL",
+		"comite"	=> "varchar(3) NOT NULL",
+		"forum"	=> "varchar(3) NOT NULL",
 		"maj"	=> "TIMESTAMP");
 
 $spip_groupes_mots_key = array(
@@ -250,7 +252,10 @@
 		"date_syndic"	=> "datetime DEFAULT '0000-00-00 00:00:00' NOT NULL",
 		"date_index"	=> "datetime DEFAULT '0000-00-00 00:00:00' NOT NULL",
 		"extra"			=> "longblob NULL",
-		"moderation"	=> "VARCHAR(3) NOT NULL");
+		"moderation"	=> "VARCHAR(3) DEFAULT 'non'",
+		"miroir"	=> "VARCHAR(3) DEFAULT 'non'",
+		"oubli"	=> "VARCHAR(3) DEFAULT 'non'"
+);
 
 $spip_syndic_key = array(
 		"PRIMARY KEY"	=> "id_syndic",

Index: inc_debug_sql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_debug_sql.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_debug_sql.php3	5 Jul 2005 00:44:00 -0000	1.5
+++ inc_debug_sql.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -67,25 +67,23 @@
 // Si une boucle cree des soucis, on peut afficher la requete fautive
 // avec son code d'erreur
 //
-function erreur_requete_boucle($query, $id_boucle, $type) {
+function erreur_requete_boucle($query, $id_boucle, $type, $erreur, $errno) {
 
 	$GLOBALS['bouton_admin_debug'] = true;
 
-	$erreur = spip_sql_error();
-	$errno = spip_sql_errno();
 	if (eregi('err(no|code):?[[:space:]]*([0-9]+)', $erreur, $regs))
-		$errsys = $regs[2];
+		$errno = $regs[2];
 	else if (($errno == 1030 OR $errno <= 1026)
-	AND ereg('[^[:alnum:]]([0-9]+)[^[:alnum:]]', $erreur, $regs))
-		$errsys = $regs[1];
+		AND ereg('[^[:alnum:]]([0-9]+)[^[:alnum:]]', $erreur, $regs))
+	$errno = $regs[1];
 
 	// Erreur systeme
-	if ($errsys > 0 AND $errsys < 200) {
+	if ($errno > 0 AND $errno < 200) {
 		$retour .= "<tt><br /><br /><blink>"
-		. _T('info_erreur_systeme', array('errsys'=>$errsys))
+		. _T('info_erreur_systeme', array('errsys'=>$errno))
 		. "</blink><br />\n"
 		. _T('info_erreur_systeme2');
-		spip_log("Erreur systeme $errsys");
+		spip_log("Erreur systeme $errno");
 	}
 	// Requete erronee
 	else {
@@ -101,7 +99,7 @@
 		include_ecrire('inc_lang.php3');
 		utiliser_langue_visiteur();
 		$retour .= aide('erreur_mysql');
-		spip_log("Erreur MySQL BOUCLE$id_boucle (".$GLOBALS['fond'].".html)");
+		spip_log("Erreur requete $id_boucle (".$GLOBALS['fond'].".html)");
 	}
 
 	erreur_squelette($retour);
@@ -326,7 +324,7 @@
 	@header('Content-Type: text/html; charset='.lire_meta('charset'));
 	echo debut_entete('Spip ' . $GLOBALS['spip_version_affichee'] . ' ' .
 			  _T('admin_debug') . ' ' .
-			  _T('info_mon_site_spip')), 
+			  supprimer_tags(extraire_multi(lire_meta('nom_site')))), 
 	  "<link rel='stylesheet' href='spip_admin.css' type='text/css'>",
 	  "</head>\n<body style='margin:0 10px;'>",
 	  "\n<div id='spip-debug' style='position: absolute; top: 22px; z-index: 1000;height:97%;left:10px;right:10px;'><div id='spip-boucles'>\n"; 

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_documents.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ inc_documents.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -320,13 +320,13 @@
 	}
 
 	if ($align != 'center') {
-		$float = "float: $align;";
-		if ($type_aff == 'IMG') {
-			$width = extraire_attribut($vignette, 'width');
-			if ($width < 120) $width = 120;
-			$width = ' width: '.$width.'px;';
-		}
-		$style = " style='$float$width'";
+		// Largeur de la div = celle de l'image ; mais s'il y a une legende
+		// mettre au moins 120px
+		$width = extraire_attribut($vignette, 'width');
+		if (strlen($txt) AND $width < 120) $width = 120;
+		$width = 'width: '.$width.'px;';
+
+		$style = " style='float: $align; $width'";
 	}
 
 	return

Index: forum_envoi.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/forum_envoi.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- forum_envoi.php3	30 Jun 2005 10:09:40 -0000	1.4
+++ forum_envoi.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -136,10 +136,16 @@
 	echo "<div>&nbsp;</div>";
 
 
-debut_cadre_formulaire();
+debut_cadre_formulaire(($statut == 'privac') ? "" : 'background-color: #dddddd;');
 
 echo "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 BACKGROUND='' WIDTH=\"100%\"><TR><TD>";
-	icone(_T('icone_retour'), $adresse_retour, "forum-interne-24.gif");
+$forum_stat = $statut;
+if ($forum_stat == "prive") $logo = "forum-interne-24.gif";
+ else if ($forum_stat == "privadm") $logo = "forum-admin-24.gif";
+ else if ($forum_stat == "privrac") $logo = "forum-interne-24.gif";
+ else $logo = "forum-public-24.gif";
+
+icone(_T('icone_retour'), $adresse_retour, $logo);
 echo "</TD>";
 
 echo "<TD><IMG SRC='" . _DIR_IMG_PACK . "rien.gif' WIDTH=10 BORDER=0></td><TD WIDTH=\"100%\">";

Index: auteur_infos.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/auteur_infos.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- auteur_infos.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ auteur_infos.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -193,7 +193,7 @@
 }
 
 // Appliquer des modifications de statut
-modifier_statut_auteur($auteur);
+modifier_statut_auteur($auteur, $_POST['statut'], $_POST['add_rub'], $_GET['supp_rub']);
 
 
 // Si on modifie la fiche auteur, reindexer et modifier htpasswd

Index: inc_acces.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_acces.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_acces.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ inc_acces.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -198,24 +198,24 @@
 	}
 }
 
-function modifier_statut_auteur (&$auteur) {
-	global $connect_statut, $connect_toutes_rubriques, $_GET, $_POST;
+function modifier_statut_auteur (&$auteur, $statut, $add_rub='', $supp_rub='') {
+	global $connect_statut, $connect_toutes_rubriques;
 	// changer le statut ?
-	if ($connect_statut == '0minirezo' AND $_POST['statut']) {
-		if (ereg("^(0minirezo|1comite|5poubelle|6forum)$",$_POST['statut'])) {
-			$auteur['statut'] = $_POST['statut'];
-			spip_query("UPDATE spip_auteurs SET statut='".$_POST['statut']."'
+	if ($connect_statut == '0minirezo' AND $statut) {
+		if (ereg("^(0minirezo|1comite|5poubelle|6forum)$",$statut)) {
+			$auteur['statut'] = $statut;
+			spip_query("UPDATE spip_auteurs SET statut='".$statut."'
 			WHERE id_auteur=".$auteur['id_auteur']);
 		}
 	}
 	// modif auteur restreint, seulement pour les admins
 	if ($connect_toutes_rubriques) {
-		if ($add_rub=intval($_POST['add_rub']))
+		if ($add_rub=intval($add_rub))
 			spip_query("INSERT INTO spip_auteurs_rubriques
 			(id_auteur,id_rubrique)
 			VALUES(".$auteur['id_auteur'].", $add_rub)");
 
-		if ($supp_rub=intval($_GET['supp_rub']))
+		if ($supp_rub=intval($supp_rub))
 			spip_query("DELETE FROM spip_auteurs_rubriques
 			WHERE id_auteur=".$auteur['id_auteur']."
 			AND id_rubrique=$supp_rub");

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- mes_options.php3	4 Jul 2005 09:15:33 -0000	1.4
+++ mes_options.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -214,7 +214,25 @@
 	include_ecrire('plugins/plug_carto.php');
     return avant_typo_carto($texte);
 }
+$champs_extra = true;
+
+$GLOBALS['champs_extra'] = Array (
+'auteurs' => Array (
+				"abo" => "radio|brut|Abonnement &agrave; lettre d'information|Format Html,Format texte,Ne pas recevoir de courrier|html,texte,non",
+"choix" => "multiple|brut|choix|choix1,choix2,choix3"
+      )
+);
+function get_extra_value($ar,$num)
+{
+	if (!is_array($ar)) return $ar;
+	else return $ar[$num];
+}
 
+function extra_afficher_fiche($extra, $type){
+	include_ecrire("inc_extra.php3");
+	include_ecrire("inc_presentation.php3");
+	extra_affichage($extra, $type);
+}
 //======================================================================
 // Integration contrib mots partout (Mortimer)
 //======================================================================
@@ -233,7 +251,6 @@
 																					'nom_id' =>  'id_carto_carte'),
 															   )
 									  );
-
 function afficher_liste_carto_objets($choses) {
   echo "<div style='height: 12px;'></div>";
   echo "<div class='liste'>";
@@ -312,5 +329,4 @@
 }
 
 //======================================================================
-
 ?>

Index: mots_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_edit.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- mots_edit.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ mots_edit.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -247,7 +247,7 @@
 		if (!$row_groupes) {
 			// il faut creer un groupe de mots (cas d'un mot cree depuis articles.php3)
 		  $row_groupes['id_groupe'] = spip_abstract_insert("spip_groupes_mots",
-							  "(titre, unseul, obligatoire, articles, breves, rubriques, syndic, 0minirezo, 1comite, 6forum)",
+							  "(titre, unseul, obligatoire, articles, breves, rubriques, syndic, minirezo, comite, forum)",
 							  "('" .
 							  addslashes(_T('info_mot_sans_groupe'))."', 'non',  'non', 'oui', 'oui', 'non', 'oui', 'oui', 'non', 'non'");
 

Index: controle_petition.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/controle_petition.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- controle_petition.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ controle_petition.php3	21 Jul 2005 21:47:15 -0000	1.3
@@ -12,13 +12,17 @@
 
 
 include ("inc.php3");
+include ("inc_signatures.php3");
 
+function message_de_signature($row)
+{
+  return propre(echapper_tags($row['message']));
+}
 
 
 debut_page(_T('titre_page_controle_petition'), "redacteurs", "suivi-petition");
 debut_gauche();
 
-
 //
 // Raccourcis
 //
@@ -30,69 +34,6 @@
 
 debut_droite();
 
-
-function controle_forum($request,$adresse_retour) {
-	global $debut;
-	global $couleur_foncee;
-	
-	$nb_forum[$compteur_forum] = spip_num_rows($request);
-	$i[$compteur_forum] = 1;
- 	while($row=spip_fetch_array($request)){
-		$id_signature = $row['id_signature'];
-		$id_article = $row['id_article'];
-		$date_time = $row['date_time'];
-		$nom_email= typo(echapper_tags($row['nom_email']));
-		$ad_email = echapper_tags($row['ad_email']);
-		$nom_site = typo(echapper_tags($row['nom_site']));
-		$url_site = echapper_tags($row['url_site']);
-		$message = propre(echapper_tags($row['message']));
-		$statut = $row['statut'];
-		
-		echo "<P>";
-		
-		if ($statut=="poubelle"){
-			echo "<TABLE WIDTH=100% CELLPADDING=2 CELLSPACING=0 BORDER=0><TR><TD BGCOLOR='#FF0000'>";
-		}
-		
-		echo "<TABLE WIDTH=100% CELLPADDING=3 CELLSPACING=0><TR><TD BGCOLOR='$couleur_foncee' class='verdana2' style='color: white;'><B>$nom_site / $nom_email</B></TD></TR>";
-		echo "<TR><TD BGCOLOR='#FFFFFF' class='serif'>";
-				
-		if ($statut=="publie"){
-			icone (_T('icone_supprimer_signature'), "controle_petition.php3?supp_petition=$id_signature&debut=$debut", "forum-interne-24.gif", "supprimer.gif", "right");
-		}
-		if ($statut=="poubelle"){
-			icone (_T('icone_valider_signature'), "controle_petition.php3?add_petition=$id_signature&debut=$debut", "forum-interne-24.gif", "creer.gif", "right");
-		}
-		
-		
-		echo "<FONT SIZE=2>".date_relative($date_time)."</FONT><BR>";
-		if ($statut=="poubelle"){
-			echo "<FONT SIZE=1 COLOR='red'>"._T('info_message_efface')."</FONT><BR>";
-		}
-		if (strlen($url_site)>6 AND strlen($nom_site)>0){
-			echo "<FONT SIZE=1>"._T('info_site_web')."</FONT> <A HREF='$url_site'>$nom_site</A><BR>";
-		}
-		if (strlen($ad_email)>0){
-			echo "<FONT SIZE=1>"._T('info_adresse_email')."</FONT> <A HREF='mailto:$ad_email'>$ad_email</A><BR>";
-		}
-		if (strlen($message)>0) echo "<P>$message";
-		
-		$query_article="SELECT * FROM spip_articles WHERE id_article=$id_article";
-		$result_article=spip_query($query_article);
-		while($row=spip_fetch_array($result_article)){
-			$id_article = $row['id_article'];
-			$titre = typo($row["titre"]);
-		}
-		echo "<P align='right'><A HREF='../spip_redirect.php3?id_article=$id_article'>$titre</A>";
-	
-		echo "</TD></TR></TABLE>";
-		
-		if ($statut=="poubelle"){
-			echo "</TD></TR></TABLE>";
-		}
-	}
-}
-
   
 echo "<div class='serif2'>";
  
@@ -119,36 +60,15 @@
 
 	if (!$debut) $debut = 0;
 
-	if ($id_article) {
-		$signature_article = " AND id_article=$id_article";
-		$url_article = "&id_article=$id_article";
-	}
-	else
-		$signature_article = '';
-
-	$query_forum = "SELECT COUNT(*) AS cnt FROM spip_signatures WHERE (statut='publie' OR statut='poubelle') AND date_time>DATE_SUB(NOW(),INTERVAL 180 DAY)$signature_article";
-	$result_forum = spip_query($query_forum);
-	$total = 0;
-	if ($row = spip_fetch_array($result_forum)) $total = $row['cnt'];
-
-	if ($total > 10) {
-		echo "<p>";
-		for ($i = 0; $i < $total; $i = $i + 10){
-			if ($i > 0) echo " | ";
-			if ($i == $debut)
-				echo "<FONT SIZE=3><B>$i</B></FONT>";
-			else
-				echo "<A HREF='controle_petition.php3?debut=$i$url_article'>$i</A>";
-		}
-	}
+	spip_query("DELETE FROM spip_signatures WHERE NOT (statut='publie' OR statut='poubelle') AND date_time<DATE_SUB(NOW(),INTERVAL 10 DAY)");
 
-	$query_forum = "DELETE FROM spip_signatures WHERE NOT (statut='publie' OR statut='poubelle') AND date_time<DATE_SUB(NOW(),INTERVAL 10 DAY)";
-	$result_forum = spip_query($query_forum);
+	controle_signatures('controle_petition.php3',
+			    $id_article,
+			    $debut, 
+			    "(statut='publie' OR statut='poubelle')",
+			    "date_time DESC");
 
-	$query_forum = "SELECT * FROM spip_signatures WHERE (statut='publie' OR statut='poubelle')$signature_article ORDER BY date_time DESC LIMIT $debut,10";
-	$result_forum = spip_query($query_forum);
-	controle_forum($result_forum, "forum.php3");
-}
+ }
 else {
 	echo "<B>"._T('avis_non_acces_page')."</B>";
 }

Index: inc_filtres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_filtres.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_filtres.php3	30 Jun 2005 10:09:39 -0000	1.6
+++ inc_filtres.php3	21 Jul 2005 21:47:15 -0000	1.7
@@ -98,8 +98,10 @@
 	$texte = filtrer_entites($texte);
 
 	// " -> &quot; et tout ce genre de choses
+	// contourner bug windows ou char(160) fait partie de la regexp \s
+	$u = (lire_meta('charset')=='utf-8') ? 'u':'';
 	$texte = str_replace("&nbsp;", " ", $texte);
-	$texte = preg_replace("/[[:space:]][[:space:]]+/", " ", $texte);
+	$texte = preg_replace("/\s\s+/$u", " ", $texte);
 	$texte = entites_html($texte);
 
 	// verifier le charset
@@ -140,7 +142,8 @@
 
 // Convertit un texte HTML en texte brut
 function textebrut($texte) {
-	$texte = preg_replace("/[[:space:]]+/", " ", $texte);
+	$u = (lire_meta('charset')=='utf-8') ? 'u':'';
+	$texte = preg_replace("/\s+/$u", " ", $texte);
 	$texte = preg_replace("/<(p|br)( [^>]*)?".">/i", "\n\n", $texte);
 	$texte = preg_replace("/^\n+/", "", $texte);
 	$texte = preg_replace("/\n+$/", "", $texte);
@@ -968,7 +971,7 @@
 // recuperer un attribut html d'une balise
 // ($complet demande de retourner $r)
 function extraire_attribut($balise, $attribut, $complet = false) {
-	if (preg_match(",(.*<[^>]*)([[:space:]]+$attribut=[[:space:]]*(['\"])?(.*?)\\3)([[:space:]/>].*>.*),ims", $balise, $r)) {
+	if (preg_match(",(.*<[^>]*)([[:space:]]+$attribut=[[:space:]]*(['\"])?(.*?)\\3)([^>]*>.*),ims", $balise, $r)) {
 		$att = $r[4];
 	}
 	else

Index: inc_forum.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_forum.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc_forum.php3	30 Jun 2005 10:09:40 -0000	1.6
+++ inc_forum.php3	21 Jul 2005 21:47:15 -0000	1.7
@@ -300,4 +300,71 @@
 	}
 }
 
+
+// Recuperer le reglage des forums publics de l'article x
+function get_forums_publics($id_article=0) {
+	$forums_publics = lire_meta("forums_publics");
+	if ($id_article) {
+		$query = "SELECT accepter_forum FROM spip_articles WHERE id_article=$id_article";
+		$res = spip_query($query);
+		if ($obj = spip_fetch_array($res))
+			$forums_publics = $obj['accepter_forum'];
+	} else { // dans ce contexte, inutile
+		$forums_publics = substr(lire_meta("forums_publics"),0,3);
+	}
+	return $forums_publics;
+}
+
+// Modifier le reglage des forums publics de l'article x
+function modifier_forums_publics($id_article, $forums_publics) {
+		spip_query ("UPDATE spip_articles
+			SET accepter_forum='$forums_publics'
+			WHERE id_article=".intval($id_article));
+		if ($forums_publics == 'abo') {
+			ecrire_meta('accepter_visiteurs', 'oui');
+			ecrire_metas();
+		}
+		include_ecrire('inc_invalideur.php3');
+		suivre_invalideur("id='id_forum/a$id_article'");
+
+}
+
+// Cree le formulaire de modification du reglage des forums de l'article
+function formulaire_modification_forums_publics($id_article, $forums_publics) {
+	global $spip_lang_right;
+
+	$r = "\n<form action='". $GLOBALS['clean_link']->getUrl()
+		."' method='POST'>";
+
+	$r .= "\n<input type='hidden' name='id_article' value='$id_article'>";
+	$r .= "<br>"._T('info_fonctionnement_forum')."\n";
+	$r .= "<select name='change_accepter_forum'
+		class='fondl' style='font-size:10px;'
+		onChange=\"setvisibility('valider_forum', 'visible');\"
+		>\n";
+
+	foreach (array(
+		'pos'=>_T('bouton_radio_modere_posteriori'),
+		'pri'=>_T('bouton_radio_modere_priori'),
+		'abo'=>_T('bouton_radio_modere_abonnement'),
+		'non'=>_T('info_pas_de_forum'))
+		as $val => $desc) {
+		$r .= "<option";
+		if ($forums_publics == $val)
+			$r .= " selected";
+		$r .= " value='$val'>".$desc."</option>\n";
+	}
+	$r .= "</select>\n";
+
+	$r .= "<div align='$spip_lang_right'
+	class='visible_au_chargement' id='valider_forum'>
+	<input type='submit' name='Changer' class='fondo'
+	value='"._T('bouton_changer')."' STYLE='font-size:10px'>
+	</div>\n";
+
+	$r .= "</form>";
+
+	return $r;
+}
+
 ?>

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- inc_version.php3	30 Jun 2005 10:09:39 -0000	1.8
+++ inc_version.php3	21 Jul 2005 21:47:15 -0000	1.9
@@ -317,7 +317,7 @@
 error_reporting(E_ALL ^ E_NOTICE);
 
 // Variables du compilateur de squelettes
-$tables_des_serveurs_sql = array();
+
 $exceptions_des_tables = array();
 $tables_principales = array();
 $table_des_tables = array();
@@ -325,6 +325,8 @@
 $tables_relations_keys = array();
 $table_primary = array();
 $table_date = array();
+$tables_des_serveurs_sql['localhost'] =  &$tables_principales;
+
 /* ATTENTION CETTE VARIABLE NE FONCTIONNE PAS ENCORE */
 // Extension du fichier du squelette 
 $extension_squelette = 'html';
@@ -410,10 +412,10 @@
 // (utilise pour les modifs de la base de donnees)
 
 // version de la base
-$spip_version = 1.816;
+$spip_version = 1.819;
 
 // version de spip
-$spip_version_affichee = "1.8.2 CVS beta 1";
+$spip_version_affichee = "1.8.2 CVS beta 2";
 
 // version de spip / tag cvs
 if (ereg('Name: v(.*) ','$Name$', $regs)) $spip_version_affichee = $regs[1];

Index: articles.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/articles.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- articles.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ articles.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -16,6 +16,7 @@
 include_ecrire ("inc_mots.php3");
 include_ecrire ("inc_date.php3");
 include_ecrire ("inc_documents.php3");
+include_ecrire ("inc_forum.php3");
 include_ecrire ("inc_abstract_sql.php3");
 
 $articles_surtitre = lire_meta("articles_surtitre");
@@ -298,24 +299,6 @@
 
 
 
-//
-// Suivi forums publics
-//
-
-// fonction dupliquee dans inc-forum.php3
-function get_forums_publics($id_article=0) {
-	$forums_publics = lire_meta("forums_publics");
-	if ($id_article) {
-		$query = "SELECT accepter_forum FROM spip_articles WHERE id_article=$id_article";
-		$res = spip_query($query);
-		if ($obj = spip_fetch_array($res))
-			$forums_publics = $obj['accepter_forum'];
-	} else { // dans ce contexte, inutile
-		$forums_publics = substr(lire_meta("forums_publics"),0,3);
-	}
-	return $forums_publics;
-}
-
 
 //
 // Lire l'article
@@ -398,17 +381,6 @@
 
 voir_en_ligne ('article', $id_article, $statut_article);
 
-if ($connect_statut=='0minirezo' AND acces_rubrique($id_rubrique)) {
-	$query = "SELECT count(*) AS count FROM spip_forum WHERE id_article=$id_article AND statut IN ('publie', 'off', 'prop')";
-	if ($row = spip_fetch_array(spip_query($query))) {
-		$nb_forums = $row['count'];
-		if ($nb_forums) {
-			icone_horizontale(_T('icone_suivi_forum', array('nb_forums' => $nb_forums)),
-				"articles_forum.php3?id_article=$id_article", "suivi-forum-24.gif", "");
-		}
-	}
-}
-
 
 $activer_statistiques = lire_meta("activer_statistiques");
 
@@ -445,15 +417,28 @@
 if ($options == "avancees" && $connect_statut=='0minirezo' && $flag_editable) {
 	echo "<p>";
 	debut_cadre_relief("forum-interne-24.gif");
-	$visible = $change_accepter_forum || $change_petition;
 
 
+	list($nb_forums) = spip_fetch_array(spip_query(
+		"SELECT count(*) AS count FROM spip_forum
+		WHERE id_article=$id_article
+		AND statut IN ('publie', 'off', 'prop')"));
+
+	list($nb_signatures) = spip_fetch_array(spip_query(
+		"SELECT COUNT(*) AS count FROM spip_signatures
+		WHERE id_article=$id_article
+		AND statut IN ('publie', 'poubelle')"));
+
+
+	$visible = $change_accepter_forum || $change_petition
+		|| $nb_forums || $nb_signatures;
+
 	echo "<div class='verdana1' style='text-align: center;'><b>";
 	if ($visible)
 		echo bouton_block_visible("forumpetition");
 	else
 		echo bouton_block_invisible("forumpetition");
-	echo _T('bouton_forum_petition');
+	echo _T('bouton_forum_petition') .aide('confforums');
 	echo "</b></div>";
 	if ($visible)
 		echo debut_block_visible("forumpetition");
@@ -463,64 +448,29 @@
 
 	echo "<font face='Verdana,Arial,Sans,sans-serif' size='1'>\n";
 
-	// Forums et petitions
 
+	// Forums
+
+	if ($nb_forums) {
+		echo "<br />\n";
+		icone_horizontale(_T('icone_suivi_forum', array('nb_forums' => $nb_forums)),
+		"articles_forum.php3?id_article=$id_article", "suivi-forum-24.gif", "");
+	}
+
+	// Reglage existant
 	$forums_publics = get_forums_publics($id_article);
 
+	// Modification du reglage ?
 	if (isset($change_accepter_forum)
 	AND $change_accepter_forum <> $forums_publics) {
-		$query_forum = "UPDATE spip_articles
-			SET accepter_forum='$change_accepter_forum'
-			WHERE id_article='$id_article'";
-		$result_forum = spip_query($query_forum);
 		$forums_publics = $change_accepter_forum;
-		if ($change_accepter_forum == 'abo') {
-			ecrire_meta('accepter_visiteurs', 'oui');
-			ecrire_metas();
-		}
-		include_ecrire('inc_invalideur.php3');
-		suivre_invalideur("id='id_forum/a$id_article'");
-	}
-
-	echo "\n<form action='articles.php3' method='get'>";
-
-	echo "\n<input type='hidden' name='id_article' value='$id_article'>";
-	echo "<br>"._T('info_fonctionnement_forum')."\n";
-	if ($forums_publics == "pos") {
-		echo "<br><input type='radio' name='change_accepter_forum' value='pos' id='accepterforumpos' checked>";
-		echo "<B><label for='accepterforumpos'> "._T('bouton_radio_modere_posteriori')."</label></B>";
-	} else {
-		echo "<br><input type='radio' name='change_accepter_forum' value='pos' id='accepterforumpos'>";
-		echo "<label for='accepterforumpos'> "._T('bouton_radio_modere_posteriori')."</label>";
-	}
-	if ($forums_publics == "pri") {
-		echo "<br><input type='radio' name='change_accepter_forum' value='pri' id='accepterforumpri' checked>";
-		echo "<B><label for='accepterforumpri'> "._T('bouton_radio_modere_priori')."</label></B>";
-	} else {
-		echo "<br><input type='radio' name='change_accepter_forum' value='pri' id='accepterforumpri'>";
-		echo "<label for='accepterforumpri'> "._T('bouton_radio_modere_priori')."</label>";
-	}
-	if ($forums_publics == "abo") {
-		echo "<br><input type='radio' name='change_accepter_forum' value='abo' id='accepterforumabo' checked>";
-		echo "<B><label for='accepterforumabo'> "._T('bouton_radio_modere_abonnement')."</label></B>";
-	} else {
-		echo "<br><input type='radio' name='change_accepter_forum' value='abo' id='accepterforumabo'>";
-		echo "<label for='accepterforumabo'> "._T('bouton_radio_modere_abonnement')."</label>";
-	}
-	if ($forums_publics == "non") {
-		echo "<br><input type='radio' name='change_accepter_forum' value='non' id='accepterforumnon' checked>";
-		echo "<B><label for='accepterforumnon'> "._T('info_pas_de_forum')."</label></B>";
-	} else {
-		echo "<br><input type='radio' name='change_accepter_forum' value='non' id='accepterforumnon'>";
-		echo "<label for='accepterforumnon'> "._T('info_pas_de_forum')."</label>";
+		modifier_forums_publics($id_article, $forums_publics);
 	}
 
-	echo "<div align='$spip_lang_right'><input type='submit' name='Changer' class='fondo' value='"._T('bouton_changer')."' STYLE='font-size:10px'></div>\n";
-	echo "</form>";
+	// Afficher le formulaire de modification du reglage
+	echo formulaire_modification_forums_publics($id_article, $forums_publics);
 
-	echo "<br>";
 
-	
 	// Petitions
 
 	if ($change_petition) {
@@ -542,32 +492,56 @@
 		}
 	}
 
-	$query_petition = "SELECT * FROM spip_petitions WHERE id_article=$id_article";
-	$result_petition = spip_query($query_petition);
-	$petition = (spip_num_rows($result_petition) > 0);
+	$petition = spip_fetch_array(spip_query(
+		"SELECT * FROM spip_petitions WHERE id_article=$id_article"));
 
-	while ($row = spip_fetch_array($result_petition)) {
-		$id_rubrique=$row["id_article"];
-		$email_unique=$row["email_unique"];
-		$site_obli=$row["site_obli"];
-		$site_unique=$row["site_unique"];
-		$message=$row["message"];
-		$texte_petition=$row["texte"];
+	$email_unique=$petition["email_unique"];
+	$site_obli=$petition["site_obli"];
+	$site_unique=$petition["site_unique"];
+	$message=$petition["message"];
+	$texte_petition=$petition["texte"];
+
+	echo "\n<form action='".$GLOBALS['clean_link']->getUrl()
+		."' method='POST'>";
+	echo "\n<input type='hidden' name='id_article' value='$id_article'>";
+
+	echo "<select name='change_petition'
+		class='fondl' style='font-size:10px;'
+		onChange=\"setvisibility('valider_petition', 'visible');\"
+		>\n";
+
+	if ($petition) {
+		$menu = array(
+			'on' => _T('bouton_radio_petition_activee'),
+			'off'=> _T('bouton_radio_supprimer_petition')
+		);
+		$val_menu = 'on';
+	} else {
+		$menu = array(
+			'off'=> _T('bouton_radio_pas_petition'),
+			'on' => _T('bouton_radio_activer_petition')
+		);
+		$val_menu = 'off';
 	}
 
-	echo "\n<FORM ACTION='articles.php3' METHOD='post'>";
-	echo "\n<INPUT TYPE='hidden' NAME='id_article' VALUE='$id_article'>";
 
-	if ($petition){
-		echo "<input type='radio' name='change_petition' value='on' id='petitionon' checked>";
-		echo "<B><label for='petitionon'>"._T('bouton_radio_petition_activee')."</label></B>";
-		$query_signatures = "SELECT COUNT(*) AS nb FROM spip_signatures WHERE id_article=$id_article";
-		$result = spip_fetch_array(spip_query($query_signatures));
-		if ($result['nb'] > 0) {
-			echo "<p><font size=1><a href='controle_petition.php3?id_article=$id_article'>".$result['nb']." "._T('info_signatures')."</a></font>\n";
+	foreach ($menu as $val => $desc) {
+		echo "<option";
+		if ($val_menu == $val)
+			echo " selected";
+		echo " value='$val'>".$desc."</option>\n";
+	}
+	echo "</select>\n";
+
+	if ($petition) {
+		if ($nb_signatures) {
+			echo "<br />\n";
+			icone_horizontale($nb_signatures.'&nbsp;'. _T('info_signatures'),
+			"controle_petition.php3?id_article=$id_article", "suivi-petition-24.gif", "");
 		}
 
-		echo "<p>";
+		echo "<br />\n";
+
 		if ($email_unique=="oui")
 			echo "<input type='checkbox' name='email_unique' value='oui' id='emailunique' checked>";
 		else
@@ -594,20 +568,12 @@
 		echo $texte_petition;
 		echo "</TEXTAREA><P>\n";
 
-	}
-	else {
-		echo "<input type='radio' name='change_petition' value='on' id='petitionon'>";
-		echo "<label for='petitionon'>"._T('bouton_radio_activer_petition')."</label>";
-	}
-	if (!$petition){
-		echo "<br><input type='radio' name='change_petition' value='off' id='petitionoff' checked>";
-		echo "<B><label for='petitionoff'>"._T('bouton_radio_pas_petition')."</label></B>";
-	}else{
-		echo "<br><input type='radio' name='change_petition' value='off' id='petitionoff'>";
-		echo "<label for='petitionoff'>"._T('bouton_radio_supprimer_petition')."</label>";
+		echo "<P align='$spip_lang_right'>";
 	}
 
-	echo "<P align='$spip_lang_right'><INPUT TYPE='submit' NAME='Changer' CLASS='fondo' VALUE='"._T('bouton_changer')."' STYLE='font-size:10px'>";
+	if (!$petition) echo "<span class='visible_au_chargement' id='valider_petition'>";
+	echo "<INPUT TYPE='submit' NAME='Changer' CLASS='fondo' VALUE='"._T('bouton_changer')."' STYLE='font-size:10px'>";
+	if (!$petition)  echo "</span>";
 	echo "</FORM>";
 
 	echo "</font>";

Index: auteurs_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/auteurs_edit.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- auteurs_edit.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ auteurs_edit.php3	21 Jul 2005 21:47:15 -0000	1.6
@@ -77,8 +77,7 @@
 
 
 // Appliquer des modifications de statut
-modifier_statut_auteur($row);
-
+modifier_statut_auteur($row, $_POST['statut'], $_POST['add_rub'], $_GET['supp_rub']);
 
 if ($connect_id_auteur == $id_auteur) debut_page($nom, "auteurs", "perso");
 else debut_page($nom,"auteurs","redacteurs");

Index: rubriques_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/rubriques_edit.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- rubriques_edit.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ rubriques_edit.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -167,8 +167,13 @@
 
 
 debut_cadre_couleur("$logo_parent", false, '', _T('entree_interieur_rubrique').aide ("rubrub"));
-//echo "<B>"._T('entree_interieur_rubrique')."</B> ".aide ("rubrub")."<BR>\n";
-echo "<SELECT NAME='id_parent' style='background-color:#ffffff; font-size:90%; font-face:verdana,arial,helvetica,sans-serif; max-height: 24px;' class='forml' SIZE='1'>\n";
+
+// Integrer la recherche de rubrique au clavier
+echo "<script language='JavaScript' type='text/javascript' src='filtery.js'></script>\n";
+echo "<input type='text' size='10' style='font-size: 90%; width: 15%;' onkeyup=\"filtery(this.value,this.form.id_parent);\" onChange=\"filtery(this.value,this.form.id_parent);\"> ";
+
+echo "<SELECT NAME='id_parent' style='font-size: 90%; width:80%; font-face:verdana,arial,helvetica,sans-serif; max-height: 24px;' SIZE=1>\n";
+
 if ($connect_toutes_rubriques) {
   echo "<OPTION".mySel("0",$id_parent). http_style_background('racine-site-12.gif',  "$spip_lang_left no-repeat; background-color:$couleur_foncee; padding-$spip_lang_left: 16px; font-weight:bold; color:white") .'>'._T('info_racine_site')."\n";
 } else {

Index: js_menu_rubriques.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/js_menu_rubriques.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- js_menu_rubriques.php	30 Jun 2005 10:09:40 -0000	1.3
+++ js_menu_rubriques.php	21 Jul 2005 21:47:15 -0000	1.4
@@ -29,7 +29,8 @@
 function gen_liste_rubriques() {
 	$q = "SELECT id_rubrique, id_parent, titre 
 		FROM spip_rubriques 
-		ORDER BY id_parent,0+titre,titre";
+		ORDER BY id_parent,0+titre,titre
+		LIMIT 0,150";
 
 	$res = spip_query($q);
 

Index: inc_majbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_majbase.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_majbase.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ inc_majbase.php3	21 Jul 2005 21:47:15 -0000	1.5
@@ -995,6 +995,32 @@
 		maj_version(1.816);
 	}
 
+	// Texte et descriptif des groupes de mots-cles
+	if ($version_installee < 1.817) {
+		spip_query("ALTER TABLE spip_groupes_mots
+		ADD descriptif text NOT NULL AFTER titre");
+		spip_query("ALTER TABLE spip_groupes_mots
+		ADD COLUMN texte longblob NOT NULL AFTER descriptif");
+		maj_version(1.817);
+	}
+
+	// Conformite des noms de certains champs (0minirezo => minirezo)
+	if ($version_installee < 1.818) {
+		spip_query("ALTER TABLE spip_groupes_mots CHANGE COLUMN 0minirezo minirezo char(3) NOT NULL");
+		spip_query("ALTER TABLE spip_groupes_mots CHANGE COLUMN 1comite comite char(3) NOT NULL");
+		spip_query("ALTER TABLE spip_groupes_mots CHANGE COLUMN 6forum forum char(3) NOT NULL");
+		maj_version(1.818);
+	}
+
+	// Options de syndication : miroir + oubli
+	if ($version_installee < 1.819) {
+		spip_query("ALTER TABLE spip_syndic
+			ADD miroir VARCHAR(3) DEFAULT 'non'");
+		spip_query("ALTER TABLE spip_syndic
+			ADD oubli VARCHAR(3) DEFAULT 'non'");
+		maj_version(1.819);
+	}
+
 
 	return true;
 }

Index: inc_barre.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_barre.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- inc_barre.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ inc_barre.php3	21 Jul 2005 21:47:16 -0000	1.3
@@ -22,12 +22,12 @@
 	return "<a\nhref=\"javascript:"
 		.$action
 		."\" class='spip_barre' tabindex='1000'\ntitle=\""
-		.attribut_html($help)
+		.addslashes(attribut_html($help))
 		."\"" 
 		.(!_DIR_RESTREINT ? '' :  "\nonMouseOver=\"helpline('"
 		  .addslashes(attribut_html($help))
 		  ."',$champhelp)\"\nonMouseOut=\"helpline('"
-		  .attribut_html(_T('barre_aide'))
+		  .addslashes(attribut_html(_T('barre_aide')))
 		  ."', $champhelp)\"")
 		."><img\nsrc='"
 		._DIR_IMG_ICONES_BARRE

Index: inc_texte.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_texte.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc_texte.php3	30 Jun 2005 10:09:39 -0000	1.7
+++ inc_texte.php3	21 Jul 2005 21:47:16 -0000	1.8
@@ -119,10 +119,7 @@
 		. ")|("
 		. "<(poesie|poetry)>((.*?))<\/(poesie|poetry)>" #poesie
 		. ")/si");
-
-define ('__regexp_img_echappe', "<(IMG|DOC|EMB)([0-9]+)(\|([^\>]*))?".">");
-define ('__regexp_img_seule_echappe', "<(IMG)([0-9]+)(\|([^\>]*))?".">");
-define ('__regexp_doc_echappe', "<(DOC|EMB)([0-9]+)(\|([^\>]*))?".">");
+define('__preg_img', ',<(img|doc|emb)([0-9]+)(\|([^>]*))?'.'>,i');
 
 function echappe_html($letexte, $source='SOURCEPROPRE', $no_transform=false) {
 	if (preg_match_all(__regexp_echappe, $letexte, $matches, PREG_SET_ORDER))
@@ -147,14 +144,15 @@
 			$lecode = ereg_replace("^\n+|\n+$", "", $lecode);
 
 			// ne pas mettre le <div...> s'il n'y a qu'une ligne
-			if (is_int(strpos($lecode,"\n")))
-				$lecode = nl2br("<div align='left' class='spip_code' dir='ltr'>".$lecode."</div>");
-			else
-				$lecode = "<span class='spip_code' dir='ltr'>".$lecode."</span>";
+			if (is_int(strpos($lecode,"\n"))) {
+				$lecode = nl2br("<div style='text-align: left;' class='spip_code' dir='ltr'><tt>".$lecode."</tt></div>");
+				$marqueur_echap = "</no p>$marqueur_echap<no p>";
+			} else
+				$lecode = "<span class='spip_code' dir='ltr'><tt>".$lecode."</tt></span>";
 
 			$lecode = str_replace("\t", "&nbsp; &nbsp; &nbsp; &nbsp; ", $lecode);
 			$lecode = str_replace("  ", " &nbsp;", $lecode);
-			$les_echap[$num_echap] = "<tt>".$lecode."</tt>";
+			$les_echap[$num_echap] = $lecode;
 		}
 		else
 		if ($regs[7]) {
@@ -185,36 +183,15 @@
 		$letexte = traiter_math($letexte, $les_echap, $num_echap, $source);
 	}
 
-	//
-	// Reperages d'images et de documents utilisateur 
+	// Traitement des images et documents <IMGxx|right>
 	// (insertion dans echappe_retour pour faciliter les doublons)
-	// on explose par paragraphes pour sortir les insertions "lourdes" (xhtml)
-	if (eregi(__regexp_img_echappe, $letexte)) {
-		$letexte = str_replace("\r\n", "\n", $letexte);
-		$letexte = str_replace("\r", "\n", $letexte);
-
-		// Attention certains raccourcis impliquent un paragraphe
-		// (a completer, ou faire autrement !)
-		$letexte = str_replace('}}}', "}}}\n\n", $letexte);
-
-		$paragraphes = explode("\n\n", $letexte);
-		
-		foreach ($paragraphes as $para) {
-			while (eregi(__regexp_doc_echappe, $para, $match)) {
-				$num_echap++;	
-				$para = "</no p>@@SPIP_$source$num_echap@@<no p>\n\n".str_replace($match[0], "", $para);
-				$les_echap[$num_echap] = $match;
-				
-			}
-			while (eregi(__regexp_img_seule_echappe, $para, $match)) {
-				$num_echap++;	
-				$para = str_replace($match[0], "@@SPIP_$source$num_echap@@<no p>", $para);
-				$les_echap[$num_echap] = $match;
-				
-			}
-			$paragraphe[] = "$para";
+	if (preg_match_all(__preg_img, $letexte, $matches, PREG_SET_ORDER)) {
+		foreach ($matches as $match) {
+			$num_echap++;
+			$letexte = str_replace($match[0],
+				"</no p>@@SPIP_$source$num_echap@@<no p>", $letexte);
+			$les_echap[$num_echap] = $match;
 		}
-		$letexte= join("\n\n",$paragraphe);
 	}
 
 	return array($letexte, $les_echap);
@@ -249,9 +226,7 @@
 
 function supprime_img($letexte) {
 	$message = _T('img_indisponible');
-	while (eregi(__regexp_img_echappe, $letexte, $match)) {
-	  $letexte = str_replace($match[0], "($message)", $letexte);
-	}
+	preg_replace(__preg_img, "($message)", $letexte);
 	return $letexte;
 }
 
@@ -1081,9 +1056,6 @@
 // Filtre a appliquer aux champs du type #TEXTE*
 function propre($letexte, $echap=false) {
 	return interdire_scripts(traiter_raccourcis(trim($letexte), $echap));
-//	$a=time(); $b=microtime();
-//	interdire_scripts(traiter_raccourcis(trim($letexte)));
-//	return time()-$a + microtime()-$b;
 }
 
 ?>

Index: inc_sites.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_sites.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_sites.php3	30 Jun 2005 10:09:40 -0000	1.5
+++ inc_sites.php3	21 Jul 2005 21:47:16 -0000	1.6
@@ -512,8 +512,8 @@
 (preg_match(",<title>(.*?)</title>,ims",$item,$match))
 			$data['titre'] = $match[1];
 			else if (($syndic_version==0.3) AND (strlen($letitre)==0))
-				if (ereg('title[[:space:]]*=[[:space:]]*[\'"]([^"\']+)[\'"]',$link_match,$mat))
-				$data['titre']=$mat[1]; 
+				if (preg_match(',title[[:space:]]*=[[:space:]]*([\'"])(.+?)\\1,ims',$link_match,$mat))
+				$data['titre']=$mat[2]; 
 		if (!$data['titre'] = trim($data['titre']))
 			$data['titre'] = _T('ecrire:info_sans_titre');
 
@@ -668,11 +668,39 @@
 
 	// Les enregistrer dans la base
 	if (is_array($articles)) {
+		$urls = array();
 		foreach ($articles as $data) {
-			if ($data['url'])
+			if ($data['url']) {
 				inserer_article_syndique ($data, $now_id_syndic, $moderation, $url_site);
+				$urls[] = $data['url'];
+			}
+		}
+
+		// moderation automatique des liens qui sont sortis du feed
+		if (count($urls) > 0
+		AND $row['miroir'] == 'oui') {
+			spip_query("UPDATE spip_syndic_articles
+				SET statut='off', maj=maj
+				WHERE id_syndic=$now_id_syndic
+				AND NOT (url IN ('"
+				. join("','", array_map('addslashes',$urls))
+				. "'))");
+		}
+
+		// suppression apres 2 mois des liens qui sont sortis du feed
+		if (count($urls) > 0
+		AND $row['oubli'] == 'oui') {
+			$time = date('U') - 61*24*3600; # deux mois
+			spip_query("DELETE FROM spip_syndic_articles
+				WHERE id_syndic=$now_id_syndic
+				AND UNIX_TIMESTAMP(maj) < $time
+				AND UNIX_TIMESTAMP(date) < $time
+				AND NOT (url IN ('"
+				. join("','", array_map('addslashes',$urls))
+				. "'))");
 		}
 
+
 		// Noter que la syndication est OK
 		spip_query("UPDATE spip_syndic SET syndication='oui'
 		WHERE id_syndic='$now_id_syndic'");
@@ -891,7 +919,7 @@
 					$puce = 'puce-rouge.gif';
 			}
 
-			else if ($statut == "off") { // vieillerie
+			else if ($statut == "off") { // feed d'un site en mode "miroir"
 					$puce = 'puce-rouge-anim.gif';
 			}
 
@@ -899,7 +927,10 @@
 			$vals[] = $s;
 
 			$s = "<a href='$url'>$titre</a>";
-			if (strlen($lesauteurs) > 0) $s .= " ($lesauteurs)";
+
+			$date = affdate_court($date);
+			if (strlen($lesauteurs) > 0) $date = $lesauteurs.', '.$date;
+			$s.= " ($date)";
 
 			// S'il y a des fichiers joints (enclosures), on les affiche ici
 			if (spip_num_rows($q = spip_query("SELECT docs.* FROM spip_documents AS docs, spip_documents_syndic AS lien WHERE lien.id_syndic_article = $id_syndic_article AND lien.id_document = docs.id_document"))) {
@@ -918,11 +949,11 @@
 			$vals[] = $s;
 
 			// $my_sites cache les resultats des requetes sur les sites
-			if ($afficher_site) {
-				if (!$my_sites[$id_syndic])
-					$my_sites[$id_syndic] = spip_fetch_array(spip_query(
-						"SELECT * FROM spip_syndic WHERE id_syndic=$id_syndic"));
+			if (!$my_sites[$id_syndic])
+				$my_sites[$id_syndic] = spip_fetch_array(spip_query(
+					"SELECT * FROM spip_syndic WHERE id_syndic=$id_syndic"));
 
+			if ($afficher_site) {
 				$aff = $my_sites[$id_syndic]['nom_site'];
 				if ($my_sites[$id_syndic]['moderation'] == 'oui')
 					$s = "<i>$aff</i>";
@@ -943,7 +974,12 @@
 				else if ($statut == "refuse"){
 					$s =  "[<a href='".$adresse_page.$lien_url."id_syndic=$id_syndic&ajouter_lien=$id_syndic_article'>"._T('info_retablir_lien')."</a>]";
 				}
-				else /* if ($statut == "dispo") */ {
+				else if ($statut == "off"
+				AND $my_sites[$id_syndic]['miroir'] == 'oui') {
+					$s = '('._T('syndic_lien_obsolete').')';
+				}
+				else /* 'dispo' ou 'off' (dans le cas ancien site 'miroir') */
+				{
 					$s = "[<a href='".$adresse_page.$lien_url."id_syndic=$id_syndic&ajouter_lien=$id_syndic_article'>"._T('info_valider_lien')."</a>]";
 				}
 				$vals[] = $s;

Index: articles_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/articles_edit.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- articles_edit.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ articles_edit.php3	21 Jul 2005 21:47:16 -0000	1.6
@@ -205,16 +205,16 @@
 
 	# affichage
 	afficher_documents_colonne($id_article, 'article', $flag_editable);
-///////////////////////////
-//MODIFICATION
-///////////////////////////
+	///////////////////////////
+	//MODIFICATION
+	///////////////////////////
 	creer_colonne_droite();
 	if (lire_meta('activer_carto') == 'oui'){
 		//on l'a deja ?
 		include_ecrire ("inc_carto.php3");
 		afficher_insertion_carte($id_article);
 	}
-////////////////////////////
+	////////////////////////////
 }
 
 debut_droite();
@@ -303,8 +303,8 @@
 			$titre = couper(supprimer_tags(typo(extraire_multi($titre)))." ", 50);
 			if (lire_meta('multi_rubriques') == 'oui' AND ($langue_choisie_rub == "oui" OR $leparent == 0)) $titre = $titre." [".traduire_nom_langue($lang_rub)."]";
 			echo "<option".mySel($my_rubrique,$id_rubrique)." class='$selec_rub' style=\"$style\">$espace$titre</option>\n";
-
-	
+		
+		
 			$ja_rub .= addslashes("[$my_rubrique] $titre ///");
 		}
 		$premier = 0;
@@ -394,81 +394,9 @@
 	debut_cadre_couleur("$logo_parent", false, "", _T('titre_cadre_interieur_rubrique').aide ("artrub"));
 
 
-	echo "<script language='JavaScript' type='text/javascript'>
-<!--
-/*
-  Author: Justin Whitford
-  Source: www.evolt.org
-*/
-function filtery(pattern, list){
-  /*
-  if the dropdown list passed in hasn't
-  already been backed up, we'll do that now
-  */
-  if (!list.bak){
-    /*
-    We're going to attach an array to the select object
-    where we'll keep a backup of the original dropdown list
-    */
-    list.bak = new Array();
-    for (n=0; n<list.length; n++){
-      list.bak[list.bak.length] = new Array(list[n].value, list[n].text);
-    }
-    bakselected = list.selectedIndex;
-  }
-
-  /*
-  We're going to iterate through the backed up dropdown
-  list. If an item matches, it is added to the list of
-  matches. If not, then it is added to the list of non matches.
-  */
-  match = new Array();
-  nomatch = new Array();
-  
-  if (pattern.length != 0) {
-	  for (n=0; n<list.bak.length; n++){
-		if(list.bak[n][1].toLowerCase().indexOf(pattern.toLowerCase())!=-1 || list.bak[n][0] == pattern ){
-		  match[match.length] = new Array(list.bak[n][0], list.bak[n][1]);
-		}else{
-		  nomatch[nomatch.length] = new Array(list.bak[n][0], list.bak[n][1]);
-		}
-	  }
-  }
-
-  /*
-  Now we completely rewrite the dropdown list.
-  First we write in the matches, then we write
-  in the non matches
-  */
-  
-  if (match.length > 0) {
-	  list.options.length = match.length;
-	  for (n=0; n<match.length; n++){
-		list[n].value = match[n][0];
-		list[n].text = match[n][1];
-	  }
-
-    list.selectedIndex=0;
-  
-  }
-  else {
-	  list.options.length = list.bak.length;
-	  for (n=0; n<list.bak.length; n++){
-		list[n].value =  list.bak[n][0];
-		list[n].text =  list.bak[n][1];
-	  }
-  list.selectedIndex = bakselected;
-  }
-
-}
-// -->
-</script>";
-
-	
+	// Integrer la recherche de rubrique au clavier
+	echo "<script language='JavaScript' type='text/javascript' src='filtery.js'></script>\n";
 	echo "<input type='text' size='10' style='font-size: 90%; width: 15%;' onkeyup=\"filtery(this.value,this.form.id_rubrique);\" onChange=\"filtery(this.value,this.form.id_rubrique);\"> ";
-
-
-
 
 	echo "<SELECT NAME='id_rubrique' style='font-size: 90%; width:80%; font-face:verdana,arial,helvetica,sans-serif; max-height: 24px;' SIZE=1>\n";
 	enfant(0);

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.12
retrieving revision 1.13
diff -u -d -r1.12 -r1.13
--- carte_edit.php3	4 Jul 2005 09:25:14 -0000	1.12
+++ carte_edit.php3	21 Jul 2005 21:47:16 -0000	1.13
@@ -164,7 +164,9 @@
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec logos'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec liens'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
+if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
 if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec geosvg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvg&var_mode=recalcul", "racine-24.gif", "rien.gif");
+if ($url_carte && ($new!="oui")) icone_horizontale( _L('pr?visualiser avec geosvgwms'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
 
 echo "</div>\n";
 
@@ -231,7 +233,7 @@
    		echo afficher_carte_interface($id_carte,$retour,$lurl_carte,$tabcallage, $url_carte);
 				
 		echo fin_block();
-		echo "</div>\n";
+		//echo "</div>\n";
 		
 		fin_cadre_relief();
 	}

Index: inc_tidy.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_tidy.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_tidy.php	30 Jun 2005 10:09:39 -0000	1.4
+++ inc_tidy.php	21 Jul 2005 21:47:16 -0000	1.5
@@ -52,13 +52,15 @@
 
 /** ici commence la petite usine a gaz des traitements d'erreurs de tidy **/
 	## NB: seul tidy en ligne de commande sait gerer ses erreurs,
+
+	// Conserver une liste des URLs en erreur tidy
+	lire_fichier($f = _DIR_SESSIONS.'w3c-go-home.txt', $liste);
+	$url = "http://".$_SERVER['HTTP_HOST'].nettoyer_uri();
+
 	if (defined('_erreur_tidy')) {
 
 		if (defined('_calcul_tidy')) {
 			spip_log("Erreur tidy : $url\n"._erreur_tidy, 'tidy');
-
-			// Conserver une liste des URLs en erreur tidy
-			lire_fichier($f = _DIR_SESSIONS.'w3c-go-home.txt', $liste);
 			if (strpos($liste, "- $url -\n") === false) {
 				$liste = substr($liste, - 8*1024); # anti-explosions
 				ecrire_fichier($f, $liste."- $url -\n");
@@ -75,9 +77,7 @@
 	{
 		// Nettoyer la liste des URLs pourries, si maintenant on est correct
 		if (defined('_calcul_tidy')) {
-			lire_fichier($f = _DIR_SESSIONS.'w3c-go-home.txt', $liste);
-			$url = "- http://".$_SERVER['HTTP_HOST'].nettoyer_uri()." -\n";
-			if (($liste2 = str_replace($url, '', $liste)) != $liste)
+			if (($liste2 = str_replace("- $url -\n", '', $liste)) != $liste)
 				ecrire_fichier($f, $liste2);
 		}
 
@@ -89,11 +89,9 @@
 #			entetes_xhtml();
 
 	}
-	// Ajouter un pseudo bouton d'admin
-	$GLOBALS['xhtml_check'] = 'http://validator.w3.org/check?uri=' .
-	  stripslashes(preg_quote(entites_html("http://" .
-					       $_SERVER['HTTP_HOST'].
-					       nettoyer_uri())));
+	// Ajouter un bouton d'admin "Analyser"
+	$GLOBALS['xhtml_check'] = 'http://validator.w3.org/check?uri='
+		. urlencode("http://" . $_SERVER['HTTP_HOST'] . nettoyer_uri());
 /** fin de l'usine a gaz **/
 
 
@@ -228,7 +226,7 @@
 			'indent-spaces' => 4,
 			'output-xhtml' => true,
 			'add-xml-decl' => false,
-			'indent' => 5,
+			'indent' => 0,
 			'show-body-only' => false,
 			'quote-nbsp' => false
 			);

Index: inc_getdocument.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_getdocument.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_getdocument.php3	30 Jun 2005 10:09:39 -0000	1.5
+++ inc_getdocument.php3	21 Jul 2005 21:47:16 -0000	1.6
@@ -280,7 +280,8 @@
 	}
 
 	// Echec avec HEAD, on tente avec GET
-	if (!$a) {
+	if (!$a AND !$max) {
+	spip_log("tente $source");
 		$a = recuperer_infos_distantes($source, 1024*1024);
 	}
 

Index: inc_spip_sax.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_spip_sax.php,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- inc_spip_sax.php	30 Jun 2005 10:09:39 -0000	1.1
+++ inc_spip_sax.php	21 Jul 2005 21:47:16 -0000	1.2
@@ -43,8 +43,8 @@
   $sep = ' ';
   foreach ($attrs as $k => $v) {
 	$delim = strpos($v, "'") === false ? "'" : '"';
-	$att .= $sep .  $k . "=" . $delim . 
-	  $phraseur_xml->translate_entities($v)
+	$att .= $sep .  $k . "=" . $delim
+	  . str_replace('"',  '&quot;', $phraseur_xml->translate_entities($v))
 	  . $delim;
 	$sep = "\n $depth";
     }
@@ -96,7 +96,6 @@
 	  eval($data);
 	  $data = ob_get_contents();
 	  ob_end_clean();
-	  //	  xml_parse($xml_parser, $data); // pas si simple
 	  $contenu[$depth] .= $data;
   }
 }

Index: mots_tous.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_tous.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- mots_tous.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ mots_tous.php3	21 Jul 2005 21:47:16 -0000	1.3
@@ -66,20 +66,22 @@
 	if ($modifier_groupe == "oui") {
 		$change_type = addslashes(corriger_caracteres($change_type));
 		$ancien_type = addslashes(corriger_caracteres($ancien_type));
-
+		$texte = addslashes(corriger_caracteres($texte));
+		$descriptif = addslashes(corriger_caracteres($descriptif));
+		
 		if ($ancien_type) {	// modif groupe
 			$query = "UPDATE spip_mots SET type='$change_type' WHERE id_groupe='$id_groupe'";
 			spip_query($query);
 
-			$query = "UPDATE spip_groupes_mots SET titre='$change_type', unseul='$unseul', obligatoire='$obligatoire',
+			$query = "UPDATE spip_groupes_mots SET titre='$change_type', texte='$texte', descriptif='$descriptif', unseul='$unseul', obligatoire='$obligatoire',
 				articles='$articles', breves='$breves', rubriques='$rubriques', syndic='$syndic',
-				0minirezo='$acces_minirezo', 1comite='$acces_comite', 6forum='$acces_forum'
+				minirezo='$acces_minirezo', comite='$acces_comite', forum='$acces_forum'
 				,carto_objets='$carto_objets' WHERE id_groupe='$id_groupe'";
 			spip_query($query);
 		} else {	// creation groupe
-			$query = "INSERT INTO spip_groupes_mots SET titre='$change_type', unseul='$unseul', obligatoire='$obligatoire',
+			$query = "INSERT INTO spip_groupes_mots SET titre='$change_type', texte='$texte', descriptif='$descriptif', unseul='$unseul', obligatoire='$obligatoire',
 				articles='$articles', breves='$breves', rubriques='$rubriques', syndic='$syndic',
-				carto_objets='$carto_objets', 0minirezo='$acces_minirezo', 1comite='$acces_comite', 6forum='$acces_forum'";
+				carto_objets='$carto_objets', minirezo='$acces_minirezo', comite='$acces_comite', forum='$acces_forum'";
 			spip_query($query);
 		}
 	}
@@ -197,15 +199,17 @@
 while ($row_groupes = spip_fetch_array($result_groupes)) {
 	$id_groupe = $row_groupes['id_groupe'];
 	$titre_groupe = typo($row_groupes['titre']);
+	$descriptif = $row_groupes['descriptif'];
+	$texte = $row_groupes['texte'];
 	$unseul = $row_groupes['unseul'];
 	$obligatoire = $row_groupes['obligatoire'];
 	$articles = $row_groupes['articles'];
 	$breves = $row_groupes['breves'];
 	$rubriques = $row_groupes['rubriques'];
 	$syndic = $row_groupes['syndic'];
-	$acces_minirezo = $row_groupes['0minirezo'];
-	$acces_comite = $row_groupes['1comite'];
-	$acces_forum = $row_groupes['6forum'];
+	$acces_minirezo = $row_groupes['minirezo'];
+	$acces_comite = $row_groupes['comite'];
+	$acces_forum = $row_groupes['forum'];
 
 	// Afficher le titre du groupe
 	debut_cadre_enfonce("groupe-mot-24.gif", false, '', $titre_groupe);
@@ -226,6 +230,21 @@
 	if ($acces_forum == "oui") echo "> "._T('info_visiteurs_02')." &nbsp;&nbsp;";
 
 	echo "</font>";
+	if ($descriptif) {
+		echo "<p><div align='left' border: 1px dashed #aaaaaa;'>";
+		echo "<font size=2 face='Verdana,Arial,Sans,sans-serif'>";
+		echo "<b>"._T('info_descriptif')."</b> ";
+		echo propre($descriptif);
+		echo "&nbsp; ";
+		echo "</font>";
+		echo "</div>";
+	}
+
+	if (strlen($texte)>0){
+		echo "<FONT FACE='Verdana,Arial,Sans,sans-serif'>";
+		echo "<P>".propre($texte);
+		echo "</FONT>";
+	}
 
 	//
 	// Afficher les mots-cles du groupe

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.13
retrieving revision 1.14
diff -u -d -r1.13 -r1.14
--- inc_carto.php3	30 Jun 2005 10:09:39 -0000	1.13
+++ inc_carto.php3	21 Jul 2005 21:47:16 -0000	1.14
@@ -90,6 +90,56 @@
 	}
 }
 
+function getArg($texte,$idArg){
+	$args=explode(",",$texte);
+	return $args[$idArg];
+}
+function wkt2imgheight($args, $callage = "",$url_carte){
+	$tab=wkt2imgsize($args, $callage,$url_carte);
+	return $tab[0];
+}
+function wkt2imgwidth($args, $callage = "",$url_carte){
+	$tab=wkt2imgsize($args, $callage,$url_carte);
+	return $tab[1];
+}
+function wkt2imgsize($args="", $callage = "",$url_carte){
+	//recuperer taille reelle carte
+	$callage 	= worldfile2array ($callage);
+	
+	$GeoWidth 	= ($callage['bottom_right']['x']-$callage['top_left']['x']);
+	$GeoHeight 	= ($callage['bottom_right']['y']-$callage['top_left']['y']);
+	
+	
+	//recuperer taille de l'image
+	$ImgRealWidth = getImgWidth ($url_carte);
+	$ImgRealHeight = getImgHeight ($url_carte);
+	
+	//ou la taille pass?e, ou ? defaut celle de la carte ???
+	if ($ImgRealWidth) $ImgWidth = $ImgRealWidth;
+	else $ImgWidth = $GeoWidth;
+	if ($ImgRealHeight) $ImgHeight = $ImgRealHeight;
+	else $ImgHeight = $GeoHeight;
+	$ratio=$ImgHeight/$ImgWidth;
+	
+	//tailles maximum parametr?es ?
+	//TODO : optimiser un peu tout ca ...
+	$ImgMaxWidth = getArg($args,1);
+	$ImgMaxHeight = getArg($args,0);
+	if ($ImgMaxWidth==0) $ImgMaxWidth=$ImgWidth;
+	if ($ImgMaxHeight==0) $ImgMaxHeight=$ImgHeight;
+	
+	if (($ImgMaxWidth)&&($ImgMaxWidth<$ImgWidth))
+	{
+		$ImgWidth=$ImgMaxWidth;
+		$ImgHeight=round($ratio*$ImgMaxWidth);
+	}
+	if (($ImgMaxHeight)&&($ImgMaxHeight<$ImgHeight))
+	{
+		$ImgHeight=$ImgMaxHeight;
+		$ImgWidth=round($ImgMaxHeight/$ratio);
+	}
+	return array($ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth);
+}
 /*
  *   +---------------------------------------------+
  *    Nom du Filtre : WKT to COORDS
@@ -108,23 +158,23 @@
  * http://www.uzine.net/spip_contrib/
  *
  */
-function wkt2coords($geometrie, $format = "HTML", $callage = "", $url_carte = ""){
+function wkt2coords($geometrie, $format = "HTML", $callage = "",$url_carte, $args = ""){
+	//recuperer geometrie
 	$wktGeomType = substr($geometrie,0,strpos($geometrie,"("));
 	$wktGeom 	= substr($geometrie,strpos($geometrie,"(")+1,-1);
 	
-	$callage 	= worldfile2array ($callage);
-	
-	$GeoWidth 	= ($callage['bottom_right']['x']-$callage['top_left']['x']);
-	$GeoHeight 	= ($callage['bottom_right']['y']-$callage['top_left']['y']);
-	
-	$ImgWidth = getImgWidth ($url_carte);
-	$ImgHeight = getImgHeight ($url_carte);;
+	$tab=wkt2imgsize($args, $callage,$url_carte);
+	//recuperer taille affich?e 
+	$ImgHeight=$tab[0];
+	$ImgWidth=$tab[1];
+	//recuperer taille reelle carte
+	$GeoHeight 	= $tab[2];
+	$GeoWidth 	= $tab[3];
 
-	if (!$ImgWidth) $ImgWidth = $GeoWidth;
-	if (!$ImgHeight) $ImgHeight = $GeoHeight;
-	
 	$radius		 = 3;	// TODO : Param?tre (ou fonction du callage ?) pr?f?rable car fonction des projections 5 peut ?tre bcp trop petit
 	$rgeo 		 = $radius*$GeoWidth/$ImgWidth;
+	$callage 	= worldfile2array ($callage);
+	
 	switch ($format){
 		case "HTML":
 			// Pour obtenir des objets HTML/MAP ...
@@ -559,4 +609,5 @@
 	fin_cadre_enfonce();
 
 }
+
 ?>

Index: inc_abstract_sql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_abstract_sql.php3,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- inc_abstract_sql.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ inc_abstract_sql.php3	21 Jul 2005 21:47:16 -0000	1.3
@@ -37,7 +37,7 @@
 
 function spip_abstract_select (
 	$select = array(), $from = array(), $where = '',
-	$groupby = '', $orderby = '', $limit = '',
+	$groupby = '', $orderby = array(), $limit = '',
 	$sousrequete = '', $cpt = '',
 	$table = '', $id = '', $serveur='') {
 
@@ -56,7 +56,7 @@
 		}
 	}
 	return $f($select, $from, $where,
-		  $groupby, $orderby, $limit,
+		  $groupby, array_filter($orderby), $limit,
 		  $sousrequete, $cpt,
 		  $table, $id, $serveur);
 }
@@ -105,7 +105,7 @@
 # une composition tellement frequente...
 function spip_abstract_fetsel(
 	$select = array(), $from = array(), $where = '',
-	$groupby = '', $orderby = '', $limit = '',
+	$groupby = '', $orderby = array(), $limit = '',
 	$sousrequete = '', $cpt = '',
 	$table = '', $id = '', $serveur='') {
 	return spip_abstract_fetch(spip_abstract_select(

Index: inc_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_import.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc_import.php3	30 Jun 2005 10:09:40 -0000	1.5
+++ inc_import.php3	21 Jul 2005 21:47:16 -0000	1.6
@@ -477,6 +477,7 @@
 		else {
 			$affiche_progression_pourcent = filesize($archive);
 			$taille = floor(100 * $my_pos / $affiche_progression_pourcent)." %";
+			$gz = false;
 		}
 		$texte_boite = _T('info_base_restauration')."<p>
 		<form name='progression'><center><input type='text' size=10 style='text-align:center;' name='taille' value='$taille'><br>

Index: inc_auth.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_auth.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc_auth.php3	3 Mar 2005 14:54:56 -0000	1.3
+++ inc_auth.php3	21 Jul 2005 21:47:16 -0000	1.4
@@ -20,6 +20,10 @@
 include_ecrire ("inc_meta.php3");
 include_ecrire ("inc_session.php3");
 
+define("_DIR_LOGIN", _DIR_RESTREINT ? "" : "../");
+define("_DIR_LOGED_IN",   _DIR_RESTREINT ? "" : _DIR_RESTREINT_ABS);
+
+
 //
 // Fonctions de gestion de l'acces restreint aux rubriques
 //
@@ -116,9 +120,9 @@
 
 	// Tentative de login echec
 	if ($_GET['bonjour'] == 'oui' AND !$auth_login) {
-		$link = new Link("../spip_cookie.php3?test_echec_cookie=oui");
+		$link = new Link(_DIR_LOGIN . "spip_cookie.php3?test_echec_cookie=oui");
 		$clean_link->delVar('bonjour');
-		$url = str_replace('/./', '/', _DIR_RESTREINT_ABS .$clean_link->getUrl());
+		$url = str_replace('/./', '/', _DIR_LOGED_IN .$clean_link->getUrl());
 		$link->addVar('url', $url);
 		redirige_par_entete($link->getUrl());
 		exit;
@@ -126,9 +130,9 @@
 
 	// Si pas authentifie, demander login / mdp
 	if (!$auth_login) {
-		$url = str_replace('/./', '/',  _DIR_RESTREINT_ABS
+		$url = str_replace('/./', '/',  _DIR_LOGED_IN
 			. $clean_link->getUrl());
-		redirige_par_entete("../spip_login.php3?url=".urlencode($url));
+		redirige_par_entete(_DIR_LOGIN . "spip_login.php3?url=".urlencode($url));
 		exit;
 	}
 
@@ -214,14 +218,17 @@
 		include_ecrire('inc_presentation.php3');
 		include_ecrire('inc_texte.php3');
 		install_debut_html(_T('avis_erreur_connexion'));
-		echo "<br><br><p>"._T('texte_inc_auth_1', array('auth_login' => $auth_login))." <A HREF='../spip_cookie.php3?logout=$auth_login'>".
+		echo "<br><br><p>".
+		  _T('texte_inc_auth_1', array('auth_login' => $auth_login)).
+		  " <a href='" .
+		  _DIR_LOGIN . "spip_cookie.php3?logout=$auth_login'>".
                 _T('texte_inc_auth_2')."</A>"._T('texte_inc_auth_3');
 		install_fin_html();
 		exit;
 	}
 
 	if (!$auth_pass_ok) {
-		redirige_par_entete("../spip_login.php3?var_erreur=pass");
+		redirige_par_entete(_DIR_LOGIN . "spip_login.php3?var_erreur=pass");
 	}
 
 	// Si c'est un nouvel inscrit, le passer de 'nouveau' a '1comite'

Index: inc_db_mysql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_db_mysql.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc_db_mysql.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ inc_db_mysql.php3	21 Jul 2005 21:47:16 -0000	1.5
@@ -74,12 +74,12 @@
 			   $sousrequete, $having,
 			   $table, $id, $serveur) {
 
-	$q = "\nFROM " . join(",\n\t", $from)
-	. ($where ? "\nWHERE " . join("\n\tAND ", $where) : '')
-	. ($groupby ? "\nGROUP BY $groupby" : '')
-	. ($having  ? "\nHAVING $having" : '')
-	. ($orderby ? "\nORDER BY $orderby" : '')
-	. ($limit ? "\nLIMIT $limit" : '');
+	$q = ($from  ?("\nFROM " . join(",\n\t", $from)) : '')
+	  .  ($where ? ("\nWHERE " . join("\n\tAND ", $where)) : '')
+	  .  ($groupby ? "\nGROUP BY $groupby" : '')
+	  .  ($having  ? "\nHAVING $having" : '')
+	  .  ($orderby ? ("\nORDER BY " . join(", ", $orderby)) : '')
+	  .  ($limit ? "\nLIMIT $limit" : '');
 
 	if (!$sousrequete)
 		$q = " SELECT ". join(", ", $select) . $q;
@@ -97,9 +97,10 @@
 
 	if (!($res = @spip_query($q))) {
 		include_ecrire('inc_debug_sql.php3');
-		echo erreur_requete_boucle($q, $id, $table);
+		erreur_requete_boucle($q, $id, $table,
+				      spip_sql_errno(),
+				      spip_sql_error());
 	}
-
 #	 spip_log($serveur . spip_num_rows($res) . $q);
 	return $res;
 }
@@ -239,19 +240,20 @@
 	if (!$valeurs) return '0=0';
 
 	$n = $i = 0;
-	$chunk = array();
+	$in_sql ="";
 	while ($n = strpos($valeurs, ',', $n+1)) {
-		if ((++$i) >= 255) {
-			$chunk = substr($valeurs, 0, $n);
-			$in_sql .= "($val $not IN (" . $chunk . "))\n" .
-				($not ? "AND\t" : "OR\t");
+	  if ((++$i) >= 255) {
+			$in_sql .= "($val $not IN (" .
+			  substr($valeurs, 0, $n) .
+			  "))\n" .
+			  ($not ? "AND\t" : "OR\t");
 			$valeurs = substr($valeurs, $n+1);
 			$i = $n = 0;
 		}
 	}
 	$in_sql .= "($val $not IN ($valeurs))";
 
-	return $in_sql;
+	return "($in_sql)";
 }
 
 ?>

Index: sites_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/sites_edit.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- sites_edit.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ sites_edit.php3	21 Jul 2005 21:47:16 -0000	1.5
@@ -183,7 +183,7 @@
 		fin_cadre_relief();
 		echo "</form>";
 		
-		echo "<p><b>"._T('texte_non_fonction_referencement')."</b>";
+		echo "<p><blockquote><b>"._T('texte_non_fonction_referencement')."</b>";
 		$cadre_ouvert = true;
 		debut_cadre_enfonce("site-24.gif");
 		
@@ -222,7 +222,12 @@
 	}
 
 	debut_cadre_couleur("$logo_parent", false, "", _T('entree_interieur_rubrique'));
-	echo "<select name='id_rubrique' style='background-color:#ffffff; font-size:90%; width:100%; max-height: 24px; font-face:verdana,arial,helvetica,sans-serif;' size=1>\n";
+
+	// Integrer la recherche de rubrique au clavier
+	echo "<script language='JavaScript' type='text/javascript' src='filtery.js'></script>\n";
+	echo "<input type='text' size='10' style='font-size: 90%; width: 15%;' onkeyup=\"filtery(this.value,this.form.id_rubrique);\" onChange=\"filtery(this.value,this.form.id_rubrique);\"> ";
+
+	echo "<SELECT NAME='id_rubrique' style='font-size: 90%; width:80%; font-face:verdana,arial,helvetica,sans-serif; max-height: 24px;' SIZE=1>\n";
 	enfant(0);
 	echo "</select>\n";
 	fin_cadre_couleur();
@@ -295,7 +300,10 @@
 echo "<div ALIGN='right'><INPUT TYPE='submit' NAME='Valider' VALUE='"._T('bouton_enregistrer')."' CLASS='fondo'></div>";
 echo "</FORM>";
 
-if ($cadre_ouvert) fin_cadre_enfonce();
+if ($cadre_ouvert) {
+	fin_cadre_enfonce();
+	echo "</blockquote>\n";
+}
 
 fin_cadre_formulaire();
 

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- inc_presentation.php3	5 Jul 2005 00:44:48 -0000	1.8
+++ inc_presentation.php3	21 Jul 2005 21:47:16 -0000	1.9
@@ -1167,7 +1167,7 @@
 	}
 
 
-	if ($afficher_auteurs) $cols = 3;
+	if ($afficher_auteurs) $cols = 4;
 	else $cols = 2;
 	$query_message .= ' ORDER BY date_heure DESC';
 	$tranches = afficher_tranches_requete($query_message, $cols);
@@ -2041,7 +2041,7 @@
 	echo "<li><a href=\"naviguer.php3\">"._T('icone_edition_site')."</a>";
 	echo "<li><a href=\"forum.php3\">"._T('titre_forum')."</a>";
 	echo "<li><a href=\"auteurs.php3\">"._T('icone_auteurs')."</a>";
-	echo "<li><a href=\"$adresse_site\">"._T('icone_visiter_site')."</a>";
+	echo "<li><a href=\"$adresse_site/\">"._T('icone_visiter_site')."</a>";
 	echo "</ul>";
 }
 else {
@@ -2077,7 +2077,7 @@
 
 
 	icone_bandeau_principal (_T('icone_aide_ligne'), "javascript:window.open('aide_index.php3?var_lang=$spip_lang', 'aide_spip', 'scrollbars=yes,resizable=yes,width=740,height=580');", "aide-48$spip_lang_rtl.png", "vide", "", "aide_index.php3?var_lang=$spip_lang", "aide-en-ligne", $sous_rubrique);
-	icone_bandeau_principal (_T('icone_visiter_site'), "$adresse_site", "visiter-48$spip_lang_rtl.png", "visiter","", "visiter", $sous_rubrique);
+	icone_bandeau_principal (_T('icone_visiter_site'), "$adresse_site/", "visiter-48$spip_lang_rtl.png", "visiter","", "visiter", $sous_rubrique);
 
 	echo "</tr></table>\n";
 
@@ -2763,8 +2763,8 @@
 
 // Cadre formulaires
 
-function debut_cadre_formulaire(){
-	echo "\n<div class='cadre-formulaire'>";
+function debut_cadre_formulaire($style=''){
+	echo "\n<div class='cadre-formulaire'" . (!$style ? "" : "style='$style'") .">";
 }
 
 function fin_cadre_formulaire(){

Index: sites.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/sites.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- sites.php3	30 Jun 2005 10:09:39 -0000	1.3
+++ sites.php3	21 Jul 2005 21:47:16 -0000	1.4
@@ -17,6 +17,7 @@
 include_ecrire ("inc_sites.php3");
 include_ecrire ("inc_date.php3");
 include_ecrire ("inc_abstract_sql.php3");
+include_ecrire ("inc_config.php3");
 
 $proposer_sites = lire_meta("proposer_sites");
 
@@ -51,10 +52,10 @@
 					 "(nom_site, id_rubrique, id_secteur, date, date_syndic, statut, syndication, moderation)",
 					 "('"._T('avis_site_introuvable')."', $id_rubrique, $id_rubrique, NOW(), NOW(), 'refuse', 'non', '$moderation')");
 	}
-}
+} else $id_syndic = intval($id_syndic);
 
-$query = "SELECT statut, id_rubrique FROM spip_syndic WHERE id_syndic='$id_syndic'";
-$result = spip_query($query);
+$result = spip_query("SELECT statut, id_rubrique FROM spip_syndic
+	WHERE id_syndic=$id_syndic");
 
 if ($row = spip_fetch_array($result)) {
 	$statut = $row["statut"];
@@ -81,10 +82,11 @@
 		$url_syndic = addslashes($v['url_syndic']);
 		$descriptif = addslashes($v['descriptif']);
 		$syndication = $v[syndic] ? 'oui' : 'non';
-		$query = "UPDATE spip_syndic ".
-			"SET nom_site='$nom_site', url_site='$url_site', url_syndic='$url_syndic', descriptif='$descriptif', syndication='$syndication', statut='$statut' ".
-			"WHERE id_syndic=".intval($id_syndic);
-		$result = spip_query($query);
+		$result = spip_query("UPDATE spip_syndic ".
+			"SET nom_site='$nom_site', url_site='$url_site',
+			url_syndic='$url_syndic', descriptif='$descriptif',
+			syndication='$syndication', statut='$statut'
+			WHERE id_syndic=$id_syndic");
 		if ($syndication == 'oui') syndic_a_jour($id_syndic);
 		$link = new Link('sites.php3');
 		$link->addVar('id_syndic');
@@ -101,13 +103,12 @@
 
 if ($nouveau_statut AND $flag_administrable) {
 	$statut = $nouveau_statut;
-	$query = "UPDATE spip_syndic SET statut='$statut' WHERE id_syndic=".intval($id_syndic);
-	$result = spip_query($query);
-	//if ($statut == 'refuse') $redirect_ok = 'oui';
-	if ($statut == 'publie') {
-		$query = "UPDATE spip_syndic SET date=NOW() WHERE id_syndic=".intval(id_syndic);
-		$result = spip_query($query);
-	}
+	$result = spip_query("UPDATE spip_syndic SET statut='$statut'
+	WHERE id_syndic=$id_syndic");
+	if ($statut == 'publie')
+		spip_query("UPDATE spip_syndic SET date=NOW() WHERE
+		id_syndic=$id_syndic");
+
 	calculer_rubriques();
 	if ($statut == 'publie') {
 		if (lire_meta('activer_moteur') == 'oui') {
@@ -133,15 +134,18 @@
 	
 	
 	
-	$query = "UPDATE spip_syndic SET id_rubrique='$id_rubrique', nom_site='$nom_site', url_site='$url_site', url_syndic='$url_syndic', descriptif='$descriptif', syndication='$syndication', statut='$statut' $add_extra WHERE id_syndic=".intval($id_syndic);
-	$result = spip_query($query);
+	spip_query("UPDATE spip_syndic SET id_rubrique='$id_rubrique',
+	nom_site='$nom_site', url_site='$url_site', url_syndic='$url_syndic',
+	descriptif='$descriptif', syndication='$syndication', statut='$statut'
+	$add_extra WHERE id_syndic=$id_syndic");
 
-	if ($syndication_old != $syndication OR $url_syndic != $old_syndic) {
+	if ($syndication_old != $syndication OR $url_syndic != $old_syndic)
 		$reload = "oui";
-	}
-	if ($syndication_old != $syndication AND $syndication == "non") {
-		spip_query("DELETE FROM spip_syndic_articles WHERE id_syndic='$id_syndic'");
-	}
+
+	if ($syndication_old != $syndication AND $syndication == "non")
+		spip_query("DELETE FROM spip_syndic_articles
+		WHERE id_syndic=$id_syndic");
+
 	calculer_rubriques();
 
 	// invalider et reindexer
@@ -167,8 +171,8 @@
 if ($jour AND $flag_administrable) {
 	if ($annee == "0000") $mois = "00";
 	if ($mois == "00") $jour = "00";
-	$query = "UPDATE spip_syndic SET date='$annee-$mois-$jour' WHERE id_syndic=".intval($id_syndic);
-	$result = spip_query($query);
+	spip_query("UPDATE spip_syndic SET date='$annee-$mois-$jour'
+	WHERE id_syndic=$id_syndic");
 	calculer_rubriques();
 }
 
@@ -182,8 +186,9 @@
 //
 // reload
 //
-if ($reload ==  "oui") {
-	$result = spip_query ("SELECT * FROM spip_syndic WHERE id_syndic='$id_syndic' AND syndication IN ('oui', 'sus', 'off')");
+if ($reload) {
+	$result = spip_query ("SELECT * FROM spip_syndic WHERE id_syndic=$id_syndic
+	AND syndication IN ('oui', 'sus', 'off')");
 	if ($result AND spip_num_rows($result)>0)
 		$erreur_syndic = syndic_a_jour ($id_syndic);
 }
@@ -195,8 +200,7 @@
 
 calculer_droits();
 
-$query = "SELECT * FROM spip_syndic WHERE id_syndic='$id_syndic'";
-$result = spip_query($query);
+$result = spip_query("SELECT * FROM spip_syndic WHERE id_syndic=$id_syndic");
 
 if ($row = spip_fetch_array($result)) {
 	$id_syndic = $row["id_syndic"];
@@ -372,30 +376,80 @@
 		fin_boite_info();
 	}
 	afficher_syndic_articles(_T('titre_articles_syndiques'),
-		"SELECT * FROM spip_syndic_articles WHERE id_syndic='$id_syndic' ORDER BY date DESC");
+		"SELECT * FROM spip_syndic_articles WHERE id_syndic=$id_syndic
+		ORDER BY date DESC");
 
 
 	echo "<font face='verdana,arial,helvetica' size=2>";
 	// afficher la date de dernier acces a la syndication
 	if ($date_syndic)
 		echo "<p><div align='left'>"._T('info_derniere_syndication').' '.affdate_heure($date_syndic)
-		.".</div><div align='right'><a href='sites.php3?id_syndic=$id_syndic&reload=oui'>"._T('lien_mise_a_jour_syndication')."</a></div>\n";
+		.".</div>\n";
+		
+		echo "<div align='right'>\n"
+		. "<form method='post' action='sites.php3?id_syndic=$id_syndic'>"
+		. "<input type='submit' name='reload' value=\""
+		. attribut_html(_T('lien_mise_a_jour_syndication'))
+		. "\" class='fondo' style='font-size:9px;' /></form></div>\n";
 
-	// modifier la moderation
+	// Options
 	if ($flag_administrable && $options=='avancees') {
+
+		debut_cadre_relief();
+		echo "<u>"._T('syndic_options')."</u>"
+			. aide('artsyn')."\n"
+			. "<form method='POST' action='sites.php3?id_syndic=$id_syndic' class='verdana2'>\n";
+
+		// modifier la moderation
 		if ($moderation == 'oui' OR $moderation == 'non')
-			spip_query("UPDATE spip_syndic SET moderation='$moderation' WHERE id_syndic=".intval($id_syndic));
+			spip_query("UPDATE spip_syndic SET moderation='$moderation'
+			WHERE id_syndic=$id_syndic");
 		else
 			$moderation = $mod;
+		if ($moderation != 'oui') $moderation='non';
 
-		if ($moderation == 'non' || $moderation =='')
-			echo "<p><div align='left'>"._T('texte_liens_syndication'). aide('artsyn') .
-				"</div><div align='right'><a
-				href='sites.php3?id_syndic=$id_syndic&moderation=oui'>"._T('info_demander_blocage_priori')."</a></div>\n";
-		else if ($moderation == 'oui')
-			echo "<p><div align='left'>"._T('texte_demander_blocage_priori'). aide('artsyn') .
-				"</div><div align='right'> <a
-				href='sites.php3?id_syndic=$id_syndic&moderation=non'>"._T('info_annuler_blocage_priori')."</a></div>\n";
+		echo "<p><div align='$spip_lang_left'>"
+			. _T('syndic_choix_moderation') . "<br />\n";
+		afficher_choix('moderation', $moderation,
+			array(
+			'non' => _T('info_publier')
+				.' ('._T('bouton_radio_modere_posteriori').')',
+			'oui' => _T('info_bloquer')
+				.' ('._T('bouton_radio_modere_priori').')'
+			));
+
+		// Oublier les vieux liens ?
+		# appliquer les choix
+		if ($miroir == 'oui' OR $miroir == 'non')
+			spip_query("UPDATE spip_syndic SET miroir='$miroir'
+			WHERE id_syndic=$id_syndic");
+		if ($oubli == 'oui' OR $oubli == 'non')
+			spip_query("UPDATE spip_syndic SET oubli='$oubli'
+			WHERE id_syndic=$id_syndic");
+
+		echo "<p><div align='left'>"._T('syndic_choix_oublier');
+
+		# miroir
+		if (!$miroir AND !$miroir = $row['miroir']) $miroir = 'non';
+		echo "<li>"._T('syndic_option_miroir').' ';
+		afficher_choix('miroir', $miroir,
+			array('oui' => _T('item_oui'), 'non' => _T('item_non')),
+			" &nbsp; ");
+		echo "</li>\n";
+
+		# oubli
+		if (!$oubli AND !$oubli = $row['oubli']) $oubli = 'non';
+		echo "<li>"._T('syndic_option_oubli', array('mois' => 2)).' ';
+		afficher_choix('oubli', $oubli,
+			array('oui' => _T('item_oui'), 'non' => _T('item_non')),
+			" &nbsp; ");
+		echo "</li>\n";
+
+		// Bouton "Valider"
+		echo "<div style='text-align:$spip_lang_right'><INPUT TYPE='submit' NAME='Valider' VALUE='"._T('bouton_valider')."' CLASS='fondo'></div>";
+
+
+		fin_cadre_relief();
 	}
 	echo "</font>";
 }
@@ -460,8 +514,8 @@
 
 echo "<p align='left'>\n";
 
-$query_forum = "SELECT * FROM spip_forum WHERE statut='prive' AND id_syndic='$id_syndic' AND id_parent=0 ORDER BY date_heure DESC LIMIT 0,20";
-$result_forum = spip_query($query_forum);
+$result_forum = spip_query("SELECT * FROM spip_forum WHERE statut='prive'
+AND id_syndic=$id_syndic AND id_parent=0 ORDER BY date_heure DESC LIMIT 0,20");
 afficher_forum($result_forum, $forum_retour);
 
 



From stef at berlios.de  Thu Jul 21 23:47:14 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:14 +0200
Subject: [Spip-carto-cvs] spipcarto/dist mot.html,1.4,1.5 login.html,1.4,1.5 backend.html,1.3,1.4 article.html,1.4,1.5
Message-ID: <200507212147.j6LLlEqX023933@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/dist
In directory sheep:/tmp/cvs-serv22230/dist

Modified Files:
	mot.html login.html backend.html article.html 
Log Message:
synchro CVS 20050719

Index: mot.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/mot.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- mot.html	30 Jun 2005 10:09:39 -0000	1.4
+++ mot.html	21 Jul 2005 21:47:11 -0000	1.5
@@ -54,10 +54,10 @@
 
 <div class="menu">
 <div class="divers">
-<div class="menu-titre"><BOUCLE_groupe(GROUPES_MOTS) {id_groupe} {doublons}>#TITRE</BOUCLE_groupe></div>
-	<ul class="menu-liste">
-<BOUCLE_mots_freres(MOTS) {type} {doublons} {par titre}>
-	<li class="menu-item"><a href="#URL_MOT" title="[(#DESCRIPTIF|textebrut|entites_html)]">#TITRE</a></li>
+<BOUCLE_groupe(GROUPES_MOTS) {id_groupe} {doublons}><div class="menu-titre"[ title="(#DESCRIPTIF|attribut_html)"]>#TITRE</div></BOUCLE_groupe>
+<ul class="menu-liste">
+<BOUCLE_mots_freres(MOTS) {type} {par titre}>
+	<li class="menu-item"><a [(#EXPOSE{name,href})]="#URL_MOT" title="[(#DESCRIPTIF|textebrut|entites_html)]">#TITRE</a></li>
 </BOUCLE_mots_freres>
 	</ul>
 </div>
@@ -76,7 +76,7 @@
 	<ul class="menu-liste">
 <BOUCLE_groupes_freres(GROUPES_MOTS) {par titre} {doublons}>
 <BOUCLE_mot_cousin(MOTS) {id_groupe} {par titre} {0,1}>
-	<li class="menu-item"><a href="#URL_MOT">#TYPE</a></li>
+	<li class="menu-item"[ title="(#_groupes_freres:DESCRIPTIF|attribut_html)"]><a href="#URL_MOT">#TYPE</a></li>
 </BOUCLE_mot_cousin>
 </BOUCLE_groupes_freres>
 	</ul>

Index: login.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/login.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- login.html	30 Jun 2005 10:09:39 -0000	1.4
+++ login.html	21 Jul 2005 21:47:11 -0000	1.5
@@ -32,7 +32,7 @@
 	target="spip_pass" 
 	onclick="javascript:window.open(this.href, 'spip_pass', 'scrollbars=yes, resizable=yes, width=480, height=280'); return false;"><:login_motpasseoublie:></a>&#93;
 
-&#91;<a style='color: #e86519' href='#URL_SITE_SPIP'><:login_retoursitepublic:></a>&#93;
+&#91;<a style='color: #e86519' href="#URL_SITE_SPIP/"><:login_retoursitepublic:></a>&#93;
 
 </div>
 

Index: backend.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/backend.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- backend.html	30 Jun 2005 10:09:39 -0000	1.3
+++ backend.html	21 Jul 2005 21:47:11 -0000	1.4
@@ -28,7 +28,7 @@
 		<dc:format>text/html</dc:format>
 		<dc:language>#LANG</dc:language>
 		<dc:creator><BOUCLE_auteursb(AUTEURS){id_article}{", "}>[(#NOM|texte_backend)]</BOUCLE_auteursb></dc:creator>
-		<BOUCLE_podcast(DOCUMENTS){id_article}{doublons}{extension==(mp3|zip)}>[
+		<BOUCLE_podcast(DOCUMENTS){id_article}{mode=document}>[
 			<enclosure url="(#URL_DOCUMENT|url_absolue|unique)" length="[(#TAILLE)]" type="#MIME_TYPE" />]
 		</BOUCLE_podcast>
 

Index: article.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/dist/article.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- article.html	30 Jun 2005 10:09:39 -0000	1.4
+++ article.html	21 Jul 2005 21:47:11 -0000	1.5
@@ -192,7 +192,7 @@
 
 
 <BOUCLE_afficher_document(DOCUMENTS){id_document}{mode=document}{extension==(png|jpg|gif)$}{doublons}>
-<hr>
+<hr />
 [<h3 class="spip">(#TITRE)</h3>]
 [<div>(#DESCRIPTIF)</div>]
 
@@ -200,7 +200,7 @@
 </BOUCLE_afficher_document>
 
 <B_documents_portfolio>
-<div><hr>
+<div><hr />
 <BOUCLE_documents_portfolio(DOCUMENTS){id_article}{mode=document}{extension==(png|jpg|gif)$}{doublons}>
 	<div style="float: left;">
 	[<a href="#URL_ARTICLE[(#URL_ARTICLE|strpos{?}|?{&amp;,?})]id_document=#ID_DOCUMENT">(#LOGO_DOCUMENT{0,60})</a>]
@@ -212,7 +212,7 @@
 </B_documents_portfolio>
 
 <B_documents_joints>
-<div><hr>
+<div><hr />
 <BOUCLE_documents_joints(DOCUMENTS) {id_article} {mode=document} {doublons}>
 	<div style="float: left;">
 	[(#LOGO_DOCUMENT|#URL_DOCUMENT)][<div style="clear: both;"><b>(#TITRE)</b></div>][<div style="clear: both;">(#DESCRIPTIF)</div>]



From stef at berlios.de  Thu Jul 21 23:47:15 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:15 +0200
Subject: [Spip-carto-cvs] spipcarto inc-html-squel.php3,1.6,1.7 inc-urls-propres.php3,1.4,1.5 inc-balises.php3,1.7,1.8 inc-criteres.php3,1.5,1.6 inc-public.php3,1.4,1.5 carto.php3,1.5,1.6 inc-cache.php3,1.9,1.10 inc-boucles.php3,1.5,1.6 inc-compilo.php3,1.6,1.7 inc-calcul-outils.php3,1.5,1.6 inc-compilo-api.php3,1.5,1.6
Message-ID: <200507212147.j6LLlFqX023937@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv22230

Modified Files:
	inc-html-squel.php3 inc-urls-propres.php3 inc-balises.php3 
	inc-criteres.php3 inc-public.php3 carto.php3 inc-cache.php3 
	inc-boucles.php3 inc-compilo.php3 inc-calcul-outils.php3 
	inc-compilo-api.php3 
Log Message:
synchro CVS 20050719

Index: inc-html-squel.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-html-squel.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc-html-squel.php3	5 Jul 2005 00:43:56 -0000	1.6
+++ inc-html-squel.php3	21 Jul 2005 21:47:12 -0000	1.7
@@ -346,7 +346,7 @@
 			else {
 			  preg_match("/^([a-zA-Z][a-zA-Z0-9]*)[[:space:]]*(.*)$/ms", $param, $m);
 			  $op = $m[1];
-			  $v[1][0]->texte = $m[2];
+			  if ($m[2]) $v[1][0]->texte = $m[2]; else array_shift($v[1]);
 			}
 			array_shift($v);
 			$crit = new Critere;
@@ -448,16 +448,16 @@
 		$result->id_parent = $id_parent;
 
 # attention: reperer la premiere des 2 balises: pre_boucle ou boucle
-# $n == $p possible car <B est un prefixe de <BOUCLE
-		$n = strpos($texte, BALISE_PRE_BOUCLE);
 
-		if ($n === false || ($n >= $p)) {
+		$n = ereg(BALISE_PRE_BOUCLE . '[0-9_]', $texte, $r);
+		if ($n) $n = strpos($texte, $r[0]);
+		if (($n === false) || ($n > $p)) {
 		  $debut = substr($texte, 0, $p);
 		  $milieu = substr($texte, $p);
 		  $k = strpos($milieu, '(');
-		  $id_boucle = substr($milieu,
-				       strlen(BALISE_BOUCLE),
-				       $k - strlen(BALISE_BOUCLE));
+		  $id_boucle = trim(substr($milieu,
+					   strlen(BALISE_BOUCLE),
+					   $k - strlen(BALISE_BOUCLE)));
 		  $milieu = substr($milieu, $k);
 
 		  /* a adapter: si $n pointe sur $id_boucle ...
@@ -475,8 +475,9 @@
 				       strlen(BALISE_PRE_BOUCLE),
 				       $k - strlen(BALISE_PRE_BOUCLE));
 
-		  if (!($p = strpos($milieu, BALISE_BOUCLE . $id_boucle . "(")))
+		  if (!ereg(BALISE_BOUCLE . $id_boucle . "[[:space:]]*\(", $milieu, $r))
 		    erreur_squelette((_T('zbug_erreur_boucle_syntaxe')), $id_boucle);
+		  $p = strpos($milieu, $r[0]);
 		  $result->avant = substr($milieu, $k+1, $p-$k-1);
 		  $milieu = substr($milieu, $p+strlen($id_boucle)+strlen(BALISE_BOUCLE));
 		}

Index: inc-urls-propres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-urls-propres.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-urls-propres.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ inc-urls-propres.php3	21 Jul 2005 21:47:12 -0000	1.5
@@ -211,7 +211,10 @@
 
 	$url_propre = $GLOBALS['_SERVER']['REDIRECT_url_propre'];
 	if (!$url_propre) $url_propre = $GLOBALS['HTTP_ENV_VARS']['url_propre'];
-	if (!$url_propre) $url_propre = substr($url, strrpos($url, '/') + 1);
+	if (!$url_propre) {
+		$url = substr($url, strrpos($url, '/') + 1);
+		$url_propre = preg_replace(',[?].*,', '', $url);
+	}
 	if (!$url_propre) return;
 
 	// Compatilibite avec propres2

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc-balises.php3	30 Jun 2005 10:09:36 -0000	1.7
+++ inc-balises.php3	21 Jul 2005 21:47:12 -0000	1.8
@@ -43,7 +43,7 @@
 		'NOM_SITE_SPIP' => 'typo(%s)',
 		'NOM_SITE' => 'typo(%s)',
 		'NOM' => 'typo(%s)',
-		'PARAMETRES_FORUM' => 'htmlspecialchars(%s)',
+		'PARAMETRES_FORUM' => 'htmlspecialchars(lang_parametres_forum(%s))',
 		'PS' => 'traiter_raccourcis(%s)',
 		'SOUSTITRE' => 'typo(%s)',
 		'SURTITRE' => 'typo(%s)',
@@ -773,8 +773,10 @@
 	return ajouter_invalideur($type, $valeur, $code);
 }
 
-// reference a l'URL de la page courante
-
+// Reference a l'URL de la page courante
+// Attention dans un INCLURE() ou une balise dynamique on n'a pas le droit de
+// mettre en cache #SELF car il peut correspondre a une autre page (attaque XSS)
+// http://www.spip.net/@self
 function balise_SELF_dist($p) {
 	$p->code = 'quote_amp($GLOBALS["clean_link"]->getUrl())';
 	$p->statut = 'php';

Index: inc-criteres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-criteres.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-criteres.php3	30 Jun 2005 10:09:36 -0000	1.5
+++ inc-criteres.php3	21 Jul 2005 21:47:12 -0000	1.6
@@ -53,7 +53,6 @@
 // attention: boucle->doublons designe une variable qu'on affecte
 function critere_doublons_dist($idb, &$boucles, $crit) {
 	$boucle = &$boucles[$idb];
-	$NOT_IN = $crit->not ? '' : 'NOT';
 	$boucle->where[] = '" .' .
 	  "calcul_mysql_in('".$boucle->id_table . '.' . $boucle->primary .
 	  "', " .
@@ -64,8 +63,9 @@
 	  "' . " .
 	  calculer_liste($crit->param[0], array(), $boucles, $boucles[$idb]->id_parent) .
 	  ')], \'' . 
-	  $NOT_IN . 
-	  " ') . \"";
+	  ($crit->not ? '' : 'NOT') .
+	  "') . \"";
+	if ($crit->not) $boucle->doublons = "";
 }
 
 // {lang_select}
@@ -108,24 +108,6 @@
 
 }
 
-// {inverse}
-// http://www.spip.net/@inverse
-function critere_inverse_dist($idb, &$boucles, $crit) {
-	$param = $crit->op;
-	$not = $crit->not;
-	$boucle = &$boucles[$idb];
-	// Classement par ordre inverse
-
-	if (!$not) {
-		if ($boucle->order)
-			$boucle->order .= ".' DESC'";
-		else 
-			erreur_squelette(_T('zbug_inversion_ordre_inexistant'), 
-			"BOUCLE" . $idb);
-	} else
-		erreur_squelette(_T('zbug_info_erreur_squelette'), "{$param} BOUCLE$idb");
-}
-
 // {traduction}
 // http://www.spip.net/@traduction
 //   (id_trad>0 AND id_trad=id_trad(precedent))
@@ -196,52 +178,64 @@
 // Tri : {par xxxx}
 // http://www.spip.net/@par
 function critere_par_dist($idb, &$boucles, $crit) {
+  critere_parinverse($idb, $boucles, $crit, '') ;
+}
+
+function critere_parinverse($idb, &$boucles, $crit, $sens) {
 
-	$not = $crit->not;
 	$boucle = &$boucles[$idb];
-	if ($not)
+	if ($crit->not)
 		erreur_squelette(_T('zbug_info_erreur_squelette'), $param);
 
 	$params = $crit->param;
 
 	foreach ($params as $tri) {
+
 	// tris specifies dynamiquement
-	    if ($tri[0]->type != 'texte')
-	      $order = calculer_liste($tri, array(), $boucles, $boucles[$idb]->id_parent);
+	  if ($tri[0]->type != 'texte') {
+	      $order = 
+		calculer_liste($tri, array(), $boucles, $boucles[$idb]->id_parent);
+	      $order =
+		"((\$x = preg_replace(\"/\\W/\",'',$order)) ? ('$boucle->id_table.' . \$x$sens) : '')";
+	  }
 	    else {
-	      // on considere que {par   col#ENV{num}} est imposible
-	      $tri = $tri[0]->texte;
+	      $par = array_shift($tri);
+	      $par = $par->texte;
 	// par hasard
-		if ($tri == 'hasard') {
+		if ($par == 'hasard') {
 		// tester si cette version de MySQL accepte la commande RAND()
 		// sinon faire un gloubi-boulga maison avec de la mayonnaise.
 		  if (spip_query("SELECT RAND()"))
-			$tri = "RAND()";
+			$par = "RAND()";
 		  else
-			$tri = "MOD(".$boucle->id_table.'.'.$boucle->primary
+			$par = "MOD(".$boucle->id_table.'.'.$boucle->primary
 			  ." * UNIX_TIMESTAMP(),32767) & UNIX_TIMESTAMP()";
-		  $boucle->select[]= $tri . " AS alea";
+		  $boucle->select[]= $par . " AS alea";
 		  $order = "'alea'";
 		}
 
 	// par titre_mot
-		else if ($tri == 'titre_mot') {
+		else if ($par == 'titre_mot') {
 		  $order= "'mots.titre'";
 		}
 
 	// par type_mot
-		else if ($tri == 'type_mot'){
+		else if ($par == 'type_mot'){
 		  $order= "'mots.type'";
 		}
 	// par num champ(, suite)
-		else if (ereg("^num[[:space:]]+(.*)$",$tri, $match2)) {
-		  $boucle->select[] = "0+".$boucle->id_table.".".$match2[1]." AS num";
-		  $order = "'num'";
+		else if (ereg("^num[[:space:]]*(.*)$",$par, $m)) {
+		  $texte = '0+' . $boucle->id_table . '.' . trim($m[1]);
+		  $suite = calculer_liste($tri, array(), $boucles, $boucle->id_parent);
+		  if ($suite !== "''")
+		    $texte = "\" . ((\$x = $suite) ? ('$texte' . \$x) : '0')" . " . \"";
+		  $as = 'num' .($boucle->order ? count($boucle->order) : "");
+		  $boucle->select[] = $texte . " AS $as";
+		  $order = "'$as'";
 	}
 	// par champ. Verifier qu'ils sont presents.
-		else
-		  if (ereg("^[a-z][a-z0-9_]*$", $tri)) {
-		    if ($tri == 'date')
+		elseif (ereg("^[a-z][a-z0-9_]*$", $par)) {
+		    if ($par == 'date')
 		      $order = "'".$boucle->id_table.".".
 			$GLOBALS['table_date'][$boucle->type_requete]
 			."'";
@@ -254,21 +248,43 @@
 			// pour les tables non Spip
 			if (!$t) $t = $r; else $t = "spip_$t";
 			$desc = $tables_des_serveurs_sql[$s][$t];
-			if ($desc['field'][$tri])
-				$order = "'".$boucle->id_table.".".$tri."'";
+			if ($desc['field'][$par])
+				$order = "'".$boucle->id_table.".".$par."'";
 			else {
 			  // tri sur les champs synthetises (cf points)
-				$order = "'".$tri."'";
+				$order = "'".$par."'";
 			}
-		  }
-		}
+		    }
+		} else
+		    erreur_squelette(_T('zbug_info_erreur_squelette'), "{par $par} BOUCLE$idb");
 	    }
-	// au final, gestion des tris multiples
-		if ($order) {
-		  if ($boucle->order) $boucle->order .= '.",".';
-		  $boucle->order .= $order;
-		}
+
+	    if ($order)
+	      $boucle->order[] = $order . (($order[0]=="'") ? $sens : "");
+	  }
+}
+
+
+// {inverse}
+// http://www.spip.net/@inverse
+// ancienne spec si pas d'argument, nouvelle sinon
+function critere_inverse_dist($idb, &$boucles, $crit) {
+
+	$boucle = &$boucles[$idb];
+	// Classement par ordre inverse
+
+	if ($crit->not || $crit->param)
+		critere_parinverse($idb, $boucles, $crit, " . ' DESC'");
+	else
+	  {
+	    $n = count($boucle->order);
+	    if ($n)
+	      $boucle->order[$n-1] .= " . ' DESC'";
+	    else
+	      erreur_squelette(_T('zbug_info_erreur_squelette'), "{inverse ?} BOUCLE$idb");
 	  }
+
+
 }
 
 function critere_agenda($idb, &$boucles, $crit)
@@ -558,7 +574,7 @@
 	      if ($crit->not) {
 		$where = "NOT ($where)";
 	      } else {
-			$boucle->default_order = 'rang';
+			$boucle->default_order = array('rang');
 			$boucle->select[]= "FIND_IN_SET($ct, \\\"'\" . " . $val . ' . "\'\\") AS rang';
 	      }
 	    } else {
@@ -646,9 +662,16 @@
 }
 
 function calculer_param_date($date_compare, $date_orig) {
+	if (ereg("'\" *\.(.*)\. *\"'", $date_compare, $r)) {
+	  $init = "'\" . (\$x = $r[1]) . \"'";
+	  $date_compare = '\'$x\'';
+	}
+	else
+	  $init = $date_compare;
+
 	return
 	"LEAST((UNIX_TIMESTAMP(" .
-	$date_compare .
+	$init .
 	")-UNIX_TIMESTAMP(" .
 	$date_orig .
 	"))/86400,\n\tTO_DAYS(" .

Index: inc-public.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-public.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-public.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ inc-public.php3	21 Jul 2005 21:47:12 -0000	1.5
@@ -91,14 +91,11 @@
 	if (trim($page) AND $xhtml AND !$flag_preserver AND !headers_sent()) {
 		if ($xhtml === true) $xhtml = 'tidy';
 		$file = 'inc_' . $xhtml. ".php";
-		spip_log(_DIR_RESTREINT . $file);
-		if (is_readable(_DIR_RESTREINT . $file))
-		  include_ecrire($file);
+#		spip_log(_DIR_RESTREINT . $file);
+		if (is_readable(_DIR_RESTREINT . $file)) { include_ecrire($file); }
 		if (function_exists($xhtml))
-		  {
 			$page = $xhtml($page);
-		  }
-		elseif (function_exists('xhtml'))
+		else if (function_exists('xhtml'))
 			$page = xhtml($page);
 	}
 

Index: carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- carto.php3	1 Jul 2005 07:05:31 -0000	1.5
+++ carto.php3	21 Jul 2005 21:47:12 -0000	1.6
@@ -5,18 +5,20 @@
 
 // Securite : le squelette *doit* exister dans squelettes/
 // voir si 
-	if ((strstr($contexte_inclus['fond'], '..'))||(strstr($_GET['fond'], '..'))
-		) {
-		die ("Faut pas se gener");
-	}
-
-// cette ligne empeche l'affichage des boutons d'administration
-// Et les headers !!!! 
 $flag_preserver = true;
 
-
-if (isset($contexte_inclus['fond'])) $fond = $rep_fond."/carto_".$contexte_inclus['fond'];
-else if (isset($_GET["fond"])&&($_GET["fond"]!="")) $fond = $rep_fond."/carto_".$_GET["fond"];
+if (isset($contexte_inclus['fond'])) {
+	if (strstr($contexte_inclus['fond'], '..'))
+		die ("Faut pas se gener");
+	else
+		$fond = $rep_fond."/carto_".$contexte_inclus['fond'];
+}
+else if (isset($_GET["fond"])&&($_GET["fond"]!="")) {
+	if (strstr($_GET['fond'], '..'))
+		die ("Faut pas se gener");
+	else	
+		$fond = $rep_fond."/carto_".$_GET["fond"];
+}
 else $fond = $rep_fond."/carto";
 if (isset($contexte_inclus['delais'])) $delais = $contexte_inclus['delais'];
 

Index: inc-cache.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-cache.php3,v
retrieving revision 1.9
retrieving revision 1.10
diff -u -d -r1.9 -r1.10
--- inc-cache.php3	30 Jun 2005 10:09:36 -0000	1.9
+++ inc-cache.php3	21 Jul 2005 21:47:12 -0000	1.10
@@ -198,20 +198,21 @@
 
 // Determination du fichier cache (si besoin)
 function determiner_cache($delais, &$use_cache, &$chemin_cache) {
-	global $_POST;
+	global $_SERVER;
+
+	$post = ($_SERVER['REQUEST_METHOD'] == 'POST');
 
 	// Le fichier cache est-il valide ?
-	$use_cache = ($delais != 0 and !count($_POST));
-	if ($use_cache)	$use_cache = utiliser_cache($chemin_cache, $delais);
+	if ($delais<>0 AND !$post)
+		$use_cache = utiliser_cache($chemin_cache, $delais);
 
 	// Sinon, tester qu'on a la connexion a la base
 	if (!$use_cache) {
 		include_local(_FILE_CONNECT);
 		if (!$GLOBALS['db_ok']) {
 			if (@file_exists($chemin_cache)) 
-			  $use_cache = 1; // passer outre
-			else
-			  {
+				$use_cache = 1; // passer outre
+			else {
 				spip_log("Erreur base de donnees & "
 					. "impossible utiliser $chemin_cache");
 				if (!$GLOBALS['flag_preserver']) {
@@ -231,6 +232,13 @@
 				define ('spip_interdire_cache', true);
 			  }
 		}
+
+		// En cas de POST (et si la connexion est ok) supprimer le cache
+		// histoire de faciliter la gestion de certaines balises dynamiques
+		else if ($post AND $chemin_cache) {
+			supprimer_fichier($chemin_cache);
+		}
+
 	}
 }
 

Index: inc-boucles.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-boucles.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-boucles.php3	5 Jul 2005 00:43:55 -0000	1.5
+++ inc-boucles.php3	21 Jul 2005 21:47:12 -0000	1.6
@@ -233,7 +233,7 @@
 	// $hierarchie sera calculee par une fonction de inc-calcul-outils
 	$boucle->where[] = 'id_rubrique IN ($hierarchie)';
 	$boucle->select[] = 'FIND_IN_SET(id_rubrique, \'$hierarchie\')-1 AS rang';
-	$boucle->default_order = 'rang';
+	$boucle->default_order = array('rang');
 	$boucle->hierarchie = '$hierarchie = calculer_hierarchie('
 	. calculer_argument_precedent($boucle->id_boucle, 'id_rubrique', $boucles)
 	. ', '

Index: inc-compilo.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-compilo.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- inc-compilo.php3	5 Jul 2005 00:43:56 -0000	1.6
+++ inc-compilo.php3	21 Jul 2005 21:47:12 -0000	1.7
@@ -215,7 +215,7 @@
 
 	if (!$order = $boucle->order
 	AND !$order = $boucle->default_order)
-		$order = "''";
+		$order = array();
 
 	$init .= $boucle->hash . 
 	  "\n\n	// REQUETE
@@ -237,7 +237,9 @@
 		"', $boucle->where) . '"')) .
 		"), # WHERE
 		'".addslashes($boucle->group)."', # GROUP
-		" . $order .", # ORDER
+		array(" .
+	  	join(', ', $order) .
+		"), # ORDER
 		" . (strpos($boucle->limit, 'intval') === false ?
 			"'".$boucle->limit."'" :
 			$boucle->limit). ", # LIMIT
@@ -253,10 +255,7 @@
 		$init .= "\n	\$Numrows['$id_boucle']['compteur_boucle'] = 0;";
 
 	if ($boucle->mode_partie)
-		$init .= calculer_parties($boucle->partie,
-			$boucle->mode_partie,
-			$boucle->total_parties,
-			$id_boucle);
+		$init .= calculer_parties($boucles, $id_boucle);
 	else if ($boucle->numrows)
 		$init .= "\n	\$Numrows['" .
 			$id_boucle .
@@ -286,7 +285,12 @@
 // fonction traitant les criteres {1,n} (analyses dans inc-criteres)
 //
 ## a deplacer dans inc-criteres ??
-function calculer_parties($partie, $mode_partie, $total_parties, $id_boucle) {
+function calculer_parties($boucles, $id_boucle) {
+
+	$boucle = &$boucles[$id_boucle];
+	$partie = $boucle->partie;
+	$mode_partie = $boucle->mode_partie;
+	$total_parties = $boucle->total_parties;
 
 	// Notes :
 	// $debut_boucle et $fin_boucle sont les indices SQL du premier

Index: inc-calcul-outils.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-calcul-outils.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-calcul-outils.php3	30 Jun 2005 10:09:36 -0000	1.5
+++ inc-calcul-outils.php3	21 Jul 2005 21:47:12 -0000	1.6
@@ -233,8 +233,7 @@
 				array('spip_rubriques AS rubriques'),
 				array(calcul_mysql_in('id_parent', 
 					$generation,
-					'')),
-				'','','','','','','');
+						      '')));
 	while ($row = spip_abstract_fetch($result))
 		$lesfils[] = $row['id_rubrique'];
 	return join(",",$lesfils);
@@ -407,7 +406,7 @@
 				'spip_auteurs_articles AS lien'), 
 			array("lien.id_article=$id_article",
 				"auteurs.id_auteur=lien.id_auteur"),
-			'','','','',1, 
+			'',array(),'','',1, 
 			$table, $id_boucle, $serveur);
 
 		while($row_auteur = spip_abstract_fetch($result_auteurs, $serveur)) {
@@ -428,7 +427,7 @@
 		array('texte'),
 		array('spip_petitions'),
 		array("id_article=".intval($id_article)),
-		'','','','',1, 
+		'',array(),'','',1, 
 		$table, $id_boucle, $serveur);
 
 	if (!$retour) return '';
@@ -511,6 +510,26 @@
 			$lang = $row['lang'];
 		return array($id_rubrique_fond, $lang);
 	}
+}
+
+// Ajouter "&lang=..." si la langue de base n'est pas celle du site
+function lang_parametres_forum($s) {
+
+	// ne pas se fatiguer si le site est unilingue (plus rapide)
+	if (strstr(lire_meta('langues_utilisees'), ',')
+	// chercher l'identifiant qui nous donnera la langue
+	AND preg_match(',id_(article|breve|rubrique|syndic)=([0-9]+),', $s, $r)){
+		$objet = $r[1];
+		$id = $r[2];
+		list($lang) = spip_fetch_array(spip_query(
+			"SELECT lang FROM spip_${objet}s WHERE id_$objet=$id"
+		));
+		// Si ce n'est pas la meme que celle du site, l'ajouter aux parametres
+		if ($lang AND $lang <> lire_meta('langue_site'))
+			$s .= "&lang=$lang";
+	}
+
+	return $s;
 }
 
 ?>

Index: inc-compilo-api.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-compilo-api.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- inc-compilo-api.php3	30 Jun 2005 10:09:36 -0000	1.5
+++ inc-compilo-api.php3	21 Jul 2005 21:47:12 -0000	1.6
@@ -59,7 +59,7 @@
 	var $having = 0;
 	var $limit;
 	var $group = '';
-	var $order = '';
+	var $order = array();
 	var $default_order = '';
 	var $date = 'date' ;
 	var $hash = "" ;
@@ -138,9 +138,6 @@
 global $tables_des_serveurs_sql, $tables_principales; // (voir inc_serialbase)
 global $exceptions_des_tables, $table_des_tables;
 global $tables_relations,  $table_primary, $table_date;
-
-$tables_des_serveurs_sql['localhost'] =  &$tables_principales;
-	
 
  // champ principal des tables SQL
 $table_primary['articles']="id_article";



From stef at berlios.de  Thu Jul 21 23:47:14 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:47:14 +0200
Subject: [Spip-carto-cvs] spipcarto/formulaires formulaire_signature.html,1.4,1.5 formulaire_inscription.html,1.3,1.4 formulaire_site.html,1.3,1.4 formulaire_login.html,1.3,1.4 formulaire_forum_previsu.html,1.1,1.2 inc-formulaire_forum.php3,1.4,1.5 formulaire_admin.html,1.4,1.5 inc-formulaire_site.php3,1.3,1.4 inc-formulaire_signature.php3,1.3,1.4 inc-formulaire_admin.php3,1.3,1.4 inc-formulaire_inscription.php3,1.4,1.5 inc-login_public.php3,1.4,1.5
Message-ID: <200507212147.j6LLlEqX023935@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/formulaires
In directory sheep:/tmp/cvs-serv22230/formulaires

Modified Files:
	formulaire_signature.html formulaire_inscription.html 
	formulaire_site.html formulaire_login.html 
	formulaire_forum_previsu.html inc-formulaire_forum.php3 
	formulaire_admin.html inc-formulaire_site.php3 
	inc-formulaire_signature.php3 inc-formulaire_admin.php3 
	inc-formulaire_inscription.php3 inc-login_public.php3 
Log Message:
synchro CVS 20050719

Index: formulaire_signature.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_signature.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- formulaire_signature.html	30 Jun 2005 10:09:35 -0000	1.4
+++ formulaire_signature.html	21 Jul 2005 21:47:12 -0000	1.5
@@ -1,4 +1,4 @@
-<form method='post' action='#SELF#sp[(#ENV{id_article})]'>
+<form method='post' action="[(#ENV{self})][#sp(#ENV{id_article})]">
 <input type="hidden" name="url_page" value="#URL_SITE_SPIP/#SELF" />
 <div class='spip_encadrer' style='color: black; font-size: 80%; font-weight: normal;'>
 [(#ENV*{texte}|propre)]

Index: formulaire_inscription.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_inscription.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- formulaire_inscription.html	30 Jun 2005 10:09:35 -0000	1.3
+++ formulaire_inscription.html	21 Jul 2005 21:47:12 -0000	1.4
@@ -8,7 +8,7 @@
  (#ENV{mode}|=={redac}|?{' ',''})
 	<:pass_espace_prive_bla:><br /><br />
 ]<:form_forum_indiquer_nom_email:>
- <form	id="inscription" method='post' action='#SELF'
+ <form	id="inscription" method='post' action="[(#ENV{self})]"
 	style='border: 0px; margin: 0px;'> 
       <fieldset style="border: none; font-weight: bold">
 	<legend><:form_forum_identifiants:></legend>

Index: formulaire_site.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_site.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- formulaire_site.html	30 Jun 2005 10:09:35 -0000	1.3
+++ formulaire_site.html	21 Jul 2005 21:47:12 -0000	1.4
@@ -1,4 +1,4 @@
-<form action="#SELF" method="post">
+<form action="[(#ENV{self})]" method="post">
       <br />
       <fieldset	class='spip_encadrer' style='color: black; font-size: 90%'>
 	<legend><:info_site:></legend>

Index: formulaire_login.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_login.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- formulaire_login.html	30 Jun 2005 10:09:35 -0000	1.3
+++ formulaire_login.html	21 Jul 2005 21:47:12 -0000	1.4
@@ -27,7 +27,7 @@
 	alt="[(#ENV{login_alt})]" /></div>]
 	<input type="hidden" name="session_login_hidden" value="(#ENV{login})" />
 <script type="text/javascript"><!--
-document.write("<:login_login:>&nbsp;<strong>[(#ENV{login_alt})]<" + "/strong><br />&#91;<a style='color: #e86519' href='spip_cookie.php3?cookie_admin=non[&amp;url=(#ENV{url})][&amp;retour=(#SELF|urlencode)]'><font size='2'><:login_autre_identifiant:><" + "/font><" + "/a>&#93;")
+document.write("<:login_login:>&nbsp;<strong>[(#ENV{login_alt})]<" + "/strong><br />&#91;<a style='color: #e86519' href='spip_cookie.php3?cookie_admin=non[&amp;url=(#ENV{url})][&amp;retour=(#ENV{self}|urlencode)]'><font size='2'><:login_autre_identifiant:><" + "/font><" + "/a>&#93;")
 //--></script>
 <noscript>
 	<p class='notes' style='font-size: 130%'>

Index: formulaire_forum_previsu.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_forum_previsu.html,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- formulaire_forum_previsu.html	20 Feb 2005 22:13:52 -0000	1.1
+++ formulaire_forum_previsu.html	21 Jul 2005 21:47:12 -0000	1.2
@@ -8,7 +8,7 @@
 
 [<p />(#ENV*{texte})]
 
-[<p /><a [href="(#ENV{url_site}|urlencode)"]>(#ENV*{nom_site_forum})</a>]
+[<p /><a [href="(#ENV{url_site}|attribut_html)"]>(#ENV*{nom_site_forum})</a>]
 
 [(#ENV*{mots_forum})]
 

Index: inc-formulaire_forum.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_forum.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-formulaire_forum.php3	30 Jun 2005 10:09:35 -0000	1.4
+++ inc-formulaire_forum.php3	21 Jul 2005 21:47:12 -0000	1.5
@@ -296,7 +296,7 @@
 	$in_group = " AND id_groupe IN (" . join($afficher_groupe, ", ") .")";
 
 	$result_groupe = spip_query("SELECT * FROM spip_groupes_mots
-	WHERE 6forum = 'oui' AND $table = 'oui'". $in_group);
+	WHERE forum = 'oui' AND $table = 'oui'". $in_group);
 
 	$ret = '';
 	while ($row_groupe = spip_fetch_array($result_groupe)) {

Index: formulaire_admin.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/formulaire_admin.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- formulaire_admin.html	30 Jun 2005 10:09:35 -0000	1.4
+++ formulaire_admin.html	21 Jul 2005 21:47:12 -0000	1.5
@@ -1,5 +1,5 @@
 <div [class="(#ENV{divclass})" ]dir='#LANG_DIR'>[
-	<a href='(#ENV{analyser})' class='spip-admin-boutons'><:Analyser:>[(#ENV{xhtml_error}?{' *',''})]</a>][
+	<a href='(#ENV{analyser})' class='spip-admin-boutons'><:analyse_xml:>[(#ENV{xhtml_error}?{' *',''})]</a>][
 	<a href='ecrire/articles.php3?id_article=(#ENV{id_article})' class='spip-admin-boutons'><:admin_modifier_article:> ([(#ENV{id_article})])</a>][
 	<a href='ecrire/breves_voir.php3?id_breve=(#ENV{id_breve})' class='spip-admin-boutons'><:admin_modifier_breve:> ([(#ENV{id_breve})])</a>][
 	<a href='ecrire/naviguer.php3?id_rubrique=(#ENV{id_rubrique})' class='spip-admin-boutons'><:admin_modifier_rubrique:> ([(#ENV{id_rubrique})])</a>][

Index: inc-formulaire_site.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_site.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc-formulaire_site.php3	3 Mar 2005 14:53:17 -0000	1.3
+++ inc-formulaire_site.php3	21 Jul 2005 21:47:12 -0000	1.4
@@ -21,7 +21,10 @@
 
 function balise_FORMULAIRE_SITE_dyn($id_rubrique) {
 
-	if (!_request('nom_site')) return array('formulaire_site', 0);
+	if (!_request('nom_site'))
+		return array('formulaire_site', $GLOBALS['delais'],
+			array('self' => $GLOBALS["clean_link"]->getUrl()
+		));
 
 	// Tester le nom du site
 	if (strlen (_request('nom_site')) < 2){

Index: inc-formulaire_signature.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_signature.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc-formulaire_signature.php3	3 Mar 2005 14:53:17 -0000	1.3
+++ inc-formulaire_signature.php3	21 Jul 2005 21:47:12 -0000	1.4
@@ -65,7 +65,8 @@
 			'petition' => $petition,
 			'texte' => $texte,
 			'site_obli' => $site_obli,
-			'message' => $message
+			'message' => $message,
+			'self' => $GLOBALS["clean_link"]->getUrl()
 		));
 	}
 }

Index: inc-formulaire_admin.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_admin.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc-formulaire_admin.php3	30 Jun 2005 10:09:35 -0000	1.3
+++ inc-formulaire_admin.php3	21 Jul 2005 21:47:12 -0000	1.4
@@ -93,7 +93,7 @@
 	$analyser = !$xhtml ? "" :
 	  (($xhtml === 'spip_sax') ?
 	   ($action . "var_mode=debug&var_mode_affiche=validation") :
-	   $xhtml_check); // cas tidy
+	   $GLOBALS['xhtml_check']); // cas tidy
 	// hack - ne pas avoir la rubrique si un autre bouton est deja present
 	if ($id_article OR $id_breve) unset ($id_rubrique);
 

Index: inc-formulaire_inscription.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_inscription.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-formulaire_inscription.php3	30 Jun 2005 10:09:35 -0000	1.4
+++ inc-formulaire_inscription.php3	21 Jul 2005 21:47:12 -0000	1.5
@@ -21,99 +21,102 @@
 	// Si une inscription est autorisee, on enregistre le demandeur
 	// comme 'nouveau' et on lui envoie ses codes par email ; lors de
 	// sa premiere connexion il obtiendra son statut final (auth->activer())
-	if (($mode == 'redac' AND lire_meta('accepter_inscriptions') == 'oui')
+	if (!(($mode == 'redac' AND lire_meta('accepter_inscriptions') == 'oui')
 	OR ($mode == 'forum' AND (
 		lire_meta('accepter_visiteurs') == 'oui'
 		OR lire_meta('forums_publics') == 'abo'
 		)
-	))
-		$statut = 'nouveau';
-	else
+	    )))
 		return _T('pass_rien_a_faire_ici');
 
 	// recuperer les donnees envoyees
-	$mail_inscription = _request('mail_inscription');
+	$mail_inscription = trim(_request('mail_inscription'));
 	$nom_inscription = _request('nom_inscription');
 
-	if (test_mail_ins($mode, $mail_inscription)
-	AND _request('nom_inscription')) {
-		// envoyer les identifiants si l'abonne n'existe pas deja.
-		$s = spip_query("SELECT statut, id_auteur, login, pass
-		FROM spip_auteurs WHERE email='".addslashes($mail_inscription)."'");
-		if (!$row = spip_fetch_array($s)) {
-			$login = test_login($nom_inscription, $mail_inscription);
-			$id_auteur = spip_abstract_insert('spip_auteurs', 
-				'(nom, email, login, statut)',
-				"('".addslashes($nom_inscription)."',
-				'".addslashes($mail_inscription)."', '$login', '$statut')");
-			$pass = creer_pass_pour_auteur($id_auteur);
-			$message = envoyer_inscription($mail_inscription,
-				$statut, $mode, $login, $pass, $nom_inscription);
-		}
-
-		else {
-			// existant mais encore muet, renvoyer les infos
-			if ($row['statut'] == 'nouveau') {
-				// recreer le pass
-				$pass = creer_pass_pour_auteur($row['id_auteur']);
-				$message = envoyer_inscription(
-					$mail_inscription, $row['statut'], $mode,
-					$row['login'], $pass, $nom_inscription);
-			} else {
-				// dead
-				if ($row['statut'] == '5poubelle')
-					$message = _T('form_forum_access_refuse');
-				// deja inscrit
-				else
-					$message = _T('form_forum_email_deja_enregistre');
-			}
-		}
-	}
-
-	// demande du formulaire
-	else {
-		if (!$nom_inscription) 
-			$message = '';
-		else {
-			spip_log("Mail incorrect: '$mail_inscription'");
-			$message = _T('info_email_invalide');
-		}
-	}
+	if (!$nom_inscription) 
+		$message = '';
+	elseif (!test_mail_ins($mode, $mail_inscription))
+		$message = _T('info_email_invalide');
+	else	$message = message_inscription($mail_inscription,
+					       $nom_inscription,
+					       false,
+					       ($mode == 'forum')  ?
+					       'form_forum_voici1' :
+					       'form_forum_voici2');
 
-	return array("formulaire_inscription", 0,
-		array('focus' => $focus,
-			'target' => _request('target'),
-			'message' => $message,
-			'mode' => $mode));
+	return array("formulaire_inscription", $GLOBALS['delais'],
+			array('focus' => $focus,
+				'target' => _request('target'),
+				'message' => $message,
+				'mode' => $mode,
+				'self' => $GLOBALS["clean_link"]->getUrl()
+				));
 }
 
 // fonction qu'on peut redefinir pour filtrer selon l'adresse mail
 // cas general: controler juste que l'adresse n'est pas vide et est valide
 
 function test_mail_ins($mode, $mail) {
-	if ($mail = trim($mail))
-		return email_valide($mail);
+	return  ($mail = trim($mail)) AND email_valide($mail);
+}
+
+// creer un nouvel utilisateur et lui envoyer un mail avec ses identifiants
+
+function message_inscription($mail_inscription, $nom_inscription, $force, $mode)
+{
+
+  $row = spip_fetch_array(spip_query("SELECT statut, id_auteur, login
+FROM spip_auteurs WHERE email='".addslashes($mail_inscription)."'"));
+
+  if (!$row) {
+  // il n'existe pas, creer les identifiants 
+    $login = test_login($nom_inscription, $mail_inscription);
+    $pass = creer_pass_pour_auteur(spip_abstract_insert('spip_auteurs', 
+				'(nom, email, login, statut)',
+				"('".
+				addslashes($nom_inscription) .
+				"', '".
+				addslashes($mail_inscription) .
+				"', '" .
+				$login .
+				"', 'nouveau')"));
+
+    return envoyer_inscription($mail_inscription, 'nouveau', $mode, $login, $pass, $nom_inscription);
+  } else {
+	// existant mais encore muet, ou ressucite: renvoyer les infos
+    if ((($row['statut'] == 'nouveau') && !$force) ||
+	(($row['statut'] == '5poubelle') && $force)) {
+      // recreer le pass
+      $pass = creer_pass_pour_auteur($row['id_auteur']);
+      return envoyer_inscription($mail_inscription, $row['statut'], $mode,
+				     $row['login'], $pass, $nom_inscription);
+    } else {
+      // irrecuperable
+      if ($row['statut'] == '5poubelle')
+	return_T('form_forum_access_refuse');
+      else
+      // deja inscrit
+	return _T('form_forum_email_deja_enregistre');
+    }
+  }
 }
 
 
 // envoyer identifiants par mail
-function envoyer_inscription($mail, $statut, $type, $login, $pass, $nom) {
+function envoyer_inscription($mail, $statut, $mode, $login, $pass, $nom) {
 	$nom_site_spip = lire_meta("nom_site");
 	$adresse_site = lire_meta("adresse_site");
 	
 	$message = _T('form_forum_message_auto')."\n\n"
-	._T('form_forum_bonjour', array('nom'=>$nom))."\n\n";
-	if ($type == 'forum') {
-		$message .= _T('form_forum_voici1', array('nom_site_spip' => $nom_site_spip, 'adresse_site' => $adresse_site)) . "\n\n";
-	} else {
-		$message .= _T('form_forum_voici2', array('nom_site_spip' => $nom_site_spip, 'adresse_site' => $adresse_site)) . "\n\n";
-	}
-	$message .= "- "._T('form_forum_login')." $login\n";
-	$message .= "- "._T('form_forum_pass')." $pass\n\n";
+	  . _T('form_forum_bonjour', array('nom'=>$nom))."\n\n"
+	  . _T($mode, array('nom_site_spip' => $nom_site_spip, 'adresse_site' => $adresse_site)) . "\n\n"
+	  . "- "._T('form_forum_login')." $login\n"
+	  . "- "._T('form_forum_pass')." $pass\n\n";
 
 	include_ecrire("inc_mail.php3");
 	if (envoyer_mail($mail,
-	"[$nom_site_spip] "._T('form_forum_identifiants'), $message))
+			 "[$nom_site_spip] "._T('form_forum_identifiants'),
+			 $message))
 		return _T('form_forum_identifiant_mail');
 	else
 		return _T('form_forum_probleme_mail');
@@ -142,9 +145,7 @@
 	$login = $login_base;
 
 	for ($i = 1; ; $i++) {
-		$s = spip_query("SELECT id_auteur FROM spip_auteurs
-		WHERE login='$login'");
-		if (!spip_num_rows($s))
+	  if (!spip_num_rows(spip_query("SELECT id_auteur FROM spip_auteurs WHERE login='$login' LIMIT 1")))
 			return $login;
 		$login = $login_base.$i;
 	}

Index: inc-login_public.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-login_public.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- inc-login_public.php3	30 Jun 2005 10:09:35 -0000	1.4
+++ inc-login_public.php3	21 Jul 2005 21:47:12 -0000	1.5
@@ -128,7 +128,7 @@
 	if (_request('var_erreur') == 'pass')
 		$erreur = _T('login_erreur_pass');
 
-	return array('formulaire_login', 0, 
+	return array('formulaire_login', $GLOBALS['delais'],
 		array_merge(
 				array_map('texte_script', $row),
 				array(
@@ -139,7 +139,8 @@
 					'auth_http' => $auth_http,
 					'echec_cookie' => ($echec_cookie ? ' ' : ''),
 					'login' => $login,
-					'login_alt' => ($login_alt ? $login_alt : $login)
+					'login_alt' => ($login_alt ? $login_alt : $login),
+					'self' => $GLOBALS["clean_link"]->getUrl()
 					)
 				)
 			);



From stef at berlios.de  Thu Jul 21 23:52:49 2005
From: stef at berlios.de (stef at berlios.de)
Date: Thu, 21 Jul 2005 23:52:49 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svg.html,1.2,1.3
Message-ID: <200507212152.j6LLqnqX025904@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv25878/squelettes/template

Modified Files:
	carto_svg.html 
Log Message:
petit & en trop

Index: carto_svg.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svg.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_svg.html	1 Jul 2005 06:37:21 -0000	1.2
+++ carto_svg.html	21 Jul 2005 21:52:47 -0000	1.3
@@ -1,3 +1,3 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
-<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfile&" width="600px" height="400px" type="image/svg+xml" name="emap"/>
+<embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfile" width="600px" height="400px" type="image/svg+xml" name="emap"/>
 </BOUCLE_carte>



From stef at berlios.de  Fri Jul 22 01:22:52 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 22 Jul 2005 01:22:52 +0200
Subject: [Spip-carto-cvs] spipcarto carto_geosvgwmsfile.php3,1.1,NONE carto_geosvgwms.php3,1.1,NONE carto_geosvgfile.php3,1.1,NONE cartov2.php3,1.1,NONE carto_svgfile.php3,1.1,NONE
Message-ID: <200507212322.j6LNMqqX007191@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv6882

Removed Files:
	carto_geosvgwmsfile.php3 carto_geosvgwms.php3 
	carto_geosvgfile.php3 cartov2.php3 carto_svgfile.php3 
Log Message:
menage

--- carto_geosvgwmsfile.php3 DELETED ---

--- carto_geosvgwms.php3 DELETED ---

--- carto_geosvgfile.php3 DELETED ---

--- cartov2.php3 DELETED ---

--- carto_svgfile.php3 DELETED ---



From stef at berlios.de  Fri Jul 22 01:22:55 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 22 Jul 2005 01:22:55 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template Copy (2) of carto_svgfilex.html,1.1,NONE Copy of carto_svgfilex.html,1.1,NONE
Message-ID: <200507212322.j6LNMtqX007247@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv6882/squelettes/template

Removed Files:
	Copy (2) of carto_svgfilex.html Copy of carto_svgfilex.html 
Log Message:
menage

--- Copy (2) of carto_svgfilex.html DELETED ---

--- Copy of carto_svgfilex.html DELETED ---



From stef at berlios.de  Fri Jul 22 01:23:09 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 22 Jul 2005 01:23:09 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes inc-formulaire_carte.php3,1.1,1.2
Message-ID: <200507212323.j6LNN9qX007401@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes
In directory sheep:/tmp/cvs-serv6882/squelettes

Modified Files:
	inc-formulaire_carte.php3 
Log Message:
menage

Index: inc-formulaire_carte.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/inc-formulaire_carte.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- inc-formulaire_carte.php3	30 Jun 2005 10:09:40 -0000	1.1
+++ inc-formulaire_carte.php3	21 Jul 2005 23:23:06 -0000	1.2
@@ -1,5 +1,4 @@
 <?php
-
 if (!defined("_ECRIRE_INC_VERSION")) return;	#securite
 
 // Le contexte indique dans quelle rubrique le visiteur peut proposer le site



From stef at berlios.de  Fri Jul 22 01:23:10 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 22 Jul 2005 01:23:10 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.1,1.2
Message-ID: <200507212323.j6LNNAqX007409@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv6882/ecrire

Modified Files:
	mots_partout.php 
Log Message:
menage

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- mots_partout.php	5 Jul 2005 00:44:48 -0000	1.1
+++ mots_partout.php	21 Jul 2005 23:23:07 -0000	1.2
@@ -443,7 +443,7 @@
 /***********************************************************************
  * r?cuperation de la chose sur laquelle on travaille
  ***********************************************************************/
-if ($HTTP_GET_VARS['installation']='oui'){
+if ($HTTP_GET_VARS['installation']=='oui'){
 	spip_query("ALTER TABLE `spip_groupes_mots` ADD `documents` CHAR( 3 ) NOT NULL DEFAULT 'non';");
 	spip_query("ALTER TABLE `spip_groupes_mots` ADD `messages` CHAR( 3 ) NOT NULL DEFAULT 'oui';");
 	spip_query("ALTER TABLE `spip_groupes_mots` ADD `auteurs` CHAR( 3 ) NOT NULL DEFAULT 'oui';");
@@ -454,7 +454,7 @@
 	spip_query("CREATE TABLE `spip_mots_auteurs` (`id_mot` bigint(20) NOT NULL default '0',`id_auteur` bigint(1) NOT NULL default '0',
   				KEY `id_auteur` (`id_auteur`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
 }
-if ($HTTP_GET_VARS['maj']='oui'){
+if ($HTTP_GET_VARS['maj']=='oui'){
 	spip_query("UPDATE `spip_groupes_mots` SET `messages`='oui';");
 	spip_query("UPDATE `spip_groupes_mots` SET `auteurs`='oui';");
 }
@@ -535,7 +535,7 @@
   $from = array();
   $where = array();
   $group = '';
-  $order = '';
+  $order = array();
   
   if(isset($limit) && $limit != 'rien') {
 	$table_lim = $tables_limite[$limit]['table'];
@@ -550,7 +550,7 @@
 	  if($HTTP_GET_VARS['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
-		$order = 'tot DESC';
+		$order = array('tot DESC');
 	  }
 	}
   } else if(count($mots) > 0) {
@@ -559,7 +559,7 @@
 	  if($HTTP_GET_VARS['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
-		$order = 'tot DESC';
+		$order = array('tot DESC');
 	  }
   } else {
 	$from[] = "$table_principale as main"; 
@@ -699,15 +699,15 @@
 // affichage de mots clefs.
 $select = array('*');
 $from = array('spip_groupes_mots');
-$order = 'titre';
+$order = array('titre');
 $result_groupes = spip_abstract_select($select,$from,'','',$order);
 
 while ($row_groupes = spip_abstract_fetch($result_groupes)) {
   $id_groupe = $row_groupes['id_groupe'];
   $titre_groupe = typo($row_groupes['titre']);
   $unseul = $row_groupes['unseul'];
-  $acces_admin =  $row_groupes['0minirezo'];
-  $acces_redacteur = $row_groupes['1comite'];
+  $acces_admin =  $row_groupes['minirezo'];
+  $acces_redacteur = $row_groupes['comite'];
 
   if($row_groupes[$nom_chose] == 'oui' && (($GLOBALS['connect_statut'] == '1comite' AND $acces_redacteur == 'oui') OR ($GLOBALS['connect_statut'] == '0minirezo' AND $acces_admin == 'oui'))) {
 	// Afficher le titre du groupe



From stef at berlios.de  Fri Jul 22 01:28:01 2005
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 22 Jul 2005 01:28:01 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.2,1.3
Message-ID: <200507212328.j6LNS1qX008794@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv8753/ecrire

Modified Files:
	mots_partout.php 
Log Message:
changement dans CVS (colonnes de groupes_mots et order de abstract_select)

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- mots_partout.php	21 Jul 2005 23:23:07 -0000	1.2
+++ mots_partout.php	21 Jul 2005 23:27:59 -0000	1.3
@@ -1,6 +1,4 @@
 <?php 
-
-
 //	  mots_partout.php
 //    Fichier cr?? pour SPIP avec un bout de code emprunt? ? celui ci.
 //    Distribu? sans garantie sous licence GPL.



From stef at berlios.de  Sat Jul 23 00:57:20 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 23 Jul 2005 00:57:20 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.5,1.6
Message-ID: <200507222257.j6MMvGqX015021@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv14944/ecrire

Modified Files:
	mes_options.php3 
Log Message:
menage

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- mes_options.php3	21 Jul 2005 21:47:15 -0000	1.5
+++ mes_options.php3	22 Jul 2005 22:57:12 -0000	1.6
@@ -188,11 +188,9 @@
 
 $table_primary['carto_objets']="id_carto_objet";
 $table_primary['carto_cartes']="id_carto_carte";
-$table_primary['forms']="id_form";
 
 $table_des_tables['carto_objets']="carto_objets";
 $table_des_tables['carto_cartes']="carto_cartes";
-$table_des_tables['forms']="forms";
 
 $tables_relations['documents']['id_carto_carte']='documents_carto_cartes';
 $tables_relations['mots']['id_carto_objet']='mots_carto_objets';
@@ -214,119 +212,4 @@
 	include_ecrire('plugins/plug_carto.php');
     return avant_typo_carto($texte);
 }
-$champs_extra = true;
-
-$GLOBALS['champs_extra'] = Array (
-'auteurs' => Array (
-				"abo" => "radio|brut|Abonnement &agrave; lettre d'information|Format Html,Format texte,Ne pas recevoir de courrier|html,texte,non",
-"choix" => "multiple|brut|choix|choix1,choix2,choix3"
-      )
-);
-function get_extra_value($ar,$num)
-{
-	if (!is_array($ar)) return $ar;
-	else return $ar[$num];
-}
-
-function extra_afficher_fiche($extra, $type){
-	include_ecrire("inc_extra.php3");
-	include_ecrire("inc_presentation.php3");
-	extra_affichage($extra, $type);
-}
-//======================================================================
-// Integration contrib mots partout (Mortimer)
-//======================================================================
-$choses_possibles['carto_objets'] = array(
-									  'titre_chose' => 'Objets',
-									  'id_chose' => 'id_carto_objet',
-									  'table_principale' => 'spip_carto_objets',
-									  
-									  'table_carte' => 'spip_carto_cartes',
-									  'tables_limite' => array(
-															   'carto_objets' => array(
-																				   'table' => 'spip_carto_objets',
-																				   'nom_id' => 'id_carto_objet'),
-															   'carto_cartes' => array(
-																					'table' => 'spip_carto_objets',
-																					'nom_id' =>  'id_carto_carte'),
-															   )
-									  );
-function afficher_liste_carto_objets($choses) {
-  echo "<div style='height: 12px;'></div>";
-  echo "<div class='liste'>";
-  bandeau_titre_boite2($titre_table, "carte-24.gif");
-  
-  echo afficher_liste_debut_tableau();
-  
-  $from = array('spip_carto_objets as carto_objets');
-  $select= array();
-  $select[] = 'id_carto_objet';
-  $select[] = 'titre';
-  $select[] = 'url_objet';
-  $select[] ='id_carto_carte';
-//  $select[] = 'statut';
-  $where = array('carto_objets.id_carto_objet IN ('.calcul_in($choses).')');
-  
-  $result = spip_abstract_select($select,$from,$where);
-  $i = 0;
-  while ($row = spip_abstract_fetch($result)) {
-	$i++;
-	$vals = '';
-	
-	$id_carto_objet = $row['id_carto_objet'];
-	$tous_id[] = $id_carto_objet;
-	$titre = $row['titre'];
-	$id_carto_carte = $row['id_carto_carte'];
-	$url_objet = $row['url_objet'];
-	
-	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_carto_objet' id='id_chose$i'/>";
-	
-	// Le titre (et la langue)
-	$s = "<div>";
-	
-	$s .= "<a href=\"carto_cartes.php3?id_carto_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
-	
-	$s .= typo($titre);
-	$s .= "</a>";
-	$s .= "</div>";
-	
-	$vals[] = $s;
-	
-	// L'url
-	$s = "<a href=\"$url_objet\" style=\"display:block;\">lien</a>";
-	$vals[] = $s;
-	
-	// Le numero (moche)
-	if ($options == "avancees") {
-	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_carto_objet</b>";
-	}
-	
-	
-	$table[] = $vals;
-  }
-  spip_free_result($result);
-  
-  if ($options == "avancees") { // Afficher le numero (JMB)
-	if ($afficher_auteurs) {
-	  $largeurs = array(11, '', 80, 100, 35);
-	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
-	} else {
-	  $largeurs = array(11, '', 100, 35);
-	  $styles = array('', 'arial2', 'arial1', 'arial1');
-	}
-  } else {
-	if ($afficher_auteurs) {
-	  $largeurs = array(11, '', 100, 100);
-	  $styles = array('', 'arial2', 'arial1', 'arial1');
-	} else {
-	  $largeurs = array(11, '', 100);
-	  $styles = array('', 'arial2', 'arial1');
-	}
-  }
-  afficher_liste($largeurs, $table, $styles);
-  
-  echo afficher_liste_fin_tableau();
-}
-
-//======================================================================
 ?>



From stef at berlios.de  Sat Jul 23 00:58:29 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 23 Jul 2005 00:58:29 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.3,1.4
Message-ID: <200507222258.j6MMwTqX015478@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv15454/ecrire

Modified Files:
	mots_partout.php 
Log Message:
derniere version + gestion carto

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- mots_partout.php	21 Jul 2005 23:27:59 -0000	1.3
+++ mots_partout.php	22 Jul 2005 22:58:26 -0000	1.4
@@ -1,9 +1,11 @@
 <?php 
+
+
 //	  mots_partout.php
 //    Fichier cr?? pour SPIP avec un bout de code emprunt? ? celui ci.
 //    Distribu? sans garantie sous licence GPL.
 //
-//    Copyright (C) 2003  Pierre ANDREWS
+//    Copyright (C) 2005  Pierre ANDREWS
 //
 //    This program is free software; you can redistribute it and/or modify
 //    it under the terms of the GNU General Public License as published by
@@ -23,11 +25,110 @@
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_abstract_sql.php3");
 include_ecrire ("inc_objet.php3");
-
+include('_libs_/tag-machine/inc_tag-machine.php');
 
 /***********************************************************************
 * D?finition des choses sur lesquels on peut vouloir mettre des mots clefs
 ***********************************************************************/
+////////////////////////////////////////////////////////////////////////
+//MODIFICATION (spip-carto)
+////////////////////////////////////////////////////////////////////////
+$choses_possibles['carto_objets'] = array(
+									  'titre_chose' => 'Objets',
+									  'id_chose' => 'id_carto_objet',
+									  'table_principale' => 'spip_carto_objets',
+									  
+									  'table_carte' => 'spip_carto_cartes',
+									  'tables_limite' => array(
+															   'carto_objets' => array(
+																				   'table' => 'spip_carto_objets',
+																				   'nom_id' => 'id_carto_objet'),
+															   'carto_cartes' => array(
+																					'table' => 'spip_carto_objets',
+																					'nom_id' =>  'id_carto_carte'),
+															   )
+									  );
+function afficher_liste_carto_objets($choses) {
+  echo "<div style='height: 12px;'></div>";
+  echo "<div class='liste'>";
+  bandeau_titre_boite2($titre_table, "carte-24.gif");
+  
+  echo afficher_liste_debut_tableau();
+  
+  $from = array('spip_carto_objets as carto_objets');
+  $select= array();
+  $select[] = 'id_carto_objet';
+  $select[] = 'titre';
+  $select[] = 'url_objet';
+  $select[] ='id_carto_carte';
+//  $select[] = 'statut';
+  $where = array('carto_objets.id_carto_objet IN ('.calcul_in($choses).')');
+  
+  $result = spip_abstract_select($select,$from,$where);
+  $i = 0;
+  while ($row = spip_abstract_fetch($result)) {
+	$i++;
+	$vals = '';
+	
+	$id_carto_objet = $row['id_carto_objet'];
+	$tous_id[] = $id_carto_objet;
+	$titre = $row['titre'];
+	$id_carto_carte = $row['id_carto_carte'];
+	$url_objet = $row['url_objet'];
+	
+	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_carto_objet' id='id_chose$i'/>";
+	
+	// Le titre (et la langue)
+	$s = "<div>";
+	
+	$s .= "<a href=\"carto_cartes.php3?id_carto_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
+	
+	$s .= typo($titre);
+	$s .= "</a>";
+	$s .= "</div>";
+	
+	$vals[] = $s;
+	
+	// L'url
+	$s = "<a href=\"$url_objet\" style=\"display:block;\">lien</a>";
+	$vals[] = $s;
+	
+	// Le numero (moche)
+	if ($options == "avancees") {
+	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_carto_objet</b>";
+	}
+	
+	
+	$table[] = $vals;
+  }
+  spip_free_result($result);
+  
+  if ($options == "avancees") { // Afficher le numero (JMB)
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 80, 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	}
+  } else {
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 100, 100);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100);
+	  $styles = array('', 'arial2', 'arial1');
+	}
+  }
+  afficher_liste($largeurs, $table, $styles);
+  
+  echo afficher_liste_fin_tableau();
+}
+////////////////////////////////////////////////////////////////////////
+//(spip-carto)
+////////////////////////////////////////////////////////////////////////
+
+//======================================================================
 
 
 $choses_possibles['articles'] = array(
@@ -69,17 +170,70 @@
 																)
 									   );
 
+$choses_possibles['auteurs'] = array(
+									  'titre_chose' => 'auteurs',
+									  'id_chose' => 'id_auteur',
+									  'table_principale' => 'spip_auteurs',
+									  'tables_limite' => array(
+															   'auteurs' => array(
+																				   'table' => 'spip_auteurs',
+																				   'nom_id' => 'id_auteur'),
+															   'articles' => array(
+																				  'table' => 'spip_auteurs_articles',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
+$choses_possibles['messages'] = array(
+									  'titre_chose' => 'Messages',
+									  'id_chose' => 'id_message',
+									  'table_principale' => 'spip_messages',
+									  
+									  'table_auth' => 'spip_auteurs_messages',
+									  'tables_limite' => array(
+															   'messages' => array(
+																				   'table' => 'spip_messages',
+																				   'nom_id' => 'id_message'),
+															   'auteurs' => array(
+																				  'table' => 'spip_auteurs_messages',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
 /***********************************************************************
- * function
+ * installation
  ***********************************************************************/
 
+if ($HTTP_GET_VARS['installation']=='oui'){
+	spip_query("ALTER TABLE `spip_groupes_mots` ADD `documents` CHAR( 3 ) NOT NULL DEFAULT 'non';");
+	spip_query("ALTER TABLE `spip_groupes_mots` ADD `messages` CHAR( 3 ) NOT NULL DEFAULT 'non';");
+	spip_query("ALTER TABLE `spip_groupes_mots` ADD `auteurs` CHAR( 3 ) NOT NULL DEFAULT 'non';");
+	spip_query("CREATE TABLE `spip_mots_documents` (`id_mot` bigint(20) NOT NULL default '0',`id_document` bigint(1) NOT NULL default '0',
+  				KEY `id_document` (`id_document`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
+	spip_query("CREATE TABLE `spip_mots_messages` (`id_mot` bigint(20) NOT NULL default '0',`id_message` bigint(1) NOT NULL default '0',
+  				KEY `id_message` (`id_message`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
+	spip_query("CREATE TABLE `spip_mots_auteurs` (`id_mot` bigint(20) NOT NULL default '0',`id_auteur` bigint(1) NOT NULL default '0',
+  				KEY `id_auteur` (`id_auteur`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
+}
+
 
+/***********************************************************************
+ * function
+ ***********************************************************************/
+
+  
 function verifier_admin() {
   global $connect_statut, $connect_toutes_rubriques;
   return (($connect_statut == '0minirezo') AND $connect_toutes_rubriques);
 }
 
-function verifier_auteur($table, $id_chose, $id) {
+function verifier_admin_restreint($id_rubrique) {
+  global $connect_id_auteur;
+  global $connect_statut, $connect_toutes_rubriques;
+
+}
+
+function verifier_auteur($table, $id_objet, $id) {
   global $connect_id_auteur;
   $select = array('id_auteur');
   
@@ -179,142 +333,122 @@
 
 //======================================================================
 
-function afficher_horizontal_document_assoc($id_document,$with_check) {
+function afficher_horizontal_document_assoc($id_document,$with_check, $case) {
 	global $connect_id_auteur, $connect_statut;
-	global $couleur_foncee, $couleur_claire, $couleur_lien_off, $couleur_lien;
-	global $clean_link;
-
-	$document = fetch_document($id_document);
-
-	$id_vignette = $document->get('id_vignette');
-	$id_type = $document->get('id_type');
-	$titre = $document->get('titre');
-	$descriptif = $document->get('descriptif');
-	$fichier = generer_url_document($id_document);
-	$largeur = $document->get('largeur');
-	$hauteur = $document->get('hauteur');
-	$taille = $document->get('taille');
-	$date = $document->get('date');
-	$mode = $document->get('mode');
-
-	if (!$titre) {
-		$titre_aff = ereg_replace("^[^\/]*\/[^\/]*\/","",$fichier);
-	} else {
-		$titre_aff = $titre;
-	}
-
-	$select =  array();
-	$select[] = 'extension';
-	$select[] = 'inclus';
-	$select[] = 'titre';
-
-	$from = array();
-	$from[] = 'spip_types_documents';
-	
-	$where = array();
-	$where[] = "id_type=$id_type";
-
-	if ($type = @spip_abstract_fetsel($select,$from,$where))	{
-		$type_extension = $type['extension'];
-		$type_inclus = $type['inclus'];
-		$type_titre = $type['titre'];
-	}
-
-	debut_cadre_enfonce("doc-24.gif");
-	echo "<div style='padding: 2px; background-color: #aaaaaa; text-align: left; color: black;'>";
-
-	if($with_check) {
-	  echo "<input type='checkbox' name='id_choses[]' value='$id_document' />";
-	}
-	echo "<font size=1 face='arial,helvetica,sans-serif'>"._T('info_document')." - </font> <b><font size=2>".typo($titre_aff)."</font></b>";
-	echo "</div>\n";
+	global $spip_lang_left, $spip_lang_right;
 
+	$bord_droit = 2;
 
-	//
-	// Recuperer la vignette
-	//
-	if ($id_vignette) $vignette = fetch_document($id_vignette);
-	if ($vignette) {
-		$fichier_vignette = generer_url_document($id_vignette);
-		$largeur_vignette = $vignette->get('largeur');
-		$hauteur_vignette = $vignette->get('hauteur');
-		$taille_vignette = $vignette->get('taille');
-	}
+	$select = array('*');
+	$from = array('spip_documents');
+	$where = array("id_document = $id_document");
 
-	echo "<p></p><div style='border: 1px dashed #666666; padding: 5px; background-color: #f0f0f0;'>";
-	if ($fichier_vignette) {
-		// Afficher la vignette
-		echo "<div align='left'>\n";
-		echo "<div align='center'>";
-		$block = "doc_vignette $id_document";
-		echo texte_vignette_document($largeur_vignette, $hauteur_vignette, $fichier_vignette, "$fichier");
-		echo "</div>";
+	$results = spip_abstract_select($select,$from,$where);
 
-		echo "</div>\n";
-	}
-	else {
-		// Pas de vignette : afficher la vignette par defaut
-		echo "<div align='center'>\n";
-		$block = "doc_vignette $id_document";
-		list($icone, $largeur_icone, $hauteur_icone) = vignette_par_defaut($type_extension);
-		if ($icone) {
-			echo "<a href='$fichier'><img src='$icone' border=0 width='$largeur_icone' align='top' height='$hauteur_icone'></a>\n";
+	if($document = spip_abstract_fetch($results)) {
+	  $id_vignette = $document['id_vignette'];
+	  $id_type = $document['id_type'];
+	  $titre = $document['titre'];
+	  $descriptif = $document['descriptif'];
+	  $url = generer_url_document($id_document);
+	  $fichier = $document['fichier'];
+	  $largeur = $document['largeur'];
+	  $hauteur = $document['hauteur'];
+	  $taille = $document['taille'];
+	  $date = $document['date'];
+	  $mode = $document['mode'];
+	  
+	  if ($case == 0) {
+		echo "<tr style='border-top: 1px solid black;'>";
+	  }
+	  
+	  $style = "border-$spip_lang_left: 1px solid $couleur; border-bottom: 1px solid $couleur;";
+	  if ($case == $bord_droit) $style .= " border-$spip_lang_right: 1px solid $couleur;";
+	  echo "<td width='33%' style='text-align: $spip_lang_left; $style' valign='top'>";
+	  
+	  echo "<label for='doc$case'>"._T('motspartout:voir').'</label>';
+	  echo "<input type='checkbox' name='id_choses[]' id='doc$case' value='$id_document' />";
+	  
+	  // Signaler les documents distants par une icone de trombone
+	  if ($document['distant'] == 'oui') {
+		echo "<img src='"._DIR_IMG_PACK.'attachment.gif'."' style='float: $spip_lang_right;' alt=\"".entites_html($document['fichier'])."\" title=\"" .
+		  entites_html($document['fichier'])."\" />\n";
+	  }
+	  
+	  // bloc vignette + rotation
+	  echo "<div style='text-align:center;'>";
+	  
+	  
+	  # 'extension', a ajouter dans la base quand on supprimera spip_types_documents
+		switch ($id_type) {
+		  case 1:
+			$document['extension'] = "jpg";
+			break;
+		  case 2:
+			$document['extension'] = "png";
+			break;
+		  case 3:
+			$document['extension'] = "gif";
+			break;
 		}
-		echo "</div>\n";
+	  
+	  //
+	  // Recuperer la vignette et afficher le doc
+	  //
+	  echo document_et_vignette($document, $url, true); 
+	  
+	  echo "</div>"; // fin du bloc vignette + rotation
+	  
+	  
+	  // bloc titre et descriptif
+	  if (strlen($titre) > 0) {
+		echo "<div class='verdana2'><b>".typo($titre)."</b>";
+		echo '</div>';
+	  } else {
+		$nom_fichier = basename($fichier);
+		
+		if (strlen($nom_fichier) > 20) {
+		  $nom_fichier = substr($nom_fichier, 0, 10)."...".substr($nom_fichier, strlen($nom_fichier)-10, strlen($nom_fichier));
+		}
+		echo "<div class='verdana1' style='text-align:center;'>$triangle$nom_fichier";
+		echo '</div>';
+	  }
+	  	  
+	  if (strlen($descriptif) > 0) {
+		echo "<div class='verdana1'>".propre($descriptif)."</div>";
+	  }
+	  
+	  // Taille de l'image ou poids du document
+	  echo "<div class='verdana1' style='text-align: center;'>";
+	  if ($largeur * $hauteur)
+		echo _T('info_largeur_vignette',
+				array('largeur_vignette' => $largeur,
+					  'hauteur_vignette' => $hauteur));
+	  else
+		echo taille_en_octets($taille);
+	  echo "</div>";
+	  
+	  
+	  echo "</td>\n";
 	}
-	echo "</div>";
-/*
-	$block = "document $id_document ";
-
-	//
-	// Boite d'edition du document
-	//
-	echo debut_block_visible($block);
-
-	echo "<p></p><div style='border: 1px solid #666666; padding: 0px; background-color: #f0f0f0;'>";
-
-	echo "<div style='padding: 5px;'>";
-
-	if ($type_titre)
-		echo "$type_titre";
-	else
-		echo "Document ".majuscules($type_extension);
-	echo " : <a href='$fichier'>".taille_en_octets($taille)."</a>";
-
-	echo "</div>";
-	echo "</div>";
-	echo fin_block();
-*/
-	fin_cadre_enfonce();
-}
-
-function afficher_pagination($count,$actu) {
-  $i = 0;
-  while($i++ < $actu)
-	echo "<button name='page' value='$i'>$i</button>";
-   echo $i;
-  while($i++ < $count/30)
-	echo "<button name='page' value='$i'>$i</button>";
 }
 
 function afficher_liste_documents($choses) {
-  echo "<table>";						  
+  global $spip_lang_left;
+  echo "<table width='100%' cellspacing='0' cellpadding='3' style=\"border-top:1px solid black\">\n";
   $i=0;
   foreach($choses as $id_chose) {
+	afficher_horizontal_document_assoc($id_chose,true,$i);
 	$i++;
-	echo "<td width='33%'>";
-	afficher_horizontal_document_assoc($id_chose,true);
-	echo "</td>";
-	if($i > 30) {
-	  echo "</tr>";
-	  afficher_pagination(count($choses),$HTTP_GET_VARS['page']);
-	  break;
-	} else
-	if ($i==3)
-	  {
-		echo "</tr><TR>";
-		$i=0;
-	  }
+	if ($i > 2) {
+	  $i = 0;
+	  echo "</tr>\n";
+	}
+  }
+  // fermer la derniere ligne
+  if ($i > 0) {
+	echo "<td style='border-$spip_lang_left: 1px solid $couleur;'>&nbsp;</td>";
+	echo "</tr>";
   }
   echo '</table>';
 }
@@ -322,9 +456,9 @@
 //======================================================================
 
 function afficher_liste_articles($choses) {
-  echo "<div style='height: 12px;'></div>";
+  //  echo "<div style='height: 12px;'></div>";
   echo "<div class='liste'>";
-  bandeau_titre_boite2($titre_table, "article-24.gif");
+  bandeau_titre_boite2('Articles', "article-24.gif");
   
   echo afficher_liste_debut_tableau();
   
@@ -424,6 +558,164 @@
   afficher_liste($largeurs, $table, $styles);
   
   echo afficher_liste_fin_tableau();
+  echo '</div>';
+}
+
+//======================================================================
+
+function afficher_liste_messages($choses) {
+  echo "<div style='height: 12px;'></div>";
+  echo "<div class='liste'>";
+  bandeau_titre_boite2($titre_table, "stock_mail.gif");
+  
+  echo afficher_liste_debut_tableau();
+  
+  $from = array('spip_messages as messages');
+  $select= array();
+  $select[] = 'id_message';
+  $select[] = 'titre';
+  $select[] = 'type';
+  $select[] = 'date_heure';
+  $select[] = 'statut';
+  $where = array('messages.id_message IN ('.calcul_in($choses).')');
+  
+  $result = spip_abstract_select($select,$from,$where);
+  $i = 0;
+  while ($row = spip_abstract_fetch($result)) {
+	$i++;
+	$vals = '';
+	
+	$id_message = $row['id_message'];
+	$tous_id[] = $id_message;
+	$titre = $row['titre'];
+	$date = $row['date_heure'];
+	$statut = $row['statut'];
+	
+	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_message' id='id_chose$i'/>";
+	
+	// Le titre (et la langue)
+	$s = "<div>";
+	
+	$s .= "<a href=\"bloogletter.php3?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
+	
+	$s .= typo($titre);
+	$s .= "</a>";
+	$s .= "</div>";
+	
+	$vals[] = $s;
+	
+	// La date
+	$s = affdate_jourcourt($date);
+	$vals[] = $s;
+	
+	// Le numero (moche)
+	if ($options == "avancees") {
+	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_message</b>";
+	}
+	
+	
+	$table[] = $vals;
+  }
+  spip_free_result($result);
+  
+  if ($options == "avancees") { // Afficher le numero (JMB)
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 80, 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100, 35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	}
+  } else {
+	if ($afficher_auteurs) {
+	  $largeurs = array(11, '', 100, 100);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+	} else {
+	  $largeurs = array(11, '', 100);
+	  $styles = array('', 'arial2', 'arial1');
+	}
+  }
+  afficher_liste($largeurs, $table, $styles);
+  
+  echo afficher_liste_fin_tableau();
+}
+
+//======================================================================
+
+function afficher_liste_auteurs($choses) {
+  echo "<div style='height: 12px;'></div>";
+  echo "<div class='liste'>";
+  bandeau_titre_boite2($titre_table, "reply-to-all-24.gif");
+  
+  echo afficher_liste_debut_tableau();
+  
+  $from = array('spip_auteurs as auteurs');
+  $select= array();
+  $select[] = 'id_auteur';
+  $select[] = 'nom';
+  $select[] = 'login';
+  $select[] = 'email';
+  $select[] = 'extra';
+  $select[] = 'statut';
+  $where = array('auteurs.id_auteur IN ('.calcul_in($choses).')');
+  
+  $result = spip_abstract_select($select,$from,$where);
+  $i = 0;
+  while ($row = spip_abstract_fetch($result)) {
+	$i++;
+	$vals = '';
+	
+	$id_auteur = $row['id_auteur'];
+	$tous_id[] = $id_auteur;
+	$nom = $row['nom'];
+	$login = $row['login'];
+	$email = $row['email'];
+	$extra = $row['extra'];
+	$statut = $row['statut'];
+	
+	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_auteur' id='id_chose$i'/>";
+	
+	// Le titre (et la langue)
+	$s = "<div>";
+	$s .= "<a href=\"auteur_edit.php3?id_auteur=$id_auteur\" style=\"display:block;\">";
+	$s .= typo($login);
+	$s .= "</a>";
+	$s .= "</div>";
+	$vals[] = $s;
+
+	$s = "<div>";
+	$s .= " (<a href=\"mailto:$email\">";
+	
+	$s .= typo($nom);
+	$s .= "</a>)";
+	$s .= "</div>";
+	
+	$vals[] = $s;
+	
+	// TODO : extra
+//	$s = affdate_jourcourt($date);
+//	$vals[] = $s;
+	
+	// Le numero (moche)
+	if ($options == "avancees") {
+	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_auteur</b>";
+	}
+	
+	
+	$table[] = $vals;
+  }
+  spip_free_result($result);
+  
+  if ($options == "avancees") { // Afficher le numero (JMB)
+	  $largeurs = array(11, '', 100,35);
+	  $styles = array('', 'arial2', 'arial1', 'arial1');
+  } else {
+	  $largeurs = array(11, '', 100);
+	  $styles = array('', 'arial2', 'arial1');
+  }
+  afficher_liste($largeurs, $table, $styles);
+  
+  echo afficher_liste_fin_tableau();
 }
 
 //======================================================================
@@ -441,21 +733,6 @@
 /***********************************************************************
  * r?cuperation de la chose sur laquelle on travaille
  ***********************************************************************/
-if ($HTTP_GET_VARS['installation']=='oui'){
-	spip_query("ALTER TABLE `spip_groupes_mots` ADD `documents` CHAR( 3 ) NOT NULL DEFAULT 'non';");
-	spip_query("ALTER TABLE `spip_groupes_mots` ADD `messages` CHAR( 3 ) NOT NULL DEFAULT 'oui';");
-	spip_query("ALTER TABLE `spip_groupes_mots` ADD `auteurs` CHAR( 3 ) NOT NULL DEFAULT 'oui';");
-	spip_query("CREATE TABLE `spip_mots_documents` (`id_mot` bigint(20) NOT NULL default '0',`id_document` bigint(1) NOT NULL default '0',
-  				KEY `id_document` (`id_document`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
-	spip_query("CREATE TABLE `spip_mots_messages` (`id_mot` bigint(20) NOT NULL default '0',`id_message` bigint(1) NOT NULL default '0',
-  				KEY `id_message` (`id_message`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
-	spip_query("CREATE TABLE `spip_mots_auteurs` (`id_mot` bigint(20) NOT NULL default '0',`id_auteur` bigint(1) NOT NULL default '0',
-  				KEY `id_auteur` (`id_auteur`),KEY `id_mot` (`id_mot`)) TYPE=MyISAM;;");
-}
-if ($HTTP_GET_VARS['maj']=='oui'){
-	spip_query("UPDATE `spip_groupes_mots` SET `messages`='oui';");
-	spip_query("UPDATE `spip_groupes_mots` SET `auteurs`='oui';");
-}
 
 $nom_chose = $HTTP_GET_VARS['nom_chose'];
 if(!isset($choses_possibles[$nom_chose])) {
@@ -473,52 +750,19 @@
 $mots = $HTTP_GET_VARS['id_mots'];
 $sans_mots = $HTTP_GET_VARS['sans_mots'];
 $choses = $HTTP_GET_VARS['id_choses'];
+$nom_tags = $HTTP_GET_VARS['nom_tags'];
+$limit =  $HTTP_GET_VARS['limit'];
+$id_limit =  $HTTP_GET_VARS['id_limit'];
 
-if($HTTP_GET_VARS['bouton'] == 'ajouter' && count($mots) && count($choses)) {
-  foreach($mots as $m) {	
-	$from = array('spip_mots');
-	$select = array('id_groupe');
-	$where = array("id_mot = $m");
-	$res = spip_abstract_select($select,$from,$where);
-	$unseul = false;
-	$id_groupe = 0;
-	$titre_groupe = '';
-	if($row = spip_abstract_fetch($res)) {
-	  spip_abstract_free($res);
-	  $from = array('spip_groupes_mots');
-	  $select = array('unseul','titre');
-	  $id_groupe = $row['id_groupe'];
-	  $where = array("id_groupe = $id_groupe");
-	  $res = spip_abstract_select($select,$from,$where);
-	  if($row = spip_abstract_fetch($res)) {
-		$unseul = ($row['unseul'] == 'oui');
-		$titre_groupe = $row['titre'];
-	  }
-	}
-	spip_abstract_free($res);
+if($HTTP_GET_VARS['bouton'] == 'ajouter' && $nom_tags && count($choses)) {
+  $tags = parser_liste($nom_tags);
 	foreach($choses as $d) {
-	  if($unseul) {
-		$from = array("spip_mots_$nom_chose",'spip_mots');
-		$select = array("count('id_mot') as cnt");
-		$where = array("id_groupe = $id_groupe","spip_mots_$nom_chose.id_mot = spip_mots.id_mot","$id_chose = $d");
-		$group = $id_chose;
-		$res = spip_abstract_select($select,$from,$where,$group);
-		if($row = spip_abstract_fetch($res)) {	
-		  if($row['cnt'] > 0) {
-			$warnings[] = array(_T('motspartout:dejamotgroupe',array('groupe' => $titre_groupe, 'chose' => $d)));
-			continue; 
-		  }
-		}
-		spip_abstract_free($res);
-	  }
-	  spip_abstract_insert("spip_mots_$nom_chose","(id_mot,$id_chose)","($m,$d)");
+	  $warnings = ajouter_liste_mots($tags,$d,'',$nom_chose,$id_chose);
 	}
-  }
-} else if ($HTTP_GET_VARS['bouton'] == 'enlever' && count($mots) && count($choses)) {
-    foreach($mots as $m) {
-	  foreach($choses as $d) {
-		spip_query("DELETE FROM spip_mots_$nom_chose WHERE id_mot=$m AND $id_chose=$d");
-	  }
+} else if ($HTTP_GET_VARS['bouton'] == 'enlever' && $nom_tags && count($choses)) {
+	$tags = parser_liste($nom_tags);
+	foreach($choses as $d) {
+	  retirer_liste_mots($tags,$d,'',$nom_chose,$id_chose);
 	}
 }
 
@@ -542,9 +786,9 @@
 	$from[] = "$table_lim as main";
 	$where[] = "main.$nom_id_lim IN ($id_limit)"; 
 	if(count($mots) > 0) {
-	  $from[] = "spip_mots_$nom_chose";
-	  $where[] = "$table_temp.id_mot IN (".calcul_in($mots).')';
-	  $where[] = "$table_temp.$id_chose = main.$id_chose";
+	  $from[] = "spip_mots_$nom_chose as table_temp";
+	  $where[] = "table_temp.id_mot IN (".calcul_in($mots).')';
+	  $where[] = "table_temp.$id_chose = main.$id_chose";
 	  if($HTTP_GET_VARS['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
@@ -626,44 +870,24 @@
 //Colonne de gauche
 debut_gauche();
 
+echo '<a name="voir"></a><form action="mots_partout.php#action">';
+
+
 // choix de la chose sur laquelle on veut ajouter des mots
 debut_cadre_enfonce('',false,'',_T('motspartout:choses'));
-echo  '<form action="mots_partout.php">
-<div class=\'liste\'>
+//echo  '<form action="mots_partout.php">';
+echo '<div class=\'liste\'>
 <table border=0 cellspacing=0 cellpadding=3 width=\"100%\">
 <tr class=\'tr_liste\'>
-<td><select name="nom_chose">';
+<td colspan=2><select name="nom_chose">';
 foreach($choses_possibles as $cho => $m) {
   echo "<option value=\"$cho\"".(($cho == $nom_chose)?'selected':'').'>'._T($m['titre_chose']).'</option>';
 }
-echo '</select></td><td><button type=\'submit\'>';
-echo _T('bouton_valider');
-echo '</button></td></tr>
-</table></div></form>';
-fin_cadre_enfonce();
-
-echo '<form action="mots_partout.php" >';
-
-// les actions et limitations possibles.
-debut_cadre_enfonce('',false,'',_T('motspartout:action'));
-
-echo '<div class=\'liste\'>
-<table border=0 cellspacing=0 cellpadding=3 width=\"100%\">
-<tr class=\'tr_liste\'>
-<td><input type=\'radio\' value=\'ajouter\' name="bouton" id=\'ajouter\'><br><label for=\'ajouter\'>'.
-_T('motspartout:ajouter').
-'</label></td>
-<td ><input type=\'radio\' value=\'enlever\' name="bouton" id=\'enlever\'><br><label for=\'enlever\'>'.
-_T('motspartout:enlever').
-'</label></td>
-<td>
-<input type=\'radio\' value=\'voir\' name="bouton" id=\'voir\' checked><br><label for=\'voir\'>'.
-_T('motspartout:voir').
-'</label></td>
-</tr>
-<tr class=\'tr_liste\'><td>'.
+echo '</select></td></tr>';
+echo '<tr class=\'tr_liste\'><td colspan=2>'.
 _T('motspartout:limite').
-':</td><td><select name="limit">
+':</td></tr>';
+echo '<tr class=\'tr_liste\'><td><select name="limit">
 <option value="rien" selected="true">'.
 _T('motspartout:aucune').
 '</option>';
@@ -673,34 +897,29 @@
 }
 
 echo '</select></td>';
-echo "<td><input type='text' size='3' name='id_limit' value='$id_limit'></td>";
+echo "<td><input type='text' size='3' name='id_limit' value='$id_limit'></td></tr>";
+echo '<tr class=\'tr_liste\'>';
 ?>
-
-</tr>
-<tr class='tr_liste'>
-<td>
+<td><button type='submit'>
+<?php echo _T('motspartout:voir'); ?>
+</button>
+</td>
+<td colspan=2>
 <input type='checkbox' id='strict' name='strict'/><label for='strict'>
 <?php echo _T('motspartout:stricte'); ?>
 </label></td>
-<td></td>
-<td><button type='submit'>
-<?php echo _T('bouton_valider'); ?>
-</button></td>
-</tr>
-</table>
-</div>
-
 <?php
-
+echo '</table></div>';
 fin_cadre_enfonce();
 
+
 // affichage de mots clefs.
 $select = array('*');
 $from = array('spip_groupes_mots');
 $order = array('titre');
-$result_groupes = spip_abstract_select($select,$from,'','',$order);
+$m_result_groupes = spip_abstract_select($select,$from,'','',$order);
 
-while ($row_groupes = spip_abstract_fetch($result_groupes)) {
+while ($row_groupes = spip_abstract_fetch($m_result_groupes)) {
   $id_groupe = $row_groupes['id_groupe'];
   $titre_groupe = typo($row_groupes['titre']);
   $unseul = $row_groupes['unseul'];
@@ -714,8 +933,10 @@
 	//
 	// Afficher les mots-cles du groupe
 	//
-	$query = "SELECT * FROM spip_mots WHERE id_groupe = '$id_groupe' ORDER BY titre";
-	$result = spip_query($query);
+	$result = spip_abstract_select(array('*'),
+								  array('spip_mots'),
+								  array("id_groupe = '$id_groupe'"),
+								  '', 'titre');
 	$table = '';
 	
 	if (spip_abstract_count($result) > 0) {
@@ -724,7 +945,7 @@
 	  $i =0;
 	  $table[] = array(
 					   ' ' => 0,
-					   _T('motspartout:select') => 0,
+					   _T('motspartout:voir') => 0,
 					   _T('motspartout:sans') => 0
 					   );
 	  while ($row = spip_abstract_fetch($result)) {
@@ -738,10 +959,7 @@
 		
 		$vals["<label for='id_mot$i'>$s</label>"] = calcul_numeros($show_mots,$id_mot,count($choses));
 		
-		if($unseul == 'oui') 
-		  $vals["<input type='radio' name='id_mots[]' id='id_mot$i' value='$id_mot'>"] = calcul_numeros($show_mots,$id_mot,count($choses));
-		else
-		  $vals["<input type='checkbox' name='id_mots[]' id='id_mot$i' value='$id_mot'>"] = calcul_numeros($show_mots,$id_mot,count($choses));
+		$vals["<input type='checkbox' name='id_mots[]' id='id_mot$i' value='$id_mot'>"] = calcul_numeros($show_mots,$id_mot,count($choses));
 		
 		$vals["<input type='checkbox' name='sans_mots[]' id='sans_mot$i' value='$id_mot'>"] = calcul_numeros($show_mots,$id_mot,count($choses));
 		$table[] = $vals;
@@ -769,13 +987,12 @@
 	fin_cadre_enfonce();
   }
 }
-spip_abstract_free($result_groupes);
+spip_abstract_free($m_result_groupes);
 
 //Milieu
 
 debut_droite();
 
-
 if(count($warnings) > 0) {
   debut_cadre_relief('',false,'',_T('motspartout:ATTENTION'));
   echo '<div class="liste"><table border=0 cellspacing=0 cellpadding=3 width=\"100%\">';
@@ -784,7 +1001,7 @@
   afficher_liste($largeurs, $warnings, $styles);
   echo '</table>';
   echo '</div>';
-  fin_cadre_enfonce();
+  fin_cadre_relief();
 }
 
 // Affichage de toutes les choses (on pourrait imaginer faire une pagination l?)
@@ -795,10 +1012,84 @@
 	$function($choses);
   else
 	afficher_liste_defaut($choses);
+?>
+<!--
+<input type="radio" name="selectall" id="all" onclick="selectAll(this.form, 'id_choses[]', 0);"><label for="all">Select All</label>
+<input type="radio" name="selectall" id="inverse"  onclick="selectAll(this.form, 'id_choses[]', 1);"><label for="inverse">Inverse All</label>
+-->
+<?php
 } else {
   echo _T('motspartout:pas_de_documents').'.';
 }
+
+
 fin_cadre_relief();
-echo '<input type="hidden" name="nom_chose" value="'.$HTTP_GET_VARS['nom_chose'].'"></form>';
+echo '</form>';
+
+if(count($choses)) {
+  echo '<a name="action"></a><form action="mots_partout.php#voir">';
+
+  echo '<input type="hidden" name="nom_chose" value="'.$HTTP_GET_VARS['nom_chose'].'">';  
+  echo "<input type='hidden' name='id_limit' value='$id_limit'>";
+  echo "<input type='hidden' name='limit' value='$limit'>";
+  for($i=0; $i < count($choses); $i++) {
+	echo "<input type=\"hidden\" name=\"id_choses[]\" value=\"".$choses[$i].'">';
+  }
+  
+  // les actions et limitations possibles.
+  debut_cadre_enfonce('',false,'',_T('motspartout:action'));
+  
+  echo '<div class=\'liste\'>
+<table border=0 cellspacing=0 cellpadding=3 width=\"100%\">';
+  echo '<tr class=\'tr_liste\'>
+<td><input type=\'radio\' value=\'ajouter\' name="bouton" id=\'ajouter\'><br><label for=\'ajouter\'>'.
+	_T('motspartout:ajouter').
+	'</label></td>
+<td ><input type=\'radio\' value=\'enlever\' name="bouton" id=\'enlever\'><br><label for=\'enlever\'>'.
+	_T('motspartout:enlever').
+	'</label></td>
+</tr>';
+  ?>
+	<tr class='tr_liste'>
+	  <td colspan=2><label for="nom_tags">liste des mots ? ajouter</label>
+</td>
+</tr>
+	<tr class='tr_liste'>
+	  <td colspan=2><textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea></td>
+	   </tr>
+	   <tr class='tr_liste'>
+	   <td colspan=2><button type='submit'>
+	   <?php echo _T('bouton_valider'); ?>
+	   </button></td>
+		   </tr>
+		   </table>
+		   </div>
+		   
+<?php
+		   
+  fin_cadre_enfonce();
+  echo '</form>';
+}
+?>
+
+
+<script>
+function selectAll(formObj, isInverse) 
+{
+   for (var i=0;i < formObj.length;i++) 
+   {
+      fldObj = formObj.elements[i];
+      if (fldObj.type == 'checkbox')
+      { 
+         if(isInverse)
+            fldObj.checked = (fldObj.checked) ? false : true;
+         else fldObj.checked = true; 
+       }
+   }
+}
+</script>
+
+<?php
+
 fin_page();
 ?>



From stef at berlios.de  Tue Jul 26 02:13:55 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 26 Jul 2005 02:13:55 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_tag-machine.php,NONE,1.1
Message-ID: <200507260013.j6Q0DtRc021109@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv21074/ecrire

Added Files:
	inc_tag-machine.php 
Log Message:
utile pour mots_partout ...

--- NEW FILE: inc_tag-machine.php ---
(This appears to be a binary file; contents omitted.)



From stef at berlios.de  Tue Jul 26 02:15:32 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 26 Jul 2005 02:15:32 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.4,1.5
Message-ID: <200507260015.j6Q0FWRc021878@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv21611/ecrire

Modified Files:
	mots_partout.php 
Log Message:
version maison (ajout/suppression de mots par case ? cocher)

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- mots_partout.php	22 Jul 2005 22:58:26 -0000	1.4
+++ mots_partout.php	26 Jul 2005 00:15:25 -0000	1.5
@@ -25,14 +25,11 @@
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_abstract_sql.php3");
 include_ecrire ("inc_objet.php3");
-include('_libs_/tag-machine/inc_tag-machine.php');
-
-/***********************************************************************
-* D?finition des choses sur lesquels on peut vouloir mettre des mots clefs
-***********************************************************************/
 ////////////////////////////////////////////////////////////////////////
 //MODIFICATION (spip-carto)
 ////////////////////////////////////////////////////////////////////////
+include_ecrire('inc_tag-machine.php');
+
 $choses_possibles['carto_objets'] = array(
 									  'titre_chose' => 'Objets',
 									  'id_chose' => 'id_carto_objet',
@@ -128,8 +125,9 @@
 //(spip-carto)
 ////////////////////////////////////////////////////////////////////////
 
-//======================================================================
-
+/***********************************************************************
+* D?finition des choses sur lesquels on peut vouloir mettre des mots clefs
+***********************************************************************/
 
 $choses_possibles['articles'] = array(
 									  'titre_chose' => 'public:articles',
@@ -342,8 +340,9 @@
 	$select = array('*');
 	$from = array('spip_documents');
 	$where = array("id_document = $id_document");
-
+	echo "<hr/>";
 	$results = spip_abstract_select($select,$from,$where);
+	echo "<hr/>";
 
 	if($document = spip_abstract_fetch($results)) {
 	  $id_vignette = $document['id_vignette'];
@@ -754,15 +753,67 @@
 $limit =  $HTTP_GET_VARS['limit'];
 $id_limit =  $HTTP_GET_VARS['id_limit'];
 
-if($HTTP_GET_VARS['bouton'] == 'ajouter' && $nom_tags && count($choses)) {
-  $tags = parser_liste($nom_tags);
-	foreach($choses as $d) {
-	  $warnings = ajouter_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+if($HTTP_GET_VARS['bouton'] == 'ajouter' && count($choses)) {
+	if(count($mots)) {
+	  foreach($mots as $m) {	
+		$from = array('spip_mots');
+		$select = array('id_groupe');
+		$where = array("id_mot = $m");
+		$res = spip_abstract_select($select,$from,$where);
+		$unseul = false;
+		$id_groupe = 0;
+		$titre_groupe = '';
+		if($row = spip_abstract_fetch($res)) {
+		  spip_abstract_free($res);
+		  $from = array('spip_groupes_mots');
+		  $select = array('unseul','titre');
+		  $id_groupe = $row['id_groupe'];
+		  $where = array("id_groupe = $id_groupe");
+		  $res = spip_abstract_select($select,$from,$where);
+		  if($row = spip_abstract_fetch($res)) {
+			$unseul = ($row['unseul'] == 'oui');
+			$titre_groupe = $row['titre'];
+		  }
+		}
+		spip_abstract_free($res);
+		foreach($choses as $d) {
+		  if($unseul) {
+			$from = array("spip_mots_$nom_chose",'spip_mots');
+			$select = array("count('id_mot') as cnt");
+			$where = array("id_groupe = $id_groupe","spip_mots_$nom_chose.id_mot = spip_mots.id_mot","$id_chose = $d");
+			$group = $id_chose;
+			$res = spip_abstract_select($select,$from,$where,$group);
+			if($row = spip_abstract_fetch($res)) {	
+			  if($row['cnt'] > 0) {
+				$warnings[] = array(_T('motspartout:dejamotgroupe',array('groupe' => $titre_groupe, 'chose' => $d)));
+				continue; 
+			  }
+			}
+			spip_abstract_free($res);
+		  }
+		  spip_abstract_insert("spip_mots_$nom_chose","(id_mot,$id_chose)","($m,$d)");
+		}
+	  }
 	}
-} else if ($HTTP_GET_VARS['bouton'] == 'enlever' && $nom_tags && count($choses)) {
-	$tags = parser_liste($nom_tags);
-	foreach($choses as $d) {
-	  retirer_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+	if ($nom_tags){
+	  	$tags = parser_liste($nom_tags);
+		foreach($choses as $d) {
+		  $warnings = ajouter_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+		}
+	}
+} else if ($HTTP_GET_VARS['bouton'] == 'enlever' && count($choses)) {
+	if (count($mots)) {
+	    foreach($mots as $m) {
+		  foreach($choses as $d) {
+			spip_query("DELETE FROM spip_mots_$nom_chose WHERE id_mot=$m AND $id_chose=$d");
+		  }
+		}
+	}
+	if ($nom_tags){
+		$tags = parser_liste($nom_tags);
+		foreach($choses as $d) {
+		  retirer_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+		}
 	}
 }
 
@@ -900,7 +951,7 @@
 echo "<td><input type='text' size='3' name='id_limit' value='$id_limit'></td></tr>";
 echo '<tr class=\'tr_liste\'>';
 ?>
-<td><button type='submit'>
+<td><button type='submit'">
 <?php echo _T('motspartout:voir'); ?>
 </button>
 </td>
@@ -936,7 +987,7 @@
 	$result = spip_abstract_select(array('*'),
 								  array('spip_mots'),
 								  array("id_groupe = '$id_groupe'"),
-								  '', 'titre');
+								  '', array('titre'));
 	$table = '';
 	
 	if (spip_abstract_count($result) > 0) {
@@ -988,46 +1039,11 @@
   }
 }
 spip_abstract_free($m_result_groupes);
-
-//Milieu
-
-debut_droite();
-
-if(count($warnings) > 0) {
-  debut_cadre_relief('',false,'',_T('motspartout:ATTENTION'));
-  echo '<div class="liste"><table border=0 cellspacing=0 cellpadding=3 width=\"100%\">';
-  $largeurs = array('100%');
-  $styles = array( 'arial11');
-  afficher_liste($largeurs, $warnings, $styles);
-  echo '</table>';
-  echo '</div>';
-  fin_cadre_relief();
-}
-
-// Affichage de toutes les choses (on pourrait imaginer faire une pagination l?)
-debut_cadre_relief('',false,'document', _T('portfolio'));
-if(count($choses) > 0) {
-  $function = "afficher_liste_$nom_chose";
-  if(function_exists($function)) 
-	$function($choses);
-  else
-	afficher_liste_defaut($choses);
-?>
-<!--
-<input type="radio" name="selectall" id="all" onclick="selectAll(this.form, 'id_choses[]', 0);"><label for="all">Select All</label>
-<input type="radio" name="selectall" id="inverse"  onclick="selectAll(this.form, 'id_choses[]', 1);"><label for="inverse">Inverse All</label>
--->
-<?php
-} else {
-  echo _T('motspartout:pas_de_documents').'.';
-}
-
-
-fin_cadre_relief();
-echo '</form>';
+  echo '</form>';
+ creer_colonne_droite();
 
 if(count($choses)) {
-  echo '<a name="action"></a><form action="mots_partout.php#voir">';
+ 	echo '<a name="action"></a><form action="mots_partout.php#voir">';
 
   echo '<input type="hidden" name="nom_chose" value="'.$HTTP_GET_VARS['nom_chose'].'">';  
   echo "<input type='hidden' name='id_limit' value='$id_limit'>";
@@ -1068,8 +1084,117 @@
 <?php
 		   
   fin_cadre_enfonce();
-  echo '</form>';
+// affichage de mots clefs.
+$select = array('*');
+$from = array('spip_groupes_mots');
+$order = array('titre');
+$m_result_groupes = spip_abstract_select($select,$from,'','',$order);
+
+while ($row_groupes = spip_abstract_fetch($m_result_groupes)) {
+  $id_groupe = $row_groupes['id_groupe'];
+  $titre_groupe = typo($row_groupes['titre']);
+  $unseul = $row_groupes['unseul'];
+  $acces_admin =  $row_groupes['minirezo'];
+  $acces_redacteur = $row_groupes['comite'];
+
+  if($row_groupes[$nom_chose] == 'oui' && (($GLOBALS['connect_statut'] == '1comite' AND $acces_redacteur == 'oui') OR ($GLOBALS['connect_statut'] == '0minirezo' AND $acces_admin == 'oui'))) {
+	// Afficher le titre du groupe
+	debut_cadre_enfonce("groupe-mot-24.gif", false, '', $titre_groupe);
+	
+	//
+	// Afficher les mots-cles du groupe
+	//
+	$result = spip_abstract_select(array('*'),
+								  array('spip_mots'),
+								  array("id_groupe = '$id_groupe'"),
+								  '', array('titre'));
+	$table = '';
+	
+	if (spip_abstract_count($result) > 0) {
+	  echo "<div class='liste'>";
+	  echo "<table border=0 cellspacing=0 cellpadding=3 width=\"100%\">";
+	  $i =0;
+	  $table[] = array(
+					   ' ' => 0,
+					   _T('motspartout:action') => 0,
+					   );
+	  while ($row = spip_abstract_fetch($result)) {
+		$i++;
+		$vals = '';
+		
+		$id_mot = $row['id_mot'];
+		$titre_mot = $row['titre'];
+		
+		$s = typo($titre_mot);
+		
+		$vals["<label for='id_mot$i'>$s</label>"] = calcul_numeros($show_mots,$id_mot,count($choses));
+		
+		$vals["<input type='checkbox' name='id_mots[]' id='id_mot$i' value='$id_mot'>"] = calcul_numeros($show_mots,$id_mot,count($choses));
+
+		$table[] = $vals;
+	  }
+	  
+  }
+	$largeurs = array(40, 10, 10);
+	$styles = array(
+					array('arial11',
+						  'diff-deplace',
+						  'diff-ajoute'),
+					array('arial1',
+						  'diff-para-deplace',
+						  'diff-para-ajoute'),
+					array('arial1',
+						  'diff-para-deplace',
+						  'diff-para-ajoute')
+					);
+	md_afficher_liste($largeurs, $table, $styles);
+	
+	echo "</table>";
+	echo "</div>";
+	spip_abstract_free($result);
+	
+	fin_cadre_enfonce();
+  }
+}
+spip_abstract_free($m_result_groupes);
+
 }
+//Milieu
+
+debut_droite();
+
+if(count($warnings) > 0) {
+  debut_cadre_relief('',false,'',_T('motspartout:ATTENTION'));
+  echo '<div class="liste"><table border=0 cellspacing=0 cellpadding=3 width=\"100%\">';
+  $largeurs = array('100%');
+  $styles = array( 'arial11');
+  afficher_liste($largeurs, $warnings, $styles);
+  echo '</table>';
+  echo '</div>';
+  fin_cadre_relief();
+}
+
+// Affichage de toutes les choses (on pourrait imaginer faire une pagination l?)
+debut_cadre_relief('',false,'document', _T('portfolio'));
+if(count($choses) > 0) {
+  $function = "afficher_liste_$nom_chose";
+  if(function_exists($function)) 
+	$function($choses);
+  else
+	afficher_liste_defaut($choses);
+?>
+<!--
+<input type="radio" name="selectall" id="all" onclick="selectAll(this.form, 'id_choses[]', 0);"><label for="all">Select All</label>
+<input type="radio" name="selectall" id="inverse"  onclick="selectAll(this.form, 'id_choses[]', 1);"><label for="inverse">Inverse All</label>
+-->
+<?php
+} else {
+  echo _T('motspartout:pas_de_documents').'.';
+}
+
+
+fin_cadre_relief();
+echo '</form>';
 ?>
 
 



