From stef at berlios.de  Sat Oct  1 00:06:58 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:06:58 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.8.2.1,1.8.2.2
Message-ID: <200509302206.j8UM6wmq011151@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv11118/ecrire

Modified Files:
      Tag: BRANCH-V1
	mes_options.php3 
Log Message:
commentaires

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8.2.1
retrieving revision 1.8.2.2
diff -u -d -r1.8.2.1 -r1.8.2.2
--- mes_options.php3	29 Sep 2005 23:42:58 -0000	1.8.2.1
+++ mes_options.php3	30 Sep 2005 22:06:55 -0000	1.8.2.2
@@ -155,14 +155,22 @@
 	return calculer_boucle($id_boucle, $boucles); 
 }
 
+//fonctions de transformation
 include_ecrire("inc_carto_fonctions.php3");
 
+//appel du plugin en dernier (peut g?n?rer du javascript)
 function apres_tout($texte) {
 	include_ecrire('plugins/plug_carto.php');
     return apres_tout_carto($texte);
 }
+
+//squelettes de carte disponibles 
+//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
 $GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
 			
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+//          FIN MODULE CARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 ?>



From stef at berlios.de  Sat Oct  1 00:07:19 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:07:19 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/js navTools.bak.js,1.1,NONE
Message-ID: <200509302207.j8UM7Jmq011184@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/js
In directory sheep:/tmp/cvs-serv11160/ecrire/js

Removed Files:
      Tag: BRANCH-V1
	navTools.bak.js 
Log Message:
vieux	

--- navTools.bak.js DELETED ---



From stef at berlios.de  Sat Oct  1 00:08:46 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:08:46 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1.2.2,1.1.2.3 spipcarto_en.php3,1.1.2.3,1.1.2.4
Message-ID: <200509302208.j8UM8kmq011344@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv11301/ecrire/lang

Modified Files:
      Tag: BRANCH-V1
	spipcarto_fr.php3 spipcarto_en.php3 
Log Message:
copyright et GPL

Index: spipcarto_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_fr.php3,v
retrieving revision 1.1.2.2
retrieving revision 1.1.2.3
diff -u -d -r1.1.2.2 -r1.1.2.3
--- spipcarto_fr.php3	29 Sep 2005 23:42:54 -0000	1.1.2.2
+++ spipcarto_fr.php3	30 Sep 2005 22:08:44 -0000	1.1.2.3
@@ -1,5 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
 
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // This is a SPIP language file  --  Ceci est un fichier langue de SPIP
 
 $GLOBALS[$GLOBALS['idx_lang']] = array(
@@ -23,7 +59,7 @@
 'carte_articles_use' => 'Articles utilisant cette carte',
 'carte_titre' => 'Titre de la carte', 
 'carte_fond' => 'Fond de carte',
-'carte_fond_numero' => '(Num?ro de l\'image Spip ou URL de l\'image)',
+'carte_fond_numero' => '(Num?ro de l\'image Spip)',
 'carte_callage' => 'Callage de la carte', 
 'carte_srs' => 'Syst?me de coordonn?es', 
 'carte_objets' => 'Objets de la carte',

Index: spipcarto_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_en.php3,v
retrieving revision 1.1.2.3
retrieving revision 1.1.2.4
diff -u -d -r1.1.2.3 -r1.1.2.4
--- spipcarto_en.php3	29 Sep 2005 23:42:54 -0000	1.1.2.3
+++ spipcarto_en.php3	30 Sep 2005 22:08:44 -0000	1.1.2.4
@@ -1,5 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
 
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // This is a SPIP language file  --  Ceci est un fichier langue de SPIP
 
 $GLOBALS[$GLOBALS['idx_lang']] = array(



From stef at berlios.de  Sat Oct  1 00:08:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:08:47 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6.2.2,1.6.2.3
Message-ID: <200509302208.j8UM8lmq011363@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv11301/ecrire/plugins

Modified Files:
      Tag: BRANCH-V1
	plug_carto.php 
Log Message:
copyright et GPL

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.6.2.2
retrieving revision 1.6.2.3
diff -u -d -r1.6.2.2 -r1.6.2.3
--- plug_carto.php	30 Sep 2005 00:16:43 -0000	1.6.2.2
+++ plug_carto.php	30 Sep 2005 22:08:45 -0000	1.6.2.3
@@ -1,7 +1,46 @@
 <?php
-// Ce plug-in ajoute le raccourci typographique <mapXX|align> 
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
+// Ce plug-in ajoute le raccourci typographique <mapXX|nom_squelette> 
 // XX est le numero de la carte
-// align fonctionne comme les images (left / center / right)
+// nom_squelette est suffixe du squelette de carte utilis?
+// ex : <map12|svg> presentera la carte n?12 avec le squelette caro_svg.html
 
 function apres_tout_carto($texte) {
 	



From stef at berlios.de  Sat Oct  1 00:08:47 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:08:47 +0200
Subject: [Spip-carto-cvs] spipcarto spip_carto.php,1.3,1.3.2.1 carto.php3,1.6,1.6.2.1
Message-ID: <200509302208.j8UM8lmq011358@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv11301

Modified Files:
      Tag: BRANCH-V1
	spip_carto.php carto.php3 
Log Message:
copyright et GPL

Index: spip_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_carto.php,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- spip_carto.php	20 Feb 2005 22:16:48 -0000	1.3
+++ spip_carto.php	30 Sep 2005 22:08:45 -0000	1.3.2.1
@@ -1,6 +1,43 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("ecrire/inc_version.php3");
-include ("ecrire/inc_connect.php3");
+//include ("ecrire/inc_connect.php3");
 
 if (isset($_GET["fond_carte"]) && !empty($_GET["fond_carte"])) 
 {

Index: carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- carto.php3	21 Jul 2005 21:47:12 -0000	1.6
+++ carto.php3	30 Sep 2005 22:08:45 -0000	1.6.2.1
@@ -1,10 +1,47 @@
 <?php 
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+//specifier ici le nom du sous repertoire du dossier squelette contenant
+//les squelettes de carte
 $rep_fond="template";
 //  valeurs par defaut
 //$delai=24*3600;
 
-// Securite : le squelette *doit* exister dans squelettes/
-// voir si 
 $flag_preserver = true;
 
 if (isset($contexte_inclus['fond'])) {



From stef at berlios.de  Sat Oct  1 00:08:46 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:08:46 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.5,1.1.2.6 inc_carto_import.php3,1.3,1.3.2.1 carte_edit.php3,1.18.2.3,1.18.2.4 carte_import.php3,1.4,1.4.2.1 inc_carto.php3,1.21.2.2,1.21.2.3 cartes.php3,1.5,1.5.2.1
Message-ID: <200509302208.j8UM8kmq011349@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv11301/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 inc_carto_import.php3 carte_edit.php3 
	carte_import.php3 inc_carto.php3 cartes.php3 
Log Message:
copyright et GPL

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.5
retrieving revision 1.1.2.6
diff -u -d -r1.1.2.5 -r1.1.2.6
--- inc_carto_fonctions.php3	29 Sep 2005 21:17:37 -0000	1.1.2.5
+++ inc_carto_fonctions.php3	30 Sep 2005 22:08:44 -0000	1.1.2.6
@@ -1,4 +1,42 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
 // Ce fichier ne sera execute qu'une fois
 if (defined("_ECRIRE_INC_CARTE")) return;
 define("_ECRIRE_INC_CARTE", "1");

Index: inc_carto_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_import.php3,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- inc_carto_import.php3	26 Sep 2005 10:17:03 -0000	1.3
+++ inc_carto_import.php3	30 Sep 2005 22:08:44 -0000	1.3.2.1
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // Ce fichier ne sera execute qu'une fois
 if (defined("_ECRIRE_INC_CARTE_IMPORT")) return;
 define("_ECRIRE_INC_CARTE_IMPORT", "1");

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.3
retrieving revision 1.18.2.4
diff -u -d -r1.18.2.3 -r1.18.2.4
--- carte_edit.php3	29 Sep 2005 23:42:58 -0000	1.18.2.3
+++ carte_edit.php3	30 Sep 2005 22:08:44 -0000	1.18.2.4
@@ -1,4 +1,42 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
 include ("inc.php3");
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_mots.php3");

Index: carte_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_import.php3,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- carte_import.php3	26 Sep 2005 10:17:03 -0000	1.4
+++ carte_import.php3	30 Sep 2005 22:08:44 -0000	1.4.2.1
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("inc.php3");
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_mots.php3");

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.21.2.2
retrieving revision 1.21.2.3
diff -u -d -r1.21.2.2 -r1.21.2.3
--- inc_carto.php3	29 Sep 2005 23:42:58 -0000	1.21.2.2
+++ inc_carto.php3	30 Sep 2005 22:08:44 -0000	1.21.2.3
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 
 //
 // Ce fichier ne sera execute qu'une fois

Index: cartes.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/cartes.php3,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- cartes.php3	26 Sep 2005 10:17:03 -0000	1.5
+++ cartes.php3	30 Sep 2005 22:08:44 -0000	1.5.2.1
@@ -1,5 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
 
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("inc.php3");
 
 include_ecrire ("inc_carto.php3");



From stef at berlios.de  Sat Oct  1 00:36:04 2005
From: stef at berlios.de (stef at berlios.de)
Date: Sat, 1 Oct 2005 00:36:04 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.4,1.18.2.5
Message-ID: <200509302236.j8UMa4mq023347@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv23172/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 
Log Message:
un oubli dans les initialisation ...
le dernier pour etre compatible PHP5 ?

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.4
retrieving revision 1.18.2.5
diff -u -d -r1.18.2.4 -r1.18.2.5
--- carte_edit.php3	30 Sep 2005 22:08:44 -0000	1.18.2.4
+++ carte_edit.php3	30 Sep 2005 22:36:00 -0000	1.18.2.5
@@ -56,6 +56,7 @@
 $supp_carte=stripslashes($_REQUEST['supp_carte']);
 $supp_confirme=stripslashes($_REQUEST['supp_confirme']);
 $supp_rejet=stripslashes($_REQUEST['supp_rejet']);
+$modif_carte=stripslashes($_REQUEST['modif_carte']);
 
 $selection_type=stripslashes($_REQUEST['selection_type']);
 $modif_objet=stripslashes($_REQUEST['modif_objet']);



From stef at berlios.de  Tue Oct  4 02:35:58 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:35:58 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.6,1.6.2.1 inc_tag-machine.php,1.1.2.1,1.1.2.2
Message-ID: <200510040035.j940Zwmq017830@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv17633/ecrire

Modified Files:
      Tag: BRANCH-V1
	mots_partout.php inc_tag-machine.php 
Log Message:
correction bug (filtrage par mots)
variable en _request => get ou post

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- mots_partout.php	18 Aug 2005 23:53:13 -0000	1.6
+++ mots_partout.php	4 Oct 2005 00:35:53 -0000	1.6.2.1
@@ -20,11 +20,19 @@
 //    along with this program; if not, write to the Free Software
 //    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 
-include ("inc.php3");
-include_ecrire ("inc_version.php3");
-include_ecrire ("inc_documents.php3");
-include_ecrire ("inc_abstract_sql.php3");
-include_ecrire ("inc_objet.php3");
+if(@file_exists('inc.php')){
+  include('inc.php');
+} else if(@file_exists('inc.php3')){
+  include('inc.php3');
+}
+if(@file_exists('inc_version.php')){
+  include('inc_version.php');
+} else if(@file_exists('inc_version.php3')){
+  include('inc_version.php3');
+}
+include_ecrire ("inc_documents"._EXTENSION_PHP);
+include_ecrire ("inc_abstract_sql"._EXTENSION_PHP);
+include_ecrire ("inc_objet"._EXTENSION_PHP);
 include_ecrire('inc_tag-machine.php');
 
 /***********************************************************************
@@ -270,7 +278,7 @@
   
   $from =  array($table);
   
-  $where = array("id_auteur = $connect_id_auteur", "$id_chose = $id");
+  $where = array("id_auteur = $connect_id_auteur", "$id_objet = $id");
   
   $result = spip_abstract_select($select,$from,$where);
   
@@ -373,9 +381,7 @@
 	$select = array('*');
 	$from = array('spip_documents');
 	$where = array("id_document = $id_document");
-	echo "<hr/>";
 	$results = spip_abstract_select($select,$from,$where);
-	echo "<hr/>";
 
 	if($document = spip_abstract_fetch($results)) {
 	  $id_vignette = $document['id_vignette'];
@@ -434,8 +440,7 @@
 	  
 	  // bloc titre et descriptif
 	  if (strlen($titre) > 0) {
-		echo "<div class='verdana2'><b>".typo($titre)."</b>";
-		echo '</div>';
+		echo '<div class=\'verdana2\' style=\'text-align:center;\'><b>'.typo($titre).'</b></div>';
 	  } else {
 		$nom_fichier = basename($fichier);
 		
@@ -526,10 +531,10 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"articles.php3?id_article=$id_article\"$descriptif$dir_lang style=\"display:block;\">";
+	$s .= "<a href=\"articles"._EXTENSION_PHP."?id_article=$id_article\"$descriptif$dir_lang style=\"display:block;\">";
 	
 	if ($spip_display != 1 AND $spip_display != 4 AND lire_meta('image_process') != "non") {
-	  include_ecrire("inc_logos.php3");
+	  include_ecrire("inc_logos"._EXTENSION_PHP);
 	  $logo = decrire_logo("arton$id_article");
 	  if ($logo) {
 		$fichier = $logo[0];
@@ -543,7 +548,7 @@
 		$hash = calculer_action_auteur ("reduire $w $h");
 		
 		$s.= "<div style='float: $spip_lang_right; margin-top: -2px; margin-bottom: -2px;'>
-<img src='../spip_image_reduite.php3?img="._DIR_IMG."$fichier&taille_x=$w&taille_y=$h&hash=$hash&hash_id_auteur=$connect_id_auteur' alt='$fichier' width='$w' height='$h' border='0'></div>";
+<img src='../spip_image_reduite"._EXTENSION_PHP."?img="._DIR_IMG."$fichier&taille_x=$w&taille_y=$h&hash=$hash&hash_id_auteur=$connect_id_auteur' alt='$fichier' width='$w' height='$h' border='0'></div>";
 		
 	  }
 	}
@@ -738,7 +743,7 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"bloogletter.php3?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
+	$s .= "<a href=\"bloogletter"._EXTENSION_PHP."?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
 	
 	$s .= typo($titre);
 	$s .= "</a>";
@@ -819,7 +824,7 @@
 	
 	// Le titre (et la langue)
 	$s = "<div>";
-	$s .= "<a href=\"auteur_edit.php3?id_auteur=$id_auteur\" style=\"display:block;\">";
+	$s .= "<a href=\"auteur_edit"._EXTENSION_PHP."?id_auteur=$id_auteur\" style=\"display:block;\">";
 	$s .= typo($login);
 	$s .= "</a>";
 	$s .= "</div>";
@@ -876,7 +881,7 @@
  * r?cuperation de la chose sur laquelle on travaille
  ***********************************************************************/
 
-$nom_chose = $HTTP_POST_VARS['nom_chose'];
+$nom_chose = $_REQUEST['nom_chose'];
 if(!isset($choses_possibles[$nom_chose])) {
   list($nom_chose,) = each($choses_possibles);
   reset($choses_possibles);
@@ -889,21 +894,21 @@
 /***********************************************************************
  * action
  ***********************************************************************/
-$mots = $HTTP_POST_VARS['id_mots'];
-$sans_mots = $HTTP_POST_VARS['sans_mots'];
-$choses = $HTTP_POST_VARS['id_choses'];
-$nom_tags = $HTTP_POST_VARS['nom_tags'];
-$limit =  $HTTP_POST_VARS['limit'];
-$id_limit =  $HTTP_POST_VARS['id_limit'];
+$mots = $_REQUEST['id_mots'];
+$sans_mots = $_REQUEST['sans_mots'];
+$choses = $_REQUEST['id_choses'];
+$nom_tags = $_REQUEST['nom_tags'];
+$limit =  $_REQUEST['limit'];
+$id_limit =  $_REQUEST['id_limit'];
 //echo "!!!".$nom_chose."!!!";
-//echo "action :".$HTTP_POST_VARS['switch']."<br>";
+//echo "action :".$_REQUEST['switch']."<br>";
 //echo "choses :".serialize($choses)."<br>";
 //echo "mots :".serialize($mots)."<br>";
 //echo "sans_mots :".serialize($sans_mots)."<br>";
 //echo "nom_tags :".serialize($nom_tags)."<br>";
 //echo "limit :".serialize($limit)."<br>";
 
-if($HTTP_POST_VARS['switch'] == 'action' && count($choses)) {
+if($_REQUEST['switch'] == 'action' && count($choses)) {
 	if(count($mots)) {
 	  foreach($mots as $m) {	
 		$from = array('spip_mots');
@@ -956,13 +961,13 @@
 		}
 	}
 	if ($nom_tags){
-		$tags = parser_liste($nom_tags);
+		$tags = new ListeTags($nom_tags,'Tag');
 //		echo "!!!!!!!tag:".$nom_tags."/".serialize($tags)."!!!!!!!!!";
 		foreach($choses as $d) {
-			if($HTTP_POST_VARS['bouton'] == 'ajouter')
-			  ajouter_liste_mots($tags,$d,'',$nom_chose,$id_chose);
-			if($HTTP_POST_VARS['bouton'] == 'retirer')
-			  retirer_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+			if($_REQUEST['bouton'] == 'ajouter')
+			  $tags->ajouter($d,$nom_chose,$id_chose);
+			if($_REQUEST['bouton'] == 'retirer')
+			  $tags->retirer($d,$nom_chose,$id_chose);
 		}
 	}
 }
@@ -989,7 +994,7 @@
 	  $from[1] = "spip_mots_$nom_chose as table_temp";
 	  $where[1] = "table_temp.$id_chose = main.$id_chose";
 	  $where[] = "table_temp.id_mot IN (".calcul_in($mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -999,7 +1004,7 @@
 	  $from[1] = "spip_mots_$nom_chose as table_temp";
 	  $where[1] = "table_temp.$id_chose = main.$id_chose";
 	  $where[] = "table_temp.id_mot not IN (".calcul_in($sans_mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1009,7 +1014,7 @@
   	if(count($mots) > 0) {
 	  $from[0] = "spip_mots_$nom_chose as main";
 	  $where[] = "main.id_mot IN (".calcul_in($mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1018,7 +1023,7 @@
   	if(count($sans_mots) > 0) {
 	  $from[0] = "spip_mots_$nom_chose as main";
 	  $where[] = "main.id_mot not IN (".calcul_in($sans_mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1054,7 +1059,7 @@
 		}
 		spip_abstract_free($test);
 	  }
-	  if(count($mots) > 0 && $HTTP_POST_VARS['strict']) {
+	  if(count($mots) > 0 && $_REQUEST['strict']) {
 		if($row['tot'] >= count($mots)) {
 		  $choses[] = $row[$id_chose];
 		} else {
@@ -1162,7 +1167,7 @@
 if(count($choses)) {
 // 	echo '<a name="action"></a><form action="mots_partout.php#voir">';
 
-  echo '<input type="hidden" name="nom_chose" value="'.$HTTP_POST_VARS['nom_chose'].'">';  
+  echo '<input type="hidden" name="nom_chose" value="'.$_REQUEST['nom_chose'].'">';  
 //  echo "<input type='hidden' name='id_limit' value='$id_limit'>";
 //  echo "<input type='hidden' name='limit' value='$limit'>";
 //  for($i=0; $i < count($choses); $i++) {
@@ -1188,17 +1193,32 @@
 </td>
 </tr>
 	<tr class='tr_liste'>
-	  <td colspan=2><textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea></td>
-	   </tr>
-	   <tr class='tr_liste'>
+	  <td colspan=2>
+		<textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea></td>
+<?php 
+	/*<div style="position:relative;overflow:visible; width: 10em;">
+        <input autocomplete="off" type="texte" id="tags" name="nom_tags" class='forml' cols='40' style="width: 100%;">
+        <div id="suggest" class="suggest_list" style="width: 100%;"></div>
+      </div>*/ 
+?>
+	  </td>
+	 </tr>
+	 <tr class='tr_liste'>
 	   <td colspan=2><button type='submit' name='switch' value='action'>
 	   <?php echo _T('bouton_valider'); ?>
 	   </button></td>
 		   </tr>
 		   </table>
 		   </div>
-		   
-<?php
+<?php 
+/*<link rel="stylesheet" type="text/css" href="./ajaxTagMachine.css">
+<script  type='text/javascript' src="./ajaxTagMachine.js">
+</script>
+  <script  type='text/javascript'> <!--
+	groupe = new AjaxSuggestMenu('ajax_mortimer.php', 'titre', 'tags','suggest');
+	groupe.addVar('nom_chose','<?php echo $nom_chose; ?>');
+	groupe.setNbrLineVisible(5);
+  	--></script>*/ 
 		   
   fin_cadre_enfonce();
  creer_colonne_droite();

Index: inc_tag-machine.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_tag-machine.php,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -u -d -r1.1.2.1 -r1.1.2.2
--- inc_tag-machine.php	28 Sep 2005 15:24:49 -0000	1.1.2.1
+++ inc_tag-machine.php	4 Oct 2005 00:35:53 -0000	1.1.2.2
@@ -25,18 +25,24 @@
 if (defined("_LIB_INC_TAG_MACHINE")) return;
 define("_LIB_INC_TAG_MACHINE", "1");
 
-if(@file_exists('ecrire/inc_version.php')){
-include('ecrire/inc_version.php');
-}elseif(@file_exists('ecrire/inc_version.php3')){
-include('ecrire/inc_version.php3');
-}elseif(@file_exists('inc_version.php')){
-include('inc_version.php');
-}elseif(@file_exists('inc_version.php3')){
-include('inc_version.php3');
+if (!defined("_ECRIRE_INC_VERSION")) {
+   if(@file_exists('ecrire/inc_version.php')){
+   include('ecrire/inc_version.php');
+   }elseif(@file_exists('ecrire/inc_version.php3')){
+   include('ecrire/inc_version.php3');
+   }elseif(@file_exists('inc_version.php')){
+   include('inc_version.php');
+   }elseif(@file_exists('inc_version.php3')){
+   include('inc_version.php3');
+   }
 }
 $path_inc_abstract_sql="inc_abstract_sql". _EXTENSION_PHP ;
 include_ecrire ($path_inc_abstract_sql);
 
+function entableau($tag) {
+  return array('groupe' => $tag->type, 'tag' => $tag->titre);
+}
+
 /**
    Ajoute les mots clefs dans la liste pass?e en param?tre au bon objet.
    Si le mot clef n'existe pas, on le cr?e,
@@ -57,80 +63,8 @@
 							$nom_objet='documents',
 							$id_objet='id_document',
 							$clear = false) {
-  if($id) {
-	if ($clear) {
-	  spip_query("DELETE FROM spip_mots_$nom_objet WHERE $id_objet=$id");
-	}
-	for($i=0;$i<sizeof($tags);$i++) {
-	  $tag=$tags[$i]['tag'];
-	  $groupe = $tags[$i]['groupe'];
-	  $groupe = $groupe?$groupe:$groupe_defaut;
-	  
-	  $select_groupe = spip_abstract_select(array('id_groupe','unseul'), 
-											array('spip_groupes_mots'), 
-											array("titre = '$groupe'"));
-	  $id_groupe = 0;
-	  $add = true;
-	  if($groupe_row = spip_abstract_fetch($select_groupe)) {
-		$id_groupe = $groupe_row['id_groupe']; 
-		$unseul = $groupe_row['unseul'];
-		if ($unseul == 'oui') {
-		  // on verifie qu'il y a pas d?j? un mot associ?
-		  $celcount = spip_abstract_select(array('count(id_mot) as tot'), 
-										   array('spip_mots as mots',
-												 "spip_mots_$nom_objet as objets"), 
-										   array("mots.id_groupe = $id_groupe",
-												 "mots.id_mot = objets.id_mot"),
-											   'mots.id_groupe');
-		  if($numrow = spip_abstract_fetch($celcount) && $numrow['tot'] > 0) {
-			$add = false;
-			$warnings[] = array(_T('motspartout:dejamotgroupe',array('groupe' => $titre_groupe, 'chose' => $d)));
-		  }
-		  spip_abstract_free($celcount);
-		}
-	  } else {
-		$id_groupe = spip_abstract_insert("spip_groupes_mots",
-										  "(titre, $nom_objet, minirezo)",
-										  "('$groupe','oui','oui')");
-		$warnings[] = array('creer groupe '.$titre_groupe);
-	  }
-	  spip_abstract_free($select_groupe);
-	  
-	  if($add) {
-		$select = array('id_mot');
-		$from = array('spip_mots');
-		$where = array("titre = '$tag'",
-					   "type='$groupe'");
-		$result = spip_abstract_select($select,$from,$where);
-		
-		if (spip_abstract_count($result) == 0){
-		  $id_mot = spip_abstract_insert("spip_mots",
-										 '(id_groupe, type, titre)', 
-										 "('$id_groupe','$groupe','$tag')");
-		  $result2 = spip_abstract_insert("spip_mots_$nom_objet",
-										  "(id_mot,$id_objet)",
-										   "($id_mot,$id)");
-		  $warnings[] = array('creer mot '.$tag);
-		} else {
-		  while ($row = spip_fetch_array($result)) {
-			$id_mot = $row['id_mot'];
-			$result3 = spip_abstract_select(array('id_mot'),
-											array("spip_mots_$nom_objet"),
-											array("id_mot='$id_mot'","$id_objet = $id"));
-			if (spip_abstract_count($result3) == 0) {
-			  spip_abstract_insert("spip_mots_$nom_objet",
-								   "(id_mot, $id_objet)",
-								   "('$id_mot','$id')");
-			}
-			spip_abstract_free($result3);	  
-		  }
-		}
-		spip_abstract_free($result);	 
-	  }
-	}
-	return $warnings;
-  } else 
-	return array();
+  $tags = new ListeTags($tags,$groupe_defaut);
+  $tags->ajouter($id, $nom_objet, $id_objet,$clear);
 }
 
 
@@ -140,8 +74,8 @@
 					  $nom_objet='documents',
 					  $id_objet='id_document',
 					  $clear = false) {
-						return ajouter_liste_mots(parser_liste($liste_tags), $id, $groupe_defaut, $nom_objet, $id_objet,$clear);
-  return array();
+  $tags = new ListeTags($liste_tags,$groupe_defaut);
+  $tags->ajouter($id, $nom_objet, $id_objet,$clear);
 }
 
 /**
@@ -160,24 +94,8 @@
 							$groupe_defaut='',
 							$nom_objet='documents',
 							$id_objet='id_document') {
-  if($id) {
-	for($i=0;$i<sizeof($tags);$i++) {
-	  $tag=$tags[$i]['tag'];
-	  $groupe = $tags[$i]['groupe'];
-	  $groupe = $groupe?$groupe:$groupe_defaut;
-	  
-	  $select = array('id_mot');
-	  $from = array('spip_mots');
-	  $where = array("titre = '$tag'",
-					 "type='$groupe'");
-	  
-	  $result = spip_abstract_select($select,$from,$where);
-	  if ($row = spip_abstract_fetch($result)){
-		spip_query("DELETE FROM spip_mots_$nom_objet WHERE id_mot=".$row['id_mot']." AND $id_objet=$id");
-	  }
-	  spip_abstract_free($result);
-	}
-  }
+  $tags = new ListeTags($tags,$groupe_defaut);
+  $tags->retirer($id, $nom_objet, $id_objet);
 }
 
 function retirer_mots($liste_tags,
@@ -185,61 +103,352 @@
 					  $groupe_defaut='',
 					  $nom_objet='documents',
 					  $id_objet='id_document') {
-  if($liste_tags) retirer_liste_mots(parser_liste($liste_tags), $id, $groupe_defaut, $nom_objet, $id_objet);
+  $tags = new ListeTags($liste_tags,$groupe_defaut);
+  $tags->retirer($id, $nom_objet, $id_objet);
 }
 
-/*Retourn un tableau de tags qui sont associ? ? l'objet, si necessaire entre guillemet*/
-function get_tags($id,
-				  $groupe_defaut='',
-				  $nom_objet='documents',
-				  $id_objet='id_document') {
-  $result = spip_abstract_select(array('titre','type'),
-								 array("spip_mots_$nom_objet",'spip_mots'),
-								  array("spip_mots_$nom_objet.id_mot=spip_mots.id_mot","spip_mots_$nom_objet.$id_objet = $id"));
+function parser_liste($liste_tags) {
+  $tags = new ListeTags($liste_tags,'');
+  return array_map('entableau',$tags->getTags());
+}
+
+?>
+
+<?php
+/*des objets*/
+
+class Tag {
+ var $titre;
+ var $type;
+ var $id_mot;
+ var $id_groupe;
+
+ function Tag($titre, $type='', $id_groupe='') {
+	$this->titre = $titre;
+	$this->id_groupe = $id_groupe;
+	$this->type = $type;
+  }
+
+  /*  function Tag($id_mot,$id_groupe) {
+	$this->id_mot = $id_mot;
+	$this->id_groupe = $id_groupe;
+  }*/
+
+ function getID() {
+	return $this->id_mot;
+  }
+
+  /*public*/ function getIDGroupe() {
+	return $this->id_groupe;
+  }
+
+  /*public*/ function getTitre() {
+	return $this->titre;
+  }
+
+  /*public*/ function getType() {
+	return $this->type;
+  }
+
+  /*public*/ function getTitreEchappe() {
+      return (strpos($this->titre,' ') || strpos($this->titre,':') || strpos($this->titre,','))?'"'.$this->titre.'"':$this->titre;
+  }
+
+  /*public*/ function getTypeEchappe() {
+      return (strpos($this->type,' ') || strpos($this->type,':') || strpos($this->type,','))?'"'.$this->type.'"':$this->type;
+  }
+
+
+ function echapper() {
+   $cgroupe = $this->type;
+   $ctag = $this->titre;
+   
+   $cgroupe = (strpos($cgroupe,' ') || strpos($cgroupe,':') || strpos($cgroupe,','))?'"'.$cgroupe.'"':$cgroupe;
+   $ctag = (strpos($ctag,' ') || strpos($ctag,':') || strpos($ctag,','))?'"'.$ctag.'"':$ctag;
+   
+   return (($cgroupe)? ($cgroupe.':'):'').$ctag;
+ }
   
-  $to_ret = array();
-  while ($row = spip_abstract_fetch($result)) {
-	$groupe = '';
-	if($groupe == $groupe_defaut) {
-	  $groupe = $groupe_defaut;
-	  if(strpos($groupe,' ') || strpos($groupe,':')) {
-		$groupe = "\"groupe\"";
+  //----------------------------------------------------------------------
+
+  /*private*/ function verifier($nom_objet) {
+   list($id_groupe,$unseul,$titre) = $this->verifier_groupe();
+	if($id_groupe > 0) {
+	  if ($unseul == 'oui') {
+		// on verifie qu'il y a pas d?j? un mot associ?
+		$celcount = spip_abstract_select(array('count(id_mot) as tot'), 
+										 array('spip_mots as mots',
+											   "spip_mots_$nom_objet as objets"), 
+										 array("mots.id_groupe = $id_groupe",
+											   "mots.id_mot = objets.id_mot"),
+										 'mots.id_groupe');
+		if($numrow = spip_abstract_fetch($celcount) && $numrow['tot'] > 0) {
+		  return false;
+		}
+		spip_abstract_free($celcount);
 	  }
+	} else if($this->type) {
+	  spip_log("cr?ation du groupe $this->type");
+	  $id_groupe = spip_abstract_insert("spip_groupes_mots",
+										"(titre, $nom_objet, minirezo)",
+										"('".addslashes($this->type)."','oui','oui')");
+	}	
+	
+	return $id_groupe;
+  }
+  
+  /*private*/ function verifier_groupe() {
+	static $groupes_verifie;
+	static $groupes_verifie_id;
+	if($this->type) {
+	  if(!isset($groupes_verifie[$this->type])) {
+		$select_groupe = spip_abstract_select(array('id_groupe','unseul'), 
+											  array('spip_groupes_mots'), 
+											  array("titre = '".addslashes($this->type)."'"));
+		if($groupe_row = spip_abstract_fetch($select_groupe)) {
+		$id = $groupe_row['id_groupe']; 
+		$unseul = $groupe_row['unseul'];
+		$groupes_verifie[$this->type] = array($id,$unseul,$this->type);
+		}
+	   
+		spip_abstract_free($select_groupe);
+	  }
+	  return $groupes_verifie[$this->type];
+	} else 	if($this->id_groupe) {
+	  if(!isset($groupes_verifie_id[$this->id_groupe])) {
+		$select_groupe = spip_abstract_select(array('titre','unseul'), 
+											  array('spip_groupes_mots'), 
+											  array("id_groupe = $this->id_groupe"));
+		if($groupe_row = spip_abstract_fetch($select_groupe)) {
+		$type = $groupe_row['titre']; 
+		$unseul = $groupe_row['unseul'];
+		$groupes_verifie_id[$this->id_groupe] = array($this->id_groupe,$unseul,$type);
+		}
+	   
+		spip_abstract_free($select_groupe);
+	  }
+	  return $groupes_verifie_id[$this->id_groupe];
 	}
-	$mot = $row['titre'];
-	if(strpos($mot,' ') || strpos($mot,':')) {
-	  $groupe = "\"groupe\"";
+	return array(0,'');
+  }
+
+  //----------------------------------------------------------------------
+
+  function creer($nom_objet) {
+	if(!$this->id_mot && ($this->id_groupe = $this->verifier($nom_objet)) > 0) {
+	  $select = array('id_mot');
+	  $from = array('spip_mots');
+	  $where = array("titre = '".$this->titre."'");
+	  if($this->type) {$where[] = "type='".$this->type."'";}
+	  else if($this->id_groupe) {$where[] = "id_groupe='".$this->id_groupe."'";}
+	  $result = spip_abstract_select($select,$from,$where);
+	  if ($row = spip_fetch_array($result)) {
+		$this->id_mot = $row['id_mot'];
+	  } else {
+		 if($this->id_groupe) {
+		   spip_log("Creer le mot $this->type:$this->titre ($this->id_mot)");
+		   $this->id_mot = spip_abstract_insert("spip_mots",
+												'(id_groupe, type, titre)', 
+												"('".$this->id_groupe."','".addslashes($this->type)."','".addslashes($this->titre)."')");		   
+		 }
+	  }
+	  spip_abstract_free($result);	 
 	}
-	$to_ret[] = $groupe.($groupe)? ':':''.$mot;
+	return $this->id_mot;
   }
-  spip_abstract_free($result);
-  return $to_ret;
+
+  function ajouter($id, $nom_objet, $id_objet) {
+	if($id) {
+	  if(!$this->id_mot) {
+		$this->creer($nom_objet);
+	  }  
+	  $select = array('id_mot');
+	  $from = array("spip_mots_$nom_objet");
+	  $where = array("id_mot = '$this->id_mot'",
+					 "$id_objet = '$id'");
+	  $result = spip_abstract_select($select,$from,$where);
+	  if (spip_abstract_count($result) == 0) {
+		spip_abstract_insert("spip_mots_$nom_objet",
+							 "(id_mot,$id_objet)",
+							 '('.$this->id_mot.",$id)");
+	  }
+	  spip_abstract_free($result);	 
+	} else
+	  spip_log("id_objet non d?fini");
+  }
+
+  function retirer($id, $nom_objet, $id_objet) {
+	if ($this->id_mot){
+	  spip_query("DELETE FROM spip_mots_$nom_objet WHERE id_mot=".$this->id_mot." AND $id_objet=$id");
+	}
+  }
+
 }
 
-function parser_liste($liste_tags) {
+class ListeTags {
+
+  //------------------------------- Variables -------------------------------------
+
+  /*private*/ var $tags = array();
+  var $groupe_defaut;
+  var $id_objet;
+
+  //------------------------------- Constructeurs ---------------------------------
+
+  /*public*/ function ListeTags($liste_tags,
+								$groupe_defaut='',
+								$id_groupe='') {
+	if(!$groupe_defaut && !$id_groupe) {
+	  echo 'You must specify either an id_groupe or a groupe_defaut';
+	  exit;
+	}
+	$this->groupe_defaut = $groupe_defaut;
+	$this->id_groupe = $id_groupe;
+	  
+	if(!is_array($liste_tags)) {
+	  $this->tags = $this->parser_liste($liste_tags);
+	} else {
+	  $this->tags = $liste_tags;
+	}
+  }
+
+  /*public*/ /*function ListeTags($id,
+							$groupe_defaut='',
+							$nom_objet='documents',
+							$id_objet='id_document') {
+	$result = spip_abstract_select(array('titre','type'),
+								   array("spip_mots_$nom_objet",'spip_mots'),
+								   array("spip_mots_$nom_objet.id_mot=spip_mots.id_mot",
+										 "spip_mots_$nom_objet.$id_objet = $id"));
+	
+	while ($row = spip_abstract_fetch($result)) {
+	  $this->tags[] = new Tag($row['titre'],$row['type']);
+	}
+	spip_abstract_free($result);
+	$this->groupe_defaut = $groupe_defaut;
+  }
+*/
+
+  //------------------------------- Info -----------------------------------------
+
+  function getTags() {
+	return $this->tags;
+  }
+  
+  // prend une liste de tags et retourne les id_mot reconnus (sans en creer)
+  function getTagsIDs() {
+	//?? Aller chercher les tags dans la boite
+	//?? pour faire plus generique : se baser sur id_$objet et/ou url_propre
+	//?? car " dans l'url arrive ici sous la forme &quot; (#ENV{tags} et non #ENV*{tags})
+	
+	$ids_mot = array();
+	foreach ($this->tags as $mot) {
+	  if (strlen($mot->titre)) {
+		$where = array(" titre='".addslashes($mot->titre)."'");
+		if(strlen($mot->type)) {
+		  $where[] = 'type=\''.addslashes($mot->type).'\'';
+		}
+		$results = spip_abstract_select(array('id_mot'),
+										array('spip_mots'),
+										$where
+										); //+ url_propre ? id_objet ?
+		list($id) = spip_abstract_fetch_array($results);
+		if ($id) 
+		  $ids_mot[] = $id;
+		spip_abstract_free($results);
+	  }
+	}
+	return $ids_mot;
+  }
+  
+  function toStringArray() {
+	$to_ret = array();
+	foreach($this->tags as $tag) {
+	  $to_ret[] = $tag->echapper();
+	}
+	return $to_ret;
+  }
 
+  //--------------------------------- Modif DB -----------------------------------
+  
+  function ajouter($id,
+				   $nom_objet='documents',
+				   $id_objet='id_document',
+				   $clear=false) {
+	if($id) {
+	  if ($clear) {
+		$result = spip_abstract_select(array('id_mot'),
+									   array('spip_mots'),
+									   array("spip_mots.type = '".addslashes($this->groupe_defaut)."' OR spip_mots.id_groupe = '".addslashes($this->id_groupe)."'")
+									   );
+		$motsaeffacer = array('0');
+		while ($row = spip_abstract_fetch($result)) {
+		  $motsaeffacer[] = $row['id_mot']; 
+		}
+		spip_abstract_free($result);
+		spip_log("Enleve les mots: ".join(',',$motsaeffacer));
+		spip_query("DELETE FROM spip_mots_$nom_objet WHERE $id_objet=$id AND id_mot IN (".join(',',$motsaeffacer).")");
+	  }
+	  foreach($this->tags as $mot) {
+		$mot->ajouter($id,$nom_objet,$id_objet);
+	  }
+	}
+  }
+
+  function retirer($id,
+				   $nom_objet='documents',
+				   $id_objet='id_document') {
+	
+	if($id) {
+	  foreach($this->tags as $mot) {
+		$mot->retirer($id,$nom_objet,$id_objet);
+	  }
+	}
+  }
+
+
+  //-------------------------------- Statique ------------------------------------
+  
+  //-- priv?
+  
+  /*private*/ /*static*/ function parser_liste($liste_tags) {
+	
+	$liste_tags = trim($liste_tags);
+	
 	// supprimer les tab (notre separateur final)
 	$liste_tags = strtr($liste_tags, "\t", " ");
-
+	
 	// doubler les caracteres qui peuvent faire office de separateur
 	$liste_tags = ' '.preg_replace('/[[:space:],]/', '\\0\\0', $liste_tags).' ';
-
+	
 	// trouver les tags et les separer par \t
 	$liste_tags = preg_replace('/[[:space:],]+("?)(.*?)\\1[[:space:],]/', "\t\\2", $liste_tags);
-
+	
 	// remettre les caracteres doubles en simple
 	$liste_tags = preg_replace('/([[:space:],])\\1/', '\\1', $liste_tags);
-
+	
 	// exploser selon les tab
 	$tags = split("\t", substr($liste_tags,1));
-
+	
 	// recuperer les groupes sous la forme  <groupe:mot>
 	foreach ($tags as $i => $tag) {
-		$tag = str_replace('"', '', $tag);
-		preg_match('/((.*):)?(.*)/', $tag, $regs);
-		$tags[$i] = array('groupe' => $regs[2], 'tag' => $regs[3]);
+	  $tag = str_replace('"', '', $tag);
+	  preg_match('/((.*):)?(.*)/', $tag, $regs);
+	  $groupe = $regs[2];
+	  if(!$groupe)
+		$groupe = $this->groupe_defaut;
+	  $tags[$i] = new Tag($regs[3], $groupe, $this->id_groupe);
 	}
-
+	
 	return $tags;
+  }
+  
+  function containsSeparateur($char) {
+	return (strpos($char,' ') || strpos($char,':') || strpos($char,','));
+  }
+ 
 }
+
 ?>
+
+



From stef at berlios.de  Tue Oct  4 02:36:31 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:36:31 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.5,1.18.2.6
Message-ID: <200510040036.j940aVmq018563@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv18466/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 
Log Message:
raccourci versmots_partout pour les admins

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.5
retrieving revision 1.18.2.6
diff -u -d -r1.18.2.5 -r1.18.2.6
--- carte_edit.php3	30 Sep 2005 22:36:00 -0000	1.18.2.5
+++ carte_edit.php3	4 Oct 2005 00:36:29 -0000	1.18.2.6
@@ -226,12 +226,19 @@
 fin_boite_info();
 
 
+
 if ($new!="oui") {
 	# modifs de la description d'un des docs joints
 	maj_documents($id_carte, 'carto_carte');
 	
 	# affichage
 	afficher_documents_colonne($id_carte, 'carto_carte', true);
+
+	debut_cadre_relief("mot-cle-24.gif");
+	if ($connect_statut == "0minirezo") {
+			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?chose=carto_cartes&limit=carto_cartes&id_limit=".$id_carte, "mot-cle-24.gif");
+	}
+	fin_cadre_relief();
 }
 
 debut_droite();



From stef at berlios.de  Tue Oct  4 02:53:41 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:53:41 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.6.2.1,1.6.2.2
Message-ID: <200510040053.j940rfmq029707@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv29599/ecrire

Modified Files:
      Tag: BRANCH-V1
	mots_partout.php 
Log Message:
un petit /td en trop ...

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6.2.1
retrieving revision 1.6.2.2
diff -u -d -r1.6.2.1 -r1.6.2.2
--- mots_partout.php	4 Oct 2005 00:35:53 -0000	1.6.2.1
+++ mots_partout.php	4 Oct 2005 00:53:36 -0000	1.6.2.2
@@ -1194,7 +1194,7 @@
 </tr>
 	<tr class='tr_liste'>
 	  <td colspan=2>
-		<textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea></td>
+		<textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea>
 <?php 
 	/*<div style="position:relative;overflow:visible; width: 10em;">
         <input autocomplete="off" type="texte" id="tags" name="nom_tags" class='forml' cols='40' style="width: 100%;">



From stef at berlios.de  Tue Oct  4 02:59:41 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:59:41 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_import.php3,1.3,1.4 mes_options.php3,1.8,1.9 inc_carto.php3,1.21,1.22 carte_import.php3,1.4,1.5 cartes.php3,1.5,1.6 inc_tag-machine.php,1.2,1.3 inc_documents.php3,1.7,1.8 carte_edit.php3,1.18,1.19 inc_carto_fonctions.php3,1.1,1.2 mots_partout.php,1.6,1.7 inc_getdocument.php3,1.7,1.8 inc_presentation.php3,1.12,1.13
Message-ID: <200510040059.j940xfmq030543@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv30408/ecrire

Modified Files:
	inc_carto_import.php3 mes_options.php3 inc_carto.php3 
	carte_import.php3 cartes.php3 inc_tag-machine.php 
	inc_documents.php3 carte_edit.php3 inc_carto_fonctions.php3 
	mots_partout.php inc_getdocument.php3 inc_presentation.php3 
Log Message:
synchro v1

Index: inc_carto_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_import.php3,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- inc_carto_import.php3	26 Sep 2005 10:17:03 -0000	1.3
+++ inc_carto_import.php3	4 Oct 2005 00:59:38 -0000	1.4
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // Ce fichier ne sera execute qu'une fois
 if (defined("_ECRIRE_INC_CARTE_IMPORT")) return;
 define("_ECRIRE_INC_CARTE_IMPORT", "1");

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8
retrieving revision 1.9
diff -u -d -r1.8 -r1.9
--- mes_options.php3	24 Sep 2005 01:00:22 -0000	1.8
+++ mes_options.php3	4 Oct 2005 00:59:38 -0000	1.9
@@ -155,12 +155,22 @@
 	return calculer_boucle($id_boucle, $boucles); 
 }
 
+//fonctions de transformation
 include_ecrire("inc_carto_fonctions.php3");
 
+//appel du plugin en dernier (peut g?n?rer du javascript)
 function apres_tout($texte) {
 	include_ecrire('plugins/plug_carto.php');
     return apres_tout_carto($texte);
 }
+
+//squelettes de carte disponibles 
+//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
+$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
+			
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+//          FIN MODULE CARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 ?>

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.21
retrieving revision 1.22
diff -u -d -r1.21 -r1.22
--- inc_carto.php3	26 Sep 2005 10:17:03 -0000	1.21
+++ inc_carto.php3	4 Oct 2005 00:59:38 -0000	1.22
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 
 //
 // Ce fichier ne sera execute qu'une fois
@@ -108,7 +145,7 @@
 		echo "</table>";
 		echo "</div>\n";
 	}
-	return $tous_id;
+	return;// $tous_id;
 }
 
 
@@ -132,31 +169,30 @@
 		$height=300;
 	};
 	
-	$returned='<script type="text/javascript" src="js/x_core_nn4.js"></script>
+	$returned=' <table border="0">
+  <tr> 
+   <td colspan="7"><script type="text/javascript" src="js/x_core_nn4.js"></script>
 <script type="text/javascript" src="js/x_dom_nn4.js"></script>
 <script type="text/javascript" src="js/x_event_nn4.js"></script>
 <script type="text/javascript" src="js/navTools.js"></script>
 <script type="text/javascript" src="js/graphTools.js"></script>
-<form method="get" action="#nouveau_objet" name="carto_form">
- <table border="0">
-  <tr> 
-   <td colspan="7">
+<form method="post" action="#nouveau_objet" name="carto_form">
 <script type="text/javascript">
 /*<![CDATA[*/ 
     var dhtmlDivs = new String();
     document.image = new Image;
     document.image.src = \''.$fichier.'\';
     document.image.usemap=\'#map'.$id_carte.'\';
-   if (xIE) {
+//   if (xIE) {
       dhtmlDivs = \'<div id="mapImageDiv" class="dhtmldiv" style="background-image:url(\'; 
       dhtmlDivs += document.image.src;
       dhtmlDivs += \');visibility:hidden;background-repeat:no-repeat;"></div>\';
-    } else {
+/*    } else {
       dhtmlDivs = \'<div id="mapImageDiv" class="dhtmldiv" style="visibility:hidden"><img \';
       dhtmlDivs += \'src="\' + document.image.src + \'" alt="Main map" title="" \';
-      dhtmlDivs += \'width="'.$width.'px" height="'.$height.'px" /></div>\';
-      
+      dhtmlDivs += \'width="'.$width.'px" height="'.$height.'px" /></div>\';    
     }
+*/
     dhtmlDivs += \'<div id="myCanvasDiv" class="dhtmldiv"></div>\';
     dhtmlDivs += \'<div id="myCanvas2Div" class="dhtmldiv"></div>\';
     dhtmlDivs += \'<div id="myCanvas3Div" class="dhtmldiv"></div>\';
@@ -240,6 +276,9 @@
    </td>
   </tr>
   <tr>
+   <td colspan="7">&nbsp;</td>
+  </tr>
+  <tr>
    <td> '._T("spipcarto:carte_draw").'
     <!--<input type="radio" name="tool" value="rectangle,submit,crossHair,zoom_in"  id="zoom_in" onclick="dhtmlBox.changeTool()" />
           zoom_in<br />-->
@@ -300,39 +339,50 @@
 
 	echo debut_block_invisible("ajouter_carte");
 	echo "<div class='verdana2'>";
-	echo _T("spipcarto:carte_insert_desc");
+	echo _T("spipcarto:carte_insert_texte");
 	echo "</div>";
 
+	$cartes_article=array();
+	$query = "SELECT id_carto_carte FROM spip_carto_cartes_articles where id_article=".$id_article;
+	$result = spip_query($query);
+	while($ligne=spip_fetch_array($result)) {
+		$cartes_article[]=$ligne[0];
+	}
 	$query = "SELECT id_carto_carte, titre FROM spip_carto_cartes ORDER BY titre";
 	$result = spip_query($query);
 	if (spip_num_rows($result)) {
 		echo "<br />\n";
-		echo "<div class='bandeau_rubriques' style='z-index: 1;'>";
-		echo "<div class='plan-articles'>";
 		while ($row = spip_fetch_array($result)) {
 			$id_carte = $row['id_carto_carte'];
+			$inclus=(in_array($id_carte,$cartes_article));
 			$titre = typo($row['titre']);
 			
 			$link = new Link("carte_edit.php3");
 			$link->addVar("id_carte", $id_carte);
 			$link->addVar("retour", $GLOBALS['clean_link']->getUrl());
-			echo "<a href='".$link->getUrl()."'>";
-			echo $titre."</a>\n";
-			echo "<div class='arial1' align='$spip_lang_right' style='color: black; padding-$spip_lang_left: 4px;' ".
+			echo "<div class='verdana3' style='border:1px;background-color: $couleur_claire;'>";
+			echo bouton_block_invisible("lien_carte$id_carte");
+			echo "<a href='".$link->getUrl()."'>".$titre."</a>\n";
+			echo debut_block_invisible("lien_carte$id_carte");
+			echo "<div class='arial1' align='$spip_lang_right' style='background-color: white;color: black; padding: 2px;margin: 0px;' ".
 				"title=\""._T("spipcarto:carte_raccourci").
 				"\">";
-			echo "<font color='333333'>";
-			echo "<div align='right'>"._T("spipcarto:carte_simple")." &lt;map$id_carte&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_logo")." &lt;map$id_carte|logo&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_lien")." &lt;map$id_carte|lien&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_svg")." &lt;map$id_carte|svg&gt;</div>";
- 			echo "<div align='right'>"._T("spipcarto:carte_svgx")." &lt;map$id_carte|svgx&gt;</div>";
-			echo "<div align='right'>"._T("spipcarto:carte_svggeo")." &lt;map$id_carte|svggeo&gt;</div>";
-			echo "</font>\n";
+			//liste des squelettes disponible : dans mes_options
+			$sq_cartes=$GLOBALS['sq_cartes'];
+			if (!is_array($sq_cartes)) $sq_cartes=array('map');
+			foreach ($sq_cartes as $sq_carte){
+				echo "<div align='right' style='color:#333333'";
+				if ($inclus) echo "style=\"text-weight: bold;\"> &lt;map".$id_carte."|".$sq_carte."&gt;";
+				else echo "><a href=\"javascript:barre_inserer('<map".$id_carte."|".$sq_carte.">',document.formulaire.texte)\">&lt;map".$id_carte."|".$sq_carte."&gt;</a>";
+				echo "</div>";
+			}
+
+			echo "</div>";
+			echo fin_block();
 			echo "</div>";
 		}
-		echo "</div>";
-		echo "</div>";
+	//	echo "</div>";
+	//	echo "</div>";
 	}
 
 	// Creer une carte

Index: carte_import.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_import.php3,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carte_import.php3	26 Sep 2005 10:17:03 -0000	1.4
+++ carte_import.php3	4 Oct 2005 00:59:38 -0000	1.5
@@ -1,4 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("inc.php3");
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_mots.php3");

Index: cartes.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/cartes.php3,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- cartes.php3	26 Sep 2005 10:17:03 -0000	1.5
+++ cartes.php3	4 Oct 2005 00:59:38 -0000	1.6
@@ -1,5 +1,41 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
 
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("inc.php3");
 
 include_ecrire ("inc_carto.php3");

Index: inc_tag-machine.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_tag-machine.php,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- inc_tag-machine.php	28 Sep 2005 23:40:50 -0000	1.2
+++ inc_tag-machine.php	4 Oct 2005 00:59:38 -0000	1.3
@@ -25,18 +25,24 @@
 if (defined("_LIB_INC_TAG_MACHINE")) return;
 define("_LIB_INC_TAG_MACHINE", "1");
 
-if(@file_exists('ecrire/inc_version.php')){
-include('ecrire/inc_version.php');
-}elseif(@file_exists('ecrire/inc_version.php3')){
-include('ecrire/inc_version.php3');
-}elseif(@file_exists('inc_version.php')){
-include('inc_version.php');
-}elseif(@file_exists('inc_version.php3')){
-include('inc_version.php3');
+if (!defined("_ECRIRE_INC_VERSION")) {
+   if(@file_exists('ecrire/inc_version.php')){
+   include('ecrire/inc_version.php');
+   }elseif(@file_exists('ecrire/inc_version.php3')){
+   include('ecrire/inc_version.php3');
+   }elseif(@file_exists('inc_version.php')){
+   include('inc_version.php');
+   }elseif(@file_exists('inc_version.php3')){
+   include('inc_version.php3');
+   }
 }
 $path_inc_abstract_sql="inc_abstract_sql". _EXTENSION_PHP ;
 include_ecrire ($path_inc_abstract_sql);
 
+function entableau($tag) {
+  return array('groupe' => $tag->type, 'tag' => $tag->titre);
+}
+
 /**
    Ajoute les mots clefs dans la liste pass?e en param?tre au bon objet.
    Si le mot clef n'existe pas, on le cr?e,
@@ -57,80 +63,8 @@
 							$nom_objet='documents',
 							$id_objet='id_document',
 							$clear = false) {
-  if($id) {
-	if ($clear) {
-	  spip_query("DELETE FROM spip_mots_$nom_objet WHERE $id_objet=$id");
-	}
-	for($i=0;$i<sizeof($tags);$i++) {
-	  $tag=$tags[$i]['tag'];
-	  $groupe = $tags[$i]['groupe'];
-	  $groupe = $groupe?$groupe:$groupe_defaut;
-	  
-	  $select_groupe = spip_abstract_select(array('id_groupe','unseul'), 
-											array('spip_groupes_mots'), 
-											array("titre = '$groupe'"));
-	  $id_groupe = 0;
-	  $add = true;
-	  if($groupe_row = spip_abstract_fetch($select_groupe)) {
-		$id_groupe = $groupe_row['id_groupe']; 
-		$unseul = $groupe_row['unseul'];
-		if ($unseul == 'oui') {
-		  // on verifie qu'il y a pas d?j? un mot associ?
-		  $celcount = spip_abstract_select(array('count(id_mot) as tot'), 
-										   array('spip_mots as mots',
-												 "spip_mots_$nom_objet as objets"), 
-										   array("mots.id_groupe = $id_groupe",
-												 "mots.id_mot = objets.id_mot"),
-											   'mots.id_groupe');
-		  if($numrow = spip_abstract_fetch($celcount) && $numrow['tot'] > 0) {
-			$add = false;
-			$warnings[] = array(_T('motspartout:dejamotgroupe',array('groupe' => $titre_groupe, 'chose' => $d)));
-		  }
-		  spip_abstract_free($celcount);
-		}
-	  } else {
-		$id_groupe = spip_abstract_insert("spip_groupes_mots",
-										  "(titre, $nom_objet, minirezo)",
-										  "('$groupe','oui','oui')");
-		$warnings[] = array('creer groupe '.$titre_groupe);
-	  }
-	  spip_abstract_free($select_groupe);
-	  
-	  if($add) {
-		$select = array('id_mot');
-		$from = array('spip_mots');
-		$where = array("titre = '$tag'",
-					   "type='$groupe'");
-		$result = spip_abstract_select($select,$from,$where);
-		
-		if (spip_abstract_count($result) == 0){
-		  $id_mot = spip_abstract_insert("spip_mots",
-										 '(id_groupe, type, titre)', 
-										 "('$id_groupe','$groupe','$tag')");
-		  $result2 = spip_abstract_insert("spip_mots_$nom_objet",
-										  "(id_mot,$id_objet)",
-										   "($id_mot,$id)");
-		  $warnings[] = array('creer mot '.$tag);
-		} else {
-		  while ($row = spip_fetch_array($result)) {
-			$id_mot = $row['id_mot'];
-			$result3 = spip_abstract_select(array('id_mot'),
-											array("spip_mots_$nom_objet"),
-											array("id_mot='$id_mot'","$id_objet = $id"));
-			if (spip_abstract_count($result3) == 0) {
-			  spip_abstract_insert("spip_mots_$nom_objet",
-								   "(id_mot, $id_objet)",
-								   "('$id_mot','$id')");
-			}
-			spip_abstract_free($result3);	  
-		  }
-		}
-		spip_abstract_free($result);	 
-	  }
-	}
-	return $warnings;
-  } else 
-	return array();
+  $tags = new ListeTags($tags,$groupe_defaut);
+  $tags->ajouter($id, $nom_objet, $id_objet,$clear);
 }
 
 
@@ -140,8 +74,8 @@
 					  $nom_objet='documents',
 					  $id_objet='id_document',
 					  $clear = false) {
-						return ajouter_liste_mots(parser_liste($liste_tags), $id, $groupe_defaut, $nom_objet, $id_objet,$clear);
-  return array();
+  $tags = new ListeTags($liste_tags,$groupe_defaut);
+  $tags->ajouter($id, $nom_objet, $id_objet,$clear);
 }
 
 /**
@@ -160,24 +94,8 @@
 							$groupe_defaut='',
 							$nom_objet='documents',
 							$id_objet='id_document') {
-  if($id) {
-	for($i=0;$i<sizeof($tags);$i++) {
-	  $tag=$tags[$i]['tag'];
-	  $groupe = $tags[$i]['groupe'];
-	  $groupe = $groupe?$groupe:$groupe_defaut;
-	  
-	  $select = array('id_mot');
-	  $from = array('spip_mots');
-	  $where = array("titre = '$tag'",
-					 "type='$groupe'");
-	  
-	  $result = spip_abstract_select($select,$from,$where);
-	  if ($row = spip_abstract_fetch($result)){
-		spip_query("DELETE FROM spip_mots_$nom_objet WHERE id_mot=".$row['id_mot']." AND $id_objet=$id");
-	  }
-	  spip_abstract_free($result);
-	}
-  }
+  $tags = new ListeTags($tags,$groupe_defaut);
+  $tags->retirer($id, $nom_objet, $id_objet);
 }
 
 function retirer_mots($liste_tags,
@@ -185,61 +103,352 @@
 					  $groupe_defaut='',
 					  $nom_objet='documents',
 					  $id_objet='id_document') {
-  if($liste_tags) retirer_liste_mots(parser_liste($liste_tags), $id, $groupe_defaut, $nom_objet, $id_objet);
+  $tags = new ListeTags($liste_tags,$groupe_defaut);
+  $tags->retirer($id, $nom_objet, $id_objet);
 }
 
-/*Retourn un tableau de tags qui sont associ? ? l'objet, si necessaire entre guillemet*/
-function get_tags($id,
-				  $groupe_defaut='',
-				  $nom_objet='documents',
-				  $id_objet='id_document') {
-  $result = spip_abstract_select(array('titre','type'),
-								 array("spip_mots_$nom_objet",'spip_mots'),
-								  array("spip_mots_$nom_objet.id_mot=spip_mots.id_mot","spip_mots_$nom_objet.$id_objet = $id"));
+function parser_liste($liste_tags) {
+  $tags = new ListeTags($liste_tags,'');
+  return array_map('entableau',$tags->getTags());
+}
+
+?>
+
+<?php
+/*des objets*/
+
+class Tag {
+ var $titre;
+ var $type;
+ var $id_mot;
+ var $id_groupe;
+
+ function Tag($titre, $type='', $id_groupe='') {
+	$this->titre = $titre;
+	$this->id_groupe = $id_groupe;
+	$this->type = $type;
+  }
+
+  /*  function Tag($id_mot,$id_groupe) {
+	$this->id_mot = $id_mot;
+	$this->id_groupe = $id_groupe;
+  }*/
+
+ function getID() {
+	return $this->id_mot;
+  }
+
+  /*public*/ function getIDGroupe() {
+	return $this->id_groupe;
+  }
+
+  /*public*/ function getTitre() {
+	return $this->titre;
+  }
+
+  /*public*/ function getType() {
+	return $this->type;
+  }
+
+  /*public*/ function getTitreEchappe() {
+      return (strpos($this->titre,' ') || strpos($this->titre,':') || strpos($this->titre,','))?'"'.$this->titre.'"':$this->titre;
+  }
+
+  /*public*/ function getTypeEchappe() {
+      return (strpos($this->type,' ') || strpos($this->type,':') || strpos($this->type,','))?'"'.$this->type.'"':$this->type;
+  }
+
+
+ function echapper() {
+   $cgroupe = $this->type;
+   $ctag = $this->titre;
+   
+   $cgroupe = (strpos($cgroupe,' ') || strpos($cgroupe,':') || strpos($cgroupe,','))?'"'.$cgroupe.'"':$cgroupe;
+   $ctag = (strpos($ctag,' ') || strpos($ctag,':') || strpos($ctag,','))?'"'.$ctag.'"':$ctag;
+   
+   return (($cgroupe)? ($cgroupe.':'):'').$ctag;
+ }
   
-  $to_ret = array();
-  while ($row = spip_abstract_fetch($result)) {
-	$groupe = '';
-	if($groupe == $groupe_defaut) {
-	  $groupe = $groupe_defaut;
-	  if(strpos($groupe,' ') || strpos($groupe,':')) {
-		$groupe = "\"groupe\"";
+  //----------------------------------------------------------------------
+
+  /*private*/ function verifier($nom_objet) {
+   list($id_groupe,$unseul,$titre) = $this->verifier_groupe();
+	if($id_groupe > 0) {
+	  if ($unseul == 'oui') {
+		// on verifie qu'il y a pas d?j? un mot associ?
+		$celcount = spip_abstract_select(array('count(id_mot) as tot'), 
+										 array('spip_mots as mots',
+											   "spip_mots_$nom_objet as objets"), 
+										 array("mots.id_groupe = $id_groupe",
+											   "mots.id_mot = objets.id_mot"),
+										 'mots.id_groupe');
+		if($numrow = spip_abstract_fetch($celcount) && $numrow['tot'] > 0) {
+		  return false;
+		}
+		spip_abstract_free($celcount);
 	  }
+	} else if($this->type) {
+	  spip_log("cr?ation du groupe $this->type");
+	  $id_groupe = spip_abstract_insert("spip_groupes_mots",
+										"(titre, $nom_objet, minirezo)",
+										"('".addslashes($this->type)."','oui','oui')");
+	}	
+	
+	return $id_groupe;
+  }
+  
+  /*private*/ function verifier_groupe() {
+	static $groupes_verifie;
+	static $groupes_verifie_id;
+	if($this->type) {
+	  if(!isset($groupes_verifie[$this->type])) {
+		$select_groupe = spip_abstract_select(array('id_groupe','unseul'), 
+											  array('spip_groupes_mots'), 
+											  array("titre = '".addslashes($this->type)."'"));
+		if($groupe_row = spip_abstract_fetch($select_groupe)) {
+		$id = $groupe_row['id_groupe']; 
+		$unseul = $groupe_row['unseul'];
+		$groupes_verifie[$this->type] = array($id,$unseul,$this->type);
+		}
+	   
+		spip_abstract_free($select_groupe);
+	  }
+	  return $groupes_verifie[$this->type];
+	} else 	if($this->id_groupe) {
+	  if(!isset($groupes_verifie_id[$this->id_groupe])) {
+		$select_groupe = spip_abstract_select(array('titre','unseul'), 
+											  array('spip_groupes_mots'), 
+											  array("id_groupe = $this->id_groupe"));
+		if($groupe_row = spip_abstract_fetch($select_groupe)) {
+		$type = $groupe_row['titre']; 
+		$unseul = $groupe_row['unseul'];
+		$groupes_verifie_id[$this->id_groupe] = array($this->id_groupe,$unseul,$type);
+		}
+	   
+		spip_abstract_free($select_groupe);
+	  }
+	  return $groupes_verifie_id[$this->id_groupe];
 	}
-	$mot = $row['titre'];
-	if(strpos($mot,' ') || strpos($mot,':')) {
-	  $groupe = "\"groupe\"";
+	return array(0,'');
+  }
+
+  //----------------------------------------------------------------------
+
+  function creer($nom_objet) {
+	if(!$this->id_mot && ($this->id_groupe = $this->verifier($nom_objet)) > 0) {
+	  $select = array('id_mot');
+	  $from = array('spip_mots');
+	  $where = array("titre = '".$this->titre."'");
+	  if($this->type) {$where[] = "type='".$this->type."'";}
+	  else if($this->id_groupe) {$where[] = "id_groupe='".$this->id_groupe."'";}
+	  $result = spip_abstract_select($select,$from,$where);
+	  if ($row = spip_fetch_array($result)) {
+		$this->id_mot = $row['id_mot'];
+	  } else {
+		 if($this->id_groupe) {
+		   spip_log("Creer le mot $this->type:$this->titre ($this->id_mot)");
+		   $this->id_mot = spip_abstract_insert("spip_mots",
+												'(id_groupe, type, titre)', 
+												"('".$this->id_groupe."','".addslashes($this->type)."','".addslashes($this->titre)."')");		   
+		 }
+	  }
+	  spip_abstract_free($result);	 
 	}
-	$to_ret[] = $groupe.($groupe)? ':':''.$mot;
+	return $this->id_mot;
   }
-  spip_abstract_free($result);
-  return $to_ret;
+
+  function ajouter($id, $nom_objet, $id_objet) {
+	if($id) {
+	  if(!$this->id_mot) {
+		$this->creer($nom_objet);
+	  }  
+	  $select = array('id_mot');
+	  $from = array("spip_mots_$nom_objet");
+	  $where = array("id_mot = '$this->id_mot'",
+					 "$id_objet = '$id'");
+	  $result = spip_abstract_select($select,$from,$where);
+	  if (spip_abstract_count($result) == 0) {
+		spip_abstract_insert("spip_mots_$nom_objet",
+							 "(id_mot,$id_objet)",
+							 '('.$this->id_mot.",$id)");
+	  }
+	  spip_abstract_free($result);	 
+	} else
+	  spip_log("id_objet non d?fini");
+  }
+
+  function retirer($id, $nom_objet, $id_objet) {
+	if ($this->id_mot){
+	  spip_query("DELETE FROM spip_mots_$nom_objet WHERE id_mot=".$this->id_mot." AND $id_objet=$id");
+	}
+  }
+
 }
 
-function parser_liste($liste_tags) {
+class ListeTags {
+
+  //------------------------------- Variables -------------------------------------
+
+  /*private*/ var $tags = array();
+  var $groupe_defaut;
+  var $id_objet;
+
+  //------------------------------- Constructeurs ---------------------------------
+
+  /*public*/ function ListeTags($liste_tags,
+								$groupe_defaut='',
+								$id_groupe='') {
+	if(!$groupe_defaut && !$id_groupe) {
+	  echo 'You must specify either an id_groupe or a groupe_defaut';
+	  exit;
+	}
+	$this->groupe_defaut = $groupe_defaut;
+	$this->id_groupe = $id_groupe;
+	  
+	if(!is_array($liste_tags)) {
+	  $this->tags = $this->parser_liste($liste_tags);
+	} else {
+	  $this->tags = $liste_tags;
+	}
+  }
+
+  /*public*/ /*function ListeTags($id,
+							$groupe_defaut='',
+							$nom_objet='documents',
+							$id_objet='id_document') {
+	$result = spip_abstract_select(array('titre','type'),
+								   array("spip_mots_$nom_objet",'spip_mots'),
+								   array("spip_mots_$nom_objet.id_mot=spip_mots.id_mot",
+										 "spip_mots_$nom_objet.$id_objet = $id"));
+	
+	while ($row = spip_abstract_fetch($result)) {
+	  $this->tags[] = new Tag($row['titre'],$row['type']);
+	}
+	spip_abstract_free($result);
+	$this->groupe_defaut = $groupe_defaut;
+  }
+*/
+
+  //------------------------------- Info -----------------------------------------
+
+  function getTags() {
+	return $this->tags;
+  }
+  
+  // prend une liste de tags et retourne les id_mot reconnus (sans en creer)
+  function getTagsIDs() {
+	//?? Aller chercher les tags dans la boite
+	//?? pour faire plus generique : se baser sur id_$objet et/ou url_propre
+	//?? car " dans l'url arrive ici sous la forme &quot; (#ENV{tags} et non #ENV*{tags})
+	
+	$ids_mot = array();
+	foreach ($this->tags as $mot) {
+	  if (strlen($mot->titre)) {
+		$where = array(" titre='".addslashes($mot->titre)."'");
+		if(strlen($mot->type)) {
+		  $where[] = 'type=\''.addslashes($mot->type).'\'';
+		}
+		$results = spip_abstract_select(array('id_mot'),
+										array('spip_mots'),
+										$where
+										); //+ url_propre ? id_objet ?
+		list($id) = spip_abstract_fetch_array($results);
+		if ($id) 
+		  $ids_mot[] = $id;
+		spip_abstract_free($results);
+	  }
+	}
+	return $ids_mot;
+  }
+  
+  function toStringArray() {
+	$to_ret = array();
+	foreach($this->tags as $tag) {
+	  $to_ret[] = $tag->echapper();
+	}
+	return $to_ret;
+  }
 
+  //--------------------------------- Modif DB -----------------------------------
+  
+  function ajouter($id,
+				   $nom_objet='documents',
+				   $id_objet='id_document',
+				   $clear=false) {
+	if($id) {
+	  if ($clear) {
+		$result = spip_abstract_select(array('id_mot'),
+									   array('spip_mots'),
+									   array("spip_mots.type = '".addslashes($this->groupe_defaut)."' OR spip_mots.id_groupe = '".addslashes($this->id_groupe)."'")
+									   );
+		$motsaeffacer = array('0');
+		while ($row = spip_abstract_fetch($result)) {
+		  $motsaeffacer[] = $row['id_mot']; 
+		}
+		spip_abstract_free($result);
+		spip_log("Enleve les mots: ".join(',',$motsaeffacer));
+		spip_query("DELETE FROM spip_mots_$nom_objet WHERE $id_objet=$id AND id_mot IN (".join(',',$motsaeffacer).")");
+	  }
+	  foreach($this->tags as $mot) {
+		$mot->ajouter($id,$nom_objet,$id_objet);
+	  }
+	}
+  }
+
+  function retirer($id,
+				   $nom_objet='documents',
+				   $id_objet='id_document') {
+	
+	if($id) {
+	  foreach($this->tags as $mot) {
+		$mot->retirer($id,$nom_objet,$id_objet);
+	  }
+	}
+  }
+
+
+  //-------------------------------- Statique ------------------------------------
+  
+  //-- priv?
+  
+  /*private*/ /*static*/ function parser_liste($liste_tags) {
+	
+	$liste_tags = trim($liste_tags);
+	
 	// supprimer les tab (notre separateur final)
 	$liste_tags = strtr($liste_tags, "\t", " ");
-
+	
 	// doubler les caracteres qui peuvent faire office de separateur
 	$liste_tags = ' '.preg_replace('/[[:space:],]/', '\\0\\0', $liste_tags).' ';
-
+	
 	// trouver les tags et les separer par \t
 	$liste_tags = preg_replace('/[[:space:],]+("?)(.*?)\\1[[:space:],]/', "\t\\2", $liste_tags);
-
+	
 	// remettre les caracteres doubles en simple
 	$liste_tags = preg_replace('/([[:space:],])\\1/', '\\1', $liste_tags);
-
+	
 	// exploser selon les tab
 	$tags = split("\t", substr($liste_tags,1));
-
+	
 	// recuperer les groupes sous la forme  <groupe:mot>
 	foreach ($tags as $i => $tag) {
-		$tag = str_replace('"', '', $tag);
-		preg_match('/((.*):)?(.*)/', $tag, $regs);
-		$tags[$i] = array('groupe' => $regs[2], 'tag' => $regs[3]);
+	  $tag = str_replace('"', '', $tag);
+	  preg_match('/((.*):)?(.*)/', $tag, $regs);
+	  $groupe = $regs[2];
+	  if(!$groupe)
+		$groupe = $this->groupe_defaut;
+	  $tags[$i] = new Tag($regs[3], $groupe, $this->id_groupe);
 	}
-
+	
 	return $tags;
+  }
+  
+  function containsSeparateur($char) {
+	return (strpos($char,' ') || strpos($char,':') || strpos($char,','));
+  }
+ 
 }
+
 ?>
+
+

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc_documents.php3	10 Aug 2005 12:00:38 -0000	1.7
+++ inc_documents.php3	4 Oct 2005 00:59:38 -0000	1.8
@@ -985,7 +985,7 @@
 	$link->addVar('ajout_doc', 'oui');
 	$link->addVar('mode', 'vignette');
 	$link->addVar('type', $type);
-	afficher_upload($link, $redirect_url, _T('info_telecharger'));
+	afficher_upload($link, $redirect_url, _T('info_telecharger'),'',true,true);
 
 	fin_cadre_relief();
 

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18
retrieving revision 1.19
diff -u -d -r1.18 -r1.19
--- carte_edit.php3	26 Sep 2005 10:17:03 -0000	1.18
+++ carte_edit.php3	4 Oct 2005 00:59:38 -0000	1.19
@@ -1,4 +1,42 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
 include ("inc.php3");
 include_ecrire ("inc_documents.php3");
 include_ecrire ("inc_mots.php3");
@@ -8,8 +46,27 @@
 //meme si il faut le faire ...
 //include_ecrire("inc_config.php3");
 
+$id_carte = intval($_REQUEST['id_carte']);
+$titre = stripslashes($_REQUEST['titre']);
+$url_carte = stripslashes($_REQUEST['url_carte']);
+$texte = stripslashes($_REQUEST['texte']);
+$callage = stripslashes($_REQUEST['callage']);
+$id_srs = intval($_REQUEST['id_srs']);
+$new =stripslashes($_REQUEST['new']);
+$supp_carte=stripslashes($_REQUEST['supp_carte']);
+$supp_confirme=stripslashes($_REQUEST['supp_confirme']);
+$supp_rejet=stripslashes($_REQUEST['supp_rejet']);
+$modif_carte=stripslashes($_REQUEST['modif_carte']);
+
+$selection_type=stripslashes($_REQUEST['selection_type']);
+$modif_objet=stripslashes($_REQUEST['modif_objet']);
+$objet_titre=stripslashes($_REQUEST['objet_titre']);
+$objet_texte=stripslashes($_REQUEST['objet_texte']);
+$url_objet=stripslashes($_REQUEST['url_objet']);
+$url_logo=stripslashes($_REQUEST['url_logo']);
+$geometrie=stripslashes($_REQUEST['geometrie']);
+
 $flag_editable=carte_editable($id_carte);
-$id_carte = intval($id_carte);
 $flag_mots = lire_meta("carto_mots");
 //$flag_mots = "oui";
 $nouveau=false;
@@ -45,7 +102,7 @@
 			if (!$callage)
 				if ($document_id=intval($url_carte)) {
 					//TODO : gerer type image et peut etre mime
-					$image = spip_fetch_array(spip_query("SELECT * FROM spip_documents WHERE id_document = $document_id"));;
+					$image = spip_fetch_array(spip_query("SELECT * FROM spip_documents WHERE id_document = $document_id"));
 					if ($image) $callage=array2worldfile($image);
 				}
 			//TODO : passer tout ca en spip_abstract ...
@@ -159,24 +216,29 @@
 echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='6'><b>$id_carte</b></font>\n";
 if ($url_carte && ($new!="oui")) {
 	echo "<br><font face='Verdana,Arial,Sans,sans-serif' size='1'><b>"._T('spipcarto:carte_apercu')."</b></font>\n";
-	icone_horizontale( _T('spipcarto:carte_img'), "../carto.php3?id_carto_carte=".$id_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_lien'), "../carto.php3?id_carto_carte=".$id_carte."&fond=lien&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_logo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=logo&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svg'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svg&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svgx'), "../carto.php3?id_carto_carte=".$id_carte."&fond=svgx&var_mode=recalcul", "racine-24.gif", "rien.gif");
-	icone_horizontale( _T('spipcarto:carte_svggeo'), "../carto.php3?id_carto_carte=".$id_carte."&fond=geosvgwms&var_mode=recalcul", "racine-24.gif", "rien.gif");
+	$sq_cartes=$GLOBALS['sq_cartes'];
+	if (!is_array($sq_cartes)) $sq_cartes=array('map');
+	foreach ($sq_cartes as $sq_carte)
+		icone_horizontale( _T('spipcarto:carte_'.$sq_carte), "../carto.php3?id_carto_carte=".$id_carte."&fond=".$sq_carte."&var_mode=recalcul", "racine-24.gif", "rien.gif");
 }
 echo "</div>\n";
 
 fin_boite_info();
 
 
+
 if ($new!="oui") {
 	# modifs de la description d'un des docs joints
 	maj_documents($id_carte, 'carto_carte');
 	
 	# affichage
 	afficher_documents_colonne($id_carte, 'carto_carte', true);
+
+	debut_cadre_relief("mot-cle-24.gif");
+	if ($connect_statut == "0minirezo") {
+			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?chose=carto_cartes&limit=carto_cartes&id_limit=".$id_carte, "mot-cle-24.gif");
+	}
+	fin_cadre_relief();
 }
 
 debut_droite();
@@ -186,7 +248,7 @@
 	echo _T("spipcarto:carte_supp_confirm")."</p>\n";
 	$link = $carte_supplink;//new Link();
 	//$link->addVar('supp_carte', $supp_carte);
-	echo $link->getform('GET');
+	echo $link->getform('POST');
 	echo "<input type='submit' name='supp_confirme' value=\""._T('item_oui')."\" class='fondl'>";
 	echo " &nbsp; ";
 	echo "<input type='submit' name='supp_rejet' value=\""._T('item_non')."\" class='fondl'>";
@@ -211,10 +273,9 @@
 		echo "<br />";
 		debut_cadre_relief();
 		
-		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>&nbsp;";
+		echo "<div style='padding: 2px; background-color: $couleur_claire; color: black;'>";
 		echo bouton_block_visible("dhtml_carte");
-		echo "<strong class='verdana3' style='text-transform: uppercase;'>"
-			._T("spipcarto:objet_add")."</strong>";
+		echo "<strong class='verdana3' style='text-transform: uppercase;'>&nbsp;"._T("spipcarto:objet_add")."</strong>";
 		echo "</div>\n";
 		
 		echo debut_block_visible("dhtml_carte");
@@ -282,7 +343,7 @@
 	echo "<div class='verdana2'>";
 	$link = $carte_link;
 	$link->addVar('modif_carte', $id_carte);
-	echo $link->getForm('GET');
+	echo $link->getForm('POST');
 	
 	echo "<strong><label for='titre_carte'>"._T("spipcarto:carte_titre")."</label></strong> "._T('info_obligatoire_02');
 	echo "<br />";
@@ -295,7 +356,7 @@
 	echo $texte;
 	echo "</textarea><br />\n";
 
-	if ($new) {
+	if ($new=="oui") {
 		echo "<input type='hidden' name='url_carte' id='url_carte_carte' ".
 			"value=\"".$url_carte."\" size='40'>";
 		
@@ -337,7 +398,7 @@
 	//
 	// Modifier / supprimer les objets
 	//
-	if (!$new) {
+	if ($new!="oui") {
 		echo "<a name='objets'></a>";
 		echo "<p><hr><p>\n";
 		echo "<div class='verdana3'>";
@@ -376,7 +437,7 @@
 			$geometrie = entites_html($t['geometrie']);
 	
 			$visible = ($id_objet == $objet_visible);
-			if ($nouveau) echo "<a name='nouveau_objet'></a>";
+			if ($nouveau&&$visible) echo "<a name='nouveau_objet'></a>";
 			else if ($visible) echo "<a name='objet_visible'></a>";
 			echo "<p>\n";
 			debut_cadre_relief();
@@ -384,7 +445,7 @@
 				// Modifier un objet
 				$link = $carte_link;
 				$link->addVar('modif_objet', $id_objet);
-				echo $link->getForm('GET', '#objet_visible');
+				echo $link->getForm('POST', '#objet_visible');
 				echo "<div class='verdana2'>";
 				echo "<table>";
 					echo "<tr valign='top'><td>";

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- inc_carto_fonctions.php3	24 Sep 2005 00:51:43 -0000	1.1
+++ inc_carto_fonctions.php3	4 Oct 2005 00:59:38 -0000	1.2
@@ -1,4 +1,42 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
 // Ce fichier ne sera execute qu'une fois
 if (defined("_ECRIRE_INC_CARTE")) return;
 define("_ECRIRE_INC_CARTE", "1");
@@ -183,10 +221,28 @@
 	$rgeo 		= round($radius*$GeoWidth/$ImgWidth);
 	$callage 	= worldfile2array ($callage);
 	
-	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage);
+	if (function_exists($format)) return $format($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc);
 	else return "";
 }
+///////////////////////////////////////////////
+// JSDHTML
+///////////////////////////////////////////////
+function wkt2coords_jsdhtml($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
+
+			$coordpair = explode (',',$wktGeom);
+			
+			for ($i=0; $i<sizeof($coordpair); $i++)
+			{		
+				$coord[$i] 		= explode(' ',$coordpair[$i]);
+				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
+				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
+ 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
+ 				$coordpair[$i] 	= implode(',',$coord[$i]);
+			}
+			$wktGeom = implode(',', $coordpair);
 
+			return $wktGeom;
+}
 ///////////////////////////////////////////////
 // HTML
 ///////////////////////////////////////////////
@@ -197,7 +253,7 @@
 				return "CIRCLE"; 
 			// HTML Image map ne supporte pas les lignes
 }
-function wkt2coords_html($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_html($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 
 			// Pour obtenir des objets HTML/MAP ...
 			// 	S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ','
@@ -215,10 +271,10 @@
 			if (strcasecmp($wktGeomType,"POLYGON")==0)
 				return $wktGeom;
 			else if (strcasecmp($wktGeomType,"POINT")==0)
-				return $wktGeom.",".$radius;
+				return $wktGeom.",6";//.$radius;
 			else return "";
 }
-function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_htmldiv($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 			// Pour obtenir des objets HTML/DIV ...
 			// Pour les polygones, la moyenne des valeurs
 			// Pour les points, la valeur
@@ -249,7 +305,7 @@
 			else return "";
 }
 
-function wkt2coords_svg($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+function wkt2coords_svg($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage,$mot_desc){	
 			// Pour obtenir des objets SVG ...
 			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
 			// S?parateur coordonn?es ',' / S?parateur paires de coordonn?es ' '
@@ -267,59 +323,10 @@
 			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0){  	
 				return "points=\"".$wktGeom."\"";		
 			} elseif (strcasecmp($wktGeomType,"POINT")==0){	
-				$coordTab = explode (" ", $wktGeom);
-				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
-			}
-}
-function wkt2coords_svggeo($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
-			// Pour obtenir des objets SVG ...
-			// Conservation des Y selon le format WKT car en coordonn?es g?ographique
-			// S?parateur coordonn?es ' ' / S?parateur paires de coordonn?es ','
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= $coord[$i][0];
-				$coord[$i][1] 	= $coord[$i][1]*-1;
- 				$coordpair[$i] 	= implode(' ' ,$coord[$i]);
-			}
-			$wktGeom = implode(',', $coordpair);
-
-			if (strcasecmp($wktGeomType,"POLYGON")==0 || strcasecmp($wktGeomType,"LINE")==0)
-			{  	return "points=\"".$wktGeom."\"";		
-			}elseif (strcasecmp($wktGeomType,"POINT")==0)
-			{	$coordTab = explode (" ", $wktGeom);
-				return "x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
-			}
-}
-
-
-
-///////////////////////////////////////////////
-// EXPERIMENTAL
-///////////////////////////////////////////////
-
-///////////////////////////////////////////////
-// DHTML (pour squelette ou formulaire)
-///////////////////////////////////////////////
-function wkt2coords_jsdhtml($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
-			// Pour obtenir des objets HTML/MAP pour la superpo avec l'interface DHTML...
-			$coordpair = explode (',',$wktGeom);
-			
-			for ($i=0; $i<sizeof($coordpair); $i++)
-			{		
-				$coord[$i] 		= explode(' ',$coordpair[$i]);
-				$coord[$i][0] 	= ($coord[$i][0]-$callage['top_left']['x'])/$GeoWidth*$ImgWidth;
-				$coord[$i][1] 	= ($callage['bottom_right']['y']-$coord[$i][1])/$GeoHeight*$ImgHeight;		// Calcul de l'Y par rapport au coin inf?rieur
- 				$coord[$i][1]   = $ImgHeight/2-($coord[$i][1]-$ImgHeight/2);								// Pour que le dessin DHTML soit ok 
- 				$coordpair[$i] 	= implode(',',$coord[$i]);
+				$coordTab = explode (",", $wktGeom);
+				return " x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
 			}
-			$wktGeom = implode(',', $coordpair);
-
-			return $wktGeom;
 }
-
 ///////////////////////////////////////////////
 // GOOGLE
 ///////////////////////////////////////////////

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- mots_partout.php	18 Aug 2005 23:53:13 -0000	1.6
+++ mots_partout.php	4 Oct 2005 00:59:38 -0000	1.7
@@ -20,11 +20,19 @@
 //    along with this program; if not, write to the Free Software
 //    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 
-include ("inc.php3");
-include_ecrire ("inc_version.php3");
-include_ecrire ("inc_documents.php3");
-include_ecrire ("inc_abstract_sql.php3");
-include_ecrire ("inc_objet.php3");
+if(@file_exists('inc.php')){
+  include('inc.php');
+} else if(@file_exists('inc.php3')){
+  include('inc.php3');
+}
+if(@file_exists('inc_version.php')){
+  include('inc_version.php');
+} else if(@file_exists('inc_version.php3')){
+  include('inc_version.php3');
+}
+include_ecrire ("inc_documents"._EXTENSION_PHP);
+include_ecrire ("inc_abstract_sql"._EXTENSION_PHP);
+include_ecrire ("inc_objet"._EXTENSION_PHP);
 include_ecrire('inc_tag-machine.php');
 
 /***********************************************************************
@@ -270,7 +278,7 @@
   
   $from =  array($table);
   
-  $where = array("id_auteur = $connect_id_auteur", "$id_chose = $id");
+  $where = array("id_auteur = $connect_id_auteur", "$id_objet = $id");
   
   $result = spip_abstract_select($select,$from,$where);
   
@@ -373,9 +381,7 @@
 	$select = array('*');
 	$from = array('spip_documents');
 	$where = array("id_document = $id_document");
-	echo "<hr/>";
 	$results = spip_abstract_select($select,$from,$where);
-	echo "<hr/>";
 
 	if($document = spip_abstract_fetch($results)) {
 	  $id_vignette = $document['id_vignette'];
@@ -434,8 +440,7 @@
 	  
 	  // bloc titre et descriptif
 	  if (strlen($titre) > 0) {
-		echo "<div class='verdana2'><b>".typo($titre)."</b>";
-		echo '</div>';
+		echo '<div class=\'verdana2\' style=\'text-align:center;\'><b>'.typo($titre).'</b></div>';
 	  } else {
 		$nom_fichier = basename($fichier);
 		
@@ -526,10 +531,10 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"articles.php3?id_article=$id_article\"$descriptif$dir_lang style=\"display:block;\">";
+	$s .= "<a href=\"articles"._EXTENSION_PHP."?id_article=$id_article\"$descriptif$dir_lang style=\"display:block;\">";
 	
 	if ($spip_display != 1 AND $spip_display != 4 AND lire_meta('image_process') != "non") {
-	  include_ecrire("inc_logos.php3");
+	  include_ecrire("inc_logos"._EXTENSION_PHP);
 	  $logo = decrire_logo("arton$id_article");
 	  if ($logo) {
 		$fichier = $logo[0];
@@ -543,7 +548,7 @@
 		$hash = calculer_action_auteur ("reduire $w $h");
 		
 		$s.= "<div style='float: $spip_lang_right; margin-top: -2px; margin-bottom: -2px;'>
-<img src='../spip_image_reduite.php3?img="._DIR_IMG."$fichier&taille_x=$w&taille_y=$h&hash=$hash&hash_id_auteur=$connect_id_auteur' alt='$fichier' width='$w' height='$h' border='0'></div>";
+<img src='../spip_image_reduite"._EXTENSION_PHP."?img="._DIR_IMG."$fichier&taille_x=$w&taille_y=$h&hash=$hash&hash_id_auteur=$connect_id_auteur' alt='$fichier' width='$w' height='$h' border='0'></div>";
 		
 	  }
 	}
@@ -738,7 +743,7 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"bloogletter.php3?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
+	$s .= "<a href=\"bloogletter"._EXTENSION_PHP."?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
 	
 	$s .= typo($titre);
 	$s .= "</a>";
@@ -819,7 +824,7 @@
 	
 	// Le titre (et la langue)
 	$s = "<div>";
-	$s .= "<a href=\"auteur_edit.php3?id_auteur=$id_auteur\" style=\"display:block;\">";
+	$s .= "<a href=\"auteur_edit"._EXTENSION_PHP."?id_auteur=$id_auteur\" style=\"display:block;\">";
 	$s .= typo($login);
 	$s .= "</a>";
 	$s .= "</div>";
@@ -876,7 +881,7 @@
  * r?cuperation de la chose sur laquelle on travaille
  ***********************************************************************/
 
-$nom_chose = $HTTP_POST_VARS['nom_chose'];
+$nom_chose = $_REQUEST['nom_chose'];
 if(!isset($choses_possibles[$nom_chose])) {
   list($nom_chose,) = each($choses_possibles);
   reset($choses_possibles);
@@ -889,21 +894,21 @@
 /***********************************************************************
  * action
  ***********************************************************************/
-$mots = $HTTP_POST_VARS['id_mots'];
-$sans_mots = $HTTP_POST_VARS['sans_mots'];
-$choses = $HTTP_POST_VARS['id_choses'];
-$nom_tags = $HTTP_POST_VARS['nom_tags'];
-$limit =  $HTTP_POST_VARS['limit'];
-$id_limit =  $HTTP_POST_VARS['id_limit'];
+$mots = $_REQUEST['id_mots'];
+$sans_mots = $_REQUEST['sans_mots'];
+$choses = $_REQUEST['id_choses'];
+$nom_tags = $_REQUEST['nom_tags'];
+$limit =  $_REQUEST['limit'];
+$id_limit =  $_REQUEST['id_limit'];
 //echo "!!!".$nom_chose."!!!";
-//echo "action :".$HTTP_POST_VARS['switch']."<br>";
+//echo "action :".$_REQUEST['switch']."<br>";
 //echo "choses :".serialize($choses)."<br>";
 //echo "mots :".serialize($mots)."<br>";
 //echo "sans_mots :".serialize($sans_mots)."<br>";
 //echo "nom_tags :".serialize($nom_tags)."<br>";
 //echo "limit :".serialize($limit)."<br>";
 
-if($HTTP_POST_VARS['switch'] == 'action' && count($choses)) {
+if($_REQUEST['switch'] == 'action' && count($choses)) {
 	if(count($mots)) {
 	  foreach($mots as $m) {	
 		$from = array('spip_mots');
@@ -956,13 +961,13 @@
 		}
 	}
 	if ($nom_tags){
-		$tags = parser_liste($nom_tags);
+		$tags = new ListeTags($nom_tags,'Tag');
 //		echo "!!!!!!!tag:".$nom_tags."/".serialize($tags)."!!!!!!!!!";
 		foreach($choses as $d) {
-			if($HTTP_POST_VARS['bouton'] == 'ajouter')
-			  ajouter_liste_mots($tags,$d,'',$nom_chose,$id_chose);
-			if($HTTP_POST_VARS['bouton'] == 'retirer')
-			  retirer_liste_mots($tags,$d,'',$nom_chose,$id_chose);
+			if($_REQUEST['bouton'] == 'ajouter')
+			  $tags->ajouter($d,$nom_chose,$id_chose);
+			if($_REQUEST['bouton'] == 'retirer')
+			  $tags->retirer($d,$nom_chose,$id_chose);
 		}
 	}
 }
@@ -989,7 +994,7 @@
 	  $from[1] = "spip_mots_$nom_chose as table_temp";
 	  $where[1] = "table_temp.$id_chose = main.$id_chose";
 	  $where[] = "table_temp.id_mot IN (".calcul_in($mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -999,7 +1004,7 @@
 	  $from[1] = "spip_mots_$nom_chose as table_temp";
 	  $where[1] = "table_temp.$id_chose = main.$id_chose";
 	  $where[] = "table_temp.id_mot not IN (".calcul_in($sans_mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1009,7 +1014,7 @@
   	if(count($mots) > 0) {
 	  $from[0] = "spip_mots_$nom_chose as main";
 	  $where[] = "main.id_mot IN (".calcul_in($mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1018,7 +1023,7 @@
   	if(count($sans_mots) > 0) {
 	  $from[0] = "spip_mots_$nom_chose as main";
 	  $where[] = "main.id_mot not IN (".calcul_in($sans_mots).')';
-	  if($HTTP_POST_VARS['strict']) {
+	  if($_REQUEST['strict']) {
 		$select[] = 'count(id_mot) as tot';
 		$group = "main.$id_chose";
 		$order = array('tot DESC');
@@ -1054,7 +1059,7 @@
 		}
 		spip_abstract_free($test);
 	  }
-	  if(count($mots) > 0 && $HTTP_POST_VARS['strict']) {
+	  if(count($mots) > 0 && $_REQUEST['strict']) {
 		if($row['tot'] >= count($mots)) {
 		  $choses[] = $row[$id_chose];
 		} else {
@@ -1162,7 +1167,7 @@
 if(count($choses)) {
 // 	echo '<a name="action"></a><form action="mots_partout.php#voir">';
 
-  echo '<input type="hidden" name="nom_chose" value="'.$HTTP_POST_VARS['nom_chose'].'">';  
+  echo '<input type="hidden" name="nom_chose" value="'.$_REQUEST['nom_chose'].'">';  
 //  echo "<input type='hidden' name='id_limit' value='$id_limit'>";
 //  echo "<input type='hidden' name='limit' value='$limit'>";
 //  for($i=0; $i < count($choses); $i++) {
@@ -1188,18 +1193,30 @@
 </td>
 </tr>
 	<tr class='tr_liste'>
-	  <td colspan=2><textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea></td>
-	   </tr>
-	   <tr class='tr_liste'>
+	  <td colspan=2>
+<div style="position:relative;overflow:visible; width: 10em;">
+        <input autocomplete="off" type="texte" id="tags" name="nom_tags" class='forml' cols='40' style="width: 100%;">
+        <div id="suggest" class="suggest_list" style="width: 100%;"></div>
+      </div>
+	  </td>
+	 </tr>
+	 <tr class='tr_liste'>
 	   <td colspan=2><button type='submit' name='switch' value='action'>
 	   <?php echo _T('bouton_valider'); ?>
 	   </button></td>
 		   </tr>
 		   </table>
 		   </div>
-		   
-<?php
-		   
+<link rel="stylesheet" type="text/css" href="./ajaxTagMachine.css">
+<script  type='text/javascript' src="./ajaxTagMachine.js">
+</script>
+  <script  type='text/javascript'> <!--
+	groupe = new AjaxSuggestMenu('ajax_mortimer.php', 'titre', 'tags','suggest');
+	groupe.addVar('nom_chose','<?php echo $nom_chose; ?>');
+	groupe.setNbrLineVisible(5);
+  	--></script>
+
+<?php		   
   fin_cadre_enfonce();
  creer_colonne_droite();
 // affichage de mots clefs.

Index: inc_getdocument.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_getdocument.php3,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- inc_getdocument.php3	7 Sep 2005 15:01:53 -0000	1.7
+++ inc_getdocument.php3	4 Oct 2005 00:59:38 -0000	1.8
@@ -338,7 +338,18 @@
 			$type_image = $a['type_image'];
 
 			$distant = 'oui';
-			$mode = 'document';
+			
+			$type_inclus_image = false;
+			ereg("\.([^.]+)$", $fichier, $match);
+			$ext = addslashes(corriger_extension(strtolower($match[1])));
+			
+			if ($row = spip_fetch_array(spip_query(
+			"SELECT * FROM spip_types_documents
+			WHERE extension='$ext' AND upload='oui'"))) {
+				$type_inclus_image = ($row['inclus'] == 'image');
+			}
+			if ($type_inclus_image) $mode = 'vignette';
+			else $mode = 'document';
 		}
 		else {
 			spip_log("Echec du lien vers le document $source, abandon");

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.12
retrieving revision 1.13
diff -u -d -r1.12 -r1.13
--- inc_presentation.php3	7 Sep 2005 15:01:53 -0000	1.12
+++ inc_presentation.php3	4 Oct 2005 00:59:38 -0000	1.13
@@ -2078,7 +2078,14 @@
 	if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) {
 		icone_bandeau_principal (_T('icone_configuration_site'), "configuration.php3", "administration-48.png", "administration", $rubrique, "", "configuration", $sous_rubrique);
 	}
-
+	////////////////////////////////////////////////////
+	//MODIFICATION
+	////////////////////////////////////////////////////
+	else /*if ($connect_statut == '0minirezo')*/ {
+		icone_bandeau_principal (_T("cartes"), "cartes.php3", "carte-24.png", "cartes", $rubrique, "", "cartes", $sous_rubrique);
+	}
+	////////////////////////////////////////////////////
+	
 	echo "<td> &nbsp; </td>";
 
 
@@ -2168,7 +2175,7 @@
 			//les cartes
 			//if (@spip_num_rows(spip_query("SELECT * FROM spip_carto_carte LIMIT 0,1")) > 0) 
 			if (lire_meta('activer_carto')== 'oui') 
-				icone_bandeau_secondaire(_L("Cartes"), "cartes.php3", "carte-24.png", "cartes", $sous_rubrique);
+				icone_bandeau_secondaire(_T("cartes"), "cartes.php3", "carte-24.png", "cartes", $sous_rubrique);
 			////////////////						
 		}
 		echo "</tr></table></div></div>";
@@ -2237,6 +2244,13 @@
 		$decal = $decal + largeur_icone_bandeau_principal(_T('icone_suivi_actualite'));
 	
 	}
+	////////////////////////////////////////////////////
+	//MODIFICATION
+	////////////////////////////////////////////////////
+	else /*if ($connect_statut == '0minirezo')*/ {
+		$decal = $decal + largeur_icone_bandeau_principal(_T('cartes'));
+	}
+	////////////////////////////////////////////////////
 
 
 	if ($connect_statut == '0minirezo' and $connect_toutes_rubriques) {



From stef at berlios.de  Tue Oct  4 02:59:41 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:59:41 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1,1.2 spipcarto_en.php3,1.1,1.2
Message-ID: <200510040059.j940xfmq030555@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv30408/ecrire/lang

Modified Files:
	spipcarto_fr.php3 spipcarto_en.php3 
Log Message:
synchro v1

Index: spipcarto_fr.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_fr.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spipcarto_fr.php3	26 Sep 2005 05:45:59 -0000	1.1
+++ spipcarto_fr.php3	4 Oct 2005 00:59:39 -0000	1.2
@@ -1,28 +1,65 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
 
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // This is a SPIP language file  --  Ceci est un fichier langue de SPIP
 
 $GLOBALS[$GLOBALS['idx_lang']] = array(
 'calque' => 'Calques ',
 
+'cartes' => 'Cartes',
 'cartes_toutes' => 'Toutes les cartes',
 'carte_creer' => 'Cr&eacute;er une nouvelle carte',
 'carte_nouvelle' => 'Nouvelle carte',
 'carte_numero' => 'CARTE NUM&Eacute;RO :', 
 'carte_apercu' => 'Aper?u de la carte', 
-'carte_img' => 'Image simple', 
+'carte_map' => 'Image simple', 
 'carte_lien' => 'Image avec liens',
 'carte_logo' => 'Image avec logos',
 'carte_svg' => 'SVG simple',
 'carte_svgx' => 'SVG avec zoom',
-'carte_svggeo' => 'SVG avec zoom et services web (WMS)',
+'carte_geosvgwms' => 'SVG avec zoom et services web (WMS)',
 'carte_warning' => 'Attention :',
 'carte_supp' => 'Supprimer cette carte', 
 'carte_supp_confirm' => 'Voulez-vous vraiment supprimer cette carte ?',
 'carte_articles_use' => 'Articles utilisant cette carte',
 'carte_titre' => 'Titre de la carte', 
 'carte_fond' => 'Fond de carte',
-'carte_fond_numero' => '(Num?ro de l\'image Spip ou URL de l\'image)',
+'carte_fond_numero' => '(Num?ro de l\'image Spip)',
 'carte_callage' => 'Callage de la carte', 
 'carte_srs' => 'Syst?me de coordonn?es', 
 'carte_objets' => 'Objets de la carte',
@@ -30,7 +67,7 @@
 'carte_import_objet' => 'Importer des objets dans la carte',
 'carte_supp_objets' => 'Supprimer tous les objets de la carte',
 'carte_insert' => 'Ins&eacute;rer une carte',
-'carte_insert_texte' => 'Vous pouvez ins&eacute;rer des cartes dans vos articles. Choisissez une <br/>carte dans la liste ci-dessous et recopiez le raccourci dans le texte <br/>de l\'article.',
+'carte_insert_texte' => 'Vous pouvez ins&eacute;rer des cartes dans vos articles.<br/>Positionnez votre curseur dans le texte de l\'article, choisissez une carte dans la liste ci-dessous et cliquez sur un raccourci pour l\'ins&eacute;rer.',
 'carte_raccourci' => 'Recopiez ce raccourci dans le texte de l\'article pour ins&eacute;rer ce formulaire.',
 'carte_loading' => 'Chargement de la carte',
 'carte_point' => 'Point',

Index: spipcarto_en.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/lang/spipcarto_en.php3,v
retrieving revision 1.1
retrieving revision 1.2
diff -u -d -r1.1 -r1.2
--- spipcarto_en.php3	26 Sep 2005 05:45:59 -0000	1.1
+++ spipcarto_en.php3	4 Oct 2005 00:59:39 -0000	1.2
@@ -1,21 +1,58 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
 
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 // This is a SPIP language file  --  Ceci est un fichier langue de SPIP
 
 $GLOBALS[$GLOBALS['idx_lang']] = array(
 'calque' => 'Layers ',
 
+'cartes' => 'Maps',
 'cartes_toutes' => 'All maps',
 'carte_creer' => 'Create a new map',
 'carte_nouvelle' => 'New map',
 'carte_numero' => 'Map identifier :', 
 'carte_apercu' => 'Map overview', 
-'carte_img' => 'Image', 
+'carte_map' => 'Image', 
 'carte_lien' => 'Image with link',
 'carte_logo' => 'Image with symbols',
 'carte_svg' => 'SVG simple',
 'carte_svgx' => 'SVG with zoom',
-'carte_svggeo' => 'SVG with zoom and webservices (WMS)',
+'carte_geosvgwms' => 'SVG with zoom and webservices (WMS)',
 'carte_warning' => 'Warning :',
 'carte_supp' => 'Remove current map', 
 'carte_supp_confirm' => 'Are you sure to remove this map ?',
@@ -30,7 +67,7 @@
 'carte_import_objet' => 'Import objects into current map',
 'carte_supp_objets' => 'Remove all objects',
 'carte_insert' => 'Insert a map',
-'carte_insert_texte' => 'You can insert maps into your articles. Select a<br/>map in the list below and copy the shortcut<br/> in your text.',
+'carte_insert_texte' => 'You can insert maps into your articles.<br/>Set focus on text, select a map in the list below and clic the shortcut to insert in your text.',
 'carte_raccourci' => 'Copy the shortcut into your article to insert this form.',
 'carte_loading' => 'Loading message',
 'carte_point' => 'Point',
@@ -62,5 +99,4 @@
 
 );
 
-?>
-
+?>
\ No newline at end of file



From stef at berlios.de  Tue Oct  4 02:59:41 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:59:41 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6,1.7
Message-ID: <200510040059.j940xfmq030559@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/plugins
In directory sheep:/tmp/cvs-serv30408/ecrire/plugins

Modified Files:
	plug_carto.php 
Log Message:
synchro v1

Index: plug_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/plugins/plug_carto.php,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- plug_carto.php	24 Sep 2005 01:02:40 -0000	1.6
+++ plug_carto.php	4 Oct 2005 00:59:39 -0000	1.7
@@ -1,16 +1,55 @@
 <?php
-// Ce plug-in ajoute le raccourci typographique <mapXX|align> 
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+
+// Ce plug-in ajoute le raccourci typographique <mapXX|nom_squelette> 
 // XX est le numero de la carte
-// align fonctionne comme les images (left / center / right)
+// nom_squelette est suffixe du squelette de carte utilis?
+// ex : <map12|svg> presentera la carte n?12 avec le squelette caro_svg.html
 
 function apres_tout_carto($texte) {
 	
 	if (is_int(strpos($texte, '<map')) &&
 	  (preg_match_all(",<map(\d+)([|])?([a-zA-Z.]+)?([(])?([a-zA-Z0-9\,\-.]+)?([)])?>,", $texte, $regs, PREG_SET_ORDER))) {	
 		global $flag_ecrire;
-		$id_article=$_POST['id_article'];
+		$id_article=$_REQUEST['id_article'];
 		if ($flag_ecrire) {
-			$query = "DELETE FROM spip_carto_carte_articles WHERE id_article=$id_article";
+			$query = "DELETE FROM spip_carto_cartes_articles WHERE id_article=$id_article";
 			spip_query($query);
 		}
 		foreach ($regs as $r) {



From stef at berlios.de  Tue Oct  4 02:59:42 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:59:42 +0200
Subject: [Spip-carto-cvs] spipcarto spip_carto.php,1.3,1.4 carto.php3,1.6,1.7
Message-ID: <200510040059.j940xgmq030561@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv30408

Modified Files:
	spip_carto.php carto.php3 
Log Message:
synchro v1

Index: spip_carto.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_carto.php,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- spip_carto.php	20 Feb 2005 22:16:48 -0000	1.3
+++ spip_carto.php	4 Oct 2005 00:59:39 -0000	1.4
@@ -1,6 +1,43 @@
 <?php
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
 include ("ecrire/inc_version.php3");
-include ("ecrire/inc_connect.php3");
+//include ("ecrire/inc_connect.php3");
 
 if (isset($_GET["fond_carte"]) && !empty($_GET["fond_carte"])) 
 {

Index: carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto.php3,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- carto.php3	21 Jul 2005 21:47:12 -0000	1.6
+++ carto.php3	4 Oct 2005 00:59:39 -0000	1.7
@@ -1,10 +1,47 @@
 <?php 
+/*****************************************************************************\
+* SPIP-CARTO, Solution de partage et d??laboration d?information 
+* (Carto)Graphique sous SPIP
+*
+* Copyright (c) 2005
+*
+* St?phane Laurent, Fran?ois-Xavier Prunayre, Pierre Giraud, Jean-Claude 
+* Moissinac et tous les membres du projet SPIP-CARTO V1 (Annie Danzart - Arnaud
+* Fontaine - Arnaud Saint L?ger - Benoit Veler - Christine Potier - Christophe 
+* Betin - Daniel Faivre - David Delon - David Jonglez - Eric Guichard - Jacques
+* Chatignoux - Julien Custot - Laurent J?gou - Mathieu G?hin - Michel Briand - 
+* Mose - Olivier Fr?rot - Philippe Fournel - Thierry Joliveau)
+* 
+* voir : http://www.geolibre.net/article.php3?id_article=16
+*
+* Ce programme est un logiciel libre distribue sous licence GNU/GPL. 
+* Pour plus de details voir le fichier COPYING.txt ou l?aide en ligne.
+* 
+? -
+This program is free software ; you can redistribute it and/or modify
+it under the terms of the GNU General Public License as published by
+the Free Software Foundation ; either version 2 of the License, or
+(at your option) any later version.
+
+This program is distributed in the hope that it will be useful,
+but WITHOUT ANY WARRANTY ; without even the implied warranty of
+MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
+GNU General Public License for more details.
+
+You should have received a copy of the GNU General Public License
+along with this program (COPYING.txt) ; if not, write to
+the Free Software Foundation, Inc.,
+59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+or check http://www.gnu.org/copyleft/gpl.html
+? -
+*
+\***************************************************************************/
+//specifier ici le nom du sous repertoire du dossier squelette contenant
+//les squelettes de carte
 $rep_fond="template";
 //  valeurs par defaut
 //$delai=24*3600;
 
-// Securite : le squelette *doit* exister dans squelettes/
-// voir si 
 $flag_preserver = true;
 
 if (isset($contexte_inclus['fond'])) {



From stef at berlios.de  Tue Oct  4 02:59:39 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 02:59:39 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_lien.html,1.2,1.3 carto_svgfilex.html,1.6,1.7 carto_geosvgwmsfile.html,1.5,1.6 carto_logo.html,1.2,1.3 carto.html,1.2,1.3 carto_svgx.html,1.3,1.4 carto_map.html,1.2,1.3 carto_svgfile.html,1.4,1.5
Message-ID: <200510040100.j940xdmq030518@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv30408/squelettes/template

Modified Files:
	carto_lien.html carto_svgfilex.html carto_geosvgwmsfile.html 
	carto_logo.html carto.html carto_svgx.html carto_map.html 
	carto_svgfile.html 
Log Message:
synchro v1

Index: carto_lien.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_lien.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_lien.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_lien.html	4 Oct 2005 00:59:34 -0000	1.3
@@ -1,19 +1,17 @@
-
-
 <div style="float: left;visibility: visible; margin: 0px; padding: 0px; height: 500px;">
 	<div style="position: absolute;">
 	<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="1"/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] style="border: 0px;"/>
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<div style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE})]border: 0px;">
-			<a href="[(#URL_OBJET|url)]" class="cartolabel" alt="#TEXTE">
+			<div style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;">
+			<a href="[(#URL_OBJET)]" class="cartolabel" alt="#TEXTE">
 			<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>[(#LOGO_MOT)]
 			</BOUCLE_mot> #TITRE
 			</a>

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.6
retrieving revision 1.7
diff -u -d -r1.6 -r1.7
--- carto_svgfilex.html	24 Sep 2005 01:12:26 -0000	1.6
+++ carto_svgfilex.html	4 Oct 2005 00:59:34 -0000	1.7
@@ -203,7 +203,7 @@
 	<!-- #DESCRIPTIF -->
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
 		 </BOUCLE_M>
@@ -214,7 +214,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>

Index: carto_geosvgwmsfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_geosvgwmsfile.html,v
retrieving revision 1.5
retrieving revision 1.6
diff -u -d -r1.5 -r1.6
--- carto_geosvgwmsfile.html	6 Sep 2005 05:41:40 -0000	1.5
+++ carto_geosvgwmsfile.html	4 Oct 2005 00:59:34 -0000	1.6
@@ -489,7 +489,7 @@
 	 		 <!-- #DESCRIPTIF -->
 				<g id="spipCarto_#ID_MOT">
 				<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
-					<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
+					<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVGGEO})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVGGEO})[(#_M:DESCRIPTIF)]]"/></a>
 				</BOUCLE_OBJECT>
 				</g>
 			 </BOUCLE_M>
@@ -499,7 +499,7 @@
 				<!-- Couche d'objets SPIP -->
 				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
-				<a target='new' xlink:href='[(#URL_OBJET|url)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVGGEO,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
 				</B_objets>	
 			</g>

Index: carto_logo.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_logo.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_logo.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_logo.html	4 Oct 2005 00:59:35 -0000	1.3
@@ -6,17 +6,17 @@
 		<B_objets>
 			<map name="map#ID_CARTO_CARTE">
 			<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TITRE"/>
+			<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TITRE"/>
 		</BOUCLE_objets>
 		</map>
 		</B_objets>
 		
-		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="1"/>
+		<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] style="border: 0px;"/>
 		
 		<BOUCLE_objets2(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-			<a href="[(#URL_OBJET|url)]">
-			<img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE})]border: 0px;" alt="#TEXTE" 
-				src="<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>IMG/moton#ID_MOT.gif</BOUCLE_mot>" border="0"/>
+			<a href="[(#URL_OBJET)]">
+			<img style="position: absolute;margin: 0px; padding: 0px;[(#GEOMETRIE|wkt2coords{HTMLDIV,#CALLAGE,#URL_CARTE,'',#ENV{args}})]border: 0px;" alt="#TEXTE" 
+				src="<BOUCLE_mot(MOTS){id_carto_objet}{par titre}{0,1}>IMG/[(#LOGO_MOT|fichier)]</BOUCLE_mot>ecrire\img_pack\croix-rouge.gif<//B_mot>" border="0"/>
 			</a>
 		</BOUCLE_objets2>
 	</BOUCLE_carte>

Index: carto.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto.html	4 Oct 2005 00:59:35 -0000	1.3
@@ -1,4 +1,4 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 </BOUCLE_objets></map></B_objets></BOUCLE_carte>

Index: carto_svgx.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgx.html,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -d -r1.3 -r1.4
--- carto_svgx.html	18 Aug 2005 06:33:33 -0000	1.3
+++ carto_svgx.html	4 Oct 2005 00:59:35 -0000	1.4
@@ -2,7 +2,7 @@
 <embed src="carto.php3?id_carto_carte=#ID_CARTO_CARTE&fond=svgfilex" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] type="image/svg+xml" name="emap"></embed>
 <noembed>
 	<img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+	<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 	</BOUCLE_objets></map></B_objets>
 </noembed>
 </BOUCLE_carte>

Index: carto_map.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_map.html,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -d -r1.2 -r1.3
--- carto_map.html	18 Aug 2005 06:33:33 -0000	1.2
+++ carto_map.html	4 Oct 2005 00:59:35 -0000	1.3
@@ -1,4 +1,4 @@
 <BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img alt="#TITRE" src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)][&amp;scale=(#ENV{scale})][&amp;x=(#ENV{x})][&amp;y=(#ENV{y})]" [height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] [width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] usemap="#map#ID_CARTO_CARTE" border="0"/><B_objets><map name="map#ID_CARTO_CARTE"><BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,#ENV{args}})]" href="[(#URL_OBJET|url)]" alt="#TEXTE"/>
+<area shape="[(#GEOMETRIE|wkt2shape)]" coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" href="[(#URL_OBJET)]" alt="#TEXTE"/>
 </BOUCLE_objets></map></B_objets></BOUCLE_carte>

Index: carto_svgfile.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfile.html,v
retrieving revision 1.4
retrieving revision 1.5
diff -u -d -r1.4 -r1.5
--- carto_svgfile.html	6 Sep 2005 05:41:40 -0000	1.4
+++ carto_svgfile.html	4 Oct 2005 00:59:35 -0000	1.5
@@ -24,7 +24,7 @@
 		 
 		<g id="mainlayer">
 		 	<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
-		  		<a xlink:href="[(#URL_OBJET|url)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
+		  		<a xlink:href="[(#URL_OBJET)]" alt="#TITRE"><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 		 	</BOUCLE_objets>
 		</g>
 	</svg>



From stef at berlios.de  Tue Oct  4 03:02:07 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 03:02:07 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire ajaxTagMachine.js,NONE,1.1 ajaxTagMachine.css,NONE,1.1 ajax_mortimer.php,NONE,1.1
Message-ID: <200510040102.j94127mq031923@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv31872/ecrire

Added Files:
	ajaxTagMachine.js ajaxTagMachine.css ajax_mortimer.php 
Log Message:
premiers pas en ajax sur mots_partout

--- NEW FILE: ajaxTagMachine.js ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: ajaxTagMachine.css ---
/*
fichier style pour le menu de suggestion ajax
a importer ou il faut

    Copyright (C) 2005  Pierre ANDREWS

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
*/

.suggest_list
 {
	 background: white;
  border: 1px solid;
  position: absolute;
  z-index : 1000;
  height: 3em;
  overflow: hidden;
}

.suggest_list ul
{
	width: 100%;
	overflow: hidden;
	position: absolute;
/* top: 0em;*/
	padding: 0;
 margin: 0;
 list-style-type: none;
}

.suggest_list li {
	display: block;
 padding-left: 3px;
 overflow: hidden;
 background: white;
}


.suggest_list li.pair {
  background: #f0f0f0;
}

.suggest_list li#suggested_list_selected_item {
	background: #0036C9;
 color: #BFD0FF;
}

.suggest_list li#suggested_list_selected_item a {
	color: white;
}

.suggest_list li .sugRight {
	display:block;
	font-size: 10px;
 text-align: right;
 padding-top: 3px;
color: #7070ff;
}


.suggest_list li#suggested_list_selected_item .sugRight {
	color: #80A2FF;
}

.suggest_list li .sugLeft {
	display: block;
 margin-left: 0%; 
 width: 50%; 
 float: left; 
}
--- NEW FILE: ajax_mortimer.php ---
<?php

 include ("inc.php3");
  include_ecrire('inc_tag-machine.php');

function seulement_titre($tag) {
  
  if(is_object($tag)) {
	return $tag->getTitreEchappe();
  } else {
  	$tag = (strpos($tag,' ') || strpos($tag,':') || strpos($tag,','))?'"'.$tag.'"':$tag;
	return $tag;
  }
  
}

function trouve_debut($liste,$id_groupe) {
  $tags = new ListeTags(filtrer_entites($liste),'Tag',$id_groupe);
  return array_slice($tags->getTags(),0,-1);
}

function titre_debut($liste,$id_groupe) {
  $mots = array_map('seulement_titre',trouve_debut($liste,$id_groupe));
  return join(' ',$mots);
}

function trouve_fin($liste,$id_groupe) {
  $tags = new ListeTags(filtrer_entites($liste),'Tag',$id_groupe);
  $tags = $tags->getTags();
  return $tags[count($tags)-1];
}

function titre_fin($liste,$id_groupe) {
  $mots = seulement_titre(trouve_fin($liste,$id_groupe));
  return str_replace('"','',$mots);

}

$res = spip_query("SELECT spip_mots.titre,spip_mots.id_groupe " .
		"FROM spip_mots".(isset($_GET['nom_chose'])?(",spip_groupes_mots " .
		"WHERE spip_groupes_mots.".$_GET['nom_chose']."='oui' AND spip_mots.id_groupe=spip_groupes_mots.id_groupe AND"):'WHERE').
		" spip_mots.titre LIKE '%".$_GET['titre']."%'");

$xml = "new Array(";
$mots = array();
  
if (spip_num_rows($res) > 0) {
  while ($row = spip_fetch_array($res)) {
	$nouveau = new Tag($row['titre'],'Tag',$row['id_groupe']);
	$mots[] = '"'.str_replace('"','\\"',titre_debut($_GET['titre'],$row['id_groupe'])." ".$nouveau->getTitreEchappe()).'"';
  }
 }
$xml .= join(',',$mots).");";
echo $xml;

?>


From stef at berlios.de  Tue Oct  4 03:02:08 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 03:02:08 +0200
Subject: [Spip-carto-cvs] spipcarto ajax.php3,NONE,1.1 mes_fonctions.php3,1.13,1.14
Message-ID: <200510040102.j94128mq031924@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv31872

Modified Files:
	mes_fonctions.php3 
Added Files:
	ajax.php3 
Log Message:
premiers pas en ajax sur mots_partout

--- NEW FILE: ajax.php3 ---
(This appears to be a binary file; contents omitted.)

Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.13
retrieving revision 1.14
diff -u -d -r1.13 -r1.14
--- mes_fonctions.php3	27 Sep 2005 20:11:14 -0000	1.13
+++ mes_fonctions.php3	4 Oct 2005 01:02:06 -0000	1.14
@@ -11,13 +11,13 @@
 	$mini_compteur+=$offset;
 	return $mini_compteur;
 }
+
 function plus($txt,$offset=1){
 	global $mini_compteur;
 	if (!isset($mini_compteur))return $offset;
 	return ($mini_compteur+$offset);
 }
 
-
 function guiPos ($compteur, $offset){
 	return $offset+$compteur*20;
 }
@@ -26,9 +26,145 @@
 	list(,$url) = extraire_lien(array('','','',$url));
 	return $url;
 }
+
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 //			FIN MODULE SPIPCARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
+
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+//			MOTS PARTOUT
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+/*
+g?n?re une regexp OU pour la liste de mot
+*/
+function enregexp($liste) {
+    include_ecrire('inc_tag-machine.php');
+	$tags = new ListeTags(filtrer_entites($liste));
+	$mots = $tags->getTags();
+	$str = '';
+	foreach ($mots as $mot) {
+	  $str .= $mot->titre.'|';
+	}
+	$str = substr($str,0,-1);
+	if ($str) {
+	  return '('.$str.')';
+	} else
+	  return '';
+}
+
+/*
+combien il y a de mots dans le param?tre
+*/
+function compte_having($liste) {
+    include_ecrire('_libs_/tag-machine/inc_tag-machine.php');
+	$liste = dernier_quote($liste);
+	$tags = new ListeTags(filtrer_entites($liste));
+	return count($tags->getTags())-1;
+}
+
+/*
+un crit?re pour le HAVING sql
+*/
+function critere_having($idb, &$boucles, $crit){	
+	$hav = calculer_liste($crit->param[0], array(), $boucles, $boucles[$idb]->id_parent);
+ $boucles[$idb]->having = "'.$hav.'";
+}
+
+//ajax
+
+function seulement_tout($tag) {
+  
+  if(is_object($tag)) {
+	return $tag->echapper();
+  } else {
+	$cgroupe = '';
+	$ctag = $tag;
+  }
+  
+  $cgroupe = (strpos($cgroupe,' ') || strpos($cgroupe,':'))?'"'.$cgroupe.'"':$cgroupe;
+  $ctag = (strpos($ctag,' ') || strpos($ctag,':'))?'"'.$ctag.'"':$ctag;
+
+  return ($cgroupe.($cgroupe)? ':':'').$ctag;
+  
+}
+
+function seulement_titre($tag) {
+  
+  if(is_object($tag)) {
+	return $tag->getTitreEchappe();
+  } else {
+  	$tag = (strpos($tag,' ') || strpos($tag,':') || strpos($tag,','))?'"'.$tag.'"':$tag;
+	return $tag;
+  }
+  
+}
+
+function seulement_type($tag) {
+  
+  if(is_object($tag)) {
+	return $tag->getTypeEchappe();
+  } else {
+  	$tag = (strpos($tag,' ') || strpos($tag,':') || strpos($tag,','))?'"'.$tag.'"':$tag;
+	return $tag;
+  }
+  
+}
+
+//marche pas ce truc!!
+function dernier_quote($lst) {
+  if(substr_count($lst,'"')%2 != 0)
+	return $lst.'"';
+  return $lst;
+}
+
+function trouve_debut($liste) {
+  include_ecrire('_libs_/tag-machine/inc_tag-machine.php');
+  $liste = dernier_quote($liste);
+  $tags = new ListeTags(filtrer_entites($liste));
+  return array_slice($tags->getTags(),0,-1);
+}
+
+function tout_debut($liste) {
+  $mots = array_map('seulement_tout',trouve_debut($liste));
+  return join(' ',$mots);
+}
+
+function titre_debut($liste) {
+  $mots = array_map('seulement_titre',trouve_debut($liste));
+  return join(' ',$mots);
+}
+
+function type_debut($liste) {
+  $mots = array_map('seulement_type',trouve_debut($liste));
+  return join(' ',$mots);
+}
+
+function trouve_fin($liste) {
+  $liste = dernier_quote($liste);
+  $tags = new ListeTags(filtrer_entites($liste));
+  $tags = $tags->getTags();
+  return $tags[count($tags)-1];
+}
+
+function titre_fin($liste) {
+  $mots = seulement_titre(trouve_fin($liste));
+  return str_replace('"','',$mots);
+
+}
+
+function type_fin($liste) {
+  $mots = seulement_type(trouve_fin($liste));
+  return str_replace('"','',$mots);
+
+}
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+//			FIN MOTS PARTOUT
+//////////////////////////////////////////////////
+//////////////////////////////////////////////////
+
 ?>



From stef at berlios.de  Tue Oct  4 16:28:50 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 16:28:50 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.6.2.2,1.6.2.3
Message-ID: <200510041428.j94ESomq011812@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv11775/ecrire

Modified Files:
      Tag: BRANCH-V1
	mots_partout.php 
Log Message:
inc_version deja inclus (Mose)

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6.2.2
retrieving revision 1.6.2.3
diff -u -d -r1.6.2.2 -r1.6.2.3
--- mots_partout.php	4 Oct 2005 00:53:36 -0000	1.6.2.2
+++ mots_partout.php	4 Oct 2005 14:28:48 -0000	1.6.2.3
@@ -25,11 +25,6 @@
 } else if(@file_exists('inc.php3')){
   include('inc.php3');
 }
-if(@file_exists('inc_version.php')){
-  include('inc_version.php');
-} else if(@file_exists('inc_version.php3')){
-  include('inc_version.php3');
-}
 include_ecrire ("inc_documents"._EXTENSION_PHP);
 include_ecrire ("inc_abstract_sql"._EXTENSION_PHP);
 include_ecrire ("inc_objet"._EXTENSION_PHP);



From stef at berlios.de  Tue Oct  4 16:29:15 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 16:29:15 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire cartes.php3,1.5.2.1,1.5.2.2
Message-ID: <200510041429.j94ETFmq011877@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv11850/ecrire

Modified Files:
      Tag: BRANCH-V1
	cartes.php3 
Log Message:
rechargement des metas apres installation

Index: cartes.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/cartes.php3,v
retrieving revision 1.5.2.1
retrieving revision 1.5.2.2
diff -u -d -r1.5.2.1 -r1.5.2.2
--- cartes.php3	30 Sep 2005 22:08:44 -0000	1.5.2.1
+++ cartes.php3	4 Oct 2005 14:29:12 -0000	1.5.2.2
@@ -121,6 +121,7 @@
 	spip_query("INSERT INTO `".$table_pref."_meta`(nom, valeur, maj) VALUES ('activer_carto','oui',now());");
 	spip_query("INSERT INTO `".$table_pref."_meta`(nom, valeur, maj) VALUES ('carto_mots','oui',now());");
 
+	ecrire_metas();
 }
 
 



From stef at berlios.de  Tue Oct  4 16:56:15 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 16:56:15 +0200
Subject: [Spip-carto-cvs] spipcarto carto-proto1.1.sql,1.4,NONE
Message-ID: <200510041456.j94EuFmq013762@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv13738

Removed Files:
      Tag: BRANCH-V1
	carto-proto1.1.sql 
Log Message:
inutile : voir cartes.php3?installation=oui

--- carto-proto1.1.sql DELETED ---



From stef at berlios.de  Tue Oct  4 18:15:20 2005
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 4 Oct 2005 18:15:20 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_documents.php3,1.7.2.1,1.7.2.2
Message-ID: <200510041615.j94GFKmq020302@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv20272/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_documents.php3 
Log Message:
bug ... marche maintenant avec images locales et distantes

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.7.2.1
retrieving revision 1.7.2.2
diff -u -d -r1.7.2.1 -r1.7.2.2
--- inc_documents.php3	30 Sep 2005 13:41:19 -0000	1.7.2.1
+++ inc_documents.php3	4 Oct 2005 16:15:17 -0000	1.7.2.2
@@ -510,7 +510,7 @@
 	}
 
 	// Lien document distant, jamais en mode image
-	if ($forcer_document) {
+	//if ($forcer_document) {
 		echo "<p /><div style='border: 1px #303030 solid; padding: 4px; color: #505050;'>";
 		echo "<img src='"._DIR_IMG_PACK.'attachment.gif',
 			"' style='float: $spip_lang_right;' alt=\"\" />\n";
@@ -518,7 +518,7 @@
 		echo "\n<input name='image_url' size='32' class='fondo' value='http://' />";
 		echo "\n  <div align='".$GLOBALS['spip_lang_right']."'><input name='ok_url' type='Submit' value='"._T('bouton_choisir')."' class='fondo'></div>";
 		echo "</div>\n";
-	}
+	//}
 
 	echo "</div>\n";
 	echo fin_block();
@@ -985,7 +985,7 @@
 	$link->addVar('ajout_doc', 'oui');
 	$link->addVar('mode', 'vignette');
 	$link->addVar('type', $type);
-	afficher_upload($link, $redirect_url, _T('info_telecharger'),'',true,true);
+	afficher_upload($link, $redirect_url, _T('info_telecharger'));
 
 	fin_cadre_relief();
 



From stef at berlios.de  Wed Oct 12 23:22:56 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 12 Oct 2005 23:22:56 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mots_partout.php,1.6.2.3,1.6.2.4 carte_edit.php3,1.18.2.6,1.18.2.7 inc_tag-machine.php,1.1.2.2,NONE
Message-ID: <200510122122.j9CLMuB5009700@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv9674/ecrire

Modified Files:
      Tag: BRANCH-V1
	mots_partout.php carte_edit.php3 
Removed Files:
      Tag: BRANCH-V1
	inc_tag-machine.php 
Log Message:
version stable mots_partout (sans ajax)
correction raccourci
ajout ancre par objet pour retour


Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6.2.3
retrieving revision 1.6.2.4
diff -u -d -r1.6.2.3 -r1.6.2.4
--- mots_partout.php	4 Oct 2005 14:28:48 -0000	1.6.2.3
+++ mots_partout.php	12 Oct 2005 21:22:54 -0000	1.6.2.4
@@ -25,18 +25,116 @@
 } else if(@file_exists('inc.php3')){
   include('inc.php3');
 }
+if(@file_exists('inc_version.php')){
+  include('inc_version.php');
+} else if(@file_exists('inc_version.php3')){
+  include('inc_version.php3');
+}
 include_ecrire ("inc_documents"._EXTENSION_PHP);
 include_ecrire ("inc_abstract_sql"._EXTENSION_PHP);
 include_ecrire ("inc_objet"._EXTENSION_PHP);
-include_ecrire('inc_tag-machine.php');
+//include_ecrire('_libs_/tag-machine/inc_tag-machine.php');
 
 /***********************************************************************
 * D?finition des choses sur lesquels on peut vouloir mettre des mots clefs
 ***********************************************************************/
+
+$choses_possibles['articles'] = array(
+									  'titre_chose' => 'public:articles',
+										  'id_chose' => 'id_article',
+									  'table_principale' => 'spip_articles',
+									  'table_auth' => 'spip_auteurs_articles',
+									  'tables_limite' => array(
+															   'articles' => array(
+																				   'table' => 'spip_articles',
+																				   'nom_id' => 'id_article'),
+															   'rubriques' => array(
+																					'table' => 'spip_articles',
+																					'nom_id' =>  'id_rubrique'),
+															   'documents' => array(
+																					'table' => 'spip_documents_articles',
+																					'nom_id' =>  'id_document'),
+															   'auteurs' => array(
+																				  'table' => 'spip_auteurs_articles',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
+
+$choses_possibles['rubriques'] = array(
+									  'titre_chose' => 'public:rubriques',
+										  'id_chose' => 'id_rubrique',
+									  'table_principale' => 'spip_rubriques',
+									  'table_auth' => 'spip_auteurs_rubriques',
+									  'tables_limite' => array(
+															   'rubriques' => array(
+																					'table' => 'spip_rubriques',
+																					'nom_id' =>  'id_rubrique'),
+																'secteurs' => array(
+																					 'table' => 'spip_rubriques',
+																					 'nom_id' =>  'id_secteur'),
+																'parents' => array(
+																					 'table' => 'spip_rubriques',
+																					 'nom_id' =>  'id_parent'),
+															   'documents' => array(
+																					'table' => 'spip_documents_rubriques',
+																					'nom_id' =>  'id_document'),
+															   'auteurs' => array(
+																				  'table' => 'spip_auteurs_articles',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
+$choses_possibles['documents'] = array(
+									   'titre_chose' => 'info_documents',
+												  'id_chose' => 'id_document',
+									   'table_principale' => 'spip_documents',
+									   'tables_limite' => array(
+																'articles' => array(
+																					'table' => 'spip_documents_articles',
+																					'nom_id' => 'id_article'),
+																'rubriques' => array(
+																					 'table' => 'spip_documents_rubriques',
+																					 'nom_id' =>  'id_rubrique'),
+																'documents' => array(
+																					 'table' => 'spip_documents',
+																					 'nom_id' =>  'id_document')
+																)
+									   );
+
+$choses_possibles['auteurs'] = array(
+									  'titre_chose' => 'auteurs',
+									  'id_chose' => 'id_auteur',
+									  'table_principale' => 'spip_auteurs',
+									  'tables_limite' => array(
+															   'auteurs' => array(
+																				   'table' => 'spip_auteurs',
+																				   'nom_id' => 'id_auteur'),
+															   'articles' => array(
+																				  'table' => 'spip_auteurs_articles',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
+$choses_possibles['messages'] = array(
+									  'titre_chose' => 'Messages',
+									  'id_chose' => 'id_message',
+									  'table_principale' => 'spip_messages',
+									  
+									  'table_auth' => 'spip_auteurs_messages',
+									  'tables_limite' => array(
+															   'messages' => array(
+																				   'table' => 'spip_messages',
+																				   'nom_id' => 'id_message'),
+															   'auteurs' => array(
+																				  'table' => 'spip_auteurs_messages',
+																				  'nom_id' => 'id_auteur')
+															   )
+									  );
+
 ////////////////////////////////////////////////////////////////////////
 //MODIFICATION (spip-carto)
 ////////////////////////////////////////////////////////////////////////
-
 $choses_possibles['carto_objets'] = array(
 									  'titre_chose' => 'Objets',
 									  'id_chose' => 'id_carto_objet',
@@ -85,7 +183,7 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"carto_cartes.php3?id_carto_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
+	$s .= "<a href=\"carte_edit.php3?id_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
 	
 	$s .= typo($titre);
 	$s .= "</a>";
@@ -129,102 +227,8 @@
   echo afficher_liste_fin_tableau();
 }
 ////////////////////////////////////////////////////////////////////////
-//(spip-carto)
+//MODIFICATION (spip-carto)
 ////////////////////////////////////////////////////////////////////////
-
-$choses_possibles['articles'] = array(
-									  'titre_chose' => 'public:articles',
-										  'id_chose' => 'id_article',
-									  'table_principale' => 'spip_articles',
-									  'table_auth' => 'spip_auteurs_articles',
-									  'tables_limite' => array(
-															   'articles' => array(
-																				   'table' => 'spip_articles',
-																				   'nom_id' => 'id_article'),
-															   'rubriques' => array(
-																					'table' => 'spip_articles',
-																					'nom_id' =>  'id_rubrique'),
-															   'documents' => array(
-																					'table' => 'spip_documents_articles',
-																					'nom_id' =>  'id_document'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-
-$choses_possibles['rubriques'] = array(
-									  'titre_chose' => 'public:rubriques',
-										  'id_chose' => 'id_rubrique',
-									  'table_principale' => 'spip_rubriques',
-									  'table_auth' => 'spip_auteurs_rubriques',
-									  'tables_limite' => array(
-															   'rubriques' => array(
-																					'table' => 'spip_rubriques',
-																					'nom_id' =>  'id_rubrique'),
-																'secteurs' => array(
-																					 'table' => 'spip_rubriques',
-																					 'nom_id' =>  'id_secteur'),
-																'parents' => array(
-																					 'table' => 'spip_rubriques',
-																					 'nom_id' =>  'id_parent'),
-															   'documents' => array(
-																					'table' => 'spip_documents_rubriques',
-																					'nom_id' =>  'id_document'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-$choses_possibles['documents'] = array(
-									   'titre_chose' => 'info_documents',
-												  'id_chose' => 'id_document',
-									   'table_principale' => 'spip_documents',
-									   'tables_limite' => array(
-																'articles' => array(
-																					'table' => 'spip_documents_articles',
-																					'nom_id' => 'id_article'),
-																'rubriques' => array(
-																					 'table' => 'spip_documents_rubriques',
-																					 'nom_id' =>  'id_rubrique'),
-																'documents' => array(
-																					 'table' => 'spip_documents',
-																					 'nom_id' =>  'id_document')
-																)
-									   );
-
-$choses_possibles['auteurs'] = array(
-									  'titre_chose' => 'auteurs',
-									  'id_chose' => 'id_auteur',
-									  'table_principale' => 'spip_auteurs',
-									  'tables_limite' => array(
-															   'auteurs' => array(
-																				   'table' => 'spip_auteurs',
-																				   'nom_id' => 'id_auteur'),
-															   'articles' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-$choses_possibles['messages'] = array(
-									  'titre_chose' => 'Messages',
-									  'id_chose' => 'id_message',
-									  'table_principale' => 'spip_messages',
-									  
-									  'table_auth' => 'spip_auteurs_messages',
-									  'tables_limite' => array(
-															   'messages' => array(
-																				   'table' => 'spip_messages',
-																				   'nom_id' => 'id_message'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_messages',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
 /***********************************************************************
 * PREFIXE
 ***********************************************************************/
@@ -892,7 +896,6 @@
 $mots = $_REQUEST['id_mots'];
 $sans_mots = $_REQUEST['sans_mots'];
 $choses = $_REQUEST['id_choses'];
-$nom_tags = $_REQUEST['nom_tags'];
 $limit =  $_REQUEST['limit'];
 $id_limit =  $_REQUEST['id_limit'];
 //echo "!!!".$nom_chose."!!!";
@@ -900,8 +903,8 @@
 //echo "choses :".serialize($choses)."<br>";
 //echo "mots :".serialize($mots)."<br>";
 //echo "sans_mots :".serialize($sans_mots)."<br>";
-//echo "nom_tags :".serialize($nom_tags)."<br>";
 //echo "limit :".serialize($limit)."<br>";
+//echo "id_limit :".serialize($id_limit)."<br>";
 
 if($_REQUEST['switch'] == 'action' && count($choses)) {
 	if(count($mots)) {
@@ -955,22 +958,12 @@
 		  }
 		}
 	}
-	if ($nom_tags){
-		$tags = new ListeTags($nom_tags,'Tag');
-//		echo "!!!!!!!tag:".$nom_tags."/".serialize($tags)."!!!!!!!!!";
-		foreach($choses as $d) {
-			if($_REQUEST['bouton'] == 'ajouter')
-			  $tags->ajouter($d,$nom_chose,$id_chose);
-			if($_REQUEST['bouton'] == 'retirer')
-			  $tags->retirer($d,$nom_chose,$id_chose);
-		}
-	}
 }
 /**********************************************************************
 * recherche des choses.
 ***********************************************************************/
 
-if(count($choses) >= 0) {
+if(count($choses) == 0) {
   $select = array();
   $select[] = "DISTINCT main.$id_chose";
   
@@ -1088,6 +1081,9 @@
  ***********************************************************************/
 
 debut_page('&laquo; '._T('motspartout:titre_page').' &raquo;', 'documents', 'mots');
+?>
+</script>
+<?php
 
 echo '<br><br><center>';
 gros_titre(_T('motspartout:titre_page'));
@@ -1109,25 +1105,7 @@
 foreach($choses_possibles as $cho => $m) {
   echo "<option value=\"$cho\"".(($cho == $nom_chose)?'selected':'').'>'._T($m['titre_chose']).'</option>';
 }
-echo '</select></td></tr>';
-
-echo '<tr class=\'tr_liste\'>';
-?>
-<td colspan=3><button type='submit' name='switch' value='chose'>
-<?php echo _T('motspartout:valider'); ?>
-</button>
-</td>
-<?php
-echo '</table></div>';
-
-fin_cadre_enfonce();
-echo '</form><form method="post" action="mots_partout.php">';
-
-// choix de la chose sur laquelle on veut ajouter des mots
-debut_cadre_enfonce('',false,'',_T('motspartout:voir'));
-
-echo '<div class=\'liste\'>
-<table border=0 cellspacing=0 cellpadding=3 width=\"100%\">
+echo '</select></td></tr>
 <tr class=\'tr_liste\'><td colspan=2>'.
 _T('motspartout:limite').
 ':</td></tr>';
@@ -1144,22 +1122,46 @@
 echo "<td><input type='text' size='3' name='id_limit' value='$id_limit'></td></tr>";
 echo '<tr class=\'tr_liste\'>';
 ?>
+<td colspan=3><button type='submit' name='switch' value='chose'>
+<?php echo _T('motspartout:voir'); ?>
+</button>
+</td>
+</table></div>
+<?php
+fin_cadre_enfonce();
+echo "</form><form method='post' action='mots_partout.php'>
+<input type='hidden' name='limit' value='$limit'>
+<input type='hidden' name='id_limit' value='$id_limit'>
+";
+
+if(count($choses)) {
+debut_cadre_enfonce('',false,'',_T('motspartout:voir'));
+?>
+<div class='liste'>
+<table border=0 cellspacing=0 cellpadding=3 width="100%">
+<tr class='tr_liste'>
+<td colspan=2>
+<!-- TODO traduire -->
+Voir les mots ou les photos selectionn?s.
+</td>
+</tr>
+<tr class='tr_liste'>
 <td><button type='submit' name='switch' value='voir'>
-<?php echo _T('motspartout:valider'); ?>
+<?php echo _T('motspartout:voir'); ?>
 </button>
 </td>
 <td colspan=2>
 <input type='checkbox' id='strict' name='strict'/><label for='strict'>
 <?php echo _T('motspartout:stricte'); ?>
 </label></td>
+</tr>
+</table></div>
 <?php
-echo '</table></div>';
 fin_cadre_enfonce();
 
 
  // echo '</form>';
 
-if(count($choses)) {
 // 	echo '<a name="action"></a><form action="mots_partout.php#voir">';
 
   echo '<input type="hidden" name="nom_chose" value="'.$_REQUEST['nom_chose'].'">';  
@@ -1172,48 +1174,34 @@
   // les actions et limitations possibles.
   debut_cadre_enfonce('',false,'',_T('motspartout:action'));
   
+  
   echo '<div class=\'liste\'>
 <table border=0 cellspacing=0 cellpadding=3 width=\"100%\">';
-  echo '<tr class=\'tr_liste\'>
+//ca ne sert ? rien, on n'utilise jamais ces choix, on utilise directement avec/sans mais ?a pourrait ?tre utile pour g?rer tag-machine 
+/* echo '<tr class=\'tr_liste\'>
 <td><input type=\'radio\' value=\'ajouter\' name="bouton" id=\'ajouter\'><br><label for=\'ajouter\'>'.
 	_T('motspartout:ajouter').
 	'</label></td>
 <td ><input type=\'radio\' value=\'enlever\' name="bouton" id=\'enlever\'><br><label for=\'enlever\'>'.
 	_T('motspartout:enlever').
 	'</label></td>
-</tr>';
+</tr>';*/
   ?>
-	<tr class='tr_liste'>
-	  <td colspan=2><label for="nom_tags">liste des mots ? ajouter</label>
+	   <tr class='tr_liste'>
+	   <td colspan=2>
+<!--TODO traduire-->
+		 Ajouter les mots coch?s <em>avec</em> et retirer les mots coch?s <em>sans</em>
 </td>
-</tr>
-	<tr class='tr_liste'>
-	  <td colspan=2>
-		<textarea name="nom_tags" rows='10' class='forml' cols='40'></textarea>
-<?php 
-	/*<div style="position:relative;overflow:visible; width: 10em;">
-        <input autocomplete="off" type="texte" id="tags" name="nom_tags" class='forml' cols='40' style="width: 100%;">
-        <div id="suggest" class="suggest_list" style="width: 100%;"></div>
-      </div>*/ 
-?>
-	  </td>
-	 </tr>
-	 <tr class='tr_liste'>
+		   </tr>
+	   <tr class='tr_liste'>
 	   <td colspan=2><button type='submit' name='switch' value='action'>
-	   <?php echo _T('bouton_valider'); ?>
+		   <?php  echo _T('bouton_valider'); ?>
 	   </button></td>
 		   </tr>
 		   </table>
 		   </div>
-<?php 
-/*<link rel="stylesheet" type="text/css" href="./ajaxTagMachine.css">
-<script  type='text/javascript' src="./ajaxTagMachine.js">
-</script>
-  <script  type='text/javascript'> <!--
-	groupe = new AjaxSuggestMenu('ajax_mortimer.php', 'titre', 'tags','suggest');
-	groupe.addVar('nom_chose','<?php echo $nom_chose; ?>');
-	groupe.setNbrLineVisible(5);
-  	--></script>*/ 
+		   
+<?php
 		   
   fin_cadre_enfonce();
  creer_colonne_droite();
@@ -1354,4 +1342,4 @@
 <?php
 
 fin_page();
-?>
\ No newline at end of file
+?>

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.6
retrieving revision 1.18.2.7
diff -u -d -r1.18.2.6 -r1.18.2.7
--- carte_edit.php3	4 Oct 2005 00:36:29 -0000	1.18.2.6
+++ carte_edit.php3	12 Oct 2005 21:22:54 -0000	1.18.2.7
@@ -236,7 +236,7 @@
 
 	debut_cadre_relief("mot-cle-24.gif");
 	if ($connect_statut == "0minirezo") {
-			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?chose=carto_cartes&limit=carto_cartes&id_limit=".$id_carte, "mot-cle-24.gif");
+			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?nom_chose=carto_objets&limit=carto_cartes&id_limit=".$id_carte, "mot-cle-24.gif");
 	}
 	fin_cadre_relief();
 }
@@ -439,7 +439,7 @@
 			$visible = ($id_objet == $objet_visible);
 			if ($nouveau&&$visible) echo "<a name='nouveau_objet'></a>";
 			else if ($visible) echo "<a name='objet_visible'></a>";
-			echo "<p>\n";
+			echo "<a name='objet$id_objet'></a><p>\n";
 			debut_cadre_relief();
 				
 				// Modifier un objet

--- inc_tag-machine.php DELETED ---



From stef at berlios.de  Wed Oct 26 18:11:39 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 26 Oct 2005 18:11:39 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svgfilex.html,1.6.2.1,1.6.2.2
Message-ID: <200510261611.j9QGBdfG010925@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv10877/squelettes/template

Modified Files:
      Tag: BRANCH-V1
	carto_svgfilex.html 
Log Message:
bug si pas d'objets (Gregory Bourbon)

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.6.2.1
retrieving revision 1.6.2.2
diff -u -d -r1.6.2.1 -r1.6.2.2
--- carto_svgfilex.html	30 Sep 2005 00:17:41 -0000	1.6.2.1
+++ carto_svgfilex.html	26 Oct 2005 16:11:36 -0000	1.6.2.2
@@ -201,23 +201,24 @@
 		<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
 		 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
 	<!-- #DESCRIPTIF -->
+			<B_OBJECT>
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
 				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
-		 </BOUCLE_M>
+		    </B_OBJECT>
+		</BOUCLE_M>
 		</BOUCLE_OBJ>
 
+<!-- Couche d'objets SPIP -->
+			<B_objets>
 			<g id="spipCartoObj">
-			
-				<!-- Couche d'objets SPIP -->
-				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
 				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
-				</B_objets>	
 			</g>
+			</B_objets>	
 		</g>
 	</svg>
 	
@@ -278,8 +279,8 @@
 				<text x="12" y="[(#ID_MOT|plus{26})]">Objets</text>
 				<text x="12" y="[(#ID_MOT|plus{46})]">Fond de carte</text>
 			</g>
-		</g>
 		</B_OBJ2>
+		</g>
 		<!-- map impressum and status Bar -->
 		<g text-rendering="optimizeLegibility">
 			<!-- text with this id is required to show help texts -->



From stef at berlios.de  Wed Oct 26 18:13:38 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 26 Oct 2005 18:13:38 +0200
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_svgfilex.html,1.7,1.8
Message-ID: <200510261613.j9QGDcfG011152@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv11128/squelettes/template

Modified Files:
	carto_svgfilex.html 
Log Message:
bug si pas d'objets (Gregory Bourbon)

Index: carto_svgfilex.html
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/squelettes/template/carto_svgfilex.html,v
retrieving revision 1.7
retrieving revision 1.8
diff -u -d -r1.7 -r1.8
--- carto_svgfilex.html	4 Oct 2005 00:59:34 -0000	1.7
+++ carto_svgfilex.html	26 Oct 2005 16:13:36 -0000	1.8
@@ -201,23 +201,24 @@
 		<BOUCLE_OBJ(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{par num titre}>
 		 <BOUCLE_M(MOTS){id_carto_objet}{par num titre}{doublons b}>
 	<!-- #DESCRIPTIF -->
+			<B_OBJECT>
 			<g id="spipCarto_#ID_MOT">
 			<BOUCLE_OBJECT(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{id_mot}{doublons obj}>
 				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE,#_M:DESCRIPTIF})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})[(#_M:DESCRIPTIF)]]"/></a>
 			</BOUCLE_OBJECT>
 			</g>
-		 </BOUCLE_M>
+		    </B_OBJECT>
+		</BOUCLE_M>
 		</BOUCLE_OBJ>
 
+<!-- Couche d'objets SPIP -->
+			<B_objets>
 			<g id="spipCartoObj">
-			
-				<!-- Couche d'objets SPIP -->
-				<B_objets>
 				<BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}{doublons obj}>
 				<a target='new' xlink:href='[(#URL_OBJET)]'><[(#GEOMETRIE|wkt2shape{SVG})] [(#GEOMETRIE|wkt2coords{SVG,#CALLAGE,#URL_CARTE})] onmouseover="statusChange('#TEXTE');" class="[(#GEOMETRIE|wkt2shape{SVG})]"/></a>
 				</BOUCLE_objets>
-				</B_objets>	
 			</g>
+			</B_objets>	
 		</g>
 	</svg>
 	
@@ -278,8 +279,8 @@
 				<text x="12" y="[(#ID_MOT|plus{26})]">Objets</text>
 				<text x="12" y="[(#ID_MOT|plus{46})]">Fond de carte</text>
 			</g>
-		</g>
 		</B_OBJ2>
+		</g>
 		<!-- map impressum and status Bar -->
 		<g text-rendering="optimizeLegibility">
 			<!-- text with this id is required to show help texts -->



From stef at berlios.de  Wed Oct 26 22:33:10 2005
From: stef at berlios.de (stef at berlios.de)
Date: Wed, 26 Oct 2005 22:33:10 +0200
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.8.2.2,1.8.2.3
Message-ID: <200510262033.j9QKXAfG026188@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv26164/ecrire

Modified Files:
      Tag: BRANCH-V1
	mes_options.php3 
Log Message:
erreur SQL ? l'installation (TEXT BINARY NOT NULL)

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8.2.2
retrieving revision 1.8.2.3
diff -u -d -r1.8.2.2 -r1.8.2.3
--- mes_options.php3	30 Sep 2005 22:06:55 -0000	1.8.2.2
+++ mes_options.php3	26 Oct 2005 20:33:07 -0000	1.8.2.3
@@ -16,10 +16,10 @@
 //////////////////////////////////////////////////
 $spip_carto_cartes = array(
 	"id_carto_carte" => "bigint(21) NOT NULL",
-	"titre" => "VARCHAR(255) BINARY NOT NULL",
-	"texte" => "TEXT BINARY NOT NULL",
-	"url_carte" => "TEXT BINARY NOT NULL",
-	"callage" => "TEXT BINARY NOT NULL",
+	"titre" => "varchar(255) NOT NULL",
+	"texte" => "text NOT NULL",
+	"url_carte" => "text NOT NULL",
+	"callage" => "text NOT NULL",
 	"id_srs" => "bigint(21) NOT NULL");
 
 $spip_carto_cartes_key = array(
@@ -34,11 +34,11 @@
 $spip_carto_objets = array(
 	"id_carto_objet" => "bigint(21) NOT NULL",
 	"id_carto_carte" => "bigint(21) NOT NULL",
-	"titre" => "VARCHAR(255) BINARY NOT NULL",
-	"texte" => "TEXT BINARY NOT NULL",
-	"url_objet" => "TEXT BINARY NOT NULL",
-	"url_logo" => "TEXT BINARY NOT NULL",
-	"geometrie" => "TEXT BINARY NOT NULL");
+	"titre" => "varchar(255) NOT NULL",
+	"texte" => "text NOT NULL",
+	"url_objet" => "text NOT NULL",
+	"url_logo" => "text NOT NULL",
+	"geometrie" => "text NOT NULL");
 	
 $spip_carto_objets_key = array(
 	"PRIMARY KEY" => "id_carto_objet",



