<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Spip-carto-cvs] spipcarto inc-urls-propres.php3,1.5,1.5.2.1 inc-calcul.php3,1.6,1.6.2.1 inc-balises.php3,1.12,1.12.2.1 spip_cookie.php3,1.6,1.6.2.1 page.php3,1.3,1.3.2.1 spip_login.php3,1.4,1.4.2.1 spip_background.php3,1.3,1.3.2.1 inc-compilo.php3,1.8,1.8.2.1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/spip-carto-cvs/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20spipcarto%20inc-urls-propres.php3%2C1.5%2C1.5.2.1%20inc-calcul.php3%2C1.6%2C1.6.2.1%20inc-balises.php3%2C1.12%2C1.12.2.1%20spip_cookie.php3%2C1.6%2C1.6.2.1%20page.php3%2C1.3%2C1.3.2.1%20spip_login.php3%2C1.4%2C1.4.2.1%20spip_background.php3%2C1.3%2C1.3.2.1%20inc-compilo.php3%2C1.8%2C1.8.2.1&In-Reply-To=%3C200511012152.jA1LptfG009731%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000334.html">
   <LINK REL="Next"  HREF="000335.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Spip-carto-cvs] spipcarto inc-urls-propres.php3,1.5,1.5.2.1 inc-calcul.php3,1.6,1.6.2.1 inc-balises.php3,1.12,1.12.2.1 spip_cookie.php3,1.6,1.6.2.1 page.php3,1.3,1.3.2.1 spip_login.php3,1.4,1.4.2.1 spip_background.php3,1.3,1.3.2.1 inc-compilo.php3,1.8,1.8.2.1</H1>
    <B>stef at berlios.de</B> 
    <A HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20spipcarto%20inc-urls-propres.php3%2C1.5%2C1.5.2.1%20inc-calcul.php3%2C1.6%2C1.6.2.1%20inc-balises.php3%2C1.12%2C1.12.2.1%20spip_cookie.php3%2C1.6%2C1.6.2.1%20page.php3%2C1.3%2C1.3.2.1%20spip_login.php3%2C1.4%2C1.4.2.1%20spip_background.php3%2C1.3%2C1.3.2.1%20inc-compilo.php3%2C1.8%2C1.8.2.1&In-Reply-To=%3C200511012152.jA1LptfG009731%40sheep.berlios.de%3E"
       TITLE="[Spip-carto-cvs] spipcarto inc-urls-propres.php3,1.5,1.5.2.1 inc-calcul.php3,1.6,1.6.2.1 inc-balises.php3,1.12,1.12.2.1 spip_cookie.php3,1.6,1.6.2.1 page.php3,1.3,1.3.2.1 spip_login.php3,1.4,1.4.2.1 spip_background.php3,1.3,1.3.2.1 inc-compilo.php3,1.8,1.8.2.1">stef at berlios.de
       </A><BR>
    <I>Tue Nov  1 22:51:55 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000334.html">[Spip-carto-cvs] spipcarto/js x_dom_nn4.js,1.1,NONE tree.js,1.1,NONE graphTools.js,1.1,NONE Copie de navTools.js,1.1,NONE navTools.bak.js,1.1,NONE carto.js,1.1,NONE navTools.js,1.1,NONE x_event_nn4.js,1.1,NONE x_core_nn4.js,1.1,NONE
</A></li>
        <LI>Next message: <A HREF="000335.html">[Spip-carto-cvs] spipcarto/ecrire auteur_infos.php3,1.6,1.6.2.1 upgrade.php3,1.4,1.4.2.1 index.php3,1.8,1.8.2.1 inc_version.php3,1.12,1.12.2.1 inc_mots.php3,1.7,1.7.2.1 inc_mail.php3,1.4,1.4.2.1 inc_texte.php3,1.12,1.12.2.1 inc_documents.php3,1.7.2.2,1.7.2.3 inc_filtres.php3,1.10,1.10.2.1 engines-list.txt,1.4,1.4.2.1 inc_debug_sql.php3,1.9,1.9.2.1 inc_extra.php3,1.2,1.2.2.1 aide_index.php3,1.6,1.6.2.1 inc_logos.php3,1.6,1.6.2.1 unpack.php3,1.2,1.2.2.1 install.php3,1.4,1.4.2.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#338">[ date ]</a>
              <a href="thread.html#338">[ thread ]</a>
              <a href="subject.html#338">[ subject ]</a>
              <a href="author.html#338">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv9696

Modified Files:
      Tag: BRANCH-V1
	inc-urls-propres.php3 inc-calcul.php3 inc-balises.php3 
	spip_cookie.php3 page.php3 spip_login.php3 
	spip_background.php3 inc-compilo.php3 
Log Message:
Mise &#224; jour Spip 1.8.2e

Index: inc-urls-propres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-urls-propres.php3,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- inc-urls-propres.php3	21 Jul 2005 21:47:12 -0000	1.5
+++ inc-urls-propres.php3	1 Nov 2005 21:51:53 -0000	1.5.2.1
@@ -51,7 +51,7 @@
 		$champ_titre = 'titre';
 
 	// D'abord, essayer de recuperer l'URL existante si possible
-	$result = spip_query(&quot;SELECT url_propre, $champ_titre
+	$result = spip_query(&quot;SELECT url_propre, statut, $champ_titre
 	FROM $table WHERE $col_id=$id_objet&quot;);
 	if (!($row = spip_fetch_array($result))) return &quot;&quot;; # objet inexistant
 
@@ -202,8 +202,7 @@
 				// recuperer les arguments supplementaires (&amp;debut_xxx=...)
 				$reste = preg_replace('/^&amp;/','?',
 					preg_replace(&quot;/[?&amp;]$id_table_objet=$id_objet/&quot;,'',$regs[5]));
-				Header(&quot;Location: $url_propre$reste&quot;);
-				exit;
+				redirige_par_entete(&quot;$url_propre$reste&quot;);
 			}
 		}
 		return;

Index: inc-calcul.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-calcul.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- inc-calcul.php3	10 Aug 2005 12:00:39 -0000	1.6
+++ inc-calcul.php3	1 Nov 2005 21:51:53 -0000	1.6.2.1
@@ -236,7 +236,7 @@
 				if ($url) { // sinon les navigateurs pataugent
 					$url = texte_script(str_replace('&amp;', '&amp;', $url));
 					$page = array('texte' =&gt; &quot;&lt;&quot;.
-					&quot;?php header('Location: $url'); ?&quot; . &quot;&gt;&quot;,
+					&quot;?php redirige_par_entete('$url'); ?&quot; . &quot;&gt;&quot;,
 					'process_ins' =&gt; 'php');
 				}
 			}

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.12
retrieving revision 1.12.2.1
diff -u -d -r1.12 -r1.12.2.1
--- inc-balises.php3	24 Sep 2005 01:13:14 -0000	1.12
+++ inc-balises.php3	1 Nov 2005 21:51:53 -0000	1.12.2.1
@@ -64,7 +64,7 @@
 		//MODIFICATION SPIPCARTO
 		/////////////////////////////////////////////////////
 		,'URL_OBJET' =&gt; 'htmlspecialchars(url(vider_url(%s)))'
-		/////////////////////////////////////////////////////
+		/////////////////////////////////////////////////////		
 	);
 	$ps = $traitements[$p-&gt;nom_champ];
 	if (!$ps) return $p-&gt;code;
@@ -101,19 +101,19 @@
 //
 function balise_NOM_SITE_SPIP_dist($p) {
 	$p-&gt;code = &quot;lire_meta('nom_site')&quot;;
-	$p-&gt;statut = 'php';
+	$p-&gt;statut = 'html';
 	return $p;
 }
 
 function balise_EMAIL_WEBMASTER_dist($p) {
 	$p-&gt;code = &quot;lire_meta('email_webmaster')&quot;;
-	$p-&gt;statut = 'php';
+	$p-&gt;statut = 'html';
 	return $p;
 }
 
 function balise_CHARSET_dist($p) {
 	$p-&gt;code = &quot;lire_meta('charset')&quot;;
-	$p-&gt;statut = 'php';
+	$p-&gt;statut = 'html';
 	return $p;
 }
 
@@ -187,13 +187,13 @@
 
 function balise_DOSSIER_SQUELETTE_dist($p) {
 	$p-&gt;code = &quot;'&quot; . addslashes(dirname($p-&gt;descr['sourcefile'])) . &quot;'&quot; ;
-	$p-&gt;statut = 'php';
+	$p-&gt;statut = 'html';
 	return $p;
 }
 
 function balise_URL_SITE_SPIP_dist($p) {
 	$p-&gt;code = &quot;lire_meta('adresse_site')&quot;;
-	$p-&gt;statut = 'php';
+	$p-&gt;statut = 'html';
 	return $p;
 }
 
@@ -215,7 +215,7 @@
 			$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 	}
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -226,7 +226,7 @@
 	if ($p-&gt;boucles[$p-&gt;nom_boucle ? $p-&gt;nom_boucle : $p-&gt;id_boucle]-&gt;hash)
 	$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -237,7 +237,7 @@
 	if ($p-&gt;boucles[$p-&gt;nom_boucle ? $p-&gt;nom_boucle : $p-&gt;id_boucle]-&gt;hash)
 	$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -249,7 +249,7 @@
 	if ($p-&gt;boucles[$p-&gt;nom_boucle ? $p-&gt;nom_boucle : $p-&gt;id_boucle]-&gt;hash)
 	$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -266,7 +266,7 @@
 	if ($p-&gt;boucles[$p-&gt;nom_boucle ? $p-&gt;nom_boucle : $p-&gt;id_boucle]-&gt;hash)
 	$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -274,7 +274,7 @@
 	$p-&gt;code = &quot;generer_url_document(&quot; .
 	champ_sql('id_document',$p) . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 
@@ -284,7 +284,7 @@
 	if ($p-&gt;boucles[$p-&gt;nom_boucle ? $p-&gt;nom_boucle : $p-&gt;id_boucle]-&gt;hash)
 	$p-&gt;code = &quot;url_var_recherche(&quot; . $p-&gt;code . &quot;)&quot;;
 
-	$p-&gt;statut = 'html';
+	$p-&gt;statut = 'php';
 	return $p;
 }
 

Index: spip_cookie.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_cookie.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- spip_cookie.php3	30 Jun 2005 10:09:36 -0000	1.6
+++ spip_cookie.php3	1 Nov 2005 21:51:53 -0000	1.6.2.1
@@ -238,7 +238,7 @@
 	redirige_par_entete($redirect);
 }
 else {
-	@header(&quot;Refresh: 0; url=&quot; . $redirect);
+	spip_header(&quot;Refresh: 0; url=&quot; . $redirect);
 	echo &quot;&lt;html&gt;&lt;head&gt;&quot;;
 	echo &quot;&lt;meta http-equiv='Refresh' content='0; url=&quot;.$redirect.&quot;'&gt;&quot;;
 	echo &quot;&lt;/head&gt;\n&quot;;

Index: page.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/page.php3,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- page.php3	18 Aug 2005 23:28:34 -0000	1.3
+++ page.php3	1 Nov 2005 21:51:53 -0000	1.3.2.1
@@ -2,6 +2,7 @@
 
 // Appel spip
 if (!function_exists('find_in_path')) {
+	define('_SPIP_PAGE',1); # ne pas mourir si on passe le $fond
 	include ('ecrire/inc_version.php3');
 }
 // Reglage du $fond

Index: spip_login.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_login.php3,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- spip_login.php3	30 Jun 2005 10:09:36 -0000	1.4
+++ spip_login.php3	1 Nov 2005 21:51:53 -0000	1.4.2.1
@@ -19,10 +19,9 @@
 // Compatibilite anciennes versions de SPIP : si un 'var_url' (cible du login)
 // est passe, renvoyer vers la meme adresse mais avec 'url'
 if (isset($_SERVER['REQUEST_URI'])
-AND strpos($_SERVER['REQUEST_URI'], 'var_url')) {
-	header('Location: '.str_replace('var_url', 'url', $_SERVER['REQUEST_URI']));
-	exit;
-}
+AND strpos($_SERVER['REQUEST_URI'], 'var_url'))
+	@header('Location: '.str_replace('var_url', 'url', $_SERVER['REQUEST_URI']));
+
 // Fin compatibilite
 
 include (&quot;inc-public.php3&quot;);

Index: spip_background.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_background.php3,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- spip_background.php3	20 Feb 2005 22:16:48 -0000	1.3
+++ spip_background.php3	1 Nov 2005 21:51:53 -0000	1.3.2.1
@@ -14,10 +14,9 @@
 // Du cote de la page HTML, utiliser un background-image en feuille de style
 // plutot qu'un &lt;img&gt;, c'est plus discret notamment sous navigateur texte
 $image = pack(&quot;H*&quot;, &quot;47494638396118001800800000ffffff00000021f90401000000002c0000000018001800000216848fa9cbed0fa39cb4da8bb3debcfb0f86e248965301003b&quot;);
-$size = strlen($image);
 
 Header(&quot;Content-Type: image/gif&quot;);
-Header(&quot;Content-Length: &quot;.$size);
+Header(&quot;Content-Length: &quot;.strlen($image));
 Header(&quot;Cache-Control: no-cache,no-store&quot;);
 Header(&quot;Pragma: no-cache&quot;);
 Header(&quot;Connection: close&quot;);

Index: inc-compilo.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-compilo.php3,v
retrieving revision 1.8
retrieving revision 1.8.2.1
diff -u -d -r1.8 -r1.8.2.1
--- inc-compilo.php3	18 Aug 2005 23:28:34 -0000	1.8
+++ inc-compilo.php3	1 Nov 2005 21:51:53 -0000	1.8.2.1
@@ -457,7 +457,7 @@
 			$altern = &quot;''&quot;;
 			break;
 
-		case 'champ';
+		case 'champ':
 
 			// cette structure pourrait etre completee des le phrase' (a faire)
 			$p-&gt;id_boucle = $id_boucle;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000334.html">[Spip-carto-cvs] spipcarto/js x_dom_nn4.js,1.1,NONE tree.js,1.1,NONE graphTools.js,1.1,NONE Copie de navTools.js,1.1,NONE navTools.bak.js,1.1,NONE carto.js,1.1,NONE navTools.js,1.1,NONE x_event_nn4.js,1.1,NONE x_core_nn4.js,1.1,NONE
</A></li>
	<LI>Next message: <A HREF="000335.html">[Spip-carto-cvs] spipcarto/ecrire auteur_infos.php3,1.6,1.6.2.1 upgrade.php3,1.4,1.4.2.1 index.php3,1.8,1.8.2.1 inc_version.php3,1.12,1.12.2.1 inc_mots.php3,1.7,1.7.2.1 inc_mail.php3,1.4,1.4.2.1 inc_texte.php3,1.12,1.12.2.1 inc_documents.php3,1.7.2.2,1.7.2.3 inc_filtres.php3,1.10,1.10.2.1 engines-list.txt,1.4,1.4.2.1 inc_debug_sql.php3,1.9,1.9.2.1 inc_extra.php3,1.2,1.2.2.1 aide_index.php3,1.6,1.6.2.1 inc_logos.php3,1.6,1.6.2.1 unpack.php3,1.2,1.2.2.1 install.php3,1.4,1.4.2.1
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#338">[ date ]</a>
              <a href="thread.html#338">[ thread ]</a>
              <a href="subject.html#338">[ subject ]</a>
              <a href="author.html#338">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/spip-carto-cvs">More information about the Spip-carto-cvs
mailing list</a><br>
</body></html>
