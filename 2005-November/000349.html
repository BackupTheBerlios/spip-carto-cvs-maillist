<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Spip-carto-cvs] contrib/squelettes formulaire_carte.html,NONE,1.1 carte.html,NONE,1.1 inc-formulaire_carte.php3,NONE,1.1
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/spip-carto-cvs/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20contrib/squelettes%20formulaire_carte.html%2CNONE%2C1.1%20carte.html%2CNONE%2C1.1%20inc-formulaire_carte.php3%2CNONE%2C1.1&In-Reply-To=%3C200511062247.jA6Ml3fG008652%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000348.html">
   <LINK REL="Next"  HREF="000350.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Spip-carto-cvs] contrib/squelettes formulaire_carte.html,NONE,1.1 carte.html,NONE,1.1 inc-formulaire_carte.php3,NONE,1.1</H1>
    <B>stef at berlios.de</B> 
    <A HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20contrib/squelettes%20formulaire_carte.html%2CNONE%2C1.1%20carte.html%2CNONE%2C1.1%20inc-formulaire_carte.php3%2CNONE%2C1.1&In-Reply-To=%3C200511062247.jA6Ml3fG008652%40sheep.berlios.de%3E"
       TITLE="[Spip-carto-cvs] contrib/squelettes formulaire_carte.html,NONE,1.1 carte.html,NONE,1.1 inc-formulaire_carte.php3,NONE,1.1">stef at berlios.de
       </A><BR>
    <I>Sun Nov  6 23:47:03 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000348.html">[Spip-carto-cvs] contrib/ecrire inc_carto_fonctions.php3,NONE,1.1
</A></li>
        <LI>Next message: <A HREF="000350.html">[Spip-carto-cvs] contrib LISEZMOI.txt,1.1.1.1,1.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#349">[ date ]</a>
              <a href="thread.html#349">[ thread ]</a>
              <a href="subject.html#349">[ subject ]</a>
              <a href="author.html#349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/spip-carto/contrib/squelettes
In directory sheep:/tmp/cvs-serv8626/squelettes

Added Files:
	formulaire_carte.html carte.html inc-formulaire_carte.php3 
Log Message:
premier jet de formulaire ...
(<A HREF="http://spipcarto.free.fr/page.php3?id_carto_carte=1&amp;fond=carte">http://spipcarto.free.fr/page.php3?id_carto_carte=1&amp;fond=carte</A>)

--- NEW FILE: formulaire_carte.html ---
&lt;BOUCLE_carte_principal(CARTO_CARTES) {id_carto_carte=#ENV{id_carto_carte}}&gt;
&lt;table border=&quot;0&quot;&gt;
  &lt;tr&gt; 
   &lt;td colspan=&quot;7&quot;&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;js/x_core_nn4.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/x_dom_nn4.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/x_event_nn4.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/navTools.js&quot;&gt;&lt;/script&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/graphTools.js&quot;&gt;&lt;/script&gt;
&lt;form action=&quot;#SELF&quot; method=&quot;post&quot; name=&quot;carto_form&quot;&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
/*&lt;![CDATA[*/ 
    var dhtmlDivs = new String();
    document.image = new Image;
    document.image.src = '../spip_carto.php?fond_carte=1';
    document.image.usemap='#map1';
//   if (xIE) {
      dhtmlDivs = '&lt;div id=&quot;mapImageDiv&quot; class=&quot;dhtmldiv&quot; style=&quot;background-image:url('; 
      dhtmlDivs += document.image.src;
      dhtmlDivs += ');visibility:hidden;background-repeat:no-repeat;&quot;&gt;&lt;/div&gt;';
/*    } else {
      dhtmlDivs = '&lt;div id=&quot;mapImageDiv&quot; class=&quot;dhtmldiv&quot; style=&quot;visibility:hidden&quot;&gt;&lt;img ';
      dhtmlDivs += 'src=&quot;' + document.image.src + '&quot; alt=&quot;Main map&quot; title=&quot;&quot; ';
      dhtmlDivs += 'width=&quot;408px&quot; height=&quot;323px&quot; /&gt;&lt;/div&gt;';    
    }
*/
    dhtmlDivs += '&lt;div id=&quot;myCanvasDiv&quot; class=&quot;dhtmldiv&quot;&gt;&lt;/div&gt;';
    dhtmlDivs += '&lt;div id=&quot;myCanvas2Div&quot; class=&quot;dhtmldiv&quot;&gt;&lt;/div&gt;';
    dhtmlDivs += '&lt;div id=&quot;myCanvas3Div&quot; class=&quot;dhtmldiv&quot;&gt;&lt;/div&gt;';
    dhtmlDivs += '&lt;div id=&quot;mainDHTMLDiv&quot; class=&quot;dhtmldiv&quot;&gt;&lt;/div&gt;';
    dhtmlDivs += '&lt;div id=&quot;diplayContainerDiv&quot; class=&quot;dhtmldiv&quot;&gt;';
    dhtmlDivs += '&lt;table border=&quot;0&quot; width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;&lt;tr&gt;';
    dhtmlDivs += '&lt;td width=&quot;50%&quot;&gt;&lt;div id=&quot;displayCoordsDiv&quot; class=&quot;dhtmlDisplay&quot;&gt;&lt;/div&gt;&lt;/td&gt;';
    dhtmlDivs += '&lt;td align=&quot;right&quot; width=&quot;50%&quot;&gt;&lt;div id=&quot;displayMeasureDiv&quot; class=&quot;dhtmlDisplay&quot;&gt;&lt;/div&gt;&lt;/td&gt;';
    dhtmlDivs += '&lt;/tr&gt;&lt;/table&gt;&lt;/div&gt;';
    document.write(dhtmlDivs);
                  
    var polys= new Array();
    var polycount= 0;
    var rects= new Array();
    var rectcount= 0;
    var lines= new Array();
    var linecount= 0;
    var circles= new Array();
    var circlecount= 0;
    var points= new Array();
    var pointcount= 0;
    	
    function dboxDrawObj (dhtmlBox){
	  for (var i=0; i&lt;polys.length; i++) dhtmlBox.drawPoly(polys[i],1);
	  for (var i=0; i&lt;rects.length; i++) dhtmlBox.drawRect(rects[i],1);
	  for (var i=0; i&lt;lines.length; i++) dhtmlBox.drawLine(lines[i],1);
	  for (var i=0; i&lt;circles.length; i++) dhtmlBox.drawCircle(circles[i],1);
	  for (var i=0; i&lt;points.length; i++) dhtmlBox.drawPoint(points[i],1);
	}
    
    function dboxInit()
    {
      myform = document.forms['carto_form'];
      // DHTML drawing and navigating tools
      dhtmlBox = new dhtmlBox();
          
      //DHTML parameters
      dhtmlBox.dispPos = 'bottom';
      dhtmlBox.thickness = 2;
      dhtmlBox.cursorsize = 4;
      dhtmlBox.jitter = 10; // minimum size of a box dimension
      dhtmlBox.d2pts = 3;   // the distance between two points (measure tools);
      dhtmlBox.nbPts = 5;   // number of points for the last vertex
      
      // map units values
	  // dynamically given by the server
      dhtmlBox.mapHeight = -323;
      dhtmlBox.boxx = 0;
      dhtmlBox.boxy = 323;
      dhtmlBox.pixel_size = 1;
      dhtmlBox.dist_msg = 'Approx. distance: ';
      dhtmlBox.dist_unit = ' m.';
      dhtmlBox.surf_msg = 'Approx. surface: ';
      dhtmlBox.surf_unit = ' m&#194;&#178;.';
      dhtmlBox.coord_msg = 'Coords (m): ';
  
          
      dhtmlBox.initialize();
	  dboxDrawObj (dhtmlBox);
    }

    window.onload = function() {
      dboxInit();
      xHide(xGetElementById('mapAnchorDiv')); 
    }
	/*]]&gt;*/
  &lt;/script&gt;

    &lt;input type=&quot;hidden&quot; name=&quot;id_carte&quot; value=&quot;1&quot;/&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;retour&quot; value=&quot;cartes.php3&quot;/&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;selection_type&quot; /&gt;
	&lt;input type=&quot;hidden&quot; name=&quot;selection_coords&quot; /&gt;
	&lt;div id=&quot;mapAnchorDiv&quot; style=&quot;position:relative; width:408px; height:323px;&quot;&gt; 
     &lt;table&gt;
      &lt;tr&gt; 
       &lt;td align=&quot;center&quot; valign=&quot;middle&quot; width=&quot;408px&quot; height=&quot;323px&quot;&gt;
		&lt;div id=&quot;loadbar&quot;&gt;Chargement de la carte&lt;/div&gt;

	   &lt;/td&gt;
      &lt;/tr&gt;
     &lt;/table&gt;
    &lt;/div&gt;
   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td colspan=&quot;7&quot;&gt;&nbsp;&lt;/td&gt;
  &lt;/tr&gt;

  &lt;tr&gt;
   &lt;td&gt; Dessiner un objet
    &lt;!--&lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;rectangle,submit,crossHair,zoom_in&quot;  id=&quot;zoom_in&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          zoom_in&lt;br /&gt;--&gt;
   &lt;/td&gt;
   &lt;td&gt;
    &lt;!--&lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;point,submit,crossHair,zoom_out&quot;  id=&quot;zoom_out&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          zoom out&lt;br /&gt;--&gt;
   &lt;/td&gt;
   &lt;td&gt;
    &lt;!--&lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;pan,submit,move,pan&quot;  id=&quot;pan&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          pan&lt;br /&gt;--&gt;

   &lt;/td&gt;
   &lt;td&gt;
    &lt;!--&lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;rectangle,submit,help,query&quot;  id=&quot;query&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          Rectangle&lt;br /&gt;--&gt;
   &lt;/td&gt;
   &lt;td&gt;
    &lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;point,submit,crossHair,point&quot;   id=&quot;point&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          Point&lt;br /&gt;
   &lt;/td&gt;

   &lt;td&gt;
    &lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;line,submit,crossHair,line&quot;   id=&quot;line&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          Ligne&lt;br /&gt;
   &lt;/td&gt;&lt;td&gt;&lt;input type=&quot;radio&quot; name=&quot;tool&quot; value=&quot;polygon,submit,crossHair,polygon&quot;   checked=&quot;checked&quot;  id=&quot;polygon&quot; onclick=&quot;dhtmlBox.changeTool()&quot; /&gt;
          Polygone&lt;br /&gt;
   &lt;/td&gt;
  &lt;/tr&gt;
 &lt;/table&gt;

&lt;/form&gt;
&lt;B_objets&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
/*&lt;![CDATA[*/
&lt;BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ENV{id_carto_carte}}&gt;
[(#GEOMETRIE|geometrie_script{#ID_CARTO_OBJET,#CALLAGE,#URL_CARTE})]
&lt;/BOUCLE_objets&gt;
/*]]&gt;*/
&lt;/script&gt;
&lt;/B_objets&gt;

&lt;/BOUCLE_carte_principal&gt;

--- NEW FILE: carte.html ---
&lt;BOUCLE_carte_principal(CARTO_CARTES) {id_carto_carte}&gt;&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;  &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
&lt;html dir=&quot;#LANG_DIR&quot; lang=&quot;#LANG&quot;&gt;
&lt;head&gt;
&lt;title&gt;[(#TITRE|textebrut)]&lt;/title&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=#CHARSET&quot; /&gt;
&lt;!-- Ceci est la feuille de style par defaut pour les types internes a SPIP --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;spip_style.css&quot; type=&quot;text/css&quot; /&gt;

&lt;!-- Les feuilles de style specifiques aux presents squelettes --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;#DOSSIER_SQUELETTE/typographie.css&quot; type=&quot;text/css&quot; /&gt;

&lt;!-- media=&quot;...&quot; permet de ne pas utiliser ce style sous Netscape 4 (sinon plantage) --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;#DOSSIER_SQUELETTE/habillage.css&quot; type=&quot;text/css&quot; media=&quot;projection, screen, tv&quot; /&gt;
&lt;!-- media=&quot;print&quot; permet d'utiliser cette feuille de style quand vous imprimez depuis votre navigateur --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;#DOSSIER_SQUELETTE/impression.css&quot; type=&quot;text/css&quot; media=&quot;print&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
&lt;div id=&quot;navigation&quot;&gt;

&lt;h1 class=&quot;structure&quot;&gt;&lt;:navigation:&gt;&lt;/h1&gt;

&lt;!-- Menu de navigation general --&gt;

&lt;div class=&quot;menu&quot;&gt;
&lt;ul class=&quot;general&quot;&gt;
	&lt;li class=&quot;menu-titre&quot;&gt;
	[&lt;a href=&quot;(#URL_SITE_SPIP)&quot; title=&quot;&lt;:accueil_site:&gt;&quot;&gt;&lt;b&gt;#NOM_SITE_SPIP&lt;/b&gt;&lt;/a&gt;]
	&lt;/li&gt;
	&lt;li class=&quot;menu-item&quot;&gt;
	&lt;a href=&quot;plan.php3&quot;&gt;&lt;:plan_site:&gt;&lt;/a&gt;
	&lt;/li&gt;
	&lt;li class=&quot;menu-item&quot;&gt;
	&lt;a href=&quot;resume.php3&quot; title=&quot;&lt;:articles_populaires:&gt;&quot;&gt;&lt;:en_resume:&gt;&lt;/a&gt;
	&lt;/li&gt;
	&lt;li class=&quot;menu-item&quot;&gt;
	&lt;a href=&quot;ecrire/&quot;&gt;&lt;:espace_prive:&gt;&lt;/a&gt;
	&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;

&lt;!-- Formulaire de recherche --&gt;

[(#FORMULAIRE_RECHERCHE)]

&lt;/div&gt;

&lt;div class=&quot;contenu&quot; id=&quot;principal&quot;&gt;
[(#FORMULAIRE_CARTE{#ID_CARTO_CARTE})]
&lt;/div&gt;

&lt;/body&gt;
&lt;/html&gt;
&lt;/BOUCLE_carte_principal&gt;

--- NEW FILE: inc-formulaire_carte.php3 ---
&lt;?php
if (!defined(&quot;_ECRIRE_INC_VERSION&quot;)) return;	#securite

// Le contexte indique dans quelle rubrique le visiteur peut proposer le site
global $balise_FORMULAIRE_CARTE_collecte;
$balise_FORMULAIRE_CARTE_collecte = array('callage','url_carte');

function balise_FORMULAIRE_CARTE_stat($args, $filtres) {

	// Pas d'id_carto_carte ? Erreur de squelette
	if (!$args[0])
		return erreur_squelette(
			_T('zbug_champ_hors_motif',
				array ('champ' =&gt; '#FORMULAIRE_CARTE',
					'motif' =&gt; 'CARTO_CARTES')), '');

	// Verifier que les visisteurs sont autorises a proposer des objets
	//return ((lire_meta(&quot;proposer_cartes&quot;) != 2) ? '' : $args);
	return ($args);
}

function balise_FORMULAIRE_CARTE_dyn($callage,$url_carte,$id_carto_carte) {
	
	if (_request('selection_type')) {
		$geometrie=coords2wkt(_request('selection_type'),_request('selection_coords'), worldfile2array($callage), $url_carte); // Si pas de fonction de zoom le callage correspond bien &#224; la valeur. Sinon avec zoom, il faut passer les coordonn&#233;es g&#233;ographiques de la vue en cours ....
		if (!_request('objet_titre')) $objet_titre = _L(&quot;Nouvel objet&quot;);
		if (!_request('url_objet')) $url_objet = &quot;#&quot;;
		//TODO : passer tout ca en spip_abstract ...
		spip_query(&quot;INSERT INTO spip_carto_objets (id_carto_carte,titre,geometrie,url_objet) VALUES (&quot;.$id_carto_carte.&quot;,'&quot;.addslashes($objet_titre).&quot;','&quot;.$geometrie.&quot;','&quot;.$url_objet.&quot;')&quot;);
		return  _T('form_prop_enregistre');
	}
	else{
		return array('formulaire_carte', 0,array('id_carto_carte'=&gt;$id_carto_carte));//,'callage'=&gt;$callage,'url_carte'=&gt;$url_carte,));
	}
}

?&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000348.html">[Spip-carto-cvs] contrib/ecrire inc_carto_fonctions.php3,NONE,1.1
</A></li>
	<LI>Next message: <A HREF="000350.html">[Spip-carto-cvs] contrib LISEZMOI.txt,1.1.1.1,1.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#349">[ date ]</a>
              <a href="thread.html#349">[ thread ]</a>
              <a href="subject.html#349">[ subject ]</a>
              <a href="author.html#349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/spip-carto-cvs">More information about the Spip-carto-cvs
mailing list</a><br>
</body></html>
