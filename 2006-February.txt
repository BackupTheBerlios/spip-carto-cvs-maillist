From stef at berlios.de  Fri Feb  3 01:23:45 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 3 Feb 2006 01:23:45 +0100
Subject: [Spip-carto-cvs] spipcarto/formulaires inc-formulaire_signature.php3,1.4,1.4.2.1 inc-login_public.php3,1.5,1.5.2.1 inc-formulaire_inscription.php3,1.6,1.6.2.1 inc-formulaire_forum.php3,1.6.2.1,1.6.2.2 inc-formulaire_site.php3,1.4,1.4.2.1
Message-ID: <200602030023.k130Njbx027882@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/formulaires
In directory sheep:/tmp/cvs-serv27680/formulaires

Modified Files:
      Tag: BRANCH-V1
	inc-formulaire_signature.php3 inc-login_public.php3 
	inc-formulaire_inscription.php3 inc-formulaire_forum.php3 
	inc-formulaire_site.php3 
Log Message:
Mise ? jour de securit? => Spip 1.8.2f

Index: inc-formulaire_signature.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_signature.php3,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- inc-formulaire_signature.php3	21 Jul 2005 21:47:12 -0000	1.4
+++ inc-formulaire_signature.php3	3 Feb 2006 00:23:39 -0000	1.4.2.1
@@ -81,6 +81,7 @@
 function reponse_confirmation($id_article, $var_confirm = '') {
 	static $confirm = '';
 
+	$id_article = intval($id_article);
 	if (!$var_confirm) return $confirm;
 	include_local(_FILE_CONNECT);
 	if ($GLOBALS['db_ok']) {

Index: inc-login_public.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-login_public.php3,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- inc-login_public.php3	21 Jul 2005 21:47:12 -0000	1.5
+++ inc-login_public.php3	3 Feb 2006 00:23:39 -0000	1.5.2.1
@@ -2,7 +2,7 @@
 
 if (!defined("_ECRIRE_INC_VERSION")) return;	#securite
 
-include(_FILE_CONNECT);
+include_local(_FILE_CONNECT);
 include_ecrire("inc_meta.php3");
 include_ecrire("inc_session.php3");
 include_ecrire("inc_filtres.php3");

Index: inc-formulaire_inscription.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_inscription.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- inc-formulaire_inscription.php3	19 Aug 2005 00:25:30 -0000	1.6
+++ inc-formulaire_inscription.php3	3 Feb 2006 00:23:39 -0000	1.6.2.1
@@ -157,7 +157,7 @@
 	$htpass = generer_htpass($pass);
 	spip_query("UPDATE spip_auteurs
 		SET pass='$mdpass', htpass='$htpass'
-		WHERE id_auteur = ".$id_auteur);
+		WHERE id_auteur = ".intval($id_auteur));
 	ecrire_acces();
 	
 	return $pass;

Index: inc-formulaire_forum.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_forum.php3,v
retrieving revision 1.6.2.1
retrieving revision 1.6.2.2
diff -u -d -r1.6.2.1 -r1.6.2.2
--- inc-formulaire_forum.php3	1 Nov 2005 21:51:55 -0000	1.6.2.1
+++ inc-formulaire_forum.php3	3 Feb 2006 00:23:39 -0000	1.6.2.2
@@ -40,6 +40,11 @@
 
 	// recuperer les donnees du forum auquel on repond, false = forum interdit
 	list ($idr, $idf, $ida, $idb, $ids) = $args;
+	$idr = intval($idr);
+	$idf = intval($idf);
+	$ida = intval($ida);
+	$idb = intval($idb);
+	$ids = intval($ids);
 	if (!$r = sql_recherche_donnees_forum ($idr, $idf, $ida, $idb, $ids))
 		return '';
 
@@ -291,9 +296,10 @@
 function table_des_mots($table, $les_mots) {
 	global $afficher_groupe;
 
-	if (!is_array($afficher_groupe)) return;
-
-	$in_group = " AND id_groupe IN (" . join($afficher_groupe, ", ") .")";
+	if (is_array($afficher_groupe))
+		$in_group = " AND id_groupe IN (" . join($afficher_groupe, ", ") .")";
+	else
+		$in_group = '';
 
 	$result_groupe = spip_query("SELECT * FROM spip_groupes_mots
 	WHERE forum = 'oui' AND $table = 'oui'". $in_group);

Index: inc-formulaire_site.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/formulaires/inc-formulaire_site.php3,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- inc-formulaire_site.php3	21 Jul 2005 21:47:12 -0000	1.4
+++ inc-formulaire_site.php3	3 Feb 2006 00:23:39 -0000	1.4.2.1
@@ -37,6 +37,7 @@
 		return _T('form_pet_url_invalide');
 
 	// Integrer a la base de donnees
+	$id_rubrique = intval($id_rubrique);
 	$nom_site = addslashes(_request('nom_site'));
 	$url_site = addslashes(_request('url_site'));
 	$description_site = addslashes(_request('description_site'));



From stef at berlios.de  Fri Feb  3 01:23:46 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 3 Feb 2006 01:23:46 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_version.php3,1.12.2.1,1.12.2.2
Message-ID: <200602030023.k130Nkbx027900@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv27680/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_version.php3 
Log Message:
Mise ? jour de securit? => Spip 1.8.2f

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.12.2.1
retrieving revision 1.12.2.2
diff -u -d -r1.12.2.1 -r1.12.2.2
--- inc_version.php3	1 Nov 2005 21:51:54 -0000	1.12.2.1
+++ inc_version.php3	3 Feb 2006 00:23:44 -0000	1.12.2.2
@@ -418,7 +418,7 @@
 $spip_version = 1.822;
 
 // version de spip
-$spip_version_affichee = "1.8.2 e";
+$spip_version_affichee = "1.8.2 f";
 
 
 // ** Securite **



From stef at berlios.de  Fri Feb  3 01:23:47 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 3 Feb 2006 01:23:47 +0100
Subject: [Spip-carto-cvs] spipcarto inc-messforum.php3,1.7,1.7.2.1
Message-ID: <200602030023.k130Nlbx027903@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv27680

Modified Files:
      Tag: BRANCH-V1
	inc-messforum.php3 
Log Message:
Mise ? jour de securit? => Spip 1.8.2f

Index: inc-messforum.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-messforum.php3,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -d -r1.7 -r1.7.2.1
--- inc-messforum.php3	30 Jun 2005 10:09:36 -0000	1.7
+++ inc-messforum.php3	3 Feb 2006 00:23:44 -0000	1.7.2.1
@@ -11,6 +11,8 @@
 \***************************************************************************/
 
 
+if (!defined("_ECRIRE_INC_VERSION")) return;
+
 include_ecrire('inc_meta.php3');
 include_ecrire('inc_forum.php3');
 include_ecrire('inc_filtres.php3');



From stef at berlios.de  Sun Feb  5 22:17:06 2006
From: stef at berlios.de (stef at berlios.de)
Date: Sun, 5 Feb 2006 22:17:06 +0100
Subject: [Spip-carto-cvs] spipcarto inc-balises.php3,1.12.2.1,1.12.2.2
Message-ID: <200602052117.k15LH6bx015925@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv15883

Modified Files:
      Tag: BRANCH-V1
	inc-balises.php3 
Log Message:
Mise ? jour de s?curit? => Spip 1.8.2g

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.12.2.1
retrieving revision 1.12.2.2
diff -u -d -r1.12.2.1 -r1.12.2.2
--- inc-balises.php3	1 Nov 2005 21:51:53 -0000	1.12.2.1
+++ inc-balises.php3	5 Feb 2006 21:17:04 -0000	1.12.2.2
@@ -60,11 +60,6 @@
 		'URL_SITE' => 'htmlspecialchars(vider_url(%s))',
 		'URL_SYNDIC' => 'htmlspecialchars(vider_url(%s))',
 		'ENV' => 'entites_html(%s)'
-		/////////////////////////////////////////////////////
-		//MODIFICATION SPIPCARTO
-		/////////////////////////////////////////////////////
-		,'URL_OBJET' => 'htmlspecialchars(url(vider_url(%s)))'
-		/////////////////////////////////////////////////////		
 	);
 	$ps = $traitements[$p->nom_champ];
 	if (!$ps) return $p->code;
@@ -484,6 +479,7 @@
 function balise_LANG_dist ($p) {
 	$_lang = champ_sql('lang', $p);
 	$p->code = "($_lang ? $_lang : \$GLOBALS['spip_lang'])";
+	$p->code = 'htmlentities'.$p->code;
 	$p->statut = 'php';
 	return $p;
 }



From stef at berlios.de  Sun Feb  5 22:17:31 2006
From: stef at berlios.de (stef at berlios.de)
Date: Sun, 5 Feb 2006 22:17:31 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_version.php3,1.12.2.2,1.12.2.3
Message-ID: <200602052117.k15LHVbx015960@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv15936/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_version.php3 
Log Message:
Mise ? jour de s?curit? => Spip 1.8.2g

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.12.2.2
retrieving revision 1.12.2.3
diff -u -d -r1.12.2.2 -r1.12.2.3
--- inc_version.php3	3 Feb 2006 00:23:44 -0000	1.12.2.2
+++ inc_version.php3	5 Feb 2006 21:17:29 -0000	1.12.2.3
@@ -418,7 +418,7 @@
 $spip_version = 1.822;
 
 // version de spip
-$spip_version_affichee = "1.8.2 f";
+$spip_version_affichee = "1.8.2 g";
 
 
 // ** Securite **



From stef at berlios.de  Tue Feb 14 02:06:25 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 14 Feb 2006 02:06:25 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.8,1.18.2.9
Message-ID: <200602140106.k1E16Mbx003428@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv3379/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 
Log Message:
retour mots_partout

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.8
retrieving revision 1.18.2.9
diff -u -d -r1.18.2.8 -r1.18.2.9
--- carte_edit.php3	14 Nov 2005 10:37:03 -0000	1.18.2.8
+++ carte_edit.php3	14 Feb 2006 01:06:18 -0000	1.18.2.9
@@ -238,7 +238,8 @@
 
 	debut_cadre_relief("mot-cle-24.gif");
 	if ($connect_statut == "0minirezo") {
-			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?nom_chose=carto_objets&limit=carto_cartes&id_limit=".$id_carte, "mot-cle-24.gif");
+			$mp_retour=new Link();
+			icone_horizontale(_T('motspartout:titre_page'),"mots_partout.php?nom_chose=carto_objets&limit=carto_cartes&id_limit=".$id_carte."&retour=".urlencode($mp_retour->getURL()), "mot-cle-24.gif");
 	}
 	fin_cadre_relief();
 }



From stef at berlios.de  Tue Feb 14 02:11:11 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 14 Feb 2006 02:11:11 +0100
Subject: [Spip-carto-cvs] spipcarto inc-balises.php3,1.12.2.2,1.12.2.3 inc-public-global.php3,1.7,1.7.2.1 spip_rss.php,1.2,1.2.2.1 spip_acces_doc.php3,1.3,1.3.2.1
Message-ID: <200602140111.k1E1BBbx005265@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv5072

Modified Files:
      Tag: BRANCH-V1
	inc-balises.php3 inc-public-global.php3 spip_rss.php 
	spip_acces_doc.php3 
Log Message:
Mise ? jour de securit? (Spip 1.8.2 SVN)
quelques bugs fix?s (Spip)
remplacement de document et affichage des id

Index: inc-balises.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-balises.php3,v
retrieving revision 1.12.2.2
retrieving revision 1.12.2.3
diff -u -d -r1.12.2.2 -r1.12.2.3
--- inc-balises.php3	5 Feb 2006 21:17:04 -0000	1.12.2.2
+++ inc-balises.php3	14 Feb 2006 01:11:09 -0000	1.12.2.3
@@ -60,6 +60,11 @@
 		'URL_SITE' => 'htmlspecialchars(vider_url(%s))',
 		'URL_SYNDIC' => 'htmlspecialchars(vider_url(%s))',
 		'ENV' => 'entites_html(%s)'
+		/////////////////////////////////////////////////////
+		//MODIFICATION SPIPCARTO
+		/////////////////////////////////////////////////////
+		,'URL_OBJET' => 'htmlspecialchars(url(vider_url(%s)))'
+		/////////////////////////////////////////////////////
 	);
 	$ps = $traitements[$p->nom_champ];
 	if (!$ps) return $p->code;
@@ -69,6 +74,23 @@
 			str_replace('typo(', 'typo_doublon($doublons,', $ps));
 	}
 
+	// Passer |safehtml sur les boucles "sensibles"
+	// sauf sur les champs dont on est surs
+	switch ($p->type_requete) {
+		case 'forums':
+		case 'signatures':
+		case 'syndic_articles':
+			$champs_surs = array(
+			'date', 'date_heure', 'statut', 'ip', 'url_article', 'maj', 'idx',
+			'parametres_forum');
+			if (!in_array(strtolower($p->nom_champ), $champs_surs)
+			AND !preg_match(',^ID_,', $p->nom_champ))
+				$ps = 'safehtml('.$ps.')';
+			break;
+		default:
+			break;
+	}
+
 	// on supprime les < IMGnnn > tant qu'on ne rapatrie pas
 	// les documents distants joints..
 	// il faudrait aussi corriger les raccourcis d'URL locales
@@ -293,7 +315,7 @@
 // Qu'afficher en cas d'erreur 404 ?
 function balise_ERREUR_AUCUN_dist($p) {
 	$p->code = '$Pile[0]["erreur_aucun"]';
-	$p->statut = 'php';
+	$p->statut = 'html';
 	return $p;
 }
 

Index: inc-public-global.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-public-global.php3,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -d -r1.7 -r1.7.2.1
--- inc-public-global.php3	30 Jun 2005 10:09:36 -0000	1.7
+++ inc-public-global.php3	14 Feb 2006 01:11:09 -0000	1.7.2.1
@@ -326,7 +326,14 @@
 		lang_select($lang);
 		$lang_select = true; // pour lang_dselect en sortie
 	}
-	
+
+	// Une fois le chemin-cache decide, on ajoute la date (et date_redac) 
+	// dans le contexte inclus, pour que les criteres {age} etc fonctionnent 
+	if (!isset($contexte_inclus['date'])) 
+		$contexte_inclus['date'] = date('Y-m-d H:i:s'); 
+	if (!isset($contexte_inclus['date_redac'])) 
+		$contexte_inclus['date_redac'] = $contexte_inclus['date']; 
+
 	$page = obtenir_page ($contexte_inclus, $chemin_cache, $delais_inclus,
 	$use_cache, $fond, true);
 

Index: spip_rss.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_rss.php,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- spip_rss.php	10 Aug 2005 12:00:39 -0000	1.2
+++ spip_rss.php	14 Feb 2006 01:11:09 -0000	1.2.2.1
@@ -35,8 +35,7 @@
 spip_timer('rss');
 if (!verifier_low_sec ($id, $cle,
 "rss $op $args"
-)
-OR ($a['id_auteur']>0 AND $id<>$a['id_auteur'])) {
+)) {
 	$op = 'erreur securite';
 	unset($a);
 } else {

Index: spip_acces_doc.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/spip_acces_doc.php3,v
retrieving revision 1.3
retrieving revision 1.3.2.1
diff -u -d -r1.3 -r1.3.2.1
--- spip_acces_doc.php3	20 Feb 2005 22:16:48 -0000	1.3
+++ spip_acces_doc.php3	14 Feb 2006 01:11:09 -0000	1.3.2.1
@@ -17,7 +17,7 @@
 # il verifie soit que le demandeur est authentifie
 # soit que le fichier est joint ? au moins 1 article, breve ou rubrique
 
-$id_document = ($_GET['id_document']);
+$id_document = intval($_GET['id_document']);
 $file = urldecode($_GET['file']);
 if (strpos($file,'../') !== false)
   $refus = 1;
@@ -41,7 +41,7 @@
       }
 
     if (!$id_document) {
-      $id_document = @spip_fetch_array(spip_query("select id_document from spip_documents as documents where documents.fichier='".$file."'"));
+      $id_document = @spip_fetch_array(spip_query("select id_document from spip_documents as documents where documents.fichier='".addslashes($file)."'"));
       if (!$id_document) $refus = 2;
       $id_document = $id_document['id_document'];
     } else {



From stef at berlios.de  Tue Feb 14 02:11:10 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 14 Feb 2006 02:11:10 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_charsets.php3,1.6,1.6.2.1 inc_majbase.php3,1.7,1.7.2.1 inc_presentation.php3,1.12.2.1,1.12.2.2 spip_style.php3,1.10,1.10.2.1 suivi_revisions.php3,1.4,1.4.2.1 inc_lang.php3,1.12.2.1,1.12.2.2 inc_suivi_revisions.php,1.5,1.5.2.1 documents_liste.php3,1.2,1.2.2.1 inc_texte.php3,1.12.2.2,1.12.2.3 naviguer.php3,1.6,1.6.2.1 inc_signatures.php3,1.1,1.1.2.1 inc_documents.php3,1.7.2.3,1.7.2.4 inc_db_mysql.php3,1.6,1.6.2.1 inc_serialbase.php3,1.5,1.5.2.1 inc_version.php3,1.12.2.3,1.12.2.4 inc_sites.php3,1.8,1.8.2.1 inc_filtres.php3,1.10.2.2,1.10.2.3 inc_extra.php3,1.2.2.1,1.2.2.2 inc_rss.php3,1.2,1.2.2.1
Message-ID: <200602140111.k1E1BAbx005229@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv5072/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_charsets.php3 inc_majbase.php3 inc_presentation.php3 
	spip_style.php3 suivi_revisions.php3 inc_lang.php3 
	inc_suivi_revisions.php documents_liste.php3 inc_texte.php3 
	naviguer.php3 inc_signatures.php3 inc_documents.php3 
	inc_db_mysql.php3 inc_serialbase.php3 inc_version.php3 
	inc_sites.php3 inc_filtres.php3 inc_extra.php3 inc_rss.php3 
Log Message:
Mise ? jour de securit? (Spip 1.8.2 SVN)
quelques bugs fix?s (Spip)
remplacement de document et affichage des id

Index: inc_charsets.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_charsets.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- inc_charsets.php3	10 Aug 2005 12:00:38 -0000	1.6
+++ inc_charsets.php3	14 Feb 2006 01:11:04 -0000	1.6.2.1
@@ -2138,6 +2138,8 @@
 	if ($charset == 'AUTO')
 		$charset = lire_meta('charset');
 
+	$charset = strtolower($charset);
+
 	switch ($charset) {
 	case 'utf-8':
 		return utf_8_to_unicode($texte);

Index: inc_majbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_majbase.php3,v
retrieving revision 1.7
retrieving revision 1.7.2.1
diff -u -d -r1.7 -r1.7.2.1
--- inc_majbase.php3	7 Sep 2005 15:01:53 -0000	1.7
+++ inc_majbase.php3	14 Feb 2006 01:11:05 -0000	1.7.2.1
@@ -971,14 +971,12 @@
 		maj_version(1.813);
 	}
 
-	// URLs propres auteurs (et prevoir les sites, sait-on jamais)
+	// URLs propres auteurs
 	if ($version_installee < 1.814) {
-		foreach (array('auteurs', 'syndic') as $objets) {
-			spip_query("ALTER TABLE spip_$objets
-				ADD url_propre VARCHAR(255) NOT NULL");
-			spip_query("ALTER TABLE spip_$objets
-				ADD INDEX url_propre (url_propre)");
-		}
+		spip_query("ALTER TABLE spip_auteurs
+			ADD url_propre VARCHAR(255) NOT NULL");
+		spip_query("ALTER TABLE spip_auteurs
+			ADD INDEX url_propre (url_propre)");
 		maj_version(1.814);
 	}
 
@@ -1044,6 +1042,20 @@
 		spip_query("ALTER TABLE spip_mots DROP INDEX type");
 		spip_query("ALTER TABLE spip_mots CHANGE type type TEXT NOT NULL");
 		maj_version(1.822);
+	}
+
+	// URLs propres des sites (sait-on jamais)
+	// + oubli des KEY url_propre sur les auteurs si installation neuve
+	if ($version_installee < 1.830) {
+		spip_query("ALTER TABLE spip_syndic
+			ADD url_propre VARCHAR(255) NOT NULL");
+		spip_query("ALTER TABLE spip_syndic
+			ADD INDEX url_propre (url_propre)");
+		spip_query("ALTER TABLE spip_auteurs
+			ADD url_propre VARCHAR(255) NOT NULL");
+		spip_query("ALTER TABLE spip_auteurs
+			ADD INDEX url_propre (url_propre)");
+		maj_version(1.830);
 	}
 
 	return true;

Index: inc_presentation.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_presentation.php3,v
retrieving revision 1.12.2.1
retrieving revision 1.12.2.2
diff -u -d -r1.12.2.1 -r1.12.2.2
--- inc_presentation.php3	28 Sep 2005 15:25:19 -0000	1.12.2.1
+++ inc_presentation.php3	14 Feb 2006 01:11:05 -0000	1.12.2.2
@@ -1337,6 +1337,7 @@
 	if ($spip_display == 4) echo "<ul>";
  
  	while($row = spip_fetch_array($request)) {
+		$row = safehtml_sur_row($row);
 		$id_forum=$row['id_forum'];
 		$id_parent=$row['id_parent'];
 		$id_rubrique=$row['id_rubrique'];

Index: spip_style.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/spip_style.php3,v
retrieving revision 1.10
retrieving revision 1.10.2.1
diff -u -d -r1.10 -r1.10.2.1
--- spip_style.php3	26 Sep 2005 09:24:26 -0000	1.10
+++ spip_style.php3	14 Feb 2006 01:11:05 -0000	1.10.2.1
@@ -46,11 +46,11 @@
 
 	function http_img_pack($f) { return _DIR_IMG_PACK . $f; }
 ?>
-/*////////////////////////////////////////*/
-/*/MODIFICATION SPIPCARTO*/
-/*////////////////////////////////////////*/
- at import "dhtml_tools.css";*/
-/*////////////////////////////////////////*/
+/* ************************************* */
+/* *******MODIFICATION SPIPCARTO******* */
+/* ************************************* */
+ at import "dhtml_tools.css"; 
+/* ************************************* */
 
 /*
  * Police par defaut (bof...)

Index: suivi_revisions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/suivi_revisions.php3,v
retrieving revision 1.4
retrieving revision 1.4.2.1
diff -u -d -r1.4 -r1.4.2.1
--- suivi_revisions.php3	30 Jun 2005 10:09:39 -0000	1.4
+++ suivi_revisions.php3	14 Feb 2006 01:11:06 -0000	1.4.2.1
@@ -63,7 +63,7 @@
 	$query_rub = "
 SELECT versions.*, articles.statut, articles.titre
 FROM spip_versions AS versions, spip_articles AS articles 
-WHERE versions.id_article = articles.id_article AND versions.id_version > 1 AND articles.id_secteur=$id_rubrique$req_where LIMIT 0,1";
+WHERE versions.id_article = articles.id_article AND versions.id_version > 1 AND articles.id_secteur=".intval($id_rubrique)."$req_where LIMIT 0,1";
 	$result_rub = spip_query($query_rub);
 	
 	if ($id_rubrique == $id_secteur)  echo "<li><b>$titre</b>";
@@ -80,7 +80,7 @@
 		$query_lang = "
 SELECT versions.*
 FROM spip_versions AS versions, spip_articles AS articles 
-WHERE versions.id_article = articles.id_article AND versions.id_version > 1 AND articles.lang='$lang' $req_where LIMIT 0,1";
+WHERE versions.id_article = articles.id_article AND versions.id_version > 1 AND articles.lang='".addslashes($lang)."' $req_where LIMIT 0,1";
 		$result_lang = spip_query($query_lang);
 		
 		if ($lang == $lang_choisie)  echo "<li><b>$titre</b>";

Index: inc_lang.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_lang.php3,v
retrieving revision 1.12.2.1
retrieving revision 1.12.2.2
diff -u -d -r1.12.2.1 -r1.12.2.2
--- inc_lang.php3	5 Nov 2005 22:34:35 -0000	1.12.2.1
+++ inc_lang.php3	14 Feb 2006 01:11:06 -0000	1.12.2.2
@@ -318,7 +318,7 @@
 	'su' => "Sundanese",
 	'sv' => "svenska",
 	'sw' => "Kiswahili",
-	'ta' => "&#2980;&#2990;&#3007;&#2996;&#3021; - tamil",
+	'ta' => "&#2980;&#2990;&#3007;&#2996;&#3021;", // Tamil
 	'te' => "Telugu",
 	'tg' => "Tajik",
 	'th' => "&#3652;&#3607;&#3618;",

Index: inc_suivi_revisions.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_suivi_revisions.php,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- inc_suivi_revisions.php	30 Jun 2005 10:09:39 -0000	1.5
+++ inc_suivi_revisions.php	14 Feb 2006 01:11:06 -0000	1.5.2.1
@@ -45,9 +45,11 @@
 		$req_where = " AND articles.statut IN ('prop','publie')";
 	}
 	
-	if (strlen($lang) > 0) $req_where .= " AND articles.lang='$lang'";
+	if (strlen($lang) > 0)
+		$req_where .= " AND articles.lang='".addslashes($lang)."'";
 
-	if ($id_secteur > 0) $req_where .= " AND articles.id_secteur = $id_secteur";
+	if ($id_secteur > 0)
+		$req_where .= " AND articles.id_secteur = ".intval($id_secteur);
 
 	$query = "
 		SELECT versions.*, articles.statut, articles.titre 

Index: documents_liste.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/documents_liste.php3,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- documents_liste.php3	20 Feb 2005 22:19:26 -0000	1.2
+++ documents_liste.php3	14 Feb 2006 01:11:06 -0000	1.2.2.1
@@ -58,7 +58,7 @@
 			if (!$titre) $titre = _T('info_document').' '.$id_document;
 			
 			debut_cadre_relief("doc-24.gif");
-			echo "<b>$titre</b> (" . $types[$row['type']]['titre'] . ', ' . affdate($date) . ")";
+			echo "$id_document - <b>$titre</b> (" . $types[$row['type']]['titre'] . ', ' . affdate($date) . ")";
 			if ($descriptif)
 				echo "<p>".propre($descriptif);
 			else

Index: inc_texte.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_texte.php3,v
retrieving revision 1.12.2.2
retrieving revision 1.12.2.3
diff -u -d -r1.12.2.2 -r1.12.2.3
--- inc_texte.php3	6 Nov 2005 09:34:10 -0000	1.12.2.2
+++ inc_texte.php3	14 Feb 2006 01:11:06 -0000	1.12.2.3
@@ -391,6 +391,53 @@
 	return $source;
 }
 
+// Securite : utiliser SafeHTML s'il est present dans ecrire/safehtml/
+function safehtml($t) {
+	static $process, $test;
+
+	# attention safehtml nettoie deux ou trois caracteres de plus. A voir
+	if (strpos($t,'<')===false)
+		return str_replace("\x00", '', $t);
+
+	if (!$test) {
+		define('XML_HTMLSAX3', _DIR_INCLUDE."safehtml/classes/");
+		if (@file_exists(XML_HTMLSAX3.'safehtml.php')) {
+			include_local(XML_HTMLSAX3.'safehtml.php');
+			$process = new safehtml();
+		}
+		if ($process)
+			$test = 1; # ok
+		else
+			$test = -1; # se rabattre sur interdire_scripts
+	}
+
+	if ($test > 0) {
+		# reset ($process->clear() ne vide que _xhtml...),
+		# on doit pouvoir programmer ca plus propremement
+		$process->_counter = array();
+		$process->_stack = array();
+		$process->_dcCounter = array();
+		$process->_dcStack = array();
+		$process->_listScope = 0;
+		$process->_liStack = array();
+#		$process->parse(''); # cas particulier ?
+		$process->clear();
+		$t = $process->parse($t);
+	}
+
+	return interdire_scripts($t); # gere le < ?php > en plus
+}
+
+// Passer safehtml sur les rows de l'espace priv?
+function safehtml_sur_row($row) {
+	$champs_surs = array(
+	'date', 'date_heure', 'statut', 'ip', 'url_article', 'maj', 'idx',
+	'parametres_forum');
+	foreach($row as $champ => $valeur)
+		if (!in_array(strtolower($champ), $champs_surs)	AND !preg_match(',^id_,', $champ))
+			$row[$champ] = safehtml($valeur);
+	return $row;
+}
 
 // Correction typographique francaise
 function typo_fr($letexte) {

Index: naviguer.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/naviguer.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- naviguer.php3	7 Sep 2005 15:01:53 -0000	1.6
+++ naviguer.php3	14 Feb 2006 01:11:06 -0000	1.6.2.1
@@ -45,12 +45,19 @@
 	}
 
 	// si c'est une rubrique-secteur contenant des breves, ne deplacer
-	// que si $confirme_deplace == 'oui'
-
-	if ((spip_num_rows(spip_query("SELECT id_rubrique FROM spip_breves WHERE id_rubrique='$id_rubrique' LIMIT 0,1")) > 0)
-	AND ($confirme_deplace != 'oui')) {
+	// que si $confirme_deplace == 'oui', et changer l'id_rubrique des
+	// breves en question
+	if ($GLOBALS['confirme_deplace'] == 'oui'
+	AND $id_parent > 0) {
+		list($id_secteur) = spip_fetch_array(spip_query(
+			"SELECT id_secteur FROM spip_rubriques
+			WHERE id_rubrique=$id_parent"));
+		if ($id_secteur)
+			spip_query("UPDATE spip_breves
+				SET id_rubrique=$id_secteur
+				WHERE id_rubrique=$id_rubrique");
+	} else
 		$id_parent = 0;
-	}
 
 	if ($flag_editable) {
 

Index: inc_signatures.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_signatures.php3,v
retrieving revision 1.1
retrieving revision 1.1.2.1
diff -u -d -r1.1 -r1.1.2.1
--- inc_signatures.php3	21 Jul 2005 21:47:16 -0000	1.1
+++ inc_signatures.php3	14 Feb 2006 01:11:06 -0000	1.1.2.1
@@ -28,6 +28,7 @@
 			      " LIMIT " . ($debut ? "$debut," : "") . $limit);
 
  	while($row=spip_fetch_array($request)){
+		$row = safehtml_sur_row($row);
 		$id_signature = $row['id_signature'];
 		$id_article = $row['id_article'];
 		$date_time = $row['date_time'];

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.7.2.3
retrieving revision 1.7.2.4
diff -u -d -r1.7.2.3 -r1.7.2.4
--- inc_documents.php3	1 Nov 2005 21:51:54 -0000	1.7.2.3
+++ inc_documents.php3	14 Feb 2006 01:11:06 -0000	1.7.2.4
@@ -664,6 +664,7 @@
 				else
 					$triangle = bouton_block_invisible("port$id_document");
 			}
+			$triangle.=$id_document." - ";
 			if (strlen($titre) > 0) {
 				echo "<div class='verdana2'><b>$triangle".typo($titre)."</b></div>";
 			} else {

Index: inc_db_mysql.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_db_mysql.php3,v
retrieving revision 1.6
retrieving revision 1.6.2.1
diff -u -d -r1.6 -r1.6.2.1
--- inc_db_mysql.php3	7 Sep 2005 15:01:53 -0000	1.6
+++ inc_db_mysql.php3	14 Feb 2006 01:11:07 -0000	1.6.2.1
@@ -237,8 +237,7 @@
 // IN (...) est limite a 255 elements, d'ou cette fonction assistante
 //
 function calcul_mysql_in($val, $valeurs, $not='') {
-	if (!$valeurs) return '0=0';
-
+	if (!$valeurs) return ($not ? "0=0" : '0=1');
 	$n = $i = 0;
 	$in_sql ="";
 	while ($n = strpos($valeurs, ',', $n+1)) {

Index: inc_serialbase.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_serialbase.php3,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -d -r1.5 -r1.5.2.1
--- inc_serialbase.php3	7 Sep 2005 15:01:53 -0000	1.5
+++ inc_serialbase.php3	14 Feb 2006 01:11:07 -0000	1.5.2.1
@@ -93,7 +93,8 @@
 		"KEY statut"	=> "statut",
 		"KEY lang"	=> "lang",
 		"KEY idx"	=> "idx",
-		"KEY en_ligne"	=> "en_ligne");
+		"KEY en_ligne"	=> "en_ligne",
+		"KEY url_propre"	=> "url_propre");
 
 $spip_breves = array(
 		"id_breve"	=> "bigint(21) NOT NULL",
@@ -242,6 +243,7 @@
 		"nom_site"	=> "blob NOT NULL",
 		"url_site"	=> "blob NOT NULL",
 		"url_syndic"	=> "blob NOT NULL",
+		"url_propre"	=> "VARCHAR(255) NOT NULL",
 		"descriptif"	=> "blob NOT NULL",
 		"idx"		=> "ENUM('', '1', 'non', 'oui', 'idx') DEFAULT '' NOT NULL",
 		"maj"	=> "TIMESTAMP",
@@ -261,7 +263,8 @@
 		"KEY id_rubrique"	=> "id_rubrique",
 		"KEY id_secteur"	=> "id_secteur",
 		"KEY idx"		=> "idx",
-		"KEY statut"	=> "statut, date_syndic");
+		"KEY statut"	=> "statut, date_syndic",
+		"KEY url_propre"	=> "url_propre");
 
 $spip_syndic_articles = array(
 		"id_syndic_article"	=> "bigint(21) NOT NULL",

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.12.2.3
retrieving revision 1.12.2.4
diff -u -d -r1.12.2.3 -r1.12.2.4
--- inc_version.php3	5 Feb 2006 21:17:29 -0000	1.12.2.3
+++ inc_version.php3	14 Feb 2006 01:11:07 -0000	1.12.2.4
@@ -64,6 +64,9 @@
 }
 
 
+// Masquer les warning
+error_reporting(E_ALL ^ E_NOTICE);
+
 // *********** traiter les variables ************
 
 // Recuperer les superglobales $_GET si non definies
@@ -79,35 +82,47 @@
 		$GLOBALS[$http_table_vars] = & $GLOBALS[$_table];
 }
 
+//
+// Securite
+//
 
-// Magic quotes : on n'en veut pas sur la base,
-// et on nettoie les GET/POST/COOKIE le cas echeant
-function magic_unquote($_table) {
-
-	// Certains hebergeurs n'activent pas $GLOBALS['GLOBALS']
-	if ($_table == 'GLOBALS'
-	AND !isset($GLOBALS['GLOBALS']))
-		$GLOBALS['GLOBALS'] = &$GLOBALS;
+// Ne pas se faire manger par un bug php qui laisse passer ?GLOBALS[truc]=toto
+if (isset($_REQUEST['GLOBALS'])) die();
+// Annuler les magic quotes \' sur GET POST COOKIE et GLOBALS ;
+// supprimer aussi les eventuels caracteres nuls %00, qui peuvent tromper
+// la commande file_exists('chemin/vers/fichier/interdit%00truc_normal')
+function spip_desinfecte(&$t) {
+	static $magic_quotes;
+	if (!isset($magic_quotes))
+		$magic_quotes = @get_magic_quotes_gpc();
 
-	if (is_array($GLOBALS[$_table])) {
-		foreach ($GLOBALS[$_table] as $key => $val) {
-			if (is_string($val))
-				$GLOBALS[$_table][$key] = stripslashes($val);
+	if (is_array($t)) {
+		foreach ($t as $key => $val) {
+			if (!is_array($val)
+			OR !isset($t['spip_recursions'])) { # interdire les recursions
+				$t['spip_recursions'] = true;
+				spip_desinfecte($t[$key]);
+			}
 		}
+	} else {
+		$t = str_replace(chr(0), '', $t);
+		if ($magic_quotes)
+			$t = stripslashes($t);
 	}
 }
-
- at set_magic_quotes_runtime(0);
-if (@get_magic_quotes_gpc()) {
-	magic_unquote('_GET');
-	magic_unquote('_POST');
-	magic_unquote('_COOKIE');
-
+spip_desinfecte($_GET);
+spip_desinfecte($_POST);
+spip_desinfecte($_COOKIE);
 #	if (@ini_get('register_globals')) // pas fiable
-		magic_unquote('GLOBALS');
-}
-
-
+spip_desinfecte($GLOBALS);
+# a la fin supprimer la variable anti-recursion devenue inutile
+# (et meme nuisible, notamment si on teste $_POST)
+unset($_GET['spip_recursions']);
+unset($_POST['spip_recursions']);
+unset($_COOKIE['spip_recursions']);
+unset($GLOBALS['spip_recursions']);
+// Par ailleurs on ne veut pas de magic_quotes au cours de l'execution
+ at set_magic_quotes_runtime(0);
 
 // Dirty hack contre le register_globals a 'Off' (PHP 4.1.x)
 // A remplacer (un jour!) par une gestion propre des variables admissibles ;-)
@@ -316,9 +331,6 @@
 // Produire du TeX ou du MathML ?
 $traiter_math = 'tex';
 
-// Masquer les warning
-error_reporting(E_ALL ^ E_NOTICE);
-
 // Variables du compilateur de squelettes
 
 $exceptions_des_tables = array();
@@ -415,7 +427,7 @@
 // (utilise pour les modifs de la base de donnees)
 
 // version de la base
-$spip_version = 1.822;
+$spip_version = 1.830;
 
 // version de spip
 $spip_version_affichee = "1.8.2 g";
@@ -525,7 +537,7 @@
 	}
 	$f = @fopen($logfile, "ab");
 	if ($f) {
-		fputs($f, $message);
+		fputs($f, htmlspecialchars($message));
 		fclose($f);
 	}
 	if ($rotate) {

Index: inc_sites.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_sites.php3,v
retrieving revision 1.8
retrieving revision 1.8.2.1
diff -u -d -r1.8 -r1.8.2.1
--- inc_sites.php3	7 Sep 2005 15:01:53 -0000	1.8
+++ inc_sites.php3	14 Feb 2006 01:11:07 -0000	1.8.2.1
@@ -325,7 +325,7 @@
 		// Cherchons quand meme un backend
 		include_ecrire('feedfinder.php');
 		$feeds = get_feed_from_url($url, $texte);
-		if (count($feeds>1)) {
+		if (count($feeds)>1) {
 			spip_log("feedfinder.php :\n".join("\n", $feeds));
 			$result['url_syndic'] = "select: ".join(' ',$feeds);
 		} else
@@ -902,6 +902,7 @@
 
 		$table = '';
 		while ($row = spip_fetch_array($result)) {
+			$row = safehtml_sur_row($row);
 			$vals = '';
 
 			$id_syndic_article=$row["id_syndic_article"];

Index: inc_filtres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_filtres.php3,v
retrieving revision 1.10.2.2
retrieving revision 1.10.2.3
diff -u -d -r1.10.2.2 -r1.10.2.3
--- inc_filtres.php3	5 Nov 2005 22:34:35 -0000	1.10.2.2
+++ inc_filtres.php3	14 Feb 2006 01:11:07 -0000	1.10.2.3
@@ -1394,7 +1394,7 @@
 		$dimensions = getimagesize($image);
 		$largeur = $dimensions[0];
 		$hauteur = $dimensions[1];
-		return inserer_attribut("<img src='$image' style='border: 0px; width: ".$largeur."px; height: ".$hauteur.px."' class='image_typo'>", 'alt', $alt);
+		return inserer_attribut("<img src='$image' style='border: 0px; width: ".$largeur."px; height: ".$hauteur.px."' class='image_typo' />", 'alt', $alt);
 	} else {
 		return $texte;
 	}

Index: inc_extra.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_extra.php3,v
retrieving revision 1.2.2.1
retrieving revision 1.2.2.2
diff -u -d -r1.2.2.1 -r1.2.2.2
--- inc_extra.php3	1 Nov 2005 21:51:54 -0000	1.2.2.1
+++ inc_extra.php3	14 Feb 2006 01:11:07 -0000	1.2.2.2
@@ -89,13 +89,12 @@
 define("_ECRIRE_INC_EXTRA", "1");
 
 // a partir de la liste des champs, generer la liste des input
-function extra_saisie($extra, $type, $ensemble='') {
+function extra_form($extra, $type, $ensemble='') {
 	$extra = unserialize($extra);
 
 	// quels sont les extras de ce type d'objet
 	if (!$champs = $GLOBALS['champs_extra'][$type])
 		$champs = Array();
-
 	// prendre en compte, eventuellement, les champs presents dans la base
 	// mais oublies dans mes_options.
 	if (is_array($extra))
@@ -233,7 +232,11 @@
 
 		$affiche .= "<p>\n";
 	}
+	return $affiche;
 
+}
+function extra_saisie($extra, $type, $ensemble='') {
+	$affiche=extra_form($extra, $type, $ensemble);
 	if ($affiche) {
 		debut_cadre_enfonce();
 		echo $affiche;

Index: inc_rss.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_rss.php3,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -d -r1.2 -r1.2.2.1
--- inc_rss.php3	10 Aug 2005 12:00:38 -0000	1.2
+++ inc_rss.php3	14 Feb 2006 01:11:07 -0000	1.2.2.1
@@ -193,6 +193,7 @@
 
 // Suivi des forums
 function rss_suivi_forums($a, $query_forum='', $lien_moderation=false) {
+	$rss = array();
 	include_ecrire("inc_forum.php3");
 
 	$result_forum = spip_query("
@@ -302,6 +303,7 @@
 }
 
 function rss_articles($critere) {
+	$rss = array();
 	$s = spip_query("SELECT * FROM spip_articles WHERE $critere
 	ORDER BY date DESC LIMIT 0,10");
 	while ($t = spip_fetch_array($s)) {
@@ -330,6 +332,7 @@
 
 
 function rss_breves($critere) {
+	$rss = array();
 	$s = spip_query("SELECT * FROM spip_breves WHERE $critere
 	ORDER BY date_heure DESC LIMIT 0,10");
 	while ($t = spip_fetch_array($s)) {
@@ -350,6 +353,7 @@
 
 
 function rss_sites($critere) {
+	$rss = array();
 	$s = spip_query("SELECT * FROM spip_syndic WHERE $critere
 	ORDER BY date DESC LIMIT 0,10");
 	while ($t = spip_fetch_array($s)) {



From stef at berlios.de  Tue Feb 14 02:34:57 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 14 Feb 2006 02:34:57 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire carto_mots_possibles.php3,NONE,1.1.2.1 mots_possibles.php3,NONE,1.1.2.1 carto_mes_options.php3,NONE,1.1.2.1 mes_options.php3,1.8.2.5,1.8.2.6 mots_partout.php,1.6.2.4,1.6.2.5
Message-ID: <200602140134.k1E1Yrbx010491@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv10424/ecrire

Modified Files:
      Tag: BRANCH-V1
	mes_options.php3 mots_partout.php 
Added Files:
      Tag: BRANCH-V1
	carto_mots_possibles.php3 mots_possibles.php3 
	carto_mes_options.php3 
Log Message:
integration un peu plus propre ...

--- NEW FILE: carto_mots_possibles.php3 ---
<?php
$choses_possibles['carto_objets'] = array(
									  'titre_chose' => 'Objets',
									  'id_chose' => 'id_carto_objet',
									  'table_principale' => 'spip_carto_objets',
									  
									  'table_carte' => 'spip_carto_cartes',
									  'tables_limite' => array(
															   'carto_objets' => array(
																				   'table' => 'spip_carto_objets',
																				   'nom_id' => 'id_carto_objet'),
															   'carto_cartes' => array(
																					'table' => 'spip_carto_objets',
																					'nom_id' =>  'id_carto_carte'),
															   )
									  );
////////////////////////////////////////////////////////////////////////
function afficher_liste_carto_objets($choses) {
  echo "<div style='height: 12px;'></div>";
  echo "<div class='liste'>";
  bandeau_titre_boite2($titre_table, "carte-24.gif");
  
  echo afficher_liste_debut_tableau();
  
  $from = array('spip_carto_objets as carto_objets');
  $select= array();
  $select[] = 'id_carto_objet';
  $select[] = 'titre';
  $select[] = 'url_objet';
  $select[] ='id_carto_carte';
//  $select[] = 'statut';
  $where = array('carto_objets.id_carto_objet IN ('.calcul_in($choses).')');
  
  $result = spip_abstract_select($select,$from,$where);
  $i = 0;
  while ($row = spip_abstract_fetch($result)) {
	$i++;
	$vals = '';
	
	$id_carto_objet = $row['id_carto_objet'];
	$tous_id[] = $id_carto_objet;
	$titre = $row['titre'];
	$id_carto_carte = $row['id_carto_carte'];
	$url_objet = $row['url_objet'];
	
	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_carto_objet' id='id_chose$i'/>";
	
	// Le titre (et la langue)
	$s = "<div>";
	
	$s .= "<a href=\"carte_edit.php3?id_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
	
	$s .= typo($titre);
	$s .= "</a>";
	$s .= "</div>";
	
	$vals[] = $s;
	
	// L'url
	$s = "<a href=\"$url_objet\" style=\"display:block;\">lien</a>";
	$vals[] = $s;
	
	// Le numero (moche)
	if ($options == "avancees") {
	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_carto_objet</b>";
	}
	
	
	$table[] = $vals;
  }
  spip_free_result($result);
  
  if ($options == "avancees") { // Afficher le numero (JMB)
	if ($afficher_auteurs) {
	  $largeurs = array(11, '', 80, 100, 35);
	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
	} else {
	  $largeurs = array(11, '', 100, 35);
	  $styles = array('', 'arial2', 'arial1', 'arial1');
	}
  } else {
	if ($afficher_auteurs) {
	  $largeurs = array(11, '', 100, 100);
	  $styles = array('', 'arial2', 'arial1', 'arial1');
	} else {
	  $largeurs = array(11, '', 100);
	  $styles = array('', 'arial2', 'arial1');
	}
  }
  afficher_liste($largeurs, $table, $styles);
  
  echo afficher_liste_fin_tableau();
}
?>
--- NEW FILE: mots_possibles.php3 ---
(This appears to be a binary file; contents omitted.)

--- NEW FILE: carto_mes_options.php3 ---
(This appears to be a binary file; contents omitted.)

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8.2.5
retrieving revision 1.8.2.6
diff -u -d -r1.8.2.5 -r1.8.2.6
--- mes_options.php3	24 Nov 2005 00:02:17 -0000	1.8.2.5
+++ mes_options.php3	14 Feb 2006 01:34:46 -0000	1.8.2.6
@@ -1,166 +1,7 @@
 <?php
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-//          MODULE CARTO
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-// PARAMETRAGE
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-
-//////////////////////////////////////////////////
-// CARTO_CARTES
-//////////////////////////////////////////////////
-$spip_carto_cartes = array(
-	"id_carto_carte" => "bigint(21) NOT NULL",
-	"titre" => "varchar(255) NOT NULL",
-	"texte" => "text NOT NULL",
-	"url_carte" => "text NOT NULL",
-	"callage" => "text NOT NULL",
-	"id_srs" => "bigint(21) NOT NULL");
-
-$spip_carto_cartes_key = array(
-	"PRIMARY KEY" => "id_carto_carte",
-	"KEY id_carto_carte" => "id_carto_carte");
-
-
-//////////////////////////////////////////////////
-// CARTO_OBJETS
-//////////////////////////////////////////////////
-
-$spip_carto_objets = array(
-	"id_carto_objet" => "bigint(21) NOT NULL",
-	"id_carto_carte" => "bigint(21) NOT NULL",
-	"titre" => "varchar(255) NOT NULL",
-	"texte" => "text NOT NULL",
-	"url_objet" => "text NOT NULL",
-	"url_logo" => "text NOT NULL",
-	"geometrie" => "text NOT NULL");
-	
-$spip_carto_objets_key = array(
-	"PRIMARY KEY" => "id_carto_objet",
-	"KEY id_carto_carte" => "id_carto_carte",
-	"KEY titre" => "titre");
-
-
-//////////////////////////////////////////////////
-// CARTO_CARTES_ARTICLES
-//////////////////////////////////////////////////
-
-$spip_carto_cartes_articles = array(
-	"id_carto_carte" 	=> "BIGINT (21) DEFAULT '0' NOT NULL",
-	"id_article" 	=> "BIGINT (21) DEFAULT '0' NOT NULL");
-
-$spip_carto_cartes_articles_key = array(
-	"KEY id_carto_carte" 	=> "id_carto_carte",
-	"KEY id_article" => "id_article");
-
-
-//////////////////////////////////////////////////
-// MOTS_CARTO_OBJETS
-//////////////////////////////////////////////////
-
-$spip_mots_carto_objets= array(
-	"id_carto_objet" 	=> "BIGINT (21) DEFAULT '0' NOT NULL",
-	"id_mot" 	=> "BIGINT (21) DEFAULT '0' NOT NULL");
-
-$spip_mots_carto_objets_key = array(
-	"KEY id_carto_objet" 	=> "id_carto_objet",
-	"KEY id_mot" => "id_mot");
-
-//////////////////////////////////////////////////
-// DOCUMENTS_CARTO_OBJETS
-//////////////////////////////////////////////////
-
-$spip_documents_carto_cartes= array(
-	"id_carto_carte" 	=> "BIGINT (21) DEFAULT '0' NOT NULL",
-	"id_document" 	=> "BIGINT (21) DEFAULT '0' NOT NULL");
-
-$spip_documents_carto_cartes_key = array(
-	"KEY id_carto_carte" 	=> "id_carto_carte",
-	"KEY id_document" => "id_document");
-
-
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-// DECLARATION
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-
-//global $tables_principales,$table_primary,$tables_auxiliaires,$tables_relations;
-
-
-$tables_principales['spip_carto_cartes'] =
-	array('field' => &$spip_carto_cartes, 'key' => &$spip_carto_cartes_key);
-
-$tables_principales['spip_carto_objets'] =
-	array('field' => &$spip_carto_objets, 'key' => &$spip_carto_objets_key);
-
-//Relation avec les articles
-//La, ca se discute ...
-/*$tables_principales['spip_carto_cartes_articles'] = array(
-	'field' => &$spip_carto_cartes_articles,
-	'key' => &$spip_carto_cartes_articles_key);
-*/
-$tables_auxiliaires['spip_carto_cartes_articles'] = array(
-	'field' => &$spip_carto_cartes_articles,
-	'key' => &$spip_carto_cartes_articles_key);
-
-//Ca devrait etre une table secondaire
-//mais comme on n'utilise que l'id_mot dans la boucle
-//on gagne une jointure dans la requete
-//$tables_principales['spip_mots_carto_objets'] = array(
-//	'field' => &$spip_mots_carto_objets,
-//	'key' => &$spip_mots_carto_objets_key);
-$tables_auxiliaires['spip_mots_carto_objets'] = array(
-	'field' => &$spip_mots_carto_objets,
-	'key' => &$spip_mots_carto_objets_key);
-	
-
-$table_primary['carto_objets']="id_carto_objet";
-$table_primary['carto_cartes']="id_carto_carte";
-
-$table_des_tables['carto_objets']="carto_objets";
-$table_des_tables['carto_cartes']="carto_cartes";
-
-$tables_relations['documents']['id_carto_carte']='documents_carto_cartes';
-$tables_relations['mots']['id_carto_objet']='mots_carto_objets';
-$tables_relations['carto_objets']['id_mot']='mots_carto_objets';
-$tables_relations['carto_cartes']['id_document']='documents_carto_cartes';
-$tables_relations['carto_cartes']['id_article']='carto_cartes_articles';
-
-function boucle_CARTO_CARTES($id_boucle, &$boucles) {
-	$boucle = &$boucles[$id_boucle];
-	$boucle->from[] =  "spip_carto_cartes AS " . $boucle->type_requete;
-	return calculer_boucle($id_boucle, $boucles); 
-}
-
-function boucle_CARTO_OBJETS($id_boucle, &$boucles) {
-	$boucle = &$boucles[$id_boucle];
-	$boucle->from[] =  "spip_carto_objets AS " . $boucle->type_requete;
-	return calculer_boucle($id_boucle, $boucles); 
-}
-
-//fonctions de transformation
-include_ecrire("inc_carto_fonctions.php3");
-
-//appel du plugin en dernier (peut g?n?rer du javascript)
-function apres_tout($texte) {
-	include_ecrire('plugins/plug_carto.php');
-    return apres_tout_carto($texte);
-}
-
-//squelettes de carte disponibles 
-//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
-$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
-			
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
-//          FIN MODULE CARTO
-//////////////////////////////////////////////////
-//////////////////////////////////////////////////
+$GLOBALS['dossier_squelettes']="/squelettes";
 
+include("carto_mes_options.php3");
+include("carto_mots_possibles.php3");
+include("mots_possibles.php3");
 ?>

Index: mots_partout.php
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mots_partout.php,v
retrieving revision 1.6.2.4
retrieving revision 1.6.2.5
diff -u -d -r1.6.2.4 -r1.6.2.5
--- mots_partout.php	12 Oct 2005 21:22:54 -0000	1.6.2.4
+++ mots_partout.php	14 Feb 2006 01:34:46 -0000	1.6.2.5
@@ -30,206 +30,13 @@
 } else if(@file_exists('inc_version.php3')){
   include('inc_version.php3');
 }
-include_ecrire ("inc_documents"._EXTENSION_PHP);
-include_ecrire ("inc_abstract_sql"._EXTENSION_PHP);
-include_ecrire ("inc_objet"._EXTENSION_PHP);
+include_ecrire("inc_documents"._EXTENSION_PHP);
+include_ecrire("inc_abstract_sql"._EXTENSION_PHP);
+include_ecrire("inc_objet"._EXTENSION_PHP);
+//include_ecrire("mots_possibles"._EXTENSION_PHP);
 //include_ecrire('_libs_/tag-machine/inc_tag-machine.php');
 
 /***********************************************************************
-* D?finition des choses sur lesquels on peut vouloir mettre des mots clefs
-***********************************************************************/
-
-$choses_possibles['articles'] = array(
-									  'titre_chose' => 'public:articles',
-										  'id_chose' => 'id_article',
-									  'table_principale' => 'spip_articles',
-									  'table_auth' => 'spip_auteurs_articles',
-									  'tables_limite' => array(
-															   'articles' => array(
-																				   'table' => 'spip_articles',
-																				   'nom_id' => 'id_article'),
-															   'rubriques' => array(
-																					'table' => 'spip_articles',
-																					'nom_id' =>  'id_rubrique'),
-															   'documents' => array(
-																					'table' => 'spip_documents_articles',
-																					'nom_id' =>  'id_document'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-
-$choses_possibles['rubriques'] = array(
-									  'titre_chose' => 'public:rubriques',
-										  'id_chose' => 'id_rubrique',
-									  'table_principale' => 'spip_rubriques',
-									  'table_auth' => 'spip_auteurs_rubriques',
-									  'tables_limite' => array(
-															   'rubriques' => array(
-																					'table' => 'spip_rubriques',
-																					'nom_id' =>  'id_rubrique'),
-																'secteurs' => array(
-																					 'table' => 'spip_rubriques',
-																					 'nom_id' =>  'id_secteur'),
-																'parents' => array(
-																					 'table' => 'spip_rubriques',
-																					 'nom_id' =>  'id_parent'),
-															   'documents' => array(
-																					'table' => 'spip_documents_rubriques',
-																					'nom_id' =>  'id_document'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-$choses_possibles['documents'] = array(
-									   'titre_chose' => 'info_documents',
-												  'id_chose' => 'id_document',
-									   'table_principale' => 'spip_documents',
-									   'tables_limite' => array(
-																'articles' => array(
-																					'table' => 'spip_documents_articles',
-																					'nom_id' => 'id_article'),
-																'rubriques' => array(
-																					 'table' => 'spip_documents_rubriques',
-																					 'nom_id' =>  'id_rubrique'),
-																'documents' => array(
-																					 'table' => 'spip_documents',
-																					 'nom_id' =>  'id_document')
-																)
-									   );
-
-$choses_possibles['auteurs'] = array(
-									  'titre_chose' => 'auteurs',
-									  'id_chose' => 'id_auteur',
-									  'table_principale' => 'spip_auteurs',
-									  'tables_limite' => array(
-															   'auteurs' => array(
-																				   'table' => 'spip_auteurs',
-																				   'nom_id' => 'id_auteur'),
-															   'articles' => array(
-																				  'table' => 'spip_auteurs_articles',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-$choses_possibles['messages'] = array(
-									  'titre_chose' => 'Messages',
-									  'id_chose' => 'id_message',
-									  'table_principale' => 'spip_messages',
-									  
-									  'table_auth' => 'spip_auteurs_messages',
-									  'tables_limite' => array(
-															   'messages' => array(
-																				   'table' => 'spip_messages',
-																				   'nom_id' => 'id_message'),
-															   'auteurs' => array(
-																				  'table' => 'spip_auteurs_messages',
-																				  'nom_id' => 'id_auteur')
-															   )
-									  );
-
-////////////////////////////////////////////////////////////////////////
-//MODIFICATION (spip-carto)
-////////////////////////////////////////////////////////////////////////
-$choses_possibles['carto_objets'] = array(
-									  'titre_chose' => 'Objets',
-									  'id_chose' => 'id_carto_objet',
-									  'table_principale' => 'spip_carto_objets',
-									  
-									  'table_carte' => 'spip_carto_cartes',
-									  'tables_limite' => array(
-															   'carto_objets' => array(
-																				   'table' => 'spip_carto_objets',
-																				   'nom_id' => 'id_carto_objet'),
-															   'carto_cartes' => array(
-																					'table' => 'spip_carto_objets',
-																					'nom_id' =>  'id_carto_carte'),
-															   )
-									  );
-function afficher_liste_carto_objets($choses) {
-  echo "<div style='height: 12px;'></div>";
-  echo "<div class='liste'>";
-  bandeau_titre_boite2($titre_table, "carte-24.gif");
-  
-  echo afficher_liste_debut_tableau();
-  
-  $from = array('spip_carto_objets as carto_objets');
-  $select= array();
-  $select[] = 'id_carto_objet';
-  $select[] = 'titre';
-  $select[] = 'url_objet';
-  $select[] ='id_carto_carte';
-//  $select[] = 'statut';
-  $where = array('carto_objets.id_carto_objet IN ('.calcul_in($choses).')');
-  
-  $result = spip_abstract_select($select,$from,$where);
-  $i = 0;
-  while ($row = spip_abstract_fetch($result)) {
-	$i++;
-	$vals = '';
-	
-	$id_carto_objet = $row['id_carto_objet'];
-	$tous_id[] = $id_carto_objet;
-	$titre = $row['titre'];
-	$id_carto_carte = $row['id_carto_carte'];
-	$url_objet = $row['url_objet'];
-	
-	$vals[] = "<input type='checkbox' name='id_choses[]' value='$id_carto_objet' id='id_chose$i'/>";
-	
-	// Le titre (et la langue)
-	$s = "<div>";
-	
-	$s .= "<a href=\"carte_edit.php3?id_carte=$id_carto_carte#objet$id_carto_objet\" style=\"display:block;\">";
-	
-	$s .= typo($titre);
-	$s .= "</a>";
-	$s .= "</div>";
-	
-	$vals[] = $s;
-	
-	// L'url
-	$s = "<a href=\"$url_objet\" style=\"display:block;\">lien</a>";
-	$vals[] = $s;
-	
-	// Le numero (moche)
-	if ($options == "avancees") {
-	  $vals[] = "<b>"._T('info_numero_abbreviation')."$id_carto_objet</b>";
-	}
-	
-	
-	$table[] = $vals;
-  }
-  spip_free_result($result);
-  
-  if ($options == "avancees") { // Afficher le numero (JMB)
-	if ($afficher_auteurs) {
-	  $largeurs = array(11, '', 80, 100, 35);
-	  $styles = array('', 'arial2', 'arial1', 'arial1', 'arial1');
-	} else {
-	  $largeurs = array(11, '', 100, 35);
-	  $styles = array('', 'arial2', 'arial1', 'arial1');
-	}
-  } else {
-	if ($afficher_auteurs) {
-	  $largeurs = array(11, '', 100, 100);
-	  $styles = array('', 'arial2', 'arial1', 'arial1');
-	} else {
-	  $largeurs = array(11, '', 100);
-	  $styles = array('', 'arial2', 'arial1');
-	}
-  }
-  afficher_liste($largeurs, $table, $styles);
-  
-  echo afficher_liste_fin_tableau();
-}
-////////////////////////////////////////////////////////////////////////
-//MODIFICATION (spip-carto)
-////////////////////////////////////////////////////////////////////////
-/***********************************************************************
 * PREFIXE
 ***********************************************************************/
 $table_pref = 'spip';
@@ -439,7 +246,7 @@
 	  
 	  // bloc titre et descriptif
 	  if (strlen($titre) > 0) {
-		echo '<div class=\'verdana2\' style=\'text-align:center;\'><b>'.typo($titre).'</b></div>';
+		echo '<div class=\'verdana2\' style=\'text-align:center;\'><b>'.$id_document.' - '.typo($titre).'</b></div>';
 	  } else {
 		$nom_fichier = basename($fichier);
 		
@@ -742,7 +549,7 @@
 	// Le titre (et la langue)
 	$s = "<div>";
 	
-	$s .= "<a href=\"bloogletter"._EXTENSION_PHP."?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
+	$s .= "<a href=\"spip_listes.php3?mode=courrier&id_message=$id_message\" style=\"display:block;\">";
 	
 	$s .= typo($titre);
 	$s .= "</a>";
@@ -879,7 +686,6 @@
 /***********************************************************************
  * r?cuperation de la chose sur laquelle on travaille
  ***********************************************************************/
-
 $nom_chose = $_REQUEST['nom_chose'];
 if(!isset($choses_possibles[$nom_chose])) {
   list($nom_chose,) = each($choses_possibles);
@@ -1081,19 +887,21 @@
  ***********************************************************************/
 
 debut_page('&laquo; '._T('motspartout:titre_page').' &raquo;', 'documents', 'mots');
-?>
-</script>
-<?php
+echo "</script>";
 
-echo '<br><br><center>';
+if ($_REQUEST['retour']) icone(_T('icone_retour'), $_REQUEST['retour'], "rubrique-24.gif", "rien.gif");
+else echo '<br/><br/>';
+echo '<center>';
 gros_titre(_T('motspartout:titre_page'));
 echo '</center>';
 
 //Colonne de gauche
 debut_gauche();
 
+
 echo '<form method="post" action="mots_partout.php">';
 
+echo '<input type="hidden" name="retour" value="'.$_REQUEST['retour'].'"/>';
 
 // choix de la chose sur laquelle on veut ajouter des mots
 debut_cadre_enfonce('',false,'',_T('motspartout:choses'));
@@ -1133,6 +941,8 @@
 <input type='hidden' name='limit' value='$limit'>
 <input type='hidden' name='id_limit' value='$id_limit'>
 ";
+
+echo '<input type="hidden" name="retour" value="'.$_REQUEST['retour'].'"/>';
 
 if(count($choses)) {
 debut_cadre_enfonce('',false,'',_T('motspartout:voir'));



From stef at berlios.de  Fri Feb 17 00:06:00 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:00 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml - New directory
Message-ID: <200602162306.k1GN60bx012610@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml
In directory sheep:/tmp/cvs-serv12576/ecrire/safehtml

Log Message:
Directory /cvsroot/spip-carto/spipcarto/ecrire/safehtml added to the repository
--> Using per-directory sticky tag `BRANCH-V1'




From stef at berlios.de  Fri Feb 17 00:06:01 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:01 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml/classes - New directory
Message-ID: <200602162306.k1GN61bx012613@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes
In directory sheep:/tmp/cvs-serv12576/ecrire/safehtml/classes

Log Message:
Directory /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes added to the repository




From stef at berlios.de  Fri Feb 17 00:06:01 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:01 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml/classes/HTMLSax3 - New directory
Message-ID: <200602162306.k1GN61bx012616@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes/HTMLSax3
In directory sheep:/tmp/cvs-serv12576/ecrire/safehtml/classes/HTMLSax3

Log Message:
Directory /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes/HTMLSax3 added to the repository




From stef at berlios.de  Fri Feb 17 00:06:13 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:13 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml license.txt,NONE,1.1.2.1 readme-SPIP.txt,NONE,1.1.2.1 readme.txt,NONE,1.1.2.1
Message-ID: <200602162306.k1GN6Dbx012717@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml
In directory sheep:/tmp/cvs-serv12672/ecrire/safehtml

Added Files:
      Tag: BRANCH-V1
	license.txt readme-SPIP.txt readme.txt 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

--- NEW FILE: license.txt ---
(c) Roman Ivanov, 2004-2005
(c) Pixel-Apes ( http://pixel-apes.com/ ), 2004-2005
(c) JetStyle   ( http://jetstyle.ru/    ), 2004-2005
Maintainer -- Roman Ivanov <thingol at mail.ru>

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:
1. Redistributions of source code must retain the above copyright
   notice, this list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright
   notice, this list of conditions and the following disclaimer in the
   documentation and/or other materials provided with the distribution.
3. The name of the author may not be used to endorse or promote products
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT
NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

--- NEW FILE: readme-SPIP.txt ---

SafeHTML pour SPIP

--------
Version 1.3.5.
http://pixel-apes.com/safehtml/
--------

Ce repertoire est extrait de SafeHTML 1.3.5 ; les fichiers suivants ont ete supprimes :

safehtml/safehtml.php
safehtml/tests/*



--- NEW FILE: readme.txt ---
SafeHTML
--------
Version 1.3.5.
http://pixel-apes.com/safehtml/
--------

This parser strips down all potentially dangerous content within HTML:
  * opening tag without its closing tag
  * closing tag without its opening tag
  * any of these tags: "base", "basefont", "head", "html", "body", "applet", "object", 
    "iframe", "frame", "frameset", "script", "layer", "ilayer", "embed", "bgsound", 
    "link", "meta", "style", "title", "blink", "xml" etc.
  * any of these attributes: on*, data*, dynsrc
  * javascript:/vbscript:/about: etc. protocols
  * expression/behavior etc. in styles
  * any other active content
It also tries to convert code to XHTML valid, but htmltidy is far better solution for this task.

If you found any bugs in this parser, please inform me -- ICQ:551593 or mailto:thingol at mail.ru

Please, subscribe to http://pixel-apes.com/safehtml/feed/rss feed in order to receive notices 
when SAFEHTML will be updated.

-- Roman Ivanov.
-- Pixel-Apes ( http://pixel-apes.com ).
-- JetStyle ( http://jetstyle.ru/ ).



--------
Version history:
--------
1.3.5.
 * Two serious security flaws fixed: UTF-7 XSS and CSS comments handling.
1.3.2.
 * Security flaw (improper quotes handling in attributes' values) fixed. Big thanks to Nick Cleaton.
1.3.1.
 * Dumb bug fixed (some closing tags were ignored).
1.3.0.
 * Two holes (with decimal HTML entities and with \x00 symbol) fixed.
 * Class rewritten under PEAR coding standarts.
 * Class now uses unmodified HTMLSax3 from PEAR.
 * To the list of table tags added: "caption", "col", "colgroup".
1.2.1.
 * It was possible to create XSS with hexadecimal HTML entities. Fixed. Big thanks to Christian Stocker.
1.2.0.
 * "id" and "name" attributes added to dangerous attributes list, because malefactor can broke legal javascript by spoofing ID or NAME of some element.
 * New method parse() allows to do all parsing process in two lines of code. Examples also updated.
 * New array, closeParagraph, contains list of block-level elements. When we open such elemet, we should close paragraph before. . It allows SafeHTML to produce more XHTML compliant code.
 * Added "webcal" to white list of protocols for those who uses calendar programs (Mozilla/iCal/etc).
 * Now SafeHTML strips down table elements when we are not inside table.
 * Now SafeHTML correctly closes unclosed "li" tags: before opening "li" of the same nesting level.
1.1.0.
 * New "dangerous" protocols: hcp, ms-help, help, disk, vnd.ms.radio, opera, res, resource, chrome, mocha, livescript.
 * <XML> tag was moved from "tags for deletion" to "tags for deletion with content".
 * New "dangerous" CSS instruction "include-source" (NN4 specific).
 * New array, Attributes, contains list of attributes for removal. If you need to remove "id" or "name" attribute, 
 just add it to this array.
 * Now it is possible to choose between white-list and black-list filtering of protocols. Defaults are "white-list".
 This list is: "http", "https", "ftp", "telnet", "news", "nntp", "gopher", "mailto", "file".
 * For speed purposes, we now filter protocols only from these attributes: src, href, action, lowsrc, dynsrc, 
 background, codebase.
 * Opera6 XSS bug ([\xC0][\xBC]script>alert(1)[\xC0][\xBC]/script> [UTF-8] workarounded.
1.0.4.
 New "dangerous" tag: plaintext.
1.0.3.
 Added array of elements that can have no closing tag.
1.0.2.
 Bug fix: <img src="&#106;&#97;&#118;&#97;&#115;&#99;&#114;&#105;&#112;&#116;&#58;alert(1);"> attack.
 Thanks to shmel.
1.0.1.
 Bug fix: safehtml hangs on <style></style></style> code.
 Thanks to lj user=electrocat.
1.0.0.
 First public release



From stef at berlios.de  Fri Feb 17 00:06:13 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:13 +0100
Subject: [Spip-carto-cvs] spipcarto Thumbs.db,1.1.2.1,1.1.2.2 mes_fonctions.php3,1.13.2.1,1.13.2.2 inc-criteres.php3,1.9,1.9.2.1 page.php3,1.3.2.1,1.3.2.2
Message-ID: <200602162306.k1GN6Dbx012720@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv12672

Modified Files:
      Tag: BRANCH-V1
	mes_fonctions.php3 inc-criteres.php3 page.php3 
Added Files:
      Tag: BRANCH-V1
	Thumbs.db 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)


Index: mes_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/mes_fonctions.php3,v
retrieving revision 1.13.2.1
retrieving revision 1.13.2.2
diff -u -d -r1.13.2.1 -r1.13.2.2
--- mes_fonctions.php3	27 Sep 2005 20:53:22 -0000	1.13.2.1
+++ mes_fonctions.php3	16 Feb 2006 23:06:11 -0000	1.13.2.2
@@ -32,4 +32,47 @@
 //			FIN MODULE SPIPCARTO
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
+function geometrie_script($geometrie, $id_objet, $callage, $url_carte){	
+				// Objet g?om?trique pour l'affichage DHTML
+				$mygeom = wkt2coords($geometrie, "JSDHTML", $callage, $url_carte); 
+				$geoArray= explode(',',$mygeom);
+		  		$returned="geoArray_".$id_objet."=new Array();\n";
+		  		for ($i=0; $i<count($geoArray) ; $i=$i+2) {
+					$returned.="var geoPoint_".$id_objet."_".($i/2)."=new Array(".$geoArray[$i].",".$geoArray[$i+1].");\n";
+					$returned.="geoArray_".$id_objet."[".($i/2)."]=geoPoint_".$id_objet."_".($i/2).";\n";
+		  		}
+		  		$geoTypex= explode('(',$geometrie);
+		  		$geoType= $geoTypex[0];
+
+		  		switch ($geoType){
+		  			case 'circle':
+		  			case 'CIRCLE':
+		  						$geoType='circle';
+		  						break;
+		  			case 'rect':
+		  			case 'RECT':
+		  			case 'rectangle':
+		  			case 'RECTANGLE':
+		  						$geoType='rect';
+		  						break;
+		  			case 'line':
+		  			case 'LINE':
+		  						$geoType='line';
+		  						break;
+		  			case 'point':
+		  			case 'POINT':
+		  						$geoType='point';
+		  						break;
+					case 'poly':
+		  			case 'POLY':
+		  			case 'polygon':
+		  			case 'POLYGON':
+		  			default:
+		  						$geoType='poly';
+		  						break;
+		  		}
+				
+				$returned.=$geoType."s[".$geoType."count++]=geoArray_".$id_objet.";";
+				return $returned;
+}
 ?>

Index: inc-criteres.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/inc-criteres.php3,v
retrieving revision 1.9
retrieving revision 1.9.2.1
diff -u -d -r1.9 -r1.9.2.1
--- inc-criteres.php3	7 Sep 2005 15:01:53 -0000	1.9
+++ inc-criteres.php3	16 Feb 2006 23:06:11 -0000	1.9.2.1
@@ -519,11 +519,11 @@
 
 	// Cas particulier : selection des documents selon l'extension
 	if ($type == 'documents' AND $col == 'extension')
-	  $col_table = 'types_documents';
+		$col_table = 'types_documents';
 	// HACK : selection des documents selon mode 'image'
-	// (a creer en dur dans la base)
-	else if ($type == 'documents' AND $col == 'mode' AND $val[0] == "'image'")
-	  $val[0] = "'vignette'";
+	// => on cherche en fait 'vignette'
+	else if ($type == 'documents' AND $col == 'mode')
+		$val[0] = str_replace('image', 'vignette', $val[0]);
 	// Cas particulier : lier les articles syndiques
 	// au site correspondant
 	else if ($type == 'syndic_articles' AND

Index: page.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/page.php3,v
retrieving revision 1.3.2.1
retrieving revision 1.3.2.2
diff -u -d -r1.3.2.1 -r1.3.2.2
--- page.php3	1 Nov 2005 21:51:53 -0000	1.3.2.1
+++ page.php3	16 Feb 2006 23:06:11 -0000	1.3.2.2
@@ -19,7 +19,8 @@
 	$delais = $contexte_inclus['delais'];
 
 // Securite 
-if (strstr($fond, '/')) {
+if (strstr($fond, '/')
+OR preg_match(',^formulaire_,i', $fond)) {
 	die ("Faut pas se gener");
 }
 if (!find_in_path("$fond.html")) {



From stef at berlios.de  Fri Feb 17 00:06:14 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:14 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_carto_fonctions.php3,1.1.2.6,1.1.2.7 mes_options.php3,1.8.2.6,1.8.2.7
Message-ID: <200602162306.k1GN6Ebx012735@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv12672/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_carto_fonctions.php3 mes_options.php3 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

Index: inc_carto_fonctions.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto_fonctions.php3,v
retrieving revision 1.1.2.6
retrieving revision 1.1.2.7
diff -u -d -r1.1.2.6 -r1.1.2.7
--- inc_carto_fonctions.php3	30 Sep 2005 22:08:44 -0000	1.1.2.6
+++ inc_carto_fonctions.php3	16 Feb 2006 23:06:12 -0000	1.1.2.7
@@ -327,4 +327,42 @@
 				return " x=\"".$coordTab[0]."\" y=\"".$coordTab[1]."\" width=\"".$rgeo."\" height=\"".$rgeo."\" xlink:href=\"#use".$mot_desc."\"";
 			}
 }
+///////////////////////////////////////////////
+// GOOGLE
+///////////////////////////////////////////////
+function wkt2coords_google($wktGeomType,$wktGeom,$ImgHeight,$ImgWidth,$GeoHeight,$GeoWidth,$rgeo,$callage){	
+// Conservation des Y selon le format WKT car en coordonn?es g?ographique
+			$coordpair = explode (',',$wktGeom);
+			
+			for ($i=0; $i<sizeof($coordpair); $i++)
+			{		
+				$coord[$i] 		= explode(' ',$coordpair[$i]);
+				$coord[$i][0] 	= $coord[$i][0];
+				$coord[$i][1] 	= $coord[$i][1]*-1;
+ 				$wktGoogle[$i]="GPoint(".intval($coord[$i][0]*$rgeo).",".intval($coord[$i][1]*$rgeo).")";
+			}
+			$wktGoogle = implode(',', $wktGoogle);
+
+			if (strcasecmp($wktGeomType,"POLYGON")==0)
+			{  	
+				return "GPolyline=([".$wktGoogle."])";		
+			}
+			elseif (strcasecmp($wktGeomType,"LINE")==0)
+			{  	
+				return "GPolyline=([".$wktGoogle."])";		
+			}
+			elseif (strcasecmp($wktGeomType,"POINT")==0)
+			{	
+				$coordTab = explode (" ", $wktGeom);
+				return "GPoint(".intval($coordTab[0]*$rgeo).",".intval($coordTab[1]*$rgeo).")";
+			}
+}
+function worldfile2google($callage){	
+	$tabcallage=worldfile2array($callage);
+	$x=intval($tabcallage['top_left']['x']-($tabcallage['bottom_right']['x']-$tabcallage['top_left']['x'])/2);
+	$y=intval($tabcallage['top_left']['y']-($tabcallage['bottom_right']['y']-$tabcallage['top_left']['y'])/2);
+	return "GPoint(".$x.",".$y.")";
+}
+
+
 ?>

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8.2.6
retrieving revision 1.8.2.7
diff -u -d -r1.8.2.6 -r1.8.2.7
--- mes_options.php3	14 Feb 2006 01:34:46 -0000	1.8.2.6
+++ mes_options.php3	16 Feb 2006 23:06:12 -0000	1.8.2.7
@@ -1,7 +1,7 @@
 <?php
 $GLOBALS['dossier_squelettes']="/squelettes";
 
-include("carto_mes_options.php3");
-include("carto_mots_possibles.php3");
-include("mots_possibles.php3");
+include_ecrire("carto_mes_options.php3");
+include_ecrire("carto_mots_possibles.php3");
+include_ecrire("mots_possibles.php3");
 ?>



From stef at berlios.de  Fri Feb 17 00:06:15 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:15 +0100
Subject: [Spip-carto-cvs] spipcarto/squelettes/template carto_demo.html,NONE,1.1.2.1
Message-ID: <200602162306.k1GN6Fbx012740@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/squelettes/template
In directory sheep:/tmp/cvs-serv12672/squelettes/template

Added Files:
      Tag: BRANCH-V1
	carto_demo.html 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

--- NEW FILE: carto_demo.html ---
<BOUCLE_carte(CARTO_CARTES){id_carto_carte}>
 <img 
 	alt="#TITRE" 
 	src="#URL_SITE_SPIP/spip_carto.php?fond_carte=[(#URL_CARTE)]" 
 	[height="(#ENV{args}|wkt2imgheight{#CALLAGE,#URL_CARTE})px"] 
 	[width="(#ENV{args}|wkt2imgwidth{#CALLAGE,#URL_CARTE})px"] 
 	usemap="#map#ID_CARTO_CARTE" 
 	border="0"/>
 <B_objets>
 <map name="map#ID_CARTO_CARTE">
 <BOUCLE_objets(CARTO_OBJETS){id_carto_carte=#ID_CARTO_CARTE}>
  <area 
	shape="[(#GEOMETRIE|wkt2shape)]" 
	coords="[(#GEOMETRIE|wkt2coords{HTML,#CALLAGE,#URL_CARTE,'',#ENV{args}})]" 
	href="[(#URL_OBJET)]" 
	alt="#TEXTE"/>
 </BOUCLE_objets>
 </map>
 </B_objets>
</BOUCLE_carte>




From stef at berlios.de  Fri Feb 17 00:06:15 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:15 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml/classes/HTMLSax3 States.php,NONE,1.1.2.1 Decorators.php,NONE,1.1.2.1
Message-ID: <200602162306.k1GN6Fbx012743@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes/HTMLSax3
In directory sheep:/tmp/cvs-serv12672/ecrire/safehtml/classes/HTMLSax3

Added Files:
      Tag: BRANCH-V1
	States.php Decorators.php 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

--- NEW FILE: States.php ---
<?php
/* vim: set expandtab tabstop=4 shiftwidth=4: */
//
// +----------------------------------------------------------------------+
// | PHP Version 4                                                        |
// +----------------------------------------------------------------------+
// | Copyright (c) 1997-2002 The PHP Group                                |
// +----------------------------------------------------------------------+
// | This source file is subject to version 2.02 of the PHP license,      |
// | that is bundled with this package in the file LICENSE, and is        |
// | available at through the world-wide-web at                           |
// | http://www.php.net/license/3_0.txt.                                  |
// | If you did not receive a copy of the PHP license and are unable to   |
// | obtain it through the world-wide-web, please send a note to          |
// | license at php.net so we can mail you a copy immediately.               |
// +----------------------------------------------------------------------+
// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
// +----------------------------------------------------------------------+
//
// $Id: States.php,v 1.1.2.1 2006/02/16 23:06:13 stef Exp $
//
/**
* Parsing states.
* @package XML_HTMLSax3
* @version $Id: States.php,v 1.1.2.1 2006/02/16 23:06:13 stef Exp $
*/
/**
* Define parser states
*/
define('XML_HTMLSAX3_STATE_STOP', 0);
define('XML_HTMLSAX3_STATE_START', 1);
define('XML_HTMLSAX3_STATE_TAG', 2);
define('XML_HTMLSAX3_STATE_OPENING_TAG', 3);
define('XML_HTMLSAX3_STATE_CLOSING_TAG', 4);
define('XML_HTMLSAX3_STATE_ESCAPE', 6);
define('XML_HTMLSAX3_STATE_JASP', 7);
define('XML_HTMLSAX3_STATE_PI', 8);
/**
* StartingState searches for the start of any XML tag
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_StartingState  {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_TAG
    * @access protected
    */
    function parse(&$context) {
        $data = $context->scanUntilString('<');
        if ($data != '') {
            $context->handler_object_data->
                {$context->handler_method_data}($context->htmlsax, $data);
        }
        $context->IgnoreCharacter();
        return XML_HTMLSAX3_STATE_TAG;
    }
}
/**
* Decides which state to move one from after StartingState
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_TagState {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant the next state to move into
    * @access protected
    */
    function parse(&$context) {
        switch($context->ScanCharacter()) {
        case '/':
            return XML_HTMLSAX3_STATE_CLOSING_TAG;
            break;
        case '?':
            return XML_HTMLSAX3_STATE_PI;
            break;
        case '%':
            return XML_HTMLSAX3_STATE_JASP;
            break;
        case '!':
            return XML_HTMLSAX3_STATE_ESCAPE;
            break;
        default:
            $context->unscanCharacter();
            return XML_HTMLSAX3_STATE_OPENING_TAG;
        }
    }
}
/**
* Dealing with closing XML tags
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_ClosingTagState {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_START
    * @access protected
    */
    function parse(&$context) {
        $tag = $context->scanUntilCharacters('/>');
        if ($tag != '') {
            $char = $context->scanCharacter();
            if ($char == '/') {
                $char = $context->scanCharacter();
                if ($char != '>') {
                    $context->unscanCharacter();
                }
            }
            $context->handler_object_element->
                {$context->handler_method_closing}($context->htmlsax, $tag, FALSE);
        }
        return XML_HTMLSAX3_STATE_START;
    }
}
/**
* Dealing with opening XML tags
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_OpeningTagState {
    /**
    * Handles attributes
    * @param string attribute name
    * @param string attribute value
    * @return void
    * @access protected
    * @see XML_HTMLSax3_AttributeStartState
    */
    function parseAttributes(&$context) {
        $Attributes = array();
    
        $context->ignoreWhitespace();
        $attributename = $context->scanUntilCharacters("=/> \n\r\t");
        while ($attributename != '') {
            $attributevalue = NULL;
            $context->ignoreWhitespace();
            $char = $context->scanCharacter();
            if ($char == '=') {
                $context->ignoreWhitespace();
                $char = $context->ScanCharacter();
                if ($char == '"') {
                    $attributevalue= $context->scanUntilString('"');
                    $context->IgnoreCharacter();
                } else if ($char == "'") {
                    $attributevalue = $context->scanUntilString("'");
                    $context->IgnoreCharacter();
                } else {
                    $context->unscanCharacter();
                    $attributevalue =
                        $context->scanUntilCharacters("> \n\r\t");
                }
            } else if ($char !== NULL) {
                $attributevalue = NULL;
                $context->unscanCharacter();
            }
            $Attributes[$attributename] = $attributevalue;
            
            $context->ignoreWhitespace();
            $attributename = $context->scanUntilCharacters("=/> \n\r\t");
        }
        return $Attributes;
    }

    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_START
    * @access protected
    */
    function parse(&$context) {
        $tag = $context->scanUntilCharacters("/> \n\r\t");
        if ($tag != '') {
            $this->attrs = array();
            $Attributes = $this->parseAttributes($context);
            $char = $context->scanCharacter();
            if ($char == '/') {
                $char = $context->scanCharacter();
                if ($char != '>') {
                    $context->unscanCharacter();
                }
                $context->handler_object_element->
                    {$context->handler_method_opening}($context->htmlsax, $tag, 
                    $Attributes, TRUE);
                $context->handler_object_element->
                    {$context->handler_method_closing}($context->htmlsax, $tag, 
                    TRUE);
            } else {
                $context->handler_object_element->
                    {$context->handler_method_opening}($context->htmlsax, $tag, 
                    $Attributes, FALSE);
            }
        }
        return XML_HTMLSAX3_STATE_START;
    }
}

/**
* Deals with XML escapes handling comments and CDATA correctly
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_EscapeState {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_START
    * @access protected
    */
    function parse(&$context) {
        $char = $context->ScanCharacter();
        if ($char == '-') {
            $char = $context->ScanCharacter();
            if ($char == '-') {
                $context->unscanCharacter();
                $context->unscanCharacter();
                $text = $context->scanUntilString('-->');
                $text .= $context->scanCharacter();
                $text .= $context->scanCharacter();
            } else {
                $context->unscanCharacter();
                $text = $context->scanUntilString('>');
            }
        } else if ( $char == '[') {
            $context->unscanCharacter();
            $text = $context->scanUntilString(']>');
            $text.= $context->scanCharacter();
        } else {
            $context->unscanCharacter();
            $text = $context->scanUntilString('>');
        }

        $context->IgnoreCharacter();
        if ($text != '') {
            $context->handler_object_escape->
            {$context->handler_method_escape}($context->htmlsax, $text);
        }
        return XML_HTMLSAX3_STATE_START;
    }
}
/**
* Deals with JASP/ASP markup
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_JaspState {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_START
    * @access protected
    */
    function parse(&$context) {
        $text = $context->scanUntilString('%>');
        if ($text != '') {
            $context->handler_object_jasp->
                {$context->handler_method_jasp}($context->htmlsax, $text);
        }
        $context->IgnoreCharacter();
        $context->IgnoreCharacter();
        return XML_HTMLSAX3_STATE_START;
    }
}
/**
* Deals with XML processing instructions
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_PiState {
    /**
    * @param XML_HTMLSax3_StateParser subclass
    * @return constant XML_HTMLSAX3_STATE_START
    * @access protected
    */
    function parse(&$context) {
        $target = $context->scanUntilCharacters(" \n\r\t");
        $data = $context->scanUntilString('?>');
        if ($data != '') {
            $context->handler_object_pi->
            {$context->handler_method_pi}($context->htmlsax, $target, $data);
        }
        $context->IgnoreCharacter();
        $context->IgnoreCharacter();
        return XML_HTMLSAX3_STATE_START;
    }
}
?>
--- NEW FILE: Decorators.php ---
<?php
/* vim: set expandtab tabstop=4 shiftwidth=4: */
//
// +----------------------------------------------------------------------+
// | PHP Version 4                                                        |
// +----------------------------------------------------------------------+
// | Copyright (c) 1997-2002 The PHP Group                                |
// +----------------------------------------------------------------------+
// | This source file is subject to version 2.02 of the PHP license,      |
// | that is bundled with this package in the file LICENSE, and is        |
// | available at through the world-wide-web at                           |
// | http://www.php.net/license/3_0.txt.                                  |
// | If you did not receive a copy of the PHP license and are unable to   |
// | obtain it through the world-wide-web, please send a note to          |
// | license at php.net so we can mail you a copy immediately.               |
// +----------------------------------------------------------------------+
// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
// +----------------------------------------------------------------------+
//
// $Id: Decorators.php,v 1.1.2.1 2006/02/16 23:06:13 stef Exp $
//
/**
* Decorators for dealing with parser options
* @package XML_HTMLSax3
* @version $Id: Decorators.php,v 1.1.2.1 2006/02/16 23:06:13 stef Exp $
* @see XML_HTMLSax3::set_option
*/
/**
* Trims the contents of element data from whitespace at start and end
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Trim {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_Trim
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_Trim(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Trims the data
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function trimData(&$parser, $data) {
        $data = trim($data);
        if ($data != '') {
            $this->orig_obj->{$this->orig_method}($parser, $data);
        }
    }
}
/**
* Coverts tag names to upper case
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_CaseFolding {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original open handler method
    * @var string
    * @access private
    */
    var $orig_open_method;
    /**
    * Original close handler method
    * @var string
    * @access private
    */
    var $orig_close_method;
    /**
    * Constructs XML_HTMLSax3_CaseFolding
    * @param object handler object being decorated
    * @param string original open handler method
    * @param string original close handler method
    * @access protected
    */
    function XML_HTMLSax3_CaseFolding(&$orig_obj, $orig_open_method, $orig_close_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_open_method = $orig_open_method;
        $this->orig_close_method = $orig_close_method;
    }
    /**
    * Folds up open tag callbacks
    * @param XML_HTMLSax3
    * @param string tag name
    * @param array tag attributes
    * @access protected
    */
    function foldOpen(&$parser, $tag, $attrs=array(), $empty = FALSE) {
        $this->orig_obj->{$this->orig_open_method}($parser, strtoupper($tag), $attrs, $empty);
    }
    /**
    * Folds up close tag callbacks
    * @param XML_HTMLSax3
    * @param string tag name
    * @access protected
    */
    function foldClose(&$parser, $tag, $empty = FALSE) {
        $this->orig_obj->{$this->orig_close_method}($parser, strtoupper($tag), $empty);
    }
}
/**
* Breaks up data by linefeed characters, resulting in additional
* calls to the data handler
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Linefeed {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_LineFeed
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_LineFeed(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Breaks the data up by linefeeds
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function breakData(&$parser, $data) {
        $data = explode("\n",$data);
        foreach ( $data as $chunk ) {
            $this->orig_obj->{$this->orig_method}($parser, $chunk);
        }
    }
}
/**
* Breaks up data by tab characters, resulting in additional
* calls to the data handler
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Tab {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_Tab
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_Tab(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Breaks the data up by linefeeds
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function breakData(&$parser, $data) {
        $data = explode("\t",$data);
        foreach ( $data as $chunk ) {
            $this->orig_obj->{$this->orig_method}($this, $chunk);
        }
    }
}
/**
* Breaks up data by XML entities and parses them with html_entity_decode(),
* resulting in additional calls to the data handler<br />
* Requires PHP 4.3.0+
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Entities_Parsed {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_Entities_Parsed
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_Entities_Parsed(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Breaks the data up by XML entities
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function breakData(&$parser, $data) {
        $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
        foreach ( $data as $chunk ) {
            $chunk = html_entity_decode($chunk,ENT_NOQUOTES);
            $this->orig_obj->{$this->orig_method}($this, $chunk);
        }
    }
}
/**
* Compatibility with older PHP versions
*/
if (version_compare(phpversion(), '4.3', '<') && !function_exists('html_entity_decode') ) {
    function html_entity_decode($str, $style=ENT_NOQUOTES) {
        return strtr($str,
            array_flip(get_html_translation_table(HTML_ENTITIES,$style)));
    }
}
/**
* Breaks up data by XML entities but leaves them unparsed,
* resulting in additional calls to the data handler<br />
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Entities_Unparsed {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_Entities_Unparsed
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_Entities_Unparsed(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Breaks the data up by XML entities
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function breakData(&$parser, $data) {
        $data = preg_split('/(&.+?;)/',$data,-1,PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);
        foreach ( $data as $chunk ) {
            $this->orig_obj->{$this->orig_method}($this, $chunk);
        }
    }
}

/**
* Strips the HTML comment markers or CDATA sections from an escape.
* If XML_OPTIONS_FULL_ESCAPES is on, this decorator is not used.<br />
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_Escape_Stripper {
    /**
    * Original handler object
    * @var object
    * @access private
    */
    var $orig_obj;
    /**
    * Original handler method
    * @var string
    * @access private
    */
    var $orig_method;
    /**
    * Constructs XML_HTMLSax3_Entities_Unparsed
    * @param object handler object being decorated
    * @param string original handler method
    * @access protected
    */
    function XML_HTMLSax3_Escape_Stripper(&$orig_obj, $orig_method) {
        $this->orig_obj =& $orig_obj;
        $this->orig_method = $orig_method;
    }
    /**
    * Breaks the data up by XML entities
    * @param XML_HTMLSax3
    * @param string element data
    * @access protected
    */
    function strip(&$parser, $data) {
        // Check for HTML comments first
        if ( substr($data,0,2) == '--' ) {
            $patterns = array(
                '/^\-\-/',          // Opening comment: --
                '/\-\-$/',          // Closing comment: --
            );
            $data = preg_replace($patterns,'',$data);

        // Check for XML CDATA sections (note: don't do both!)
        } else if ( substr($data,0,1) == '[' ) {
            $patterns = array(
                '/^\[.*CDATA.*\[/s', // Opening CDATA
                '/\].*\]$/s',       // Closing CDATA
                );
            $data = preg_replace($patterns,'',$data);
        }

        $this->orig_obj->{$this->orig_method}($this, $data);
    }
}
?>


From stef at berlios.de  Fri Feb 17 00:06:14 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:14 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/safehtml/classes HTMLSax3.php,NONE,1.1.2.1 safehtml.php,NONE,1.1.2.1
Message-ID: <200602162306.k1GN6Ebx012727@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/safehtml/classes
In directory sheep:/tmp/cvs-serv12672/ecrire/safehtml/classes

Added Files:
      Tag: BRANCH-V1
	HTMLSax3.php safehtml.php 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

--- NEW FILE: HTMLSax3.php ---
<?php
/* vim: set expandtab tabstop=4 shiftwidth=4: */
//
// +----------------------------------------------------------------------+
// | PHP Version 4                                                        |
// +----------------------------------------------------------------------+
// | Copyright (c) 1997-2002 The PHP Group                                |
// +----------------------------------------------------------------------+
// | This source file is subject to version 2.02 of the PHP license,      |
// | that is bundled with this package in the file LICENSE, and is        |
// | available at through the world-wide-web at                           |
// | http://www.php.net/license/3_0.txt.                                  |
// | If you did not receive a copy of the PHP license and are unable to   |
// | obtain it through the world-wide-web, please send a note to          |
// | license at php.net so we can mail you a copy immediately.               |
// +----------------------------------------------------------------------+
// | Authors: Alexander Zhukov <alex at veresk.ru> Original port from Python |
// | Authors: Harry Fuecks <hfuecks at phppatterns.com> Port to PEAR + more  |
// | Authors: Many @ Sitepointforums Advanced PHP Forums                  |
// +----------------------------------------------------------------------+
//
// $Id: HTMLSax3.php,v 1.1.2.1 2006/02/16 23:06:12 stef Exp $
//
/**
* Main parser components
* @package XML_HTMLSax3
* @version $Id: HTMLSax3.php,v 1.1.2.1 2006/02/16 23:06:12 stef Exp $
*/
/**
* Required classes
*/
if (!defined('XML_HTMLSAX3')) {
    define('XML_HTMLSAX3', 'XML/');
}
require_once(XML_HTMLSAX3 . 'HTMLSax3/States.php');
require_once(XML_HTMLSAX3 . 'HTMLSax3/Decorators.php');

/**
* Base State Parser
* @package XML_HTMLSax3
* @access protected
* @abstract
*/
class XML_HTMLSax3_StateParser {
    /**
    * Instance of user front end class to be passed to callbacks
    * @var XML_HTMLSax3
    * @access private
    */
    var $htmlsax;
    /**
    * User defined object for handling elements
    * @var object
    * @access private
    */
    var $handler_object_element;
    /**
    * User defined open tag handler method
    * @var string
    * @access private
    */
    var $handler_method_opening;
    /**
    * User defined close tag handler method
    * @var string
    * @access private
    */
    var $handler_method_closing;
    /**
    * User defined object for handling data in elements
    * @var object
    * @access private
    */
    var $handler_object_data;
    /**
    * User defined data handler method
    * @var string
    * @access private
    */
    var $handler_method_data;
    /**
    * User defined object for handling processing instructions
    * @var object
    * @access private
    */
    var $handler_object_pi;
    /**
    * User defined processing instruction handler method
    * @var string
    * @access private
    */
    var $handler_method_pi;
    /**
    * User defined object for handling JSP/ASP tags
    * @var object
    * @access private
    */
    var $handler_object_jasp;
    /**
    * User defined JSP/ASP handler method
    * @var string
    * @access private
    */
    var $handler_method_jasp;
    /**
    * User defined object for handling XML escapes
    * @var object
    * @access private
    */
    var $handler_object_escape;
    /**
    * User defined XML escape handler method
    * @var string
    * @access private
    */
    var $handler_method_escape;
    /**
    * User defined handler object or NullHandler
    * @var object
    * @access private
    */
    var $handler_default;
    /**
    * Parser options determining parsing behavior
    * @var array
    * @access private
    */
    var $parser_options = array();
    /**
    * XML document being parsed
    * @var string
    * @access private
    */
    var $rawtext;
    /**
    * Position in XML document relative to start (0)
    * @var int
    * @access private
    */
    var $position;
    /**
    * Length of the XML document in characters
    * @var int
    * @access private
    */
    var $length;
    /**
    * Array of state objects
    * @var array
    * @access private
    */
    var $State = array();

    /**
    * Constructs XML_HTMLSax3_StateParser setting up states
    * @var XML_HTMLSax3 instance of user front end class
    * @access protected
    */
    function XML_HTMLSax3_StateParser (& $htmlsax) {
        $this->htmlsax = & $htmlsax;
        $this->State[XML_HTMLSAX3_STATE_START] =& new XML_HTMLSax3_StartingState();

        $this->State[XML_HTMLSAX3_STATE_CLOSING_TAG] =& new XML_HTMLSax3_ClosingTagState();
        $this->State[XML_HTMLSAX3_STATE_TAG] =& new XML_HTMLSax3_TagState();
        $this->State[XML_HTMLSAX3_STATE_OPENING_TAG] =& new XML_HTMLSax3_OpeningTagState();

        $this->State[XML_HTMLSAX3_STATE_PI] =& new XML_HTMLSax3_PiState();
        $this->State[XML_HTMLSAX3_STATE_JASP] =& new XML_HTMLSax3_JaspState();
        $this->State[XML_HTMLSAX3_STATE_ESCAPE] =& new XML_HTMLSax3_EscapeState();
    }

    /**
    * Moves the position back one character
    * @access protected
    * @return void
    */
    function unscanCharacter() {
        $this->position -= 1;
    }

    /**
    * Moves the position forward one character
    * @access protected
    * @return void
    */
    function ignoreCharacter() {
        $this->position += 1;
    }

    /**
    * Returns the next character from the XML document or void if at end
    * @access protected
    * @return mixed
    */
    function scanCharacter() {
        if ($this->position < $this->length) {
            return $this->rawtext{$this->position++};
        }
    }

    /**
    * Returns a string from the current position to the next occurance
    * of the supplied string
    * @param string string to search until
    * @access protected
    * @return string
    */
    function scanUntilString($string) {
        $start = $this->position;
        $this->position = strpos($this->rawtext, $string, $start);
        if ($this->position === FALSE) {
            $this->position = $this->length;
        }
        return substr($this->rawtext, $start, $this->position - $start);
    }

    /**
    * Returns a string from the current position until the first instance of
    * one of the characters in the supplied string argument
    * @param string string to search until
    * @access protected
    * @return string
    * @abstract
    */
    function scanUntilCharacters($string) {}

    /**
    * Moves the position forward past any whitespace characters
    * @access protected
    * @return void
    * @abstract
    */
    function ignoreWhitespace() {}

    /**
    * Begins the parsing operation, setting up any decorators, depending on
    * parse options invoking _parse() to execute parsing
    * @param string XML document to parse
    * @access protected
    * @return void
    */
    function parse($data) {
        if ($this->parser_options['XML_OPTION_TRIM_DATA_NODES']==1) {
            $decorator =& new XML_HTMLSax3_Trim(
                $this->handler_object_data,
                $this->handler_method_data);
            $this->handler_object_data =& $decorator;
            $this->handler_method_data = 'trimData';
        }
        if ($this->parser_options['XML_OPTION_CASE_FOLDING']==1) {
            $open_decor =& new XML_HTMLSax3_CaseFolding(
                $this->handler_object_element,
                $this->handler_method_opening,
                $this->handler_method_closing);
            $this->handler_object_element =& $open_decor;
            $this->handler_method_opening ='foldOpen';
            $this->handler_method_closing ='foldClose';
        }
        if ($this->parser_options['XML_OPTION_LINEFEED_BREAK']==1) {
            $decorator =& new XML_HTMLSax3_Linefeed(
                $this->handler_object_data,
                $this->handler_method_data);
            $this->handler_object_data =& $decorator;
            $this->handler_method_data = 'breakData';
        }
        if ($this->parser_options['XML_OPTION_TAB_BREAK']==1) {
            $decorator =& new XML_HTMLSax3_Tab(
                $this->handler_object_data,
                $this->handler_method_data);
            $this->handler_object_data =& $decorator;
            $this->handler_method_data = 'breakData';
        }
        if ($this->parser_options['XML_OPTION_ENTITIES_UNPARSED']==1) {
            $decorator =& new XML_HTMLSax3_Entities_Unparsed(
                $this->handler_object_data,
                $this->handler_method_data);
            $this->handler_object_data =& $decorator;
            $this->handler_method_data = 'breakData';
        }
        if ($this->parser_options['XML_OPTION_ENTITIES_PARSED']==1) {
            $decorator =& new XML_HTMLSax3_Entities_Parsed(
                $this->handler_object_data,
                $this->handler_method_data);
            $this->handler_object_data =& $decorator;
            $this->handler_method_data = 'breakData';
        }
        // Note switched on by default
        if ($this->parser_options['XML_OPTION_STRIP_ESCAPES']==1) {
            $decorator =& new XML_HTMLSax3_Escape_Stripper(
                $this->handler_object_escape,
                $this->handler_method_escape);
            $this->handler_object_escape =& $decorator;
            $this->handler_method_escape = 'strip';
        }
        $this->rawtext = $data;
        $this->length = strlen($data);
        $this->position = 0;
        $this->_parse();
    }

    /**
    * Performs the parsing itself, delegating calls to a specific parser
    * state
    * @param constant state object to parse with
    * @access protected
    * @return void
    */
    function _parse($state = XML_HTMLSAX3_STATE_START) {
        do {
            $state = $this->State[$state]->parse($this);
        } while ($state != XML_HTMLSAX3_STATE_STOP &&
                    $this->position < $this->length);
    }
}

/**
* Parser for PHP Versions below 4.3.0. Uses a slower parsing mechanism than
* the equivalent PHP 4.3.0+  subclass of StateParser
* @package XML_HTMLSax3
* @access protected
* @see XML_HTMLSax3_StateParser_Gtet430
*/
class XML_HTMLSax3_StateParser_Lt430 extends XML_HTMLSax3_StateParser {
    /**
    * Constructs XML_HTMLSax3_StateParser_Lt430 defining available
    * parser options
    * @var XML_HTMLSax3 instance of user front end class
    * @access protected
    */
    function XML_HTMLSax3_StateParser_Lt430(& $htmlsax) {
        parent::XML_HTMLSax3_StateParser($htmlsax);
        $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
        $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
        $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
        $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
        $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
        $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
        $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
    }

    /**
    * Returns a string from the current position until the first instance of
    * one of the characters in the supplied string argument
    * @param string string to search until
    * @access protected
    * @return string
    */
    function scanUntilCharacters($string) {
        $startpos = $this->position;
        while ($this->position < $this->length && strpos($string, $this->rawtext{$this->position}) === FALSE) {
            $this->position++;
        }
        return substr($this->rawtext, $startpos, $this->position - $startpos);
    }

    /**
    * Moves the position forward past any whitespace characters
    * @access protected
    * @return void
    */
    function ignoreWhitespace() {
        while ($this->position < $this->length && 
            strpos(" \n\r\t", $this->rawtext{$this->position}) !== FALSE) {
            $this->position++;
        }
    }

    /**
    * Begins the parsing operation, setting up the unparsed XML entities
    * decorator if necessary then delegating further work to parent
    * @param string XML document to parse
    * @access protected
    * @return void
    */
    function parse($data) {
        parent::parse($data);
    }
}

/**
* Parser for PHP Versions equal to or greater than 4.3.0. Uses a faster
* parsing mechanism than the equivalent PHP < 4.3.0 subclass of StateParser
* @package XML_HTMLSax3
* @access protected
* @see XML_HTMLSax3_StateParser_Lt430
*/
class XML_HTMLSax3_StateParser_Gtet430 extends XML_HTMLSax3_StateParser {
    /**
    * Constructs XML_HTMLSax3_StateParser_Gtet430 defining available
    * parser options
    * @var XML_HTMLSax3 instance of user front end class
    * @access protected
    */
    function XML_HTMLSax3_StateParser_Gtet430(& $htmlsax) {
        parent::XML_HTMLSax3_StateParser($htmlsax);
        $this->parser_options['XML_OPTION_TRIM_DATA_NODES'] = 0;
        $this->parser_options['XML_OPTION_CASE_FOLDING'] = 0;
        $this->parser_options['XML_OPTION_LINEFEED_BREAK'] = 0;
        $this->parser_options['XML_OPTION_TAB_BREAK'] = 0;
        $this->parser_options['XML_OPTION_ENTITIES_PARSED'] = 0;
        $this->parser_options['XML_OPTION_ENTITIES_UNPARSED'] = 0;
        $this->parser_options['XML_OPTION_STRIP_ESCAPES'] = 0;
    }
    /**
    * Returns a string from the current position until the first instance of
    * one of the characters in the supplied string argument.
    * @param string string to search until
    * @access protected
    * @return string
    */
    function scanUntilCharacters($string) {
        $startpos = $this->position;
        $length = strcspn($this->rawtext, $string, $startpos);
        $this->position += $length;
        return substr($this->rawtext, $startpos, $length);
    }

    /**
    * Moves the position forward past any whitespace characters
    * @access protected
    * @return void
    */
    function ignoreWhitespace() {
        $this->position += strspn($this->rawtext, " \n\r\t", $this->position);
    }

    /**
    * Begins the parsing operation, setting up the parsed and unparsed
    * XML entity decorators if necessary then delegating further work
    * to parent
    * @param string XML document to parse
    * @access protected
    * @return void
    */
    function parse($data) {
        parent::parse($data);
    }
}

/**
* Default NullHandler for methods which were not set by user
* @package XML_HTMLSax3
* @access protected
*/
class XML_HTMLSax3_NullHandler {
    /**
    * Generic handler method which does nothing
    * @access protected
    * @return void
    */
    function DoNothing() {
    }
}

/**
* User interface class. All user calls should only be made to this class
* @package XML_HTMLSax3
* @access public
*/
class XML_HTMLSax3 {
    /**
    * Instance of concrete subclass of XML_HTMLSax3_StateParser
    * @var XML_HTMLSax3_StateParser
    * @access private
    */
    var $state_parser;

    /**
    * Constructs XML_HTMLSax3 selecting concrete StateParser subclass
    * depending on PHP version being used as well as setting the default
    * NullHandler for all callbacks<br />
    * <b>Example:</b>
    * <pre>
    * $myHandler = & new MyHandler();
    * $parser = new XML_HTMLSax3();
    * $parser->set_object($myHandler);
    * $parser->set_option('XML_OPTION_CASE_FOLDING');
    * $parser->set_element_handler('myOpenHandler','myCloseHandler');
    * $parser->set_data_handler('myDataHandler');
    * $parser->parser($xml);
    * </pre>
    * @access public
    */
    function XML_HTMLSax3() {
        if (version_compare(phpversion(), '4.3', 'ge')) {
            $this->state_parser =& new XML_HTMLSax3_StateParser_Gtet430($this);
        } else {
            $this->state_parser =& new XML_HTMLSax3_StateParser_Lt430($this);
        }
        $nullhandler =& new XML_HTMLSax3_NullHandler();
        $this->set_object($nullhandler);
        $this->set_element_handler('DoNothing', 'DoNothing');
        $this->set_data_handler('DoNothing');
        $this->set_pi_handler('DoNothing');
        $this->set_jasp_handler('DoNothing');
        $this->set_escape_handler('DoNothing');
    }

    /**
    * Sets the user defined handler object. Returns a PEAR Error
    * if supplied argument is not an object.
    * @param object handler object containing SAX callback methods
    * @access public
    * @return mixed
    */
    function set_object(&$object) {
        if ( is_object($object) ) {
            $this->state_parser->handler_default =& $object;
            return true;
        } else {
            require_once('PEAR.php');
            PEAR::raiseError('XML_HTMLSax3::set_object requires '.
                'an object instance');
        }
    }

    /**
    * Sets a parser option. By default all options are switched off.
    * Returns a PEAR Error if option is invalid<br />
    * <b>Available options:</b>
    * <ul>
    * <li>XML_OPTION_TRIM_DATA_NODES: trim whitespace off the beginning
    * and end of data passed to the data handler</li>
    * <li>XML_OPTION_LINEFEED_BREAK: linefeeds result in additional data
    * handler calls</li>
    * <li>XML_OPTION_TAB_BREAK: tabs result in additional data handler
    * calls</li>
    * <li>XML_OPTION_ENTITIES_UNPARSED: XML entities are returned as
    * seperate data handler calls in unparsed form</li>
    * <li>XML_OPTION_ENTITIES_PARSED: (PHP 4.3.0+ only) XML entities are
    * returned as seperate data handler calls and are parsed with 
    * PHP's html_entity_decode() function</li>
    * <li>XML_OPTION_STRIP_ESCAPES: strips out the -- -- comment markers
    * or CDATA markup inside an XML escape, if found.</li>
    * </ul>
    * To get HTMLSax to behave in the same way as the native PHP SAX parser,
    * using it's default state, you need to switch on XML_OPTION_LINEFEED_BREAK,
    * XML_OPTION_ENTITIES_PARSED and XML_OPTION_CASE_FOLDING
    * @param string name of parser option
    * @param int (optional) 1 to switch on, 0 for off
    * @access public
    * @return boolean
    */
    function set_option($name, $value=1) {
        if ( array_key_exists($name,$this->state_parser->parser_options) ) {
            $this->state_parser->parser_options[$name] = $value;
            return true;
        } else {
            require_once('PEAR.php');
            PEAR::raiseError('XML_HTMLSax3::set_option('.$name.') illegal');
        }
    }

    /**
    * Sets the data handler method which deals with the contents of XML
    * elements.<br />
    * The handler method must accept two arguments, the first being an
    * instance of XML_HTMLSax3 and the second being the contents of an
    * XML element e.g.
    * <pre>
    * function myDataHander(& $parser,$data){}
    * </pre>
    * @param string name of method
    * @access public
    * @return void
    * @see set_object
    */
    function set_data_handler($data_method) {
        $this->state_parser->handler_object_data =& $this->state_parser->handler_default;
        $this->state_parser->handler_method_data = $data_method;
    }

    /**
    * Sets the open and close tag handlers
    * <br />The open handler method must accept three arguments; the parser,
    * the tag name and an array of attributes e.g.
    * <pre>
    * function myOpenHander(& $parser,$tagname,$attrs=array()){}
    * </pre>
    * The close handler method must accept two arguments; the parser and
    * the tag name e.g.
    * <pre>
    * function myCloseHander(& $parser,$tagname){}
    * </pre>
    * @param string name of open method
    * @param string name of close method
    * @access public
    * @return void
    * @see set_object
    */
    function set_element_handler($opening_method, $closing_method) {
        $this->state_parser->handler_object_element =& $this->state_parser->handler_default;
        $this->state_parser->handler_method_opening = $opening_method;
        $this->state_parser->handler_method_closing = $closing_method;
    }

    /**
    * Sets the processing instruction handler method e.g. for PHP open
    * and close tags<br />
    * The handler method must accept three arguments; the parser, the
    * PI target and data inside the PI
    * <pre>
    * function myPIHander(& $parser,$target, $data){}
    * </pre>
    * @param string name of method
    * @access public
    * @return void
    * @see set_object
    */
    function set_pi_handler($pi_method) {
        $this->state_parser->handler_object_pi =& $this->state_parser->handler_default;
        $this->state_parser->handler_method_pi = $pi_method;
    }

    /**
    * Sets the XML escape handler method e.g. for comments and doctype
    * declarations<br />
    * The handler method must accept two arguments; the parser and the
    * contents of the escaped section
    * <pre>
    * function myEscapeHander(& $parser, $data){}
    * </pre>
    * @param string name of method
    * @access public
    * @return void
    * @see set_object
    */
    function set_escape_handler($escape_method) {
        $this->state_parser->handler_object_escape =& $this->state_parser->handler_default;
        $this->state_parser->handler_method_escape = $escape_method;
    }

    /**
    * Sets the JSP/ASP markup handler<br />
    * The handler method must accept two arguments; the parser and
    * body of the JASP tag
    * <pre>
    * function myJaspHander(& $parser, $data){}
    * </pre>
    * @param string name of method
    * @access public
    * @return void
    * @see set_object
    */
    function set_jasp_handler ($jasp_method) {
        $this->state_parser->handler_object_jasp =& $this->state_parser->handler_default;
        $this->state_parser->handler_method_jasp = $jasp_method;
    }

    /**
    * Returns the current string position of the "cursor" inside the XML
    * document
    * <br />Intended for use from within a user defined handler called
    * via the $parser reference e.g.
    * <pre>
    * function myDataHandler(& $parser,$data) {
    *     echo( 'Current position: '.$parser->get_current_position() );
    * }
    * </pre>
    * @access public
    * @return int
    * @see get_length
    */
    function get_current_position() {
        return $this->state_parser->position;
    }

    /**
    * Returns the string length of the XML document being parsed
    * @access public
    * @return int
    */
    function get_length() {
        return $this->state_parser->length;
    }

    /**
    * Start parsing some XML
    * @param string XML document
    * @access public
    * @return void
    */
    function parse($data) {
        $this->state_parser->parse($data);
    }
}
?>
--- NEW FILE: safehtml.php ---
<?php
/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */

/**
 * SafeHTML Parser
 *
 * PHP versions 4 and 5
 *
 * @category   HTML
 * @package    SafeHTML
 * @author     Roman Ivanov <thingol at mail.ru>
 * @copyright  2004-2005 Roman Ivanov
 * @license    http://www.debian.org/misc/bsd.license  BSD License (3 Clause)
 * @version    CVS: $Id: safehtml.php,v 1.1.2.1 2006/02/16 23:06:12 stef Exp $
 * @link       http://pixel-apes.com/safehtml/
 */


/**
 * This package requires HTMLSax3 package
 */
require_once(XML_HTMLSAX3 . 'HTMLSax3.php');

 
/**
 *
 * SafeHTML Parser
 *
 * This parser strips down all potentially dangerous content within HTML:
 * <ul>
 * <li>opening tag without its closing tag</li>
 * <li>closing tag without its opening tag</li>
 * <li>any of these tags: "base", "basefont", "head", "html", "body", "applet", 
 * "object", "iframe", "frame", "frameset", "script", "layer", "ilayer", "embed", 
 * "bgsound", "link", "meta", "style", "title", "blink", "xml" etc.</li>
 * <li>any of these attributes: on*, data*, dynsrc</li>
 * <li>javascript:/vbscript:/about: etc. protocols</li>
 * <li>expression/behavior etc. in styles</li>
 * <li>any other active content</li>
 * </ul>
 * It also tries to convert code to XHTML valid, but htmltidy is far better 
 * solution for this task.
 *
 * <b>Example:</b>
 * <pre>
 * $parser =& new SafeHTML();
 * $result = $parser->parse($doc);
 * </pre>
 *
 * @category   HTML
 * @package    SafeHTML
 * @author     Roman Ivanov <thingol at mail.ru>
 * @copyright  1997-2005 Roman Ivanov
 * @license    http://www.debian.org/misc/bsd.license  BSD License (3 Clause)
 * @version    Release: @package_version@
 * @link       http://pear.php.net/package/SafeHTML
 */
class SafeHTML 
{
    /**
     * Storage for resulting HTML output
     *
     * @var string
     * @access private
     */
    var $_xhtml = '';
    
    /**
     * Array of counters for each tag
     *
     * @var array
     * @access private
     */
    var $_counter = array();
    
    /**
     * Stack of unclosed tags
     *
     * @var array
     * @access private
     */
    var $_stack = array();
    
    /**
     * Array of counters for tags that must be deleted with all content
     *
     * @var array
     * @access private
     */
    var $_dcCounter = array();
    
    /**
     * Stack of unclosed tags that must be deleted with all content
     *
     * @var array
     * @access private
     */
    var $_dcStack = array();
    
    /**
     * Stores level of list (ol/ul) nesting
     *
     * @var int
     * @access private
     */
    var $_listScope = 0; 
    
    /**
     * Stack of unclosed list tags 
     *
     * @var array
     * @access private
     */
    var $_liStack = array();

    /**
     * Array of prepared regular expressions for protocols (schemas) matching
     *
     * @var array
     * @access private
     */
    var $_protoRegexps = array();
    
    /**
     * Array of prepared regular expressions for CSS matching
     *
     * @var array
     * @access private
     */
    var $_cssRegexps = array();

    /**
     * List of single tags ("<tag />")
     *
     * @var array
     * @access public
     */
    var $singleTags = array('area', 'br', 'img', 'input', 'hr', 'wbr', );

    /**
     * List of dangerous tags (such tags will be deleted)
     *
     * @var array
     * @access public
     */
    var $deleteTags = array(
        'applet', 'base',   'basefont', 'bgsound', 'blink',  'body', 
        'embed',  'frame',  'frameset', 'head',    'html',   'ilayer', 
        'iframe', 'layer',  'link',     'meta',    'object', 'style', 
        'title',  'script', 
        );

    /**
     * List of dangerous tags (such tags will be deleted, and all content 
     * inside this tags will be also removed)
     *
     * @var array
     * @access public
     */
    var $deleteTagsContent = array('script', 'style', 'title', 'xml', );

    /**
     * Type of protocols filtering ('white' or 'black')
     *
     * @var string
     * @access public
     */
    var $protocolFiltering = 'white';

    /**
     * List of "dangerous" protocols (used for blacklist-filtering)
     *
     * @var array
     * @access public
     */
    var $blackProtocols = array(
        'about',   'chrome',     'data',       'disk',     'hcp',     
        'help',    'javascript', 'livescript', 'lynxcgi',  'lynxexec', 
        'ms-help', 'ms-its',     'mhtml',      'mocha',    'opera',   
        'res',     'resource',   'shell',      'vbscript', 'view-source', 
        'vnd.ms.radio',          'wysiwyg', 
        );

    /**
     * List of "safe" protocols (used for whitelist-filtering)
     *
     * @var array
     * @access public
     */
    var $whiteProtocols = array(
        'ed2k',   'file', 'ftp',  'gopher', 'http',  'https', 
        'irc',    'mailto', 'news', 'nntp', 'telnet', 'webcal', 
        'xmpp', 
        );

    /**
     * List of attributes that can contain protocols
     *
     * @var array
     * @access public
     */
    var $protocolAttributes = array(
        'action', 'background', 'codebase', 'dynsrc', 'href', 'lowsrc', 'src', 
        );

    /**
     * List of dangerous CSS keywords
     *
     * Whole style="" attribute will be removed, if parser will find one of 
     * these keywords
     *
     * @var array
     * @access public
     */
    var $cssKeywords = array(
        'absolute', 'behavior',       'behaviour',   'content', 'expression', 
        'fixed',    'include-source', 'moz-binding',
        );

    /**
     * List of tags that can have no "closing tag"
     *
     * @var array
     * @access public
     * @deprecated XHTML does not allow such tags
     */
    var $noClose = array();

    /**
     * List of block-level tags that terminates paragraph
     *
     * Paragraph will be closed when this tags opened
     *
     * @var array
     * @access public
     */
    var $closeParagraph = array(
        'address', 'blockquote', 'center', 'dd',      'dir',       'div', 
        'dl',      'dt',         'h1',     'h2',      'h3',        'h4', 
        'h5',      'h6',         'hr',     'isindex', 'listing',   'marquee', 
        'menu',    'multicol',   'ol',     'p',       'plaintext', 'pre', 
        'table',   'ul',         'xmp', 
        );

    /**
     * List of table tags, all table tags outside a table will be removed
     *
     * @var array
     * @access public
     */
    var $tableTags = array(
        'caption', 'col', 'colgroup', 'tbody', 'td', 'tfoot', 'th', 
        'thead',   'tr', 
        );

    /**
     * List of list tags
     *
     * @var array
     * @access public
     */
    var $listTags = array('dir', 'menu', 'ol', 'ul', );

    /**
     * List of dangerous attributes
     *
     * @var array
     * @access public
     */
    var $attributes = array('dynsrc', 'id', 'name', );

    /**
     * Constructs class
     *
     * @access public
     */
    function SafeHTML() 
    {
        //making regular expressions based on Proto & CSS arrays
        foreach ($this->blackProtocols as $proto) {
            $preg = "/[\s\x01-\x1F]*";
            for ($i=0; $i<strlen($proto); $i++) {
                $preg .= $proto{$i} . "[\s\x01-\x1F]*";
            }
            $preg .= ":/i";
            $this->_protoRegexps[] = $preg;
        }

        foreach ($this->cssKeywords as $css) {
            $this->_cssRegexps[] = '/' . $css . '/i';
        }
        return true;
    }

    /**
     * Handles the writing of attributes - called from $this->_openHandler()
     *
     * @param array $attrs array of attributes $name => $value
     * @return boolean
     * @access private
     */
    function _writeAttrs ($attrs) 
    {
        if (is_array($attrs)) {
            foreach ($attrs as $name => $value) {

                $name = strtolower($name);

                if (strpos($name, 'on') === 0) {
                    continue;
                }
                if (strpos($name, 'data') === 0) {
                    continue;
                }
                if (in_array($name, $this->attributes)) {
                    continue;
                }
                if (!preg_match("/^[a-z0-9]+$/i", $name)) {
                    continue;
                }

                if (($value === TRUE) || (is_null($value))) {
                    $value = $name;
                }

                if ($name == 'style') {
                   
                   // removes insignificant backslahes
                   $value = str_replace("\\", '', $value);

                   // removes CSS comments
                   while (1)
                   {
                     $_value = preg_replace("!/\*.*?\*/!s", '', $value);
                     if ($_value == $value) break;
                     $value = $_value;
                   }
                   
                   // replace all & to &amp;
                   $value = str_replace('&amp;', '&', $value);
                   $value = str_replace('&', '&amp;', $value);

                   foreach ($this->_cssRegexps as $css) {
                       if (preg_match($css, $value)) { 
                           continue 2;
                       }
                   }
                   foreach ($this->_protoRegexps as $proto) {
                       if (preg_match($proto, $value)) {
                           continue 2;
                       }
                   }
                }

                $tempval = preg_replace('/&#(\d+);?/me', "chr('\\1')", $value); //"'
                $tempval = preg_replace('/&#x([0-9a-f]+);?/mei', "chr(hexdec('\\1'))", $tempval);

                if ((in_array($name, $this->protocolAttributes)) && 
                    (strpos($tempval, ':') !== false)) 
                {
                    if ($this->protocolFiltering == 'black') {
                        foreach ($this->_protoRegexps as $proto) {
                            if (preg_match($proto, $tempval)) continue 2;
                        }
                    } else {
                        $_tempval = explode(':', $tempval);
                        $proto = $_tempval[0];
                        if (!in_array($proto, $this->whiteProtocols)) {
                            continue;
                        }
                    }
                }

                $value = str_replace("\"", "&quot;", $value);
                $this->_xhtml .= ' ' . $name . '="' . $value . '"';
            }
        }
        return true;
    }

    /**
     * Opening tag handler - called from HTMLSax
     *
     * @param object $parser HTML Parser
     * @param string $name   tag name
     * @param array  $attrs  tag attributes
     * @return boolean
     * @access private
     */
    function _openHandler(&$parser, $name, $attrs) 
    {
        $name = strtolower($name);

        if (in_array($name, $this->deleteTagsContent)) {
            array_push($this->_dcStack, $name);
            $this->_dcCounter[$name] = isset($this->_dcCounter[$name]) ? $this->_dcCounter[$name]+1 : 1;
        }
        if (count($this->_dcStack) != 0) {
            return true;
        }

        if (in_array($name, $this->deleteTags)) {
            return true;
        }
        
        if (!preg_match("/^[a-z0-9]+$/i", $name)) {
            if (preg_match("!(?:\@|://)!i", $name)) {
                $this->_xhtml .= '&lt;' . $name . '&gt;';
            }
            return true;
        }

        if (in_array($name, $this->singleTags)) {
            $this->_xhtml .= '<' . $name;
            $this->_writeAttrs($attrs);
            $this->_xhtml .= ' />';
            return true;
        }

        // TABLES: cannot open table elements when we are not inside table
        if ((isset($this->_counter['table'])) && ($this->_counter['table'] <= 0) 
            && (in_array($name, $this->tableTags))) 
        {
            return true;
        }

        // PARAGRAPHS: close paragraph when closeParagraph tags opening
        if ((in_array($name, $this->closeParagraph)) && (in_array('p', $this->_stack))) {
            $this->_closeHandler($parser, 'p');
        }

        // LISTS: we should close <li> if <li> of the same level opening
        if ($name == 'li' && count($this->_liStack) && 
            $this->_listScope == $this->_liStack[count($this->_liStack)-1]) 
        {
            $this->_closeHandler($parser, 'li');
        }

        // LISTS: we want to know on what nesting level of lists we are
        if (in_array($name, $this->listTags)) {
            $this->_listScope++;
        }
        if ($name == 'li') {
            array_push($this->_liStack, $this->_listScope);
        }
            
        $this->_xhtml .= '<' . $name;
        $this->_writeAttrs($attrs);
        $this->_xhtml .= '>';
        array_push($this->_stack,$name);
        $this->_counter[$name] = isset($this->_counter[$name]) ? $this->_counter[$name]+1 : 1;
        return true;
    }

    /**
     * Closing tag handler - called from HTMLSax
     *
     * @param object $parsers HTML parser
     * @param string $name    tag name
     * @return boolean
     * @access private
     */
    function _closeHandler(&$parser, $name) 
    {

        $name = strtolower($name);

        if (isset($this->_dcCounter[$name]) && ($this->_dcCounter[$name] > 0) && 
            (in_array($name, $this->deleteTagsContent))) 
        {
           while ($name != ($tag = array_pop($this->_dcStack))) {
            $this->_dcCounter[$tag]--;
           }

           $this->_dcCounter[$name]--;
        }

        if (count($this->_dcStack) != 0) {
            return true;
        }

        if ((isset($this->_counter[$name])) && ($this->_counter[$name] > 0)) {
           while ($name != ($tag = array_pop($this->_stack))) {
               $this->_closeTag($tag);
           }

           $this->_closeTag($name);
        }
        return true;
    }

    /**
     * Closes tag 
     *
     * @param string $tag tag name
     * @return boolean
     * @access private
     */
    function _closeTag($tag) 
    {
        if (!in_array($tag, $this->noClose)) {
            $this->_xhtml .= '</' . $tag . '>';
        }

        $this->_counter[$tag]--;

        if (in_array($tag, $this->listTags)) {
            $this->_listScope--;
        }

        if ($tag == 'li') {
            array_pop($this->_liStack);
        }
        return true;
    }

    /**
     * Character data handler - called from HTMLSax
     *
     * @param object $parser HTML parser
     * @param string $data   textual data
     * @return boolean
     * @access private
     */
    function _dataHandler(&$parser, $data) 
    {
        if (count($this->_dcStack) == 0) {
            $this->_xhtml .= $data;
        }
        return true;
    }

    /**
     * Escape handler - called from HTMLSax
     *
     * @param object $parser HTML parser
     * @param string $data   comments or other type of data
     * @return boolean
     * @access private
     */
    function _escapeHandler(&$parser, $data) 
    {
        return true;
    }

    /**
     * Returns the XHTML document
     *
     * @return string Processed (X)HTML document
     * @access public
     */
    function getXHTML () 
    {
        while ($tag = array_pop($this->_stack)) {
            $this->_closeTag($tag);
        }
        
        return $this->_xhtml;
    }

    /**
     * Clears current document data
     *
     * @return boolean
     * @access public
     */
    function clear() 
    {
        $this->_xhtml = '';
        return true;
    }

    /**
     * Main parsing fuction
     *
     * @param string $doc HTML document for processing
     * @return string Processed (X)HTML document
     * @access public
     */
    function parse($doc) 
    {

       // Save all '<' symbols
       $doc = preg_replace("/<(?=[^a-zA-Z\/\!\?\%])/", '&lt;', $doc);

       // Web documents shouldn't contains \x00 symbol
       $doc = str_replace("\x00", '', $doc);

       // Opera6 bug workaround
       $doc = str_replace("\xC0\xBC", '&lt;', $doc);
       
       // UTF-7 encoding XSS workaround
       $doc = str_replace("+ADw-", '&lt;', $doc);

       // Instantiate the parser
       $parser=& new XML_HTMLSax3();

       // Set up the parser
       $parser->set_object($this);

       $parser->set_element_handler('_openHandler','_closeHandler');
       $parser->set_data_handler('_dataHandler');
       $parser->set_escape_handler('_escapeHandler');

       $parser->parse($doc);

       return $this->getXHTML();

    }

}

/*
 * Local variables:
 * tab-width: 4
 * c-basic-offset: 4
 * c-hanging-comment-ender-p: nil
 * End:
 */

?>



From stef at berlios.de  Fri Feb 17 00:06:14 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 00:06:14 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire/lang ecrire_cs.php3,NONE,1.1.2.1 spip_cs.php3,NONE,1.1.2.1 public_cs.php3,NONE,1.1.2.1
Message-ID: <200602162306.k1GN6Ebx012732@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire/lang
In directory sheep:/tmp/cvs-serv12672/ecrire/lang

Added Files:
      Tag: BRANCH-V1
	ecrire_cs.php3 spip_cs.php3 public_cs.php3 
Log Message:
Mise ? jour (Spip 1.8.2 SVN)
bugs boucle document image
safehtml
ajout lang CS
page (secu formulaires)

--- NEW FILE: ecrire_cs.php3 ---
<?php

// This is a SPIP language file  --  Ceci est un fichier langue de SPIP

$GLOBALS[$GLOBALS['idx_lang']] = array(


// A
'aide_non_disponible' => 'Tato &#269;&aacute;st vestav&#283;n&eacute; n&aacute;pov&#283;dy nen&iacute; je&#353;t&#283; v tomto jazykov&eacute;m zn&#283;n&iacute; k dispozici.',
'avis_acces_interdit' => 'P&#345;&iacute;stup zak&aacute;z&aacute;n.',
'avis_article_modifie' => 'Varov&aacute;n&iacute;: Na tomto &#269;l&aacute;nku pracoval p&#345;ed @date_diff@ minutou/minutami @nom_auteur_modif at .',
'avis_aucun_resultat' => 'Nenalezeny &#382;&aacute;dn&eacute; v&yacute;sledky.',
'avis_chemin_invalide_1' => 'Zvolili jste cestu',
'avis_chemin_invalide_2' => 'nejsp&iacute;&#353; neplatnou. Vra&#357;te se na p&#345;edchoz&iacute; str&aacute;nku a zkontrolujte zadan&eacute; &uacute;daje.',
'avis_connexion_echec_1' => 'Spojen&iacute; k serveru MySQL selhalo.',
'avis_connexion_echec_2' => 'Vra&#357;te se na p&#345;edchoz&iacute; str&aacute;nku a zkontrolujte zadan&eacute; &uacute;daje.',
'avis_connexion_echec_3' => '<b>Pozn.:</b> V mnoha p&#345;&iacute;padech mus&iacute;te nejprve <b>po&#382;&aacute;dat</b> o aktivaci p&#345;&iacute;stupu k datab&aacute;zi MySQL a teprve pot&eacute;m ji m&#367;&#382;ete pou&#382;&iacute;vat. Nem&#367;&#382;ete-li se p&#345;ipojit, zkontrolujte, zda jste tento po&#382;adavek opravdu zadali.',
'avis_connexion_ldap_echec_1' => 'Selhalo p&#345;ipojen&iacute; k serveru LDAP.',
'avis_connexion_ldap_echec_2' => 'Vra&#357;te se na p&#345;edchoz&iacute; str&aacute;nku a zkontrolujte zadan&eacute; &uacute;daje.',
[...1021 lines suppressed...]
'titre_sites_syndiques' => 'Syndikovan&eacute; weby',
'titre_sites_tous' => 'Odkazovan&eacute; weby',
'titre_suivi_petition' => 'Sledov&aacute;n&iacute; petic&iacute;',
'titre_syndication' => 'Syndikace web&#367;',
'tout_dossier_upload' => 'Cel&aacute; slo&#382;ka @upload@',
'trad_article_inexistant' => '&#268;l&aacute;nek tohoto &#269;&iacute;sla neexistuje.',
'trad_article_traduction' => 'V&#353;echny verze tohoto &#269;l&aacute;nku:',
'trad_deja_traduit' => 'Tento &#269;l&aacute;nek je ji&#382; p&#345;ekladem tohoto &#269;l&aacute;nku.',
'trad_delier' => 'Tento &#269;l&aacute;nek nad&aacute;le s p&#345;eklady nespojovat',
'trad_lier' => 'Toto je p&#345;eklad &#269;l&aacute;nku &#269;&iacute;slo:',
'trad_new' => 'Nov&#283; p&#345;elo&#382;it &#269;l&aacute;nek',


// V
'version_initiale' => 'P&#367;vodn&iacute; verze'

);


?>

--- NEW FILE: spip_cs.php3 ---
<?php

// This is a SPIP language file  --  Ceci est un fichier langue de SPIP

$GLOBALS[$GLOBALS['idx_lang']] = array(


// 0
'0_URL' => 'http://listes.rezo.net/mailman/listinfo/spip-dev',
'0_langue' => '&#268;e&#353;tina [cs]',
'0_liste' => 'spip-cs at rezo.net',
'0_mainteneur' => 'otto at pacholik.cz',


// A
'access_interface_graphique' => 'Zp&#283;t do kompletn&iacute;ho grafick&eacute;ho rozhran&iacute;',
'access_mode_texte' => 'Zobrazit jednoduch&eacute; textov&eacute; rozhran&iacute;',
'admin_debug' => 'lad&#283;n&iacute;',
'admin_modifier_article' => 'Zm&#283;nit &#269;l&aacute;nek',
'admin_modifier_auteur' => 'Zm&#283;nit autora',
'admin_modifier_breve' => 'Zm&#283;nit tuto zpr&aacute;vu',
'admin_modifier_mot' => 'Zm&#283;nit kl&iacute;&#269;ov&eacute; slovo',
'admin_modifier_rubrique' => 'Zm&#283;nit sekci',
'admin_recalculer' => 'Obnovit str&aacute;nku',
'alerte_maj_impossible' => '<b>Varov&aacute;n&iacute;!</b> Aktualizace datab&aacute;ze MySQL na verzi @version@ se nezda&#345;ilo. Je mo&#382;n&eacute;, &#382;e je to kv&#367;li probl&eacute;m&#367;m s p&#345;&iacute;stupov&yacute;mi pr&aacute;vy k datab&aacute;zi. Kontaktujte sv&eacute;ho poskytovatele p&#345;ipojen&iacute; k internetu (ISP).',
'analyse_xml' => 'XML parsov&aacute;n&iacute;',
'avis_archive_incorrect' => 'soubor nen&iacute; platn&yacute;m SPIP archivem',
'avis_archive_invalide' => 'neplatn&yacute; soubor arch&iacute;vu',
'avis_attention' => 'POZOR!',
'avis_champ_incorrect_type_objet' => 'Naplatn&yacute; n&aacute;zev pole @name@ objektu typu @type@',
'avis_colonne_inexistante' => 'Sloupec @col@ neexistuje',
'avis_echec_syndication_01' => 'Vytvo&#345;en&iacute; dat selhalo: Bu&#271; nelze &#269;&iacute;st z vybran&eacute;ho z&aacute;kladn&iacute;ho syst&eacute;mu (backend) nebo na n&#283;m nen&iacute; &#382;&aacute;dn&yacute; &#269;l&aacute;nek.',
'avis_echec_syndication_02' => 'Selhalo zpracov&aacute;n&iacute; dat: Nelze komunikovat se z&aacute;kladn&iacute;m syst&eacute;mem (backend) t&#283;chto str&aacute;nek.',
'avis_erreur' => 'Chyba: viz n&iacute;&#382;e;',
'avis_erreur_connexion' => 'Chyba p&#345;i spojen&iacute;',
'avis_erreur_cookie' => 'Probl&eacute;my se su&#353;enkou :-) (cookie)',
'avis_erreur_fonction_contexte' => 'Program&aacute;torsk&aacute; chyba. Funkce by nem&#283;la b&yacute;t v tomto kontextu vol&aacute;na.',
'avis_erreur_mysql' => 'Chyba MySQL',
'avis_erreur_sauvegarde' => 'Chyba v z&aacute;lohov&aacute;n&iacute; (@type@ @id_objet@)!',


// B
'barre_a_accent_grave' => 'Zadejte velk&eacute; A s obr&aacute;cenou &#269;&aacute;rkou (`)',
'barre_aide' => 'Vzhled str&aacute;nek (layout) dola&#271;te pomoc&iacute; typografick&yacute;ch zkratek',
'barre_aide_rac' => 'Nepou&#382;&iacute;v&aacute; se',
'barre_e_accent_aigu' => 'Zadejte p&iacute;smeno &Eacute;',
'barre_eo' => 'Zadejte p&iacute;smeno oe',
'barre_eo_maj' => 'Zadejte p&iacute;smeno EO',
'barre_euro' => 'Zadejte symbol &euro;',
'barre_gras' => 'Zadejte {{tu&#269;n&eacute; p&iacute;smo}}',
'barre_guillemets' => 'Um&iacute;st&#283;te znaky do dvojit&yacute;ch uvozovek (")',
'barre_guillemets_simples' => 'Um&iacute;st&#283;te znaky do jednoduch&yacute;ch uvozovek (?)',
'barre_intertitre' => 'Zm&#283;&#328;te na {{{podz&aacute;hlav&iacute;}}}',
'barre_italic' => 'Zadejte {kurz&iacute;vou}',
'barre_lien' => 'Zm&#283;nit na [hypertextov&yacute; odkaz->http://...]',
'barre_lien_input' => 'Zadejte c&iacute;l hypertextov&eacute;ho odkazu (adresu URL ve form&aacute;tu http://www.mysite.com nebo &#269;&iacute;slo &#269;l&aacute;nku na t&#283;chto str&aacute;nk&aacute;ch).',
'barre_note' => 'Zm&#283;nit na [[pozn&aacute;mku pod &#269;arou]]',
'barre_quote' => '<quote>Citovat zpr&aacute;vu</quote>',
'bouton_ajouter_document' => 'P&#344;IDAT DOKUMENT',
'bouton_ajouter_image' => 'P&#344;IDAT OBR&Aacute;ZEK',
'bouton_changer' => 'Zm&#283;nit',
'bouton_chercher' => 'Naj&iacute;t',
'bouton_choisir' => 'Vybrat',
'bouton_enregistrer' => 'Ulo&#382;it',
'bouton_radio_desactiver_messagerie_interne' => 'Vypnout intern&iacute; hl&aacute;&#353;en&iacute;',
'bouton_radio_envoi_annonces' => 'Zaslat editorsk&aacute; ozn&aacute;men&iacute;',
'bouton_radio_non_envoi_annonces' => 'Nezas&iacute;lat &#382;&aacute;dn&aacute; ozn&aacute;men&iacute;',
'bouton_radio_non_envoi_liste_nouveautes' => 'Nezas&iacute;lat seznam nejnov&#283;j&#353;&iacute;ch zpr&aacute;v',
'bouton_recharger_page' => 'znovu na&#269;&iacute;st tuto str&aacute;nku',
'bouton_telecharger' => 'Odeslat',
'bouton_valider' => 'Odeslat',


// C
'cal_apresmidi' => 'odpoledne',
'cal_jour_entier' => 'cel&yacute; den',
'cal_matin' => 'dopoledne',
'cal_par_jour' => 'zobrazen&iacute; jednotliv&yacute;ch dn&#367;',
'cal_par_mois' => 'zobrazen&iacute; cel&eacute;ho m&#283;s&iacute;ce',
'cal_par_semaine' => 'zobrazen&iacute; cel&yacute;ch t&yacute;dn&#367;',
'confirm_changer_statut' => 'Je nutn&eacute; potvrzen&iacute; akce: Po&#382;&aacute;dali jste o zm&#283;nu stavu &#269;l&aacute;nku. Chcete pokra&#269;ovat?',


// D
'date_aujourdhui' => 'dnes',
'date_avant_jc' => 'p&#345;. n. l.',
'date_dans' => 'b&#283;hem @delai@',
'date_de_mois_1' => '@j@ ledna',
'date_de_mois_10' => '@j@ &#345;&iacute;jna',
'date_de_mois_11' => '@j@ listopadu',
'date_de_mois_12' => '@j@ prosince',
'date_de_mois_2' => '@j@ &uacute;nora',
'date_de_mois_3' => '@j@ b&#345;ezna',
'date_de_mois_4' => '@j@ dubna',
'date_de_mois_5' => '@j@ kv&#283;tna',
'date_de_mois_6' => '@j@ &#269;ervna',
'date_de_mois_7' => '@j@ &#269;ervence',
'date_de_mois_8' => '@j@ srpna',
'date_de_mois_9' => '@j@ z&aacute;&#345;&iacute;',
'date_demain' => 'z&iacute;tra',
'date_fmt_heures_minutes' => '@h at h@m at min',
'date_fmt_jour_heure' => '@jour@ a @heure@',
'date_fmt_jour_mois' => '@jourmois@',
'date_fmt_jour_mois_annee' => '@jourmois@ @annee@',
'date_fmt_mois_annee' => '@nommois@ @annee@',
'date_fmt_nomjour_date' => '@date@ @nomjour@',
'date_heures' => 'hodin',
'date_hier' => 'v&#269;era',
'date_il_y_a' => 'p&#345;ed @delai@',
'date_jnum1' => '1.',
'date_jnum10' => '10.',
'date_jnum11' => '11.',
'date_jnum12' => '12.',
'date_jnum13' => '13.',
'date_jnum14' => '14.',
'date_jnum15' => '15.',
'date_jnum16' => '16.',
'date_jnum17' => '17.',
'date_jnum18' => '18.',
'date_jnum19' => '19.',
'date_jnum2' => '2.',
'date_jnum20' => '20.',
'date_jnum21' => '21.',
'date_jnum22' => '22.',
'date_jnum23' => '23.',
'date_jnum24' => '24.',
'date_jnum25' => '25.',
'date_jnum26' => '26.',
'date_jnum27' => '27.',
'date_jnum28' => '28.',
'date_jnum29' => '29.',
'date_jnum3' => '3.',
'date_jnum30' => '30.',
'date_jnum31' => '31.',
'date_jnum4' => '4.',
'date_jnum5' => '5.',
'date_jnum6' => '6.',
'date_jnum7' => '7.',
'date_jnum8' => '8.',
'date_jnum9' => '9.',
'date_jour_1' => 'ned&#283;le',
'date_jour_2' => 'pond&#283;l&iacute;',
'date_jour_3' => '&uacute;ter&yacute;',
'date_jour_4' => 'st&#345;eda',
'date_jour_5' => '&#269;tvrtek',
'date_jour_6' => 'p&aacute;tek',
'date_jour_7' => 'sobota',
'date_jours' => 'dn&#367;',
'date_minutes' => 'minut',
'date_mois' => 'm&#283;s&iacute;c&#367;',
'date_mois_1' => 'Leden',
'date_mois_10' => '&#344;&iacute;jen',
'date_mois_11' => 'Listopad',
'date_mois_12' => 'Prosinec',
'date_mois_2' => '&Uacute;nor',
'date_mois_3' => 'B&#345;ezen',
'date_mois_4' => 'Duben',
'date_mois_5' => 'Kv&#283;ten',
'date_mois_6' => '&#268;erven',
'date_mois_7' => '&#268;ervenec',
'date_mois_8' => 'Srpen',
'date_mois_9' => 'Z&aacute;&#345;&iacute;',
'date_saison_1' => 'zima',
'date_saison_2' => 'jaro',
'date_saison_3' => 'l&eacute;to',
'date_saison_4' => 'podzim',
'date_semaines' => 't&yacute;dn&#367;',
'dirs_commencer' => 'pro vlastn&iacute; zah&aacute;jen&iacute; instalace',
'dirs_preliminaire' => 'P&#345;edb&#283;&#382;n&aacute; akce: <b>Nastaven&iacute; p&#345;&iacute;stupov&yacute;ch pr&aacute;v</b>',
'dirs_probleme_droits' => 'Probl&eacute;m s p&#345;&iacute;stupov&yacute;mi pr&aacute;vy',
'dirs_repertoires_absents' => '<b>Nebyl nalezen adres&aacute;&#345;, resp. adres&aacute;&#345;e: <ul>@bad_dirs at .</ul> </b>
  <p />M&#367;&#382;e to b&yacute;t kv&#367;li nespr&aacute;vn&eacute;mu zad&aacute;n&iacute; velk&yacute;ch a mal&yacute;ch p&iacute;smen.
  Zkontrolujte, zda mal&aacute; a velk&aacute; p&iacute;smena uveden&eacute;ho adres&aacute;&#345;e, resp. adres&aacute;&#345;&#367; souhlas&iacute; s t&iacute;m,
  co je uvedeno v&yacute;&#353;e. Pokud ne, p&#345;ejmenujte adres&aacute;&#345;e pomoc&iacute; klienta programu FTP. T&iacute;m chybu oprav&iacute;te.
  <p />Pot&eacute; m&#367;&#382;ete',
'dirs_repertoires_suivants' => '<b>K n&aacute;sleduj&iacute;c&iacute;mu adres&aacute;&#345;i, resp. adres&aacute;&#345;&#367;m chyb&iacute; pr&aacute;vo z&aacute;pisu: <ul>@bad_dirs at .</ul> </b>

  <p />Zm&#283;&#328;te tato pr&aacute;va pomoc&iacute; klienta FTP a nastavte pr&aacute;va p&#345;&iacute;stupu jednotliv&yacute;ch adres&aacute;&#345;&#367;

  Podrobn&yacute; popis je v n&aacute;vodu k instalaci.

  <p />Pot&eacute; m&#367;&#382;ete ',


// E
'entree_dimensions' => 'Velikost:',
'entree_titre_document' => 'N&aacute;zev dokumentu:',
'entree_titre_image' => 'N&aacute;zev obr&aacute;zku:',
'envoi_via_le_site' => 'Odeslat pomoc&iacute; webu',


// F
'fichier_introuvable' => 'Nalezen nov&yacute; soubor: @fichier@',
'form_deja_inscrit' => 'U&#382; jste zaregistrov&aacute;ni.',
'form_email_non_valide' => 'Neplatn&aacute; elektronick&aacute; adresa.',
'form_forum_access_refuse' => 'K tomuto webu ji&#382; nem&aacute;te p&#345;&iacute;stup.',
'form_forum_bonjour' => 'Dobr&yacute; den @nom@,',
'form_forum_email_deja_enregistre' => 'Tato elektronick&aacute; adresa je ji&#382; zaregistrov&aacute;na. M&#367;&#382;ete tedy pou&#382;&iacute;vat sv&eacute; obvykl&eacute; heslo.',
'form_forum_identifiant_mail' => 'Nov&eacute; identifika&#269;n&iacute; &uacute;daje v&aacute;m byly odesl&aacute;ny elektronickou po&#353;tou.',
'form_forum_identifiants' => 'Osobn&iacute; identifika&#269;n&iacute; &uacute;daje',
'form_forum_indiquer_nom_email' => 'Zadejte jm&eacute;no a elektronickou adresu. Osobn&iacute; identifika&#269;n&iacute; &uacute;daje obdr&#382;&iacute;te v brzk&eacute; dob&#283; elektronickou po&#353;tou.',
'form_forum_login' => 'Login:',
'form_forum_message_auto' => '(toto je automatick&aacute; zpr&aacute;va)',
'form_forum_pass' => 'Heslo:',
'form_forum_probleme_mail' => 'Probl&eacute;my s elektronickou po&#353;tou: Odesl&aacute;n&iacute; identifika&#269;n&iacute;ch &uacute;daj&#367; se nezda&#345;ilo.',
'form_forum_voici1' => 'Zde jsou identifika&#269;n&iacute; &uacute;daje umo&#382;&#328;uj&iacute;c&iacute; &uacute;&#269;ast na aktivit&aacute;ch tohoto webu
"@nom_site_spip@" (@adresse_site@):',
'form_forum_voici2' => 'Zde jsou identifika&#269;n&iacute; &uacute;daje, kter&eacute; v&aacute;m umo&#382;n&iacute; publikovat &#269;l&aacute;nky
na webu "@nom_site_spip@" (@adresse_login@):',
'form_indiquer_email' => 'Zadejte sv&#367;j e-mail.',
'form_indiquer_nom' => 'Zadejte sv&eacute; jm&eacute;no.',
'form_indiquer_nom_site' => 'Zadejte n&aacute;zev sv&eacute;ho webu.',
'form_pet_adresse_site' => 'Zadejte adresu URL sv&eacute;ho webu',
'form_pet_aucune_signature' => 'Tomuto k&oacute;du neodpov&iacute;d&aacute; &#382;&aacute;dn&yacute; podpis...',
'form_pet_confirmation' => 'Potvr&#271;te sv&#367;j podpis:',
'form_pet_deja_enregistre' => 'Tento web je ji&#382; zaregistrov&aacute;n',
'form_pet_deja_signe' => 'Tento text jste ji&#382; podepsali.',
'form_pet_envoi_mail_confirmation' => 'Byla v&aacute;m zasl&aacute;na elektronick&aacute; zpr&aacute;va s potvrzen&iacute;m. Platnost podpisu ov&#283;&#345;&iacute;te na adrese URL, kter&aacute; je v t&eacute;to zpr&aacute;v&#283; uvedena.',
'form_pet_mail_confirmation' => '<MODIF>Dobr&yacute; den,

Rozhodli jste se podepsat petici:
@titre at .

Uvedli jste n&aacute;sleduj&iacute;c&iacute; &uacute;daje:
    Jm&eacute;no: @nom_email@
    Web: @nom_site@ - @url_site@

D&#366;LE&#381;IT&Eacute; UPOZORN&#282;N&Iacute;...
Platnost sv&eacute;ho podpisu ov&#283;&#345;&iacute;te p&#345;echodem
na n&iacute;&#382;e uvedenou adresu (jinak bude v&aacute;&#353; po&#382;adavek
zam&iacute;tnut):
    @url@

D&#283;kujeme v&aacute;m za &uacute;&#269;ast
',
'form_pet_message_commentaire' => 'Chcete n&aacute;m n&#283;co sd&#283;lit nebo m&aacute;te n&#283;jak&eacute; p&#345;ipom&iacute;nky?',
'form_pet_nom_site2' => 'N&aacute;zev va&#353;eho webu',
'form_pet_probleme_technique' => 'Z technick&yacute;ch d&#367;vod&#367; nelze moment&aacute;ln&#283; podepisovat.',
'form_pet_signature_pasprise' => 'V&aacute;&#353; podpis nebyl zohledn&#283;n.',
'form_pet_signature_validee' => 'V&aacute;&#353; podpis je platn&yacute;. D&#283;kujeme v&aacute;m!',
'form_pet_site_deja_enregistre' => 'Tento web je ji&#382; zaregistrov&aacute;n',
'form_pet_url_invalide' => 'Zadali jste neplatnou adresu URL.',
'form_pet_votre_email' => 'Nov&aacute; elektronick&aacute; adresa',
'form_pet_votre_nom' => 'Jm&eacute;no nebo p&#345;ezd&iacute;vka (alias)',
'form_pet_votre_site' => 'M&aacute;te-li web, m&#367;&#382;ete d&aacute;le zadat jeho adresu',
'form_prop_confirmer_envoi' => 'Potvr&#271;te odesl&aacute;n&iacute;',
'form_prop_description' => 'Popis/pozn&aacute;mka',
'form_prop_enregistre' => 'V&aacute;&#353; n&aacute;vrh byl zaregistrov&aacute;n. Po kontrole spr&aacute;vci tohoto webu bude zv&#283;&#345;ejn&#283;n online.',
'form_prop_envoyer' => 'Odeslat zpr&aacute;vu',
'form_prop_indiquer_email' => 'Zadejte platnou elektronickou adresu',
'form_prop_indiquer_nom_site' => 'Zadejte n&aacute;zev webu.',
'form_prop_indiquer_sujet' => 'Zadejte p&#345;edm&#283;t',
'form_prop_message_envoye' => 'Zpr&aacute;va byla odesl&aacute;na',
'form_prop_nom_site' => 'N&aacute;zev webu',
'form_prop_non_enregistre' => 'V&aacute;&#353; n&aacute;vrh byl zaznamen&aacute;n.',
'form_prop_sujet' => 'P&#345;edm&#283;t',
'form_prop_url_site' => 'Adresa URL webu',
'forum_acces_refuse' => 'K t&#283;mto diskusn&iacute;m skupin&aacute;m ji&#382; nem&aacute;te p&#345;&iacute;stup.',
'forum_attention_dix_caracteres' => '<b>Varov&aacute;n&iacute;!</b> Zpr&aacute;va mus&iacute; obsahovat minim&aacute;ln&#283; deset znak&#367;.',
'forum_attention_trois_caracteres' => '<b>Varov&aacute;n&iacute;!</b> N&aacute;zev mus&iacute; obsahovat minim&aacute;ln&#283; deset znak&#367;.',
'forum_avez_selectionne' => 'Zvolili jste:',
'forum_cliquer_retour' => 'Pokra&#269;ujte klepnut&iacute;m <a href=\'@retour_forum@\'>na tento odkaz</a>.',
'forum_forum' => 'diskusn&iacute; skupina',
'forum_info_modere' => 'Tato diskusn&iacute; skupina je moderovan&aacute;: va&#353;e p&#345;&iacute;sp&#283;vky se zobraz&iacute; a&#382; po schv&aacute;len&iacute; spr&aacute;vcem tohoto webu.',
'forum_lien_hyper' => '<b>Hypertextov&yacute; odkaz</b> (voliteln&eacute;)',
'forum_message_definitif' => 'Z&aacute;v&#283;re&#269;n&aacute; zpr&aacute;va: odesl&aacute;no na web',
'forum_message_trop_long' => 'Zpr&aacute;va je p&#345;&iacute;li&#353; dlouh&aacute;. Maximum je 20.000 znak&#367;.',
'forum_ne_repondez_pas' => 'Neodpov&iacute;dejte na tuto zpr&aacute;vu. Odpov&#283;&#271; zve&#345;ejn&#283;te v r&aacute;mci skupiny na adrese:',
'forum_non_inscrit' => 'Bu&#271; nejste zaregistrov&aacute;ni nebo jste zadali nespr&aacute;vnou adresu &#269;i heslo.',
'forum_page_url' => '(T&yacute;k&aacute;-li se zpr&aacute;va &#269;l&aacute;nku zve&#345;ejn&#283;n&eacute;ho na webu nebo str&aacute;nky s dopl&#328;uj&iacute;c&iacute;mi informacemi, zadejte d&aacute;le n&aacute;zev str&aacute;nky a jej&iacute; adresu).',
'forum_par_auteur' => 'Autor: @auteur@',
'forum_poste_par' => 'Zpr&aacute;va od posted at parauteur@ na z&aacute;klad&#283; va&#353;eho &#269;l&aacute;nku.',
'forum_probleme_database' => 'Kv&#367;li probl&eacute;m&#367;m s datab&aacute;z&iacute; nebylo mo&#382;n&eacute; va&#353;i zpr&aacute;vu zaznamenat.',
'forum_qui_etes_vous' => '<b>Kdo jste?</b> (voliteln&eacute;)',
'forum_texte' => 'Text zpr&aacute;vy:',
'forum_titre' => 'P&#345;edm&#283;t:',
'forum_titre_erreur' => 'Chyba...',
'forum_url' => 'Adresa URL:',
'forum_valider' => 'Potvrdit v&yacute;b&#283;r',
'forum_voir_avant' => 'P&#345;ed odesl&aacute;n&iacute;m zpr&aacute;vu zobrazit',
'forum_votre_email' => 'V&aacute;&#353; e-mail:',
'forum_votre_nom' => 'Va&#353;e jm&eacute;no (resp. p&#345;ezd&iacute;vka):',
'forum_vous_enregistrer' => 'T&eacute;to diskusn&iacute; skupiny se m&#367;&#382;ete &uacute;&#269;astnit
  a&#382; po zaregistrov&aacute;n&iacute;. D&#283;kujeme v&aacute;m
  za zad&aacute;n&iacute; identifika&#269;n&iacute;ch &uacute;daj&#367;.
  Nejste-li doposud zaregistrov&aacute;ni, mus&iacute;te ',
'forum_vous_inscrire' => 'tak u&#269;init nyn&iacute;.',


// I
'ical_texte_rss_articles' => 'Adresa souboru na serveru (backend) &#269;l&aacute;nk&#367; na webu je:',
'ical_texte_rss_articles2' => 'M&#367;&#382;ete z&iacute;skat i serverov&eacute; soubory k &#269;l&aacute;nk&#367;m z jednotliv&yacute;ch sekc&iacute; webu:',
'ical_texte_rss_breves' => 'D&aacute;le existuje soubor obsahuj&iacute;c&iacute; novinky z webu. Zad&aacute;n&iacute;m &#269;&iacute;sla sekce z&iacute;sk&aacute;te pouze novinky t&yacute;kaj&iacute;c&iacute; se dan&eacute; sekce.',
'icone_a_suivre' => 'Hlavn&iacute; nab&iacute;dka',
'icone_admin_site' => 'Spr&aacute;va webu',
'icone_agenda' => 'Kalend&aacute;&#345;',
'icone_aide_ligne' => 'N&aacute;pov&#283;da',
'icone_articles' => '&#268;l&aacute;nky',
'icone_auteurs' => 'Auto&#345;i',
'icone_breves' => 'Novinky',
'icone_brouteur' => 'Rychl&eacute; proch&aacute;zen&iacute;',
'icone_configuration_site' => 'Nastaven&iacute;',
'icone_configurer_site' => 'Nastavte sv&#367;j web',
'icone_creer_mot_cle' => 'Zadejte nov&eacute; kl&iacute;&#269;ov&eacute; slovo a spojte jej s t&iacute;mto &#269;l&aacute;nkem',
'icone_creer_nouvel_auteur' => 'Vytvo&#345;it nov&eacute;ho autora',
'icone_creer_rubrique' => 'Vytvo&#345;it sekci',
'icone_creer_sous_rubrique' => 'Vytvo&#345;it podsekci',
'icone_deconnecter' => 'Odhl&aacute;sit',
'icone_discussions' => 'Diskuse',
'icone_doc_rubrique' => 'Dokumenty v p&#345;&iacute;loze',
'icone_ecrire_article' => 'Napsat nov&yacute; &#269;l&aacute;nek',
'icone_edition_site' => 'Editovat web',
'icone_forum_administrateur' => 'Diskusn&iacute; skupina spr&aacute;vc&#367;',
'icone_forum_suivi' => 'Navazuj&iacute;c&iacute; zpr&aacute;vy diskusn&iacute; skupiny',
'icone_gestion_langues' => 'Spr&aacute;va jazyk&#367;',
'icone_informations_personnelles' => 'Osobn&iacute; &uacute;daje',
'icone_interface_complet' => '&Uacute;pln&eacute; rozhran&iacute;',
'icone_interface_simple' => 'Jednoduch&eacute; rozhran&iacute;',
'icone_maintenance_site' => '&Uacute;dr&#382;ba webu',
'icone_messagerie_personnelle' => 'Osobn&iacute; zpr&aacute;vy',
'icone_mots_cles' => 'Kl&iacute;&#269;ov&aacute; slova',
'icone_nouvelle_breve' => 'Napsat novinku',
'icone_repartition_actuelle' => 'Zobrazit aktu&aacute;ln&iacute; rozd&#283;len&iacute;',
'icone_repartition_debut' => 'Zobrazit rozd&#283;len&iacute; od po&#269;&aacute;tku',
'icone_repartition_visites' => 'Rozd&#283;len&iacute; n&aacute;v&#353;t&#283;v',
'icone_rubriques' => 'Sekce',
'icone_sauver_site' => 'Ulo&#382;en&iacute; webu',
'icone_site_entier' => 'V&#353;echny str&aacute;nky',
'icone_sites_references' => 'Str&aacute;nky na n&#283;&#382; existuj&iacute; odkazy',
'icone_statistiques' => 'Statistiky str&aacute;nek',
'icone_statistiques_visites' => 'Statistiky',
'icone_suivi_activite' => 'Sledov&aacute;n&iacute; aktivity webu',
'icone_suivi_actualite' => 'Statistiky str&aacute;nek',
'icone_suivi_forums' => 'Spr&aacute;va diskusn&iacute;ch skupin',
'icone_suivi_pettions' => 'Spr&aacute;va petic&iacute;',
'icone_suivi_revisions' => 'Revize &#269;l&aacute;nk&#367;',
'icone_supprimer_document' => 'Odstranit dokument',
'icone_supprimer_image' => 'Odstranit obr&aacute;zek',
'icone_supprimer_message' => 'Ostranit zpr&aacute;vu',
'icone_tous_articles' => 'V&#353;echny va&#353;e &#269;l&aacute;nky',
'icone_tous_auteur' => 'V&#353;ichni auto&#345;i',
'icone_valider_message' => 'Schv&aacute;lit zpr&aacute;vu',
'icone_visiter_site' => 'Zobrazit web',
'icone_voir_en_ligne' => 'Prohl&iacute;&#382;et online',
'image_tourner_180' => 'Oto&#269;it o 180&deg;',
'image_tourner_droite' => 'Oto&#269;it o 90&deg; doprava',
'image_tourner_gauche' => 'Oto&#269;it o 90&deg; doleva',
'img_indisponible' => 'Obr&aacute;zek nen&iacute; k dispozici',
'info_a_suivre' => 'HLAVN&Iacute; NAB&Iacute;DKA"',
'info_a_valider' => '[ke schv&aacute;len&iacute;]',
'info_acces_interdit' => 'P&#345;&iacute;stup zak&aacute;z&aacute;n',
'info_acces_refuse' => 'P&#345;&iacute;stup odep&#345;en',
'info_action' => 'Akce: @action@',
'info_administrer_rubriques' => 'M&#367;&#382;ete prov&aacute;d&#283;t &uacute;dr&#382;bu t&eacute;to sekce a jej&iacute;ch podsekc&iacute;',
'info_adresse_non_indiquee' => 'Nezadali jste, kter&aacute; adresa se m&aacute; otestovat!',
'info_aide' => 'N&Aacute;POV&#282;DA:',
'info_ajouter_mot' => 'P&#345;idat kl&iacute;&#269;ov&eacute; slovo',
'info_annonce' => 'OZN&Aacute;MEN&Iacute;',
'info_annonces_generales' => 'Obecn&aacute; ozn&aacute;men&iacute;:',
'info_article_propose' => '&#268;l&aacute;nek byl odesl&aacute;n',
'info_article_publie' => '&#268;l&aacute;nek byl zve&#345;ejn&#283;n',
'info_article_redaction' => '&#268;l&aacute;nky ve zpracov&aacute;n&iacute;',
'info_article_refuse' => 'Odm&iacute;tnut&eacute; &#269;l&aacute;nky',
'info_article_supprime' => 'Odstran&#283;n&eacute; &#269;l&aacute;nky',
'info_articles' => '&#268;l&aacute;nky',
'info_articles_a_valider' => '&#268;l&aacute;nky ke schv&aacute;len&iacute;',
'info_articles_proposes' => 'P&#345;edlo&#382;en&eacute; &#269;l&aacute;nky',
'info_auteurs_nombre' => 'Autor &#269;i auto&#345;i:',
'info_authentification_ftp' => 'Autentifikace (pomoc&iacute; FTP).',
'info_bloquer_lien' => 'zablokovat tento odkaz',
'info_breves_02' => 'Novinky',
'info_breves_2' => 'novinky',
'info_breves_valider' => 'Novinky ke schv&aacute;len&iacute;',
'info_connexion_refusee' => 'Spojen&iacute; bylo odep&#345;eno',
'info_contact_developpeur' => 'Kontaktujte v&yacute;voj&aacute;&#345;e.',
'info_contenance' => 'Tyto str&aacute;nky obsahuj&iacute;:',
'info_contribution' => 'p&#345;&iacute;sp&#283;vky do diskusn&iacute; skupiny',
'info_copyright' => '@spip@ je freeware distribuovan&yacute; @lien_gpl at .',
'info_copyright_doc' => 'Bli&#382;&#353;&iacute; informace viz <a href=\'http://www.spip.net/en\'>http://www.spip.net/en</a>.',
'info_copyright_gpl' => 'v r&aacute;mci licence GPL',
'info_cours_edition' => 'Va&#353;e rozpracovan&eacute; &#269;l&aacute;nky',
'info_creer_repertoire' => 'Vytvo&#345;te soubor nebo adres&aacute;&#345; s n&aacute;zvem:',
'info_creer_repertoire_2' => 'v podadres&aacute;&#345;i <b>@repertoire@</b>. Potom',
'info_creer_vignette' => 'automatick&eacute; vytvo&#345;en&iacute; n&aacute;hledu',
'info_deplier' => 'Rozbalit',
'info_descriptif_nombre' => 'Popis:',
'info_description' => 'Popis:',
'info_description_2' => 'Popis:',
'info_dimension' => 'Velikost:',
'info_document' => 'Dokument',
'info_documents' => 'Dokumenty',
'info_echange_message' => 'Syst&eacute;m SPIP umo&#382;&#328;uje v&yacute;m&#283;nu zpr&aacute;v a vytv&aacute;&#345;en&iacute; soukrom&yacute;ch
  diskusn&iacute;ch skupin pro &uacute;&#269;astn&iacute;ky webu. Tuto funkci m&#367;&#382;ete
  zapnout nebo vypnout.',
'info_ecire_message_prive' => 'Napsat soukromou zpr&aacute;vu',
'info_email_invalide' => 'Neplatn&yacute; e-mail.',
'info_en_cours_validation' => 'Va&#353;e rozpracovan&eacute; &#269;l&aacute;nky',
'info_en_ligne' => 'Nyn&iacute; online:',
'info_envoyer_message_prive' => 'Odeslat soukromou zpr&aacute;vu tomuto autorovi',
'info_erreur_requete' => 'Chyba p&#345;i datab&aacute;zov&eacute;m dotazu:',
'info_erreur_squelette2' => 'Neexistuj&iacute;c&iacute; &#353;ablona <b>@fichier@</b>...',
'info_erreur_systeme' => 'Syst&eacute;mov&aacute; chyba (&#269;&iacute;slo: @errsys@)',
'info_erreur_systeme2' => 'Pevn&yacute; disk m&#367;&#382;e b&yacute;t pln&yacute; nebo m&#367;&#382;e b&yacute;t po&#353;kozen. <br>
 <font color=\'red\'>Zkuste <a href=\'@script@\'>opravit datab&aacute;zi</a>,
 nebo kontaktujte sv&eacute;ho poskytovatele prostoru pro web.</font>',
'info_fini' => 'Hotovo!',
'info_format_image' => 'Form&aacute;t obr&aacute;zku pro tvorbu n&aacute;hled&#367;: @gd_formats at .',
'info_format_non_defini' => 'form&aacute;t nen&iacute; definov&aacute;n',
'info_grand_ecran' => 'Velk&eacute; zobrazen&iacute;',
'info_image_aide' => 'N&Aacute;POV&#282;DA',
'info_image_process_titre' => 'N&aacute;vod k vytvo&#345;en&iacute; n&aacute;hled&#367;',
'info_impossible_lire_page' => '<B>Chyba!</b> Str&aacute;nku nelze &#269;&iacute;st <tt><html>@test_proxy@</html></tt> p&#345;es proxy br&aacute;nu <tt>',
'info_inclusion_directe' => 'P&#345;&iacute;m&eacute; vlo&#382;en&iacute;:',
'info_inclusion_vignette' => 'Vlo&#382;it n&aacute;hled:',
'info_installation_systeme_publication' => 'Instalace publika&#269;n&iacute;ho syst&eacute;mu ...',
'info_installer_documents' => 'V&#353;echny dokumenty ve slo&#382;ce @upload@ lze nainstalovat automaticky.',
'info_installer_ftp' => 'Jako spr&aacute;vce m&#367;&#382;ete instalovat (pomoc&iacute; FTP) soubory do slo&#382;ky @upload@ a n&aacute;sledn&#283; je odtamtud m&#367;&#382;ete p&#345;&iacute;mo vyb&iacute;rat.',
'info_installer_images' => 'Obr&aacute;zky lze instalovat ve form&aacute;tu JPEG, GIF a PNG.',
'info_installer_images_dossier' => 'Nainstalujte obr&aacute;zky do slo&#382;ky @upload@, abyste je odtamtud mohli vyb&iacute;rat.',
'info_installer_tous_documents' => 'Instalovat v&#353;echny dokumenty',
'info_interface_complete' => '&uacute;pln&eacute; rozhran&iacute;',
'info_interface_simple' => 'jednoduch&eacute; rozhran&iacute;',
'info_joindre_document_article' => 'K &#269;l&aacute;nku lze p&#345;ipojit dokumenty ve form&aacute;tu',
'info_joindre_document_rubrique' => 'K t&eacute;to sekci m&#367;&#382;ete p&#345;id&aacute;vat dokumenty ve form&aacute;tu',
'info_joindre_documents_article' => 'K &#269;l&aacute;nku m&#367;&#382;ete p&#345;id&aacute;vat dokumenty ve form&aacute;tu:',
'info_l_article' => '&#269;l&aacute;nek',
'info_la_breve' => 'novinka',
'info_la_rubrique' => 'sekce',
'info_langue_principale' => 'Hlavn&iacute; jazyk str&aacute;nek',
'info_largeur_vignette' => '@largeur_vignette@ &times; @hauteur_vignette@ pixel&#367;',
'info_les_auteurs_1' => 'od @les_auteurs@',
'info_logo_format_interdit' => 'Loga jsou povolena pouze ve form&aacute;tu @formats at .',
'info_logo_max_poids' => 'Log nesm&iacute; b&yacute;t v&#283;t&#353;&iacute; ne&#382; @maxi@ (tento soubor m&aacute; velikost @actuel@).',
'info_logo_max_taille' => 'Logo nesm&iacute; b&yacute;t v&#283;t&#353;&iacute; ne&#382; @maxi@ (tento soubor m&aacute; velikost @actuel@).',
'info_mail_fournisseur' => 'you at isp.com',
'info_message_2' => 'ZPR&Aacute;VA',
'info_message_supprime' => 'ZPR&Aacute;VA BYLA ODSTRAN&#282;NA',
'info_mise_en_ligne' => 'Datum zve&#345;ejn&#283;n&iacute; online:',
'info_modification_parametres_securite' => '&uacute;prava bezpe&#269;nostn&iacute;ch parametr&#367;',
'info_mois_courant' => 'V m&#283;s&iacute;ci:',
'info_mot_cle_ajoute' => 'Bylo p&#345;id&aacute;no toto kl&iacute;&#269;ov&eacute; slovo',
'info_multi_herit' => 'V&yacute;choz&iacute; jazyk',
'info_multi_langues_soulignees' => 'Jazyky <u>zobrazen&eacute; podtr&#382;en&#283;</u> maj&iacute; p&#345;elo&#382;eno cel&eacute; rozhran&iacute;. Pokue je zvol&iacute;te, bude automaticky p&#345;elo&#382;ena cel&aacute; &#345;ada polo&#382;ek ve&#345;ejn&yacute;ch str&aacute;neki(data, formul&aacute;&#345;e). U jazyk&#367;, kter&eacute; nejsou podtr&#382;eny, budou tyto polo&#382;ky zobrazeny v hlavn&iacute;m jazyce str&aacute;nek.',
'info_multilinguisme' => 'V&iacute;cejazy&#269;n&eacute;',
'info_nom_non_utilisateurs_connectes' => 'Va&#353;e jm&eacute;no nen&iacute; uvedeno na seznamu p&#345;ipojen&yacute;ch u&#382;ivatel&#367;.',
'info_nom_utilisateurs_connectes' => 'Va&#353;e jm&eacute;no je uvedeno na seznamu p&#345;ipojen&yacute;ch u&#382;ivatel&#367;.',
'info_nombre_en_ligne' => 'Aktu&aacute;ln&#283; online:',
'info_non_resultat' => '&#377;&aacute;dn&eacute; v&yacute;sledky pro "@cherche_mot@"',
'info_non_utilisation_messagerie' => 'Nepou&#382;&iacute;v&aacute;te syst&eacute;m pro intern&iacute; zas&iacute;l&aacute;n&iacute; zpr&aacute;v v r&aacute;mci t&#283;chto str&aacute;nek.',
'info_nouveau_message' => 'M&Aacute;TE NOVOU ZPR&Aacute;VU',
'info_nouveaux_messages' => 'M&Aacute;TE CELKEM @total_messages@ NOV&Yacute;CH ZPR&Aacute;V',
'info_numero_abbreviation' => '&#269;.',
'info_panne_site_syndique' => 'Syndikovan&yacute; web nefunguje',
'info_pense_bete' => 'POZN&Aacute;MKA',
'info_petit_ecran' => 'Mal&yacute; displej',
'info_pixels' => 'pixel&#367;',
'info_plusieurs_mots_trouves' => 'Pro "@cherche_mot@" bylo nalezeno n&#283;kolik kl&iacute;&#269;ov&yacute;ch slov:',
'info_popularite_5' => 'obl&iacute;benost:',
'info_portfolio' => 'Portfolio',
'info_portfolio_automatique' => 'Automatizovan&eacute; portfolio:',
'info_premier_resultat' => '[@debut_limit@ prvn&iacute;ch v&yacute;sledk&#367; z @total@]',
'info_premier_resultat_sur' => '[@debut_limit@ prvn&iacute;ch v&yacute;sledk&#367; z @total@]',
'info_probleme_grave' => 'chyba',
'info_propose_1' => '[@nom_site_spip@] P&#345;edlo&#382;eno: @titre@',
'info_propose_2' => 'P&#345;edlo&#382;en &#269;l&aacute;nek
-----------------',
'info_propose_3' => '&#268;l&aacute;nek "@titre@" byl p&#345;edlo&#382;en ke zve&#345;ejn&#283;n&iacute;.',
'info_propose_4' => 'Pros&iacute;m, p&#345;e&#269;t&#283;te si jej a sd&#283;lte sv&#367;j n&aacute;zor',
'info_propose_5' => 'v diskusn&iacute; skupin&#283;, na n&iacute;&#382; navazuje. Je k dispozici na adrese:',
'info_publie_01' => '&#268;l&aacute;nek "@titre@" byl schv&aacute;len @connect_nom at .',
'info_publie_1' => '[@nom_site_spip@] ZVE&#344;EJN&#282;NO: @titre@',
'info_publie_2' => 'Zve&#345;ejn&#283;n&yacute; &#269;l&aacute;nek
-----------------',
'info_rechercher' => 'Naj&iacute;t',
'info_rechercher_02' => 'Naj&iacute;t:',
'info_remplacer_vignette' => 'Nahradit standardn&iacute; n&aacute;hled vlastn&iacute;m logem:',
'info_retablir_lien' => 'obnovit tento odkaz',
'info_retirer_mot' => 'Odstranit toto kl&iacute;&#269;ov&eacute; slovo',
'info_retirer_mots' => 'Odstranit v&#353;echna kl&iacute;&#269;ov&aacute; slova',
'info_sans_titre_2' => 'bez n&aacute;zvu',
'info_selectionner_fichier' => 'M&#367;&#382;ete vybrat soubor ze slo&#382;ky @upload@',
'info_selectionner_fichier_2' => 'Vybrat soubor:',
'info_site_attente' => 'Web &#269;ek&aacute; na schv&aacute;len&iacute;',
'info_site_reference' => 'Web odkazovan&yacute; online',
'info_site_refuse' => 'Web byl odm&iacute;tnut',
'info_sites_referencer' => 'Zadat odkaz na web',
'info_supprimer_vignette' => 'odstranit n&aacute;hled',
'info_symbole_bleu' => '<B>Modr&yacute;m</B> symbolem je ozna&#269;ena <B>intern&iacute; pozn&aacute;mka</B>, tj. zpr&aacute;va ur&#269;en&aacute; pro osobn&iacute; pot&#345;ebu.',
'info_symbole_jaune' => '<B>&#381;lut&yacute;m</B> symbolem je ozna&#269;ena <B>zpr&aacute;va pro v&#353;echny redaktory</B>: m&#367;&#382;e ji upravovat kter&yacute;koli ze spr&aacute;vc&#367; a zobrazuje se v&#353;em redaktor&#367;m.',
'info_symbole_vert' => '<B>Zelen&yacute;m</B> symbolem jsou ozna&#269;eny <B>zpr&aacute;vy vym&#283;&#328;ovan&eacute; s ostatn&iacute;mi u&#382;ivateli</B> webu.',
'info_syndication' => 'syndikace:',
'info_syndication_articles' => '&#269;l&aacute;nek/&#269;l&aacute;nk&#367;',
'info_telecharger' => 'Odeslat z po&#269;&iacute;ta&#269;e:',
'info_telecharger_nouveau_logo' => 'Odeslat nov&eacute; logo:',
'info_telecharger_ordinateur' => 'Odeslat z po&#269;&iacute;ta&#269;e:',
'info_tous_resultats_enregistres' => '[v&#353;echny v&yacute;sledky jsou zaps&aacute;ny]',
'info_tout_afficher' => 'Zobrazit v&#353;e',
'info_travaux_texte' => 'Tyto str&aacute;nky nejsou je&#353;t&#283; nastaveny. Nav&#353;tivte je, pros&iacute;m, pozd&#283;ji...',
'info_travaux_titre' => 'Na webu se pracuje',
'info_trop_resultat' => 'Pro: "@cherche_mot@" bylo zobrazeno p&#345;&iacute;li&#353; mnoho v&yacute;sledk&#367;. Zadejte podrobn&#283;j&#353;&iacute; krit&eacute;ria pro vyhled&aacute;v&aacute;n&iacute;.',
'info_utilisation_messagerie_interne' => 'U tohoto webu pou&#382;&iacute;v&aacute;te syst&eacute;m intern&iacute;ch zpr&aacute;v.',
'info_valider_lien' => 'schv&aacute;lit tento odkaz',
'info_verifier_image' => ', zkontrolujte, zda jste obr&aacute;zky p&#345;enesli spr&aacute;vn&#283;.',
'info_vignette_defaut' => 'V&yacute;choz&iacute; n&aacute;hled',
'info_vignette_personnalisee' => 'Vlastn&iacute; n&aacute;hled',
'info_visite' => 'n&aacute;v&#353;t&#283;vy:',
'info_visites' => 'n&aacute;v&#353;t&#283;vy:',
'info_vos_rendez_vous' => 'Va&#353;e budouc&iacute; sch&#367;zky',
'info_zoom' => 'zv&#283;t&#353;it/zmen&#353;it',
'infos_vos_pense_bete' => 'Va&#353;e pozn&aacute;mky',
'item_breve_proposee' => 'P&#345;edlo&#382;en&eacute; novinky',


// L
'lien_afficher_icones_seuls' => 'Zobrazit pouze ikony',
'lien_afficher_texte_icones' => 'Zobrazit ikony a text',
'lien_afficher_texte_seul' => 'Zobrazit pouze text',
'lien_icones_interface' => 'Ikony rozhran&iacute; jsou od <a href=\'http://jimmac.musichall.cz/\'>Jakuba \'Jimmac\' Steinera</a>.',
'lien_liberer' => 'verze',
'lien_liberer_tous' => 'uvolnit tyto &#269;l&aacute;nky',
'lien_nouvea_pense_bete' => 'NOV&Aacute; POZN&Aacute;MKA',
'lien_nouveau_message' => 'NOV&Aacute; ZPR&Aacute;VA',
'lien_nouvelle_annonce' => 'NOV&Eacute; OZN&Aacute;MEN&Iacute;',
'lien_petitions' => 'PETICE',
'lien_popularite' => 'obl&iacute;benost: @popularite@%',
'lien_racine_site' => 'KO&#344;ENOV&Yacute; ADRES&Aacute;&#344; STR&Aacute;NEK',
'lien_reessayer' => 'zkusit znovu',
'lien_repondre_message' => 'Odpov&#283;d&#283;t na zpr&aacute;vu',
'lien_supprimer' => 'odstranit',
'lien_tout_afficher' => 'Zobrazit v&#353;e',
'lien_visite_site' => 'nav&#353;t&iacute;vit tyto str&aacute;nky',
'lien_visites' => '@visites@ n&aacute;v&#353;t&#283;v',
'lien_voir_auteur' => 'Zobrazit autora',
'login_acces_prive' => 'p&#345;&iacute;stup do neve&#345;ejn&eacute; oblasti',
'login_autre_identifiant' => 'pou&#382;&iacute;t jin&eacute; ID',
'login_connexion_refusee' => 'Spojen&iacute; odm&iacute;tnuto.',
'login_cookie_accepte' => 'Nastavte prohl&iacute;&#382;e&#269; tak, aby je p&#345;ij&iacute;mal (alespo&#328; pro tento web).',
'login_cookie_oblige' => 'Pro bezpe&#269;nou identifikaci mus&iacute; b&yacute;t povoleny soubory cookies.',
'login_deconnexion_ok' => 'Byli jste odhl&aacute;&#353;eni.',
'login_erreur_pass' => 'Nespr&aacute;vn&eacute; heslo.',
'login_espace_prive' => 'neve&#345;ejn&aacute; oblast',
'login_identifiant_inconnu' => 'Identifikace "@login@" je nezn&aacute;m&aacute;.',
'login_login' => 'P&#345;ihl&aacute;&#353;en&iacute;:',
'login_login2' => 'P&#345;ihla&#353;ovac&iacute; &uacute;daje (identifikace pro p&#345;ipojen&iacute; k t&#283;mto str&aacute;nk&aacute;m):',
'login_login_pass_incorrect' => '(Nespr&aacute;vn&eacute; u&#382;ivatelsk&eacute; jm&eacute;no nebo heslo).',
'login_motpasseoublie' => 'zapomn&#283;li jste heslo?',
'login_non_securise' => 'POZOR! Tento formul&aacute;&#345; nen&iacute; zabezpe&#269;en&yacute;.
   Pokud nechcete, aby va&#353;e heslo mohl n&#283;kdo
   b&#283;hem p&#345;enosu po s&iacute;ti zachytit, zapn&#283;te v prohl&iacute;&#382;e&#269;i
   Javascript a',
'login_nouvelle_tentative' => 'Dal&#353;&iacute; pokus',
'login_par_ici' => 'Jste registrov&aacute;ni... takto...',
'login_pass2' => 'Heslo:',
'login_preferez_refuser' => '<b>Nechcete-li soubory cookies povolit</b>, existuje i jin&yacute; (m&eacute;n&#283; bezpe&#269;n&yacute;) zp&#367;sob p&#345;ipojen&iacute;:',
'login_recharger' => 'znovu na&#269;&iacute;st tuto str&aacute;nku',
'login_rester_identifie' => 'Pamatovat moje ID n&#283;kolik dn&iacute;',
'login_retour_public' => 'Zp&#283;t na ve&#345;ejn&eacute; str&aacute;nky',
'login_retour_site' => 'Zp&#283;t na ve&#345;ejn&eacute; str&aacute;nky',
'login_retoursitepublic' => 'zp&#283;t na ve&#345;ejn&eacute; str&aacute;nky',
'login_sans_cookiie' => 'Identifikace bez pou&#382;it&iacute; cookies',
'login_sinscrire' => 'registrovat',
'login_test_navigateur' => 'test prohl&iacute;&#382;e&#269;e/opakovan&eacute; p&#345;ipojen&iacute;',
'login_verifiez_navigateur' => '(P&#345;esv&#283;d&#269;te se v&#353;ak, zda si prohl&iacute;&#382;e&#269; nezapamatoval va&#353;e heslo...)',


// M
'module_fichiers_langues' => 'Jazykov&eacute; soubory',


// N
'navigateur_pas_redirige' => 'Nedojde-li k p&#345;esm&#283;rov&aacute;n&iacute; prohl&iacute;&#382;e&#269;e, klepn&#283;te sem.',


// O
'onglet_affacer_base' => 'Odstranit datab&aacute;zi',
'onglet_auteur' => 'Autor',
'onglet_contenu_site' => 'Obsah webu',
'onglet_evolution_visite_mod' => '&Uacute;rove&#328; n&aacute;v&#353;t&#283;v',
'onglet_fonctions_avances' => 'Roz&#353;&iacute;&#345;en&eacute; funkce',
'onglet_informations_personnelles' => 'Osobn&iacute; &uacute;daje',
'onglet_interactivite' => 'Interaktivita',
'onglet_messagerie' => 'Syst&eacute;m zpr&aacute;v',
'onglet_messages_internes' => 'Intern&iacute; zpr&aacute;vy',
'onglet_messages_publics' => 'Ve&#345;ejn&eacute; zpr&aacute;vy',
'onglet_messages_vide' => 'Zpr&aacute;vy bez textu',
'onglet_origine_visites' => 'P&#367;vod n&aacute;v&#353;t&#283;v',
'onglet_repartition_debut' => 'od po&#269;&aacute;tku',
'onglet_repartition_lang' => 'Rozd&#283;len&iacute; podle jazyk&#367;',
'onglet_repartition_rubrique' => 'Rozd&#283;len&iacute; podle sekc&iacute;',
'onglet_save_restaur_base' => 'Z&aacute;loha/obnova datab&aacute;ze',
'onglet_vider_cache' => 'Vymazat mezipam&#283;t (cache)',
'ortho_trop_de_fautes2' => 'Odstra&#328;te chyby patrn&eacute; na prvn&iacute; pohled a zkuste to znovu.',


// P
'pass_choix_pass' => 'Zadejte nov&eacute; heslo:',
'pass_erreur' => 'Chyba',
'pass_erreur_acces_refuse' => '<b>Chyba:</b> K t&#283;mto str&aacute;nk&aacute;m ji&#382; nem&aacute;te p&#345;&iacute;stup.',
'pass_erreur_code_inconnu' => '<b>Chyba:</b> Zadan&eacute; k&oacute;dy neodpov&iacute;daj&iacute; &#382;&aacute;dn&eacute;mu n&aacute;v&#353;t&#283;vn&iacute;kovi, kter&yacute; m&aacute; k t&#283;mto str&aacute;nk&aacute;m p&#345;&iacute;stup.',
'pass_erreur_non_enregistre' => '<b>Chyba:</b> Adresa <tt>@email_oubli@</tt> nen&iacute; na t&#283;chto str&aacute;nk&aacute;ch zaregistrov&aacute;na.',
'pass_erreur_non_valide' => '<b>Chyba:</b> Neplatn&yacute; e-mail <tt>@email_oubli@</tt>!',
'pass_erreur_probleme_technique' => '<b>Chyba:</b> Z technick&yacute;ch d&#367;vod&#367; nebylo mo&#382;n&eacute; e-mail odeslat.',
'pass_espace_prive_bla' => 'Neve&#345;ejn&aacute; oblast str&aacute;nek je n&aacute;v&#353;t&#283;vn&iacute;k&#367;m
p&#345;&iacute;stupn&aacute; po registraci. Jakmile se zaregistrujete,
budete moci korigovat rozpracovan&eacute; &#269;l&aacute;nky,
p&#345;edkl&aacute;dat &#269;l&aacute;nky ke schv&aacute;len&iacute; a budete se moci &uacute;&#269;astnit diskusn&iacute;ch skupin.',
'pass_forum_bla' => 'Po&#382;&aacute;dali jste o &uacute;&#269;ast v diskusn&iacute; skupin&#283;,
kter&aacute; je vyhrazena registrovan&yacute;m u&#382;ivatel&#367;m.',
'pass_indiquez_cidessous' => 'D&aacute;le zadejte elektronickou adresu, pod kterou
jste ji&#382; zaregistrov&aacute;ni. Obdr&#382;&iacute;te
e-mail, kde bude vysv&#283;tleno, jak
z&iacute;sk&aacute;te p&#345;&iacute;stup zp&#283;t.',
'pass_mail_passcookie' => '(toto je automatick&aacute; zpr&aacute;va)
P&#345;&iacute;stup ke str&aacute;nk&aacute;m
@nom_site_spip@ (@adresse_site@)

z&iacute;sk&aacute;te p&#345;echodem na adresu:

    @sendcookie@

Tam zad&aacute;te nov&eacute; heslo
a znovu se ke str&aacute;nk&aacute;m p&#345;ipoj&iacute;te.

',
'pass_mot_oublie' => 'Zapomenut&eacute; heslo',
'pass_nouveau_enregistre' => 'Nov&eacute; heslo bylo zaps&aacute;no.',
'pass_nouveau_pass' => 'Nov&eacute; heslo',
'pass_ok' => 'V po&#345;&aacute;dku',
'pass_oubli_mot' => 'Zapomenut&eacute; heslo',
'pass_quitter_fenetre' => 'Odej&iacute;t z tohoto okna',
'pass_rappel_login' => 'P&#345;ipomenut&iacute;: Va&#353;e u&#382;ivatelsk&eacute; jm&eacute;no (login) je "@login@".',
'pass_recevoir_mail' => 'Obdr&#382;&iacute;te e-mail s vysv&#283;tlen&iacute;m, jak znovu z&iacute;skat p&#345;&iacute;stup k t&#283;mto str&aacute;nk&aacute;m.',
'pass_retour_public' => 'Zp&#283;t na ve&#345;ejn&#283; p&#345;&iacute;stupn&eacute; str&aacute;nky',
'pass_rien_a_faire_ici' => 'Tady nen&iacute; co d&#283;lat :-).',
'pass_vousinscrire' => 'Registrace p&#345;&iacute;stupu na str&aacute;nky',
'precedent' => 'p&#345;edchoz&iacute;',
'previsualisation' => 'N&aacute;hled',
'previsualiser' => 'N&aacute;hled',


// S
'stats_visites_et_popularite' => 'po&#269;et n&aacute;v&#353;t&#283;v: @visites@; obl&iacute;benost: @popularite@',
'suivant' => 'dal&#353;&iacute;',


// T
'taille_ko' => '@taille@&nbsp;kb',
'taille_mo' => '@taille@&nbsp;Mb',
'taille_octets' => '@taille@&nbsp;byt&#367;',
'texte_actualite_site_1' => 'A&#382; se s rozhran&iacute;m obezn&aacute;m&iacute;te, klepn&#283;te na "',
'texte_actualite_site_2' => '&uacute;pln&eacute; rozhran&iacute;',
'texte_actualite_site_3' => '&raquo; ke zp&#345;&iacute;stupn&#283;n&iacute; v&iacute;ce funkc&iacute;.',
'texte_creation_automatique_vignette' => 'Na t&#283;chto str&aacute;nk&aacute;ch je zapnuta automatick&aacute; tvorba n&aacute;hled&#367; a jejich p&#345;edb&#283;&#382;n&eacute; zobrazen&iacute;. Pokud pomoc&iacute; tohoto formul&aacute;&#345;e nainstalujete obr&aacute;zky ve form&aacute;tu @gd_formats@, budou spojeny s n&aacute;hledem, kter&yacute; m&aacute; maxim&aacute;ln&iacute; velikost @taille_preview@ pixel&#367;.',
'texte_documents_associes' => 'S &#269;l&aacute;nkem jsou spojeny n&aacute;sleduj&iacute;c&iacute; dokumenty,
    je&#382; v&#353;ak do n&#283;j nejsou p&#345;&iacute;mo
    vlo&#382;eny. Podle ve&#345;ejn&eacute;ho vzhledu str&aacute;nek
    se mohou zobrazit jako p&#345;ilo&#382;en&eacute; dokumenty.',
'texte_erreur_mise_niveau_base' => 'P&#345;i aktualizaci datab&aacute;ze do&#353;lo k chyb&#283;.
      Obr&aacute;zek <B>@fichier@</B> nebylo mo&#382;n&eacute; p&#345;edat (&#269;l&aacute;nek @id_article@).<p>
      Pe&#269;liv&#283; si poznamenejte toto &#269;&iacute;slo, zkuste aktualizaci
      a p&#345;esv&#283;d&#269;te se, &#382;e obr&aacute;zky jsou i nad&aacute;le v &#269;l&aacute;nc&iacute;ch
      zobrazeny.',
'texte_inc_auth_1' => 'P&#345;ihl&aacute;sili jsgte se jako
  <B>@auth_login@</B>, ale toto u&#382;ivatelsk&eacute; jm&eacute;no (ji&#382;) v datab&aacute;zi neexistuje. 
  Zkuste',
'texte_inc_auth_2' => 'znovu p&#345;ipojit',
'texte_inc_auth_3' => 'po opu&#353;t&#283;n&iacute;
  restartujte v p&#345;&iacute;pad&#283; pot&#345;eby prohl&iacute;&#382;e&#269;.',
'texte_inc_config' => 'N&iacute;&#382;e uveden&eacute; &uacute;pravy v&yacute;znamn&#283; ovliv&#328;uj&iacute;
  fungov&aacute;n&iacute; webu. M&#283;nit tato nastaven&iacute; by m&#283;li jenom u&#382;ivatel&eacute;, kte&#345;&iacute; dob&#345;e v&#283;d&iacute;,
 jak syst&eacute;m SPIP funguje. <P align="justify"><B>Obecn&#283;
 plat&iacute;, &#382;e s t&#283;mito str&aacute;nkami by m&#283;l pracovat pouze hlavn&iacute; spr&aacute;vce va&#353;eho webu.</b>',
'texte_inc_meta_1' => 'P&#345;i pokusu o z&aacute;pis do souboru  <code>@fichier@</code> do&#353;lo k syst&eacute;mov&eacute; chyb&#283;. Jako&#382;to spr&aacute;vce webu',
'texte_inc_meta_2' => 'zkontrolujte opr&aacute;vn&#283;n&iacute; k z&aacute;pisu ',
'texte_inc_meta_3' => 'do adres&aacute;&#345;e <code>@repertoire@</code>.',
'texte_statut_en_cours_redaction' => 'rozpracovan&eacute; &uacute;pravy',
'texte_statut_poubelle' => 'v ko&#353;i',
'texte_statut_propose_evaluation' => 'p&#345;edlo&#382;eno ke schv&aacute;len&iacute;',
'texte_statut_publie' => 'zve&#345;ejn&#283;no online',
'texte_statut_refuse' => 'odm&iacute;tnuto',
'titre_ajouter_mot_cle' => 'P&#344;IDAT KL&Iacute;&#268;OV&Eacute; SLOVO:',
'titre_breve_proposee' => 'P&#345;edlo&#382;en&aacute; novinka',
'titre_breve_publiee' => 'Novinka zve&#345;ejn&#283;na',
'titre_breve_refusee' => 'Novinka zam&iacute;tnuta',
'titre_cadre_raccourcis' => 'KL&Aacute;VESOV&Eacute; ZKRATKY:',
'titre_changer_couleur_interface' => 'Zm&#283;na barvy rozhran&iacute;',
'titre_forum' => 'Diskusn&iacute; skupina',
'titre_image_admin_article' => 'M&aacute;te mo&#382;nost spr&aacute;vy tohoto &#269;l&aacute;nku',
'titre_image_administrateur' => 'Spr&aacute;vce',
'titre_image_aide' => 'N&aacute;pov&#283;da k polo&#382;ce',
'titre_image_auteur_supprime' => 'Autor odstran&#283;n',
'titre_image_redacteur' => 'Redaktor bez p&#345;&iacute;stupu',
'titre_image_redacteur_02' => 'Redaktor',
'titre_image_visiteur' => 'N&aacute;v&#353;t&#283;vn&iacute;k',
'titre_joindre_document' => 'P&#344;IPOJIT DOKUMENT',
'titre_liens_entrants' => 'P&#345;&iacute;choz&iacute; odkazy',
'titre_mots_cles' => 'KL&Iacute;&#268;OV&Aacute; SLOVA',
'titre_probleme_technique' => 'Varov&aacute;n&iacute;: Z technick&yacute;ch d&#367;vod&#367; (server MySQL) je tato &#269;&aacute;st webu nep&#345;&iacute;stupn&aacute;.<p>D&#283;kujeme v&aacute;m za pochopen&iacute;.',
'titre_publier_document' => 'ZVE&#344;EJNIT DOKUMENT V T&Eacute;TO &#268;&Aacute;STI',
'titre_statistiques' => 'Statistiky str&aacute;nek',
'titre_titre_document' => 'N&aacute;zev dokumentu:',
'trad_reference' => '(referen&#269;n&iacute; &#269;l&aacute;nek)',


// U
'upload_fichier_zip' => 'Komprimovan&yacute; soubor ZIP',
'upload_fichier_zip_texte' => 'Chcete nainstalovat komprimovan&yacute; soubor ZIP.',
'upload_fichier_zip_texte2' => 'Tento soubor m&#367;&#382;e b&yacute;t:',
'upload_limit' => 'Soubor je pro server p&#345;&iacute;li&#353; velk&yacute;. Maxim&aacute;ln&iacute; povolen&aacute; velikost pro <i>odesl&aacute;n&iacute;</i> je @max at .',
'upload_zip_decompacter' => 'rozbalen&yacute; a ka&#382;d&yacute; ze soubor&#367; v n&#283;m obsa&#382;en&yacute; bude na web nainstalov&aacute;n. Budou nainstalov&aacute;ny tyto soubory:',
'upload_zip_telquel' => 'nainstalovat tak, jak je, tedy ve form&aacute;tu ZIP;',


// Z
'zbug_balise_b_aval' => ': tag B je p&#345;&iacute;li&#353; pozd&#283; ve smy&#269;ce',
'zbug_boucle' => 'smy&#269;ka',
'zbug_boucle_recursive_undef' => 'nedefinovan&aacute; rekurzivn&iacute; smy&#269;ka',
'zbug_champ_hors_boucle' => 'Pole @champ@ je mimo smy&#269;ku',
'zbug_champ_hors_motif' => 'Pole @champ@ je mimo smy&#269;ku a m&aacute; tag @motif@',
'zbug_code' => 'k&oacute;d',
'zbug_critere_inconnu' => 'nezn&aacute;m&aacute; podm&iacute;nka @critere@',
'zbug_distant_interdit' => 'extern&iacute; data jsou zak&aacute;z&aacute;na',
'zbug_erreur_boucle_double' => 'SMY&#268;KA at id@: dvoj&iacute; definice',
'zbug_erreur_boucle_fermant' => 'SMY&#268;KA at id@: chyb&iacute; uzav&iacute;rac&iacute; tag',
'zbug_erreur_boucle_syntaxe' => 'Nespr&aacute;vn&aacute; syntax (BOUCLE)',
'zbug_erreur_execution_page' => 'chyba p&#345;i v&yacute;po&#269;tu str&aacute;nky',
'zbug_erreur_filtre' => 'Chyba - nedefinovan&yacute; filtr: <b>"@filtre@"</b>',
'zbug_erreur_meme_parent' => '{meme_parent} t&yacute;k&aacute; se jenom smy&#269;ek (FORUMS) a (RUBRIQUES)',
'zbug_erreur_squelette' => 'Chyba &#269;i chyby v &#353;ablon&#283;',
'zbug_info_erreur_squelette' => 'Na webu do&#353;lo k chyb&#283;',
'zbug_inversion_ordre_inexistant' => 'obr&aacute;cen&eacute; nebo neexistuj&iacute;c&iacute; po&#345;ad&iacute;',
'zbug_parametres_inclus_incorrects' => 'Nespr&aacute;vn&eacute; parametry inkluze',
'zbug_resultat' => 'v&yacute;sledky',
'zbug_serveur_indefini' => 'Nedefinovan&yacute; server SQL',
'zbug_table_inconnue' => 'Nezn&aacute;m&aacute; tabulka SQL "@table@"'

);


?>

--- NEW FILE: public_cs.php3 ---
<?php

// This is a SPIP language file  --  Ceci est un fichier langue de SPIP

$GLOBALS[$GLOBALS['idx_lang']] = array(


// A
'accueil_site' => 'Hlavn&iacute; strana',
'articles' => '&#268;l&aacute;nky',
'articles_auteur' => '&#268;l&aacute;nky tohoto autora',
'articles_populaires' => 'Nej&#269;ten&#283;j&#353;&iacute; &#269;l&aacute;nky',
'articles_recents' => 'Ned&aacute;vn&eacute; &#269;l&aacute;nky',
'articles_rubrique' => '&#268;l&aacute;nky v t&eacute;to rubrice',
'aucun_article' => 'Na t&eacute;to adrese nen&iacute; &#382;&aacute;dn&yacute; &#269;l&aacute;nek',
'aucun_auteur' => 'Na t&eacute;to adrese nen&iacute; &#382;&aacute;dn&yacute; autor',
'aucun_site' => 'Na t&eacute;to adrese nen&iacute; &#382;&aacute;dn&yacute; odkaz',
'aucune_breve' => 'Na t&eacute;to adrese nen&iacute; &#382;&aacute;dn&aacute; novinka',
'aucune_rubrique' => 'Na t&eacute;to adrese nen&iacute; &#382;&aacute;dn&aacute; rubrika',
'autres_breves' => 'Dal&#353;&iacute; novinky',
'autres_groupes_mots_clefs' => 'Dal&#353;&iacute; skupiny kl&iacute;&#269;ov&yacute;ch slov',
'autres_sites' => 'Dal&#353;&iacute; odkazy',


// B
'bonjour' => 'Dobr&yacute; den',
'breves' => 'Novinky',


// C
'commenter_site' => 'Koment&aacute;&#345; k tomuto odkazu',


// D
'date' => 'Datum',
'dernier_ajout' => 'Posledn&iacute; p&#345;&iacute;sp&#283;vky',
'dernieres_breves' => 'Posledn&iacute; novinky',
'derniers_articles' => 'Posledn&iacute; &#269;l&aacute;nky',
'derniers_commentaires' => 'Posledn&iacute; koment&aacute;&#345;e',
'derniers_messages_forum' => 'Posledn&iacute; p&#345;&iacute;sp&#283;vky v diskusn&iacute;ch f&oacute;rech',


// E
'edition_mode_texte' => 'Textov&yacute; re&#382;im',
'en_reponse' => 'Odpov&#283;&#271; na:',
'en_resume' => 'Shrnut&iacute;',
'envoyer_message' => 'Odeslat zpr&aacute;vu',
'espace_prive' => 'Vstup pro autory',


// F
'forum' => 'F&oacute;rum',


// H
'hierarchie_site' => 'Struktura str&aacute;nek',


// J
'jours' => 'dn&#367;',


// M
'meme_auteur' => 'Od stejn&eacute;ho autora',
'meme_rubrique' => 'Ve stejn&eacute; rubrice',
'memes_auteurs' => 'Od stejn&yacute;ch autor&#367;',
'message' => 'Zpr&aacute;va',
'messages_forum' => 'Zpr&aacute;vy v diskusn&iacute;m f&oacute;ru',
'messages_recents' => 'Posledn&iacute; zpr&aacute;vy v diskusn&iacute;ch f&oacute;rech',
'mots_clefs' => 'Kl&iacute;&#269;ov&aacute; slova',
'mots_clefs_meme_groupe' => 'Kl&iacute;&#269;ov&aacute; slova ve stejn&eacute; skupin&#283;',


// N
'navigation' => 'Navigace',
'nom' => 'Jm&eacute;no',
'nouveautes' => 'Co je nov&eacute;ho',
'nouveautes_web' => 'Novinky na webu',
'nouveaux_articles' => 'Nov&eacute; &#269;l&aacute;nky',
'nouvelles_breves' => 'Nov&eacute; novinky',


// P
'page_precedente' => 'p&#345;edchoz&iacute; strana',
'page_suivante' => 'dal&#353;&iacute; strana',
'par_auteur' => 'napsal(a)',
'participer_site' => 'M&#367;&#382;ete se aktivn&#283; zapojit a napsat n&#283;jak&yacute; &#269;l&aacute;nek pro tento web - zaregistrujte se n&iacute;&#382;e. Okam&#382;it&#283; obdr&#382;&iacute;te e-mail s p&#345;&iacute;stupov&yacute;mi k&oacute;dy do &#269;&aacute;sti pro autory.',
'plan_du_site' => 'Mapa str&aacute;nek',
'plan_site' => 'Mapa str&aacute;nek',
'popularite' => 'Popularita',
'poster_message' => 'Napsat zpr&aacute;vu',
'proposer_site' => 'M&#367;&#382;ete navrhnout odkaz, kter&yacute; m&aacute; b&yacute;t za&#345;azen do t&eacute;to rubriky:',


// R
'repondre_article' => 'Reagovat na tento &#269;l&aacute;nek',
'repondre_breve' => 'Reagovat na tuto novinku ',
'repondre_message' => 'Reagovat na tuto zpr&aacute;vu',
'resultats_recherche' => 'V&yacute;sledky hled&aacute;n&iacute;',
'retour_debut_forums' => 'Zp&#283;t na za&#269;&aacute;tek diskusn&iacute;ch f&oacute;r',
'rubrique' => 'Rubrika',
'rubriques' => 'Rubriky',


// S
'signatures_petition' => 'Podpisy',
'site_realise_avec_spip' => 'Str&aacute;nky vytvo&#345;eny pomoc&iacute; SPIP',
'sites_web' => 'Odkazy',
'sous_rubriques' => 'Podrubriky',
'suite' => 'pokra&#269;ov&aacute;n&iacute;',
'sur_web' => 'Na webu',
'syndiquer_rubrique' => 'Zahrnout tuto rubriku',
'syndiquer_site' => 'Zahrnout cel&yacute; web',


// T
'texte_lettre_information' => 'Zde je zpravodaj tohoto webu',
'texte_lettre_information_2' => 'Tento soupis sumarizuje &#269;l&aacute;nky a novinky publikovan&eacute; od ',


// V
'ver_imprimer' => 'Verze pro tisk',
'voir_en_ligne' => 'Pod&iacute;vejte se online'

);


?>



From stef at berlios.de  Fri Feb 17 01:45:54 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 01:45:54 +0100
Subject: [Spip-carto-cvs] spipcarto carto.php3,1.6.2.1,1.6.2.2
Message-ID: <200602170045.k1H0jsbx016217@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto
In directory sheep:/tmp/cvs-serv16122

Modified Files:
      Tag: BRANCH-V1
	carto.php3 
Log Message:
encore plus mieux int?gr? et en plus, ca marche !
(bug inclure_ecrire / declarations de boucles)

Index: carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/carto.php3,v
retrieving revision 1.6.2.1
retrieving revision 1.6.2.2
diff -u -d -r1.6.2.1 -r1.6.2.2
--- carto.php3	30 Sep 2005 22:08:45 -0000	1.6.2.1
+++ carto.php3	17 Feb 2006 00:45:52 -0000	1.6.2.2
@@ -36,28 +36,42 @@
 ? -
 *
 \***************************************************************************/
+// Appel spip
+if (!function_exists('find_in_path')) {
+	define('_SPIP_PAGE',1); # ne pas mourir si on passe le $fond
+	include ('ecrire/inc_version.php3');
+}
 //specifier ici le nom du sous repertoire du dossier squelette contenant
 //les squelettes de carte
-$rep_fond="template";
+//squelettes de carte disponibles 
+//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
+$rep_fond=$GLOBALS['rep_cartes'];
 //  valeurs par defaut
 //$delai=24*3600;
 
 $flag_preserver = true;
 
-if (isset($contexte_inclus['fond'])) {
-	if (strstr($contexte_inclus['fond'], '..'))
-		die ("Faut pas se gener");
-	else
-		$fond = $rep_fond."/carto_".$contexte_inclus['fond'];
+if (isset($contexte_inclus['fond'])&&($contexte_inclus['fond']!="")){
+		if (strstr($fond, '/')
+		OR preg_match(',^formulaire_,i', $fond))
+			die ("Faut pas se gener");
+		else $fond = $rep_fond."/carto_".$contexte_inclus['fond'];
 }
-else if (isset($_GET["fond"])&&($_GET["fond"]!="")) {
-	if (strstr($_GET['fond'], '..'))
-		die ("Faut pas se gener");
-	else	
-		$fond = $rep_fond."/carto_".$_GET["fond"];
+elseif (isset($_GET["fond"])&&($_GET["fond"]!="")){
+		if (strstr($fond, '/')
+		OR preg_match(',^formulaire_,i', $fond))
+			die ("Faut pas se gener");
+		else $fond = $rep_fond."/carto_".$_GET["fond"];
 }
 else $fond = $rep_fond."/carto";
-if (isset($contexte_inclus['delais'])) $delais = $contexte_inclus['delais'];
+
+// Securite 
+if (!find_in_path("$fond.html")) {
+	spip_log("carto.php3: find_in_path ne trouve pas le squelette $fond");
+	$fond = '404';
+}
+
+if (isset($contexte_inclus['delais'])) $delais = intval($contexte_inclus['delais']);
 
 include ("inc-public.php3");
 



From stef at berlios.de  Fri Feb 17 01:45:52 2006
From: stef at berlios.de (stef at berlios.de)
Date: Fri, 17 Feb 2006 01:45:52 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire mes_options.php3,1.8.2.7,1.8.2.8 carto_mes_options.php3,1.1.2.1,1.1.2.2
Message-ID: <200602170046.k1H0jqbx016210@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv16122/ecrire

Modified Files:
      Tag: BRANCH-V1
	mes_options.php3 carto_mes_options.php3 
Log Message:
encore plus mieux int?gr? et en plus, ca marche !
(bug inclure_ecrire / declarations de boucles)

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8.2.7
retrieving revision 1.8.2.8
diff -u -d -r1.8.2.7 -r1.8.2.8
--- mes_options.php3	16 Feb 2006 23:06:12 -0000	1.8.2.7
+++ mes_options.php3	17 Feb 2006 00:45:46 -0000	1.8.2.8
@@ -1,7 +1,12 @@
 <?php
 $GLOBALS['dossier_squelettes']="/squelettes";
 
-include_ecrire("carto_mes_options.php3");
+//squelettes de carte disponibles 
+//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
+$GLOBALS['rep_cartes']="template";
+$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
+include("carto_mes_options.php3");
+include_ecrire("inc_carto_fonctions.php3");
 include_ecrire("carto_mots_possibles.php3");
 include_ecrire("mots_possibles.php3");
 ?>

Index: carto_mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/Attic/carto_mes_options.php3,v
retrieving revision 1.1.2.1
retrieving revision 1.1.2.2
diff -u -d -r1.1.2.1 -r1.1.2.2
--- carto_mes_options.php3	14 Feb 2006 01:34:47 -0000	1.1.2.1
+++ carto_mes_options.php3	17 Feb 2006 00:45:46 -0000	1.1.2.2
@@ -186,33 +186,11 @@
 	return calculer_boucle($id_boucle, $boucles); 
 }
 
-//fonctions de transformation
-include_ecrire("inc_carto_fonctions.php3");
 
 //appel du plugin en dernier (peut g?n?rer du javascript)
 function apres_tout($texte) {
 	include_ecrire('plugins/plug_carto.php');
     return apres_tout_carto($texte);
 }
-
-//squelettes de carte disponibles 
-//(preview dans cartes.php3 et raccourcis dans carte_edit.php3)
-$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
-
-$choses_possibles['carto_objets'] = array(
-									  'titre_chose' => 'Objets',
-									  'id_chose' => 'id_carto_objet',
-									  'table_principale' => 'spip_carto_objets',
-									  
-									  'table_carte' => 'spip_carto_cartes',
-									  'tables_limite' => array(
-															   'carto_objets' => array(
-																				   'table' => 'spip_carto_objets',
-																				   'nom_id' => 'id_carto_objet'),
-															   'carto_cartes' => array(
-																					'table' => 'spip_carto_objets',
-																					'nom_id' =>  'id_carto_carte'),
-															   )
-									  );
-		
+	
 ?>



From stef at berlios.de  Tue Feb 28 14:34:51 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 28 Feb 2006 14:34:51 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_version.php3,1.12.2.4,1.12.2.5
Message-ID: <200602281334.k1SDYpbx030770@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv30746/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_version.php3 
Log Message:
encore un petit patch de securit?

Index: inc_version.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_version.php3,v
retrieving revision 1.12.2.4
retrieving revision 1.12.2.5
diff -u -d -r1.12.2.4 -r1.12.2.5
--- inc_version.php3	14 Feb 2006 01:11:07 -0000	1.12.2.4
+++ inc_version.php3	28 Feb 2006 13:34:45 -0000	1.12.2.5
@@ -1021,7 +1021,7 @@
 // qq  fonctions service pour les 2 niveaux
 //
 function calculer_hierarchie($id_rubrique, $exclure_feuille = false) {
-	if (!$id_rubrique)
+	if (!$id_rubrique = intval($id_rubrique))
 		return '0';
 	if (!$exclure_feuille)
 		$hierarchie = ",$id_rubrique";



From stef at berlios.de  Tue Feb 28 14:35:56 2006
From: stef at berlios.de (stef at berlios.de)
Date: Tue, 28 Feb 2006 14:35:56 +0100
Subject: [Spip-carto-cvs] spipcarto/ecrire inc_documents.php3,1.7.2.4,1.7.2.5
Message-ID: <200602281335.k1SDZubx030944@sheep.berlios.de>

Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv30914/ecrire

Modified Files:
      Tag: BRANCH-V1
	inc_documents.php3 
Log Message:
patch documents distants (pour permettre de specifier la taille)

Index: inc_documents.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_documents.php3,v
retrieving revision 1.7.2.4
retrieving revision 1.7.2.5
diff -u -d -r1.7.2.4 -r1.7.2.5
--- inc_documents.php3	14 Feb 2006 01:11:06 -0000	1.7.2.4
+++ inc_documents.php3	28 Feb 2006 13:35:53 -0000	1.7.2.5
@@ -432,9 +432,10 @@
 	AND $type = @spip_fetch_array($r))
 			$type_inclus = $type['inclus'];
 
-	if (($type_inclus == "embed"  #meme pour le MP3 : "l x h pixels"? 
-	OR $type_inclus == "image")
-	AND $document['largeur']*$document['hauteur']) {
+    if (($type_inclus == "embed"  #meme pour le MP3 : "l x h pixels"?
+    OR $type_inclus == "image")
+        AND ($document['largeur'] * $document['hauteur']
+        OR $document['distant'] == 'oui')) {
 		echo "<br /><b>"._T('entree_dimensions')."</b><br />\n";
 		echo "<input type='text' name='largeur_document' class='fondl' style='font-size:9px;' value=\"".$document['largeur']."\" size='5'>";
 		echo " &#215; <input type='text' name='hauteur_document' class='fondl' style='font-size:9px;' value=\"".$document['hauteur']."\" size='5'> "._T('info_pixels');



