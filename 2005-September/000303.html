<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.2,1.18.2.3 mes_options.php3,1.8,1.8.2.1 inc_carto.php3,1.21.2.1,1.21.2.2
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/spip-carto-cvs/2005-September/index.html" >
   <LINK REL="made" HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20spipcarto/ecrire%20carte_edit.php3%2C1.18.2.2%2C1.18.2.3%20mes_options.php3%2C1.8%2C1.8.2.1%20inc_carto.php3%2C1.21.2.1%2C1.21.2.2&In-Reply-To=%3C200509292343.j8TNh2mq024716%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000304.html">
   <LINK REL="Next"  HREF="000305.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.2,1.18.2.3 mes_options.php3,1.8,1.8.2.1 inc_carto.php3,1.21.2.1,1.21.2.2</H1>
    <B>stef at berlios.de</B> 
    <A HREF="mailto:spip-carto-cvs%40lists.berlios.de?Subject=Re%3A%20%5BSpip-carto-cvs%5D%20spipcarto/ecrire%20carte_edit.php3%2C1.18.2.2%2C1.18.2.3%20mes_options.php3%2C1.8%2C1.8.2.1%20inc_carto.php3%2C1.21.2.1%2C1.21.2.2&In-Reply-To=%3C200509292343.j8TNh2mq024716%40sheep.berlios.de%3E"
       TITLE="[Spip-carto-cvs] spipcarto/ecrire carte_edit.php3,1.18.2.2,1.18.2.3 mes_options.php3,1.8,1.8.2.1 inc_carto.php3,1.21.2.1,1.21.2.2">stef at berlios.de
       </A><BR>
    <I>Fri Sep 30 01:43:02 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000304.html">[Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1.2.1,1.1.2.2 spipcarto_en.php3,1.1.2.2,1.1.2.3
</A></li>
        <LI>Next message: <A HREF="000305.html">[Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6.2.1,1.6.2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#303">[ date ]</a>
              <a href="thread.html#303">[ thread ]</a>
              <a href="subject.html#303">[ subject ]</a>
              <a href="author.html#303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Update of /cvsroot/spip-carto/spipcarto/ecrire
In directory sheep:/tmp/cvs-serv24645/ecrire

Modified Files:
      Tag: BRANCH-V1
	carte_edit.php3 mes_options.php3 inc_carto.php3 
Log Message:
gestion des squelettes de cartes et raccourcis cliquables

Index: carte_edit.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/carte_edit.php3,v
retrieving revision 1.18.2.2
retrieving revision 1.18.2.3
diff -u -d -r1.18.2.2 -r1.18.2.3
--- carte_edit.php3	29 Sep 2005 21:18:35 -0000	1.18.2.2
+++ carte_edit.php3	29 Sep 2005 23:42:58 -0000	1.18.2.3
@@ -177,12 +177,10 @@
 echo &quot;&lt;br&gt;&lt;font face='Verdana,Arial,Sans,sans-serif' size='6'&gt;&lt;b&gt;$id_carte&lt;/b&gt;&lt;/font&gt;\n&quot;;
 if ($url_carte &amp;&amp; ($new!=&quot;oui&quot;)) {
 	echo &quot;&lt;br&gt;&lt;font face='Verdana,Arial,Sans,sans-serif' size='1'&gt;&lt;b&gt;&quot;._T('spipcarto:carte_apercu').&quot;&lt;/b&gt;&lt;/font&gt;\n&quot;;
-	icone_horizontale( _T('spipcarto:carte_img'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
-	icone_horizontale( _T('spipcarto:carte_lien'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=lien&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
-	icone_horizontale( _T('spipcarto:carte_logo'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=logo&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
-	icone_horizontale( _T('spipcarto:carte_svg'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=svg&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
-	icone_horizontale( _T('spipcarto:carte_svgx'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=svgx&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
-	icone_horizontale( _T('spipcarto:carte_svggeo'), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=geosvgwms&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
+	$sq_cartes=$GLOBALS['sq_cartes'];
+	if (!is_array($sq_cartes)) $sq_cartes=array('map');
+	foreach ($sq_cartes as $sq_carte)
+		icone_horizontale( _T('spipcarto:carte_'.$sq_carte), &quot;../carto.php3?id_carto_carte=&quot;.$id_carte.&quot;&amp;fond=&quot;.$sq_carte.&quot;&amp;var_mode=recalcul&quot;, &quot;racine-24.gif&quot;, &quot;rien.gif&quot;);
 }
 echo &quot;&lt;/div&gt;\n&quot;;
 

Index: mes_options.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/mes_options.php3,v
retrieving revision 1.8
retrieving revision 1.8.2.1
diff -u -d -r1.8 -r1.8.2.1
--- mes_options.php3	24 Sep 2005 01:00:22 -0000	1.8
+++ mes_options.php3	29 Sep 2005 23:42:58 -0000	1.8.2.1
@@ -161,6 +161,8 @@
 	include_ecrire('plugins/plug_carto.php');
     return apres_tout_carto($texte);
 }
+$GLOBALS['sq_cartes']=array('map','logo','lien','svg','svgx','geosvgwms');
+			
 //////////////////////////////////////////////////
 //////////////////////////////////////////////////
 ?&gt;

Index: inc_carto.php3
===================================================================
RCS file: /cvsroot/spip-carto/spipcarto/ecrire/inc_carto.php3,v
retrieving revision 1.21.2.1
retrieving revision 1.21.2.2
diff -u -d -r1.21.2.1 -r1.21.2.2
--- inc_carto.php3	29 Sep 2005 21:14:03 -0000	1.21.2.1
+++ inc_carto.php3	29 Sep 2005 23:42:58 -0000	1.21.2.2
@@ -108,7 +108,7 @@
 		echo &quot;&lt;/table&gt;&quot;;
 		echo &quot;&lt;/div&gt;\n&quot;;
 	}
-	return $tous_id;
+	return;// $tous_id;
 }
 
 
@@ -302,39 +302,50 @@
 
 	echo debut_block_invisible(&quot;ajouter_carte&quot;);
 	echo &quot;&lt;div class='verdana2'&gt;&quot;;
-	echo _T(&quot;spipcarto:carte_insert_desc&quot;);
+	echo _T(&quot;spipcarto:carte_insert_texte&quot;);
 	echo &quot;&lt;/div&gt;&quot;;
 
+	$cartes_article=array();
+	$query = &quot;SELECT id_carto_carte FROM spip_carto_cartes_articles where id_article=&quot;.$id_article;
+	$result = spip_query($query);
+	while($ligne=spip_fetch_array($result)) {
+		$cartes_article[]=$ligne[0];
+	}
 	$query = &quot;SELECT id_carto_carte, titre FROM spip_carto_cartes ORDER BY titre&quot;;
 	$result = spip_query($query);
 	if (spip_num_rows($result)) {
 		echo &quot;&lt;br /&gt;\n&quot;;
-		echo &quot;&lt;div class='bandeau_rubriques' style='z-index: 1;'&gt;&quot;;
-		echo &quot;&lt;div class='plan-articles'&gt;&quot;;
 		while ($row = spip_fetch_array($result)) {
 			$id_carte = $row['id_carto_carte'];
+			$inclus=(in_array($id_carte,$cartes_article));
 			$titre = typo($row['titre']);
 			
 			$link = new Link(&quot;carte_edit.php3&quot;);
 			$link-&gt;addVar(&quot;id_carte&quot;, $id_carte);
 			$link-&gt;addVar(&quot;retour&quot;, $GLOBALS['clean_link']-&gt;getUrl());
-			echo &quot;&lt;a href='&quot;.$link-&gt;getUrl().&quot;'&gt;&quot;;
-			echo $titre.&quot;&lt;/a&gt;\n&quot;;
-			echo &quot;&lt;div class='arial1' align='$spip_lang_right' style='color: black; padding-$spip_lang_left: 4px;' &quot;.
+			echo &quot;&lt;div class='verdana3' style='border:1px;background-color: $couleur_claire;'&gt;&quot;;
+			echo bouton_block_invisible(&quot;lien_carte$id_carte&quot;);
+			echo &quot;&lt;a href='&quot;.$link-&gt;getUrl().&quot;'&gt;&quot;.$titre.&quot;&lt;/a&gt;\n&quot;;
+			echo debut_block_invisible(&quot;lien_carte$id_carte&quot;);
+			echo &quot;&lt;div class='arial1' align='$spip_lang_right' style='background-color: white;color: black; padding: 2px;margin: 0px;' &quot;.
 				&quot;title=\&quot;&quot;._T(&quot;spipcarto:carte_raccourci&quot;).
 				&quot;\&quot;&gt;&quot;;
-			echo &quot;&lt;font color='333333'&gt;&quot;;
-			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_simple&quot;).&quot; &lt;map$id_carte&gt;&lt;/div&gt;&quot;;
-			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_logo&quot;).&quot; &lt;map$id_carte|logo&gt;&lt;/div&gt;&quot;;
-			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_lien&quot;).&quot; &lt;map$id_carte|lien&gt;&lt;/div&gt;&quot;;
-			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_svg&quot;).&quot; &lt;map$id_carte|svg&gt;&lt;/div&gt;&quot;;
- 			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_svgx&quot;).&quot; &lt;map$id_carte|svgx&gt;&lt;/div&gt;&quot;;
-			echo &quot;&lt;div align='right'&gt;&quot;._T(&quot;spipcarto:carte_svggeo&quot;).&quot; &lt;map$id_carte|svggeo&gt;&lt;/div&gt;&quot;;
-			echo &quot;&lt;/font&gt;\n&quot;;
+			//liste des squelettes disponible : dans mes_options
+			$sq_cartes=$GLOBALS['sq_cartes'];
+			if (!is_array($sq_cartes)) $sq_cartes=array('map');
+			foreach ($sq_cartes as $sq_carte){
+				echo &quot;&lt;div align='right' style='color:#333333'&quot;;
+				if ($inclus) echo &quot;style=\&quot;text-weight: bold;\&quot;&gt; &lt;map&quot;.$id_carte.&quot;|&quot;.$sq_carte.&quot;&gt;&quot;;
+				else echo &quot;&gt;&lt;a href=\&quot;javascript:barre_inserer('&lt;map&quot;.$id_carte.&quot;|&quot;.$sq_carte.&quot;&gt;',document.formulaire.texte)\&quot;&gt;&lt;map&quot;.$id_carte.&quot;|&quot;.$sq_carte.&quot;&gt;&lt;/a&gt;&quot;;
+				echo &quot;&lt;/div&gt;&quot;;
+			}
+
+			echo &quot;&lt;/div&gt;&quot;;
+			echo fin_block();
 			echo &quot;&lt;/div&gt;&quot;;
 		}
-		echo &quot;&lt;/div&gt;&quot;;
-		echo &quot;&lt;/div&gt;&quot;;
+	//	echo &quot;&lt;/div&gt;&quot;;
+	//	echo &quot;&lt;/div&gt;&quot;;
 	}
 
 	// Creer une carte


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000304.html">[Spip-carto-cvs] spipcarto/ecrire/lang spipcarto_fr.php3,1.1.2.1,1.1.2.2 spipcarto_en.php3,1.1.2.2,1.1.2.3
</A></li>
	<LI>Next message: <A HREF="000305.html">[Spip-carto-cvs] spipcarto/ecrire/plugins plug_carto.php,1.6.2.1,1.6.2.2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#303">[ date ]</a>
              <a href="thread.html#303">[ thread ]</a>
              <a href="subject.html#303">[ subject ]</a>
              <a href="author.html#303">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/spip-carto-cvs">More information about the Spip-carto-cvs
mailing list</a><br>
</body></html>
